<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Yocto Project Development Manual</title><link rel="stylesheet" type="text/css" href="css/dev-style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /></head><body><div xml:lang="en" class="book" title="Yocto Project Development Manual" id="dev-manual" lang="en"><div class="titlepage"><div><div><h1 class="title">
            Yocto Project Development Manual
        </h1></div><div><div class="authorgroup">
            <div class="author"><h3 class="author"><span class="firstname">Scott</span> <span class="surname">Rifenbark</span></h3><div class="affiliation">
                    <span class="orgname">Intel Corporation<br /></span>
                </div><code class="email">&lt;<a class="email" href="mailto:srifenbark@gmail.com">srifenbark@gmail.com</a>&gt;</code></div>
        </div></div><div><p class="copyright">Copyright © 2010-2017 Linux Foundation</p></div><div><div class="legalnotice" title="Legal Notice"><a id="idm45900183509808"></a>
      <p>
          Permission is granted to copy, distribute and/or modify this document under
          the terms of the <a class="ulink" href="http://creativecommons.org/licenses/by-sa/2.0/uk/" target="_top">
          Creative Commons Attribution-Share Alike 2.0 UK: England &amp; Wales</a> as published by
          Creative Commons.
      </p>

            <div class="note" title="Manual Notes" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Manual Notes</h3>
                <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        For the latest version of the Yocto Project Development
                        Manual associated with this Yocto Project release
                        (version 2.3),
                        see the Yocto Project Development Manual from the
                        <a class="ulink" href="http://www.yoctoproject.org/documentation" target="_top">Yocto Project documentation page</a>.
                        </p></li><li class="listitem"><p>
                        This version of the manual is version
                        2.3.
                        For later releases of the Yocto Project (if they exist),
                        go to the
                        <a class="ulink" href="http://www.yoctoproject.org/documentation" target="_top">Yocto Project documentation page</a>
                        and use the drop-down "Active Releases" button
                        and choose the Yocto Project version for which you want
                        the manual.
                        </p></li><li class="listitem"><p>
                        For an in-development version of the Yocto Project
                        Development Manual, see
                        <a class="ulink" href="http://www.yoctoproject.org/docs/latest/dev-manual/dev-manual.html" target="_top">http://www.yoctoproject.org/docs/latest/dev-manual/dev-manual.html</a>.
                        </p></li></ul></div>
            </div>
    </div></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="2"><strong>Revision History</strong></th></tr>
            <tr><td align="left">Revision 1.1</td><td align="left">6 October 2011</td></tr><tr><td align="left" colspan="2">The initial document released with the Yocto Project 1.1 Release.</td></tr>
            <tr><td align="left">Revision 1.2</td><td align="left">April 2012</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.2 Release.</td></tr>
            <tr><td align="left">Revision 1.3</td><td align="left">October 2012</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.3 Release.</td></tr>
            <tr><td align="left">Revision 1.4</td><td align="left">April 2013</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.4 Release.</td></tr>
            <tr><td align="left">Revision 1.5</td><td align="left">October 2013</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.5 Release.</td></tr>
            <tr><td align="left">Revision 1.5.1</td><td align="left">January 2014</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.5.1 Release.</td></tr>
            <tr><td align="left">Revision 1.6</td><td align="left">April 2014</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.6 Release.</td></tr>
            <tr><td align="left">Revision 1.7</td><td align="left">October 2014</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.7 Release.</td></tr>
            <tr><td align="left">Revision 1.8</td><td align="left">April 2015</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 1.8 Release.</td></tr>
            <tr><td align="left">Revision 2.0</td><td align="left">October 2015</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 2.0 Release.</td></tr>
            <tr><td align="left">Revision 2.1</td><td align="left">April 2016</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 2.1 Release.</td></tr>
            <tr><td align="left">Revision 2.2</td><td align="left">October 2016</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 2.2 Release.</td></tr>
            <tr><td align="left">Revision 2.3</td><td align="left">May 2017</td></tr><tr><td align="left" colspan="2">Released with the Yocto Project 2.3 Release.</td></tr>
        </table></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#dev-manual-intro">1. The Yocto Project Development Manual</a></span></dt><dd><dl><dt><span class="section"><a href="#dev-intro">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#what-this-manual-provides">1.2. What This Manual Provides</a></span></dt><dt><span class="section"><a href="#what-this-manual-does-not-provide">1.3. What this Manual Does Not Provide</a></span></dt><dt><span class="section"><a href="#other-information">1.4. Other Information</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dev-manual-start">2. Getting Started with the Yocto Project</a></span></dt><dd><dl><dt><span class="section"><a href="#introducing-the-yocto-project">2.1. Introducing the Yocto Project</a></span></dt><dt><span class="section"><a href="#getting-setup">2.2. Getting Set Up</a></span></dt><dt><span class="section"><a href="#building-images">2.3. Building Images</a></span></dt><dt><span class="section"><a href="#flashing-images-using-bmaptool">2.4. Flashing Images Using <code class="filename">bmaptool</code></a></span></dt><dt><span class="section"><a href="#using-pre-built-binaries-and-qemu">2.5. Using Pre-Built Binaries and QEMU</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dev-manual-newbie">3. The Yocto Project Open Source Development Environment</a></span></dt><dd><dl><dt><span class="section"><a href="#open-source-philosophy">3.1. Open Source Philosophy</a></span></dt><dt><span class="section"><a href="#usingpoky-changes-collaborate">3.2. Using the Yocto Project in a Team Environment</a></span></dt><dd><dl><dt><span class="section"><a href="#best-practices-system-configurations">3.2.1. System Configurations</a></span></dt><dt><span class="section"><a href="#best-practices-source-control-management">3.2.2. Source Control Management (SCM)</a></span></dt><dt><span class="section"><a href="#best-practices-autobuilders">3.2.3. Autobuilders</a></span></dt><dt><span class="section"><a href="#best-practices-policies-and-change-flow">3.2.4. Policies and Change Flow</a></span></dt><dt><span class="section"><a href="#best-practices-summary">3.2.5. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#yocto-project-repositories">3.3. Yocto Project Source Repositories</a></span></dt><dt><span class="section"><a href="#yocto-project-terms">3.4. Yocto Project Terms</a></span></dt><dt><span class="section"><a href="#licensing">3.5. Licensing</a></span></dt><dt><span class="section"><a href="#git">3.6. Git</a></span></dt><dd><dl><dt><span class="section"><a href="#repositories-tags-and-branches">3.6.1. Repositories, Tags, and Branches</a></span></dt><dt><span class="section"><a href="#basic-commands">3.6.2. Basic Commands</a></span></dt></dl></dd><dt><span class="section"><a href="#workflows">3.7. Workflows</a></span></dt><dt><span class="section"><a href="#tracking-bugs">3.8. Tracking Bugs</a></span></dt><dt><span class="section"><a href="#how-to-submit-a-change">3.9. How to Submit a Change</a></span></dt><dd><dl><dt><span class="section"><a href="#submit-change-overview">3.9.1. Overview</a></span></dt><dt><span class="section"><a href="#submit-change-submissions-to-poky">3.9.2. Submissions to Poky</a></span></dt><dt><span class="section"><a href="#submit-change-submissions-to-other-layers">3.9.3. Submissions to Other Layers</a></span></dt><dt><span class="section"><a href="#submit-change-patch-submission-details">3.9.4. Patch Submission Details</a></span></dt><dt><span class="section"><a href="#pushing-a-change-upstream">3.9.5. Using Scripts to Push a Change Upstream and Request a Pull</a></span></dt><dt><span class="section"><a href="#submitting-a-patch">3.9.6. Using Email to Submit a Patch</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#dev-manual-model">4. Common Development Models</a></span></dt><dd><dl><dt><span class="section"><a href="#system-development-model">4.1. System Development Workflow</a></span></dt><dd><dl><dt><span class="section"><a href="#developing-a-board-support-package-bsp">4.1.1. Developing a Board Support Package (BSP)</a></span></dt><dt><span class="section"><a href="#modifying-the-kernel">4.1.2. Modifying the Kernel</a></span></dt></dl></dd><dt><span class="section"><a href="#application-development-workflow-using-an-sdk">4.2. Application Development Workflow Using an SDK</a></span></dt><dt><span class="section"><a href="#dev-modifying-source-code">4.3. Modifying Source Code</a></span></dt><dd><dl><dt><span class="section"><a href="#using-devtool-in-your-workflow">4.3.1. Using <code class="filename">devtool</code> in Your Workflow</a></span></dt><dt><span class="section"><a href="#using-a-quilt-workflow">4.3.2. Using Quilt in Your Workflow</a></span></dt><dt><span class="section"><a href="#finding-the-temporary-source-code">4.3.3. Finding Temporary Source Code</a></span></dt></dl></dd><dt><span class="section"><a href="#image-development-using-toaster">4.4. Image Development Using Toaster</a></span></dt><dt><span class="section"><a href="#platdev-appdev-devshell">4.5. Using a Development Shell</a></span></dt><dt><span class="section"><a href="#platdev-appdev-devpyshell">4.6. Using a Development Python Shell</a></span></dt></dl></dd><dt><span class="chapter"><a href="#extendpoky">5. Common Tasks</a></span></dt><dd><dl><dt><span class="section"><a href="#understanding-and-creating-layers">5.1. Understanding and Creating Layers</a></span></dt><dd><dl><dt><span class="section"><a href="#yocto-project-layers">5.1.1. Layers</a></span></dt><dt><span class="section"><a href="#creating-your-own-layer">5.1.2. Creating Your Own Layer</a></span></dt><dt><span class="section"><a href="#best-practices-to-follow-when-creating-layers">5.1.3. Best Practices to Follow When Creating Layers</a></span></dt><dt><span class="section"><a href="#making-sure-your-layer-is-compatible-with-yocto-project">5.1.4. Making Sure Your Layer is Compatible With Yocto Project</a></span></dt><dt><span class="section"><a href="#enabling-your-layer">5.1.5. Enabling Your Layer</a></span></dt><dt><span class="section"><a href="#using-bbappend-files">5.1.6. Using .bbappend Files</a></span></dt><dt><span class="section"><a href="#prioritizing-your-layer">5.1.7. Prioritizing Your Layer</a></span></dt><dt><span class="section"><a href="#managing-layers">5.1.8. Managing Layers</a></span></dt><dt><span class="section"><a href="#creating-a-general-layer-using-the-yocto-layer-script">5.1.9. Creating a General Layer Using the yocto-layer Script</a></span></dt></dl></dd><dt><span class="section"><a href="#usingpoky-extend-customimage">5.2. Customizing Images</a></span></dt><dd><dl><dt><span class="section"><a href="#usingpoky-extend-customimage-localconf">5.2.1. Customizing Images Using <code class="filename">local.conf</code></a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-imagefeatures">5.2.2. Customizing Images Using Custom <code class="filename">IMAGE_FEATURES</code> and
                <code class="filename">EXTRA_IMAGE_FEATURES</code></a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-custombb">5.2.3. Customizing Images Using Custom .bb Files</a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-customtasks">5.2.4. Customizing Images Using Custom Package Groups</a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-image-name">5.2.5. Customizing an Image Hostname</a></span></dt></dl></dd><dt><span class="section"><a href="#new-recipe-writing-a-new-recipe">5.3. Writing a New Recipe</a></span></dt><dd><dl><dt><span class="section"><a href="#new-recipe-overview">5.3.1. Overview</a></span></dt><dt><span class="section"><a href="#new-recipe-locate-or-automatically-create-a-base-recipe">5.3.2. Locate or Automatically Create a Base Recipe</a></span></dt><dt><span class="section"><a href="#new-recipe-storing-and-naming-the-recipe">5.3.3. Storing and Naming the Recipe</a></span></dt><dt><span class="section"><a href="#understanding-recipe-syntax">5.3.4. Understanding Recipe Syntax</a></span></dt><dt><span class="section"><a href="#new-recipe-running-a-build-on-the-recipe">5.3.5. Running a Build on the Recipe</a></span></dt><dt><span class="section"><a href="#new-recipe-fetching-code">5.3.6. Fetching Code</a></span></dt><dt><span class="section"><a href="#new-recipe-unpacking-code">5.3.7. Unpacking Code</a></span></dt><dt><span class="section"><a href="#new-recipe-patching-code">5.3.8. Patching Code</a></span></dt><dt><span class="section"><a href="#new-recipe-licensing">5.3.9. Licensing</a></span></dt><dt><span class="section"><a href="#new-dependencies">5.3.10. Dependencies</a></span></dt><dt><span class="section"><a href="#new-recipe-configuring-the-recipe">5.3.11. Configuring the Recipe</a></span></dt><dt><span class="section"><a href="#new-recipe-using-headers-to-interface-with-devices">5.3.12. Using Headers to Interface with Devices</a></span></dt><dt><span class="section"><a href="#new-recipe-compilation">5.3.13. Compilation</a></span></dt><dt><span class="section"><a href="#new-recipe-installing">5.3.14. Installing</a></span></dt><dt><span class="section"><a href="#new-recipe-enabling-system-services">5.3.15. Enabling System Services</a></span></dt><dt><span class="section"><a href="#new-recipe-packaging">5.3.16. Packaging</a></span></dt><dt><span class="section"><a href="#new-sharing-files-between-recipes">5.3.17. Sharing Files Between Recipes</a></span></dt><dt><span class="section"><a href="#properly-versioning-pre-release-recipes">5.3.18. Properly Versioning Pre-Release Recipes</a></span></dt><dt><span class="section"><a href="#new-recipe-post-installation-scripts">5.3.19. Post-Installation Scripts</a></span></dt><dt><span class="section"><a href="#new-recipe-testing">5.3.20. Testing</a></span></dt><dt><span class="section"><a href="#new-recipe-testing-examples">5.3.21. Examples</a></span></dt><dt><span class="section"><a href="#following-recipe-style-guidelines">5.3.22. Following Recipe Style Guidelines</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-newmachine">5.4. Adding a New Machine</a></span></dt><dd><dl><dt><span class="section"><a href="#platdev-newmachine-conffile">5.4.1. Adding the Machine Configuration File</a></span></dt><dt><span class="section"><a href="#platdev-newmachine-kernel">5.4.2. Adding a Kernel for the Machine</a></span></dt><dt><span class="section"><a href="#platdev-newmachine-formfactor">5.4.3. Adding a Formfactor Configuration File</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-building-targets-with-multiple-configurations">5.5. Building Targets with Multiple Configurations</a></span></dt><dt><span class="section"><a href="#platdev-working-with-libraries">5.6. Working With Libraries</a></span></dt><dd><dl><dt><span class="section"><a href="#including-static-library-files">5.6.1. Including Static Library Files</a></span></dt><dt><span class="section"><a href="#combining-multiple-versions-library-files-into-one-image">5.6.2. Combining Multiple Versions of Library Files into One Image</a></span></dt><dt><span class="section"><a href="#installing-multiple-versions-of-the-same-library">5.6.3. Installing Multiple Versions of the Same Library</a></span></dt></dl></dd><dt><span class="section"><a href="#enabling-gobject-introspection-support">5.7. Enabling GObject Introspection Support</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-the-generation-of-introspection-data">5.7.1. Enabling the Generation of Introspection Data</a></span></dt><dt><span class="section"><a href="#disabling-the-generation-of-introspection-data">5.7.2. Disabling the Generation of Introspection Data</a></span></dt><dt><span class="section"><a href="#testing-that-introspection-works-in-an-image">5.7.3. Testing that Introspection Works in an Image</a></span></dt><dt><span class="section"><a href="#known-issues">5.7.4. Known Issues</a></span></dt></dl></dd><dt><span class="section"><a href="#dev-optionally-using-an-external-toolchain">5.8. Optionally Using an External Toolchain</a></span></dt><dt><span class="section"><a href="#creating-partitioned-images">5.9. Creating Partitioned Images</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-wic-images-oe">5.9.1. Creating Partitioned Images</a></span></dt><dt><span class="section"><a href="#create-wic-images-wic">5.9.2. Using OpenEmbedded Image Creator Wic to Generate Partitioned Images</a></span></dt></dl></dd><dt><span class="section"><a href="#building-an-initramfs-image">5.10. Building an Initial RAM Filesystem (initramfs) Image</a></span></dt><dt><span class="section"><a href="#configuring-the-kernel">5.11. Configuring the Kernel</a></span></dt><dd><dl><dt><span class="section"><a href="#using-menuconfig">5.11.1. Using  <code class="filename">menuconfig</code></a></span></dt><dt><span class="section"><a href="#creating-a-defconfig-file">5.11.2. Creating a  <code class="filename">defconfig</code> File</a></span></dt><dt><span class="section"><a href="#creating-config-fragments">5.11.3. Creating Configuration Fragments</a></span></dt><dt><span class="section"><a href="#fine-tuning-the-kernel-configuration-file">5.11.4. Fine-Tuning the Kernel Configuration File</a></span></dt><dt><span class="section"><a href="#determining-hardware-and-non-hardware-features-for-the-kernel-configuration-audit-phase">5.11.5. Determining Hardware and Non-Hardware Features for the Kernel Configuration Audit Phase</a></span></dt></dl></dd><dt><span class="section"><a href="#patching-the-kernel">5.12. Patching the Kernel</a></span></dt><dd><dl><dt><span class="section"><a href="#create-a-layer-for-your-changes">5.12.1. Create a Layer for your Changes</a></span></dt><dt><span class="section"><a href="#finding-the-kernel-source-code">5.12.2. Finding the Kernel Source Code</a></span></dt><dt><span class="section"><a href="#creating-the-patch">5.12.3. Creating the Patch</a></span></dt><dt><span class="section"><a href="#set-up-your-layer-for-the-build">5.12.4. Set Up Your Layer for the Build</a></span></dt><dt><span class="section"><a href="#set-up-for-the-build">5.12.5. Set Up for the Build</a></span></dt><dt><span class="section"><a href="#build-the-modified-qemu-kernel-image">5.12.6. Build the Modified QEMU Kernel Image</a></span></dt><dt><span class="section"><a href="#boot-the-image-and-verify-your-changes">5.12.7. Boot the Image and Verify Your Changes</a></span></dt></dl></dd><dt><span class="section"><a href="#making-images-more-secure">5.13. Making Images More Secure</a></span></dt><dd><dl><dt><span class="section"><a href="#general-considerations">5.13.1. General Considerations</a></span></dt><dt><span class="section"><a href="#security-flags">5.13.2. Security Flags</a></span></dt><dt><span class="section"><a href="#considerations-specific-to-the-openembedded-build-system">5.13.3. Considerations Specific to the OpenEmbedded Build System</a></span></dt><dt><span class="section"><a href="#tools-for-hardening-your-image">5.13.4. Tools for Hardening Your Image</a></span></dt></dl></dd><dt><span class="section"><a href="#creating-your-own-distribution">5.14. Creating Your Own Distribution</a></span></dt><dt><span class="section"><a href="#creating-a-custom-template-configuration-directory">5.15. Creating a Custom Template Configuration Directory</a></span></dt><dt><span class="section"><a href="#building-a-tiny-system">5.16. Building a Tiny System</a></span></dt><dd><dl><dt><span class="section"><a href="#tiny-system-overview">5.16.1. Overview</a></span></dt><dt><span class="section"><a href="#goals-and-guiding-principles">5.16.2. Goals and Guiding Principles</a></span></dt><dt><span class="section"><a href="#understand-what-gives-your-image-size">5.16.3. Understand What Contributes to Your Image Size</a></span></dt><dt><span class="section"><a href="#trim-the-root-filesystem">5.16.4. Trim the Root Filesystem</a></span></dt><dt><span class="section"><a href="#trim-the-kernel">5.16.5. Trim the Kernel</a></span></dt><dt><span class="section"><a href="#remove-package-management-requirements">5.16.6. Remove Package Management Requirements</a></span></dt><dt><span class="section"><a href="#look-for-other-ways-to-minimize-size">5.16.7. Look for Other Ways to Minimize Size</a></span></dt><dt><span class="section"><a href="#iterate-on-the-process">5.16.8. Iterate on the Process</a></span></dt></dl></dd><dt><span class="section"><a href="#building-images-for-more-than-one-machine">5.17. Building Images for More than One Machine</a></span></dt><dt><span class="section"><a href="#working-with-packages">5.18. Working with Packages</a></span></dt><dd><dl><dt><span class="section"><a href="#excluding-packages-from-an-image">5.18.1. Excluding Packages from an Image</a></span></dt><dt><span class="section"><a href="#incrementing-a-binary-package-version">5.18.2. Incrementing a Package Version</a></span></dt><dt><span class="section"><a href="#handling-optional-module-packaging">5.18.3. Handling Optional Module Packaging</a></span></dt><dt><span class="section"><a href="#using-runtime-package-management">5.18.4. Using Runtime Package Management</a></span></dt><dt><span class="section"><a href="#generating-and-using-signed-packages">5.18.5. Generating and Using Signed Packages</a></span></dt><dt><span class="section"><a href="#testing-packages-with-ptest">5.18.6. Testing Packages With ptest</a></span></dt></dl></dd><dt><span class="section"><a href="#working-with-source-files">5.19. Working with Source Files</a></span></dt><dd><dl><dt><span class="section"><a href="#setting-up-effective-mirrors">5.19.1. Setting up Effective Mirrors</a></span></dt><dt><span class="section"><a href="#getting-source-files-and-suppressing-the-build">5.19.2. Getting Source Files and Suppressing the Build</a></span></dt></dl></dd><dt><span class="section"><a href="#building-software-from-an-external-source">5.20. Building Software from an External Source</a></span></dt><dt><span class="section"><a href="#selecting-an-initialization-manager">5.21. Selecting an Initialization Manager</a></span></dt><dd><dl><dt><span class="section"><a href="#using-systemd-exclusively">5.21.1. Using systemd Exclusively</a></span></dt><dt><span class="section"><a href="#using-systemd-for-the-main-image-and-using-sysvinit-for-the-rescue-image">5.21.2. Using systemd for the Main Image and Using SysVinit for the Rescue Image</a></span></dt></dl></dd><dt><span class="section"><a href="#selecting-dev-manager">5.22. Selecting a Device Manager</a></span></dt><dd><dl><dt><span class="section"><a href="#static-dev-management">5.22.1. Using Persistent and Pre-Populated<code class="filename">/dev</code></a></span></dt><dt><span class="section"><a href="#devtmpfs-dev-management">5.22.2. Using <code class="filename">devtmpfs</code> and a Device Manager</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-appdev-srcrev">5.23. Using an External SCM</a></span></dt><dt><span class="section"><a href="#creating-a-read-only-root-filesystem">5.24. Creating a Read-Only Root Filesystem</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-the-root-filesystem">5.24.1. Creating the Root Filesystem</a></span></dt><dt><span class="section"><a href="#post-installation-scripts">5.24.2. Post-Installation Scripts</a></span></dt><dt><span class="section"><a href="#areas-with-write-access">5.24.3. Areas With Write Access</a></span></dt></dl></dd><dt><span class="section"><a href="#performing-automated-runtime-testing">5.25. Performing Automated Runtime Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-tests">5.25.1. Enabling Tests</a></span></dt><dt><span class="section"><a href="#qemu-image-running-tests">5.25.2. Running Tests</a></span></dt><dt><span class="section"><a href="#exporting-tests">5.25.3. Exporting Tests</a></span></dt><dt><span class="section"><a href="#qemu-image-writing-new-tests">5.25.4. Writing New Tests</a></span></dt><dt><span class="section"><a href="#installing-packages-in-the-dut-without-the-package-manager">5.25.5. Installing Packages in the DUT Without the Package Manager</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-gdb-remotedebug">5.26. Debugging With the GNU Project Debugger (GDB) Remotely</a></span></dt><dt><span class="section"><a href="#debugging-with-the-gnu-project-debugger-gdb-on-the-target">5.27. Debugging with the GNU Project Debugger (GDB) on the Target</a></span></dt><dt><span class="section"><a href="#debugging-parallel-make-races">5.28. Debugging Parallel Make Races</a></span></dt><dd><dl><dt><span class="section"><a href="#the-failure">5.28.1. The Failure</a></span></dt><dt><span class="section"><a href="#reproducing-the-error">5.28.2. Reproducing the Error</a></span></dt><dt><span class="section"><a href="#creating-a-patch-for-the-fix">5.28.3. Creating a Patch for the Fix</a></span></dt><dt><span class="section"><a href="#testing-the-build">5.28.4. Testing the Build</a></span></dt></dl></dd><dt><span class="section"><a href="#maintaining-open-source-license-compliance-during-your-products-lifecycle">5.29. Maintaining Open Source License Compliance During Your Product's Lifecycle</a></span></dt><dd><dl><dt><span class="section"><a href="#providing-the-source-code">5.29.1. Providing the Source Code</a></span></dt><dt><span class="section"><a href="#providing-license-text">5.29.2. Providing License Text</a></span></dt><dt><span class="section"><a href="#providing-compilation-scripts-and-source-code-modifications">5.29.3. Providing Compilation Scripts and Source Code Modifications</a></span></dt></dl></dd><dt><span class="section"><a href="#using-the-error-reporting-tool">5.30. Using the Error Reporting Tool</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-and-using-the-tool">5.30.1. Enabling and Using the Tool</a></span></dt><dt><span class="section"><a href="#disabling-the-tool">5.30.2. Disabling the Tool</a></span></dt><dt><span class="section"><a href="#setting-up-your-own-error-reporting-server">5.30.3. Setting Up Your Own Error Reporting Server</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#dev-manual-qemu">6. Using the Quick EMUlator (QEMU)</a></span></dt><dd><dl><dt><span class="section"><a href="#qemu-overview">6.1. Overview</a></span></dt><dt><span class="section"><a href="#qemu-running-qemu">6.2. Running QEMU</a></span></dt><dd><dl><dt><span class="section"><a href="#qemu-setting-up-the-environment">6.2.1. Setting Up the Environment</a></span></dt><dt><span class="section"><a href="#qemu-using-the-runqemu-command">6.2.2. Using the <code class="filename">runqemu</code> Command</a></span></dt></dl></dd><dt><span class="section"><a href="#qemu-running-under-a-network-file-system-nfs-server">6.3. Running Under a Network File System (NFS) Server</a></span></dt><dd><dl><dt><span class="section"><a href="#qemu-setting-up-to-use-nfs">6.3.1. Setting Up to Use NFS</a></span></dt><dt><span class="section"><a href="#qemu-starting-and-stopping-nfs">6.3.2. Starting and Stopping NFS</a></span></dt></dl></dd><dt><span class="section"><a href="#qemu-tips-and-tricks">6.4. Tips and Tricks</a></span></dt></dl></dd></dl></div>
    

    <div class="chapter" title="Chapter 1. The Yocto Project Development Manual" id="dev-manual-intro"><div class="titlepage"><div><div><h2 class="title">Chapter 1. The Yocto Project Development Manual<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-manual-intro">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="#dev-intro">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#what-this-manual-provides">1.2. What This Manual Provides</a></span></dt><dt><span class="section"><a href="#what-this-manual-does-not-provide">1.3. What this Manual Does Not Provide</a></span></dt><dt><span class="section"><a href="#other-information">1.4. Other Information</a></span></dt></dl></div><div class="section" title="1.1. Introduction"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="dev-intro">1.1. Introduction<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-intro">¶</a></span></h2></div></div></div><p>
            Welcome to the Yocto Project Development Manual!
            This manual provides information on how to use the Yocto Project to
            develop embedded Linux images and user-space applications that
            run on targeted devices.
            The manual provides an overview of image, kernel, and
            user-space application development using the Yocto Project.
            Because much of the information in this manual is general, it
            contains many references to other sources where you can find more
            detail.
            For example, you can find detailed information on Git, repositories,
            and open source in general in many places on the Internet.
            Another example specific to the Yocto Project is how to quickly
            set up your host development system and build an image, which you
            find in the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html" target="_top">Yocto Project Quick Start</a>.
        </p><p>
            The Yocto Project Development Manual does, however, provide
            guidance and examples on how to change the kernel source code,
            reconfigure the kernel, and develop an application using
            <code class="filename">devtool</code>.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            By default, using the Yocto Project creates a Poky distribution.
            However, you can create your own distribution by providing key
            <a class="link" href="#metadata">Metadata</a>.
            A good example is Angstrom, which has had a distribution
            based on the Yocto Project since its inception.
            Other examples include commercial distributions like
            <a class="ulink" href="https://www.yoctoproject.org/organization/wind-river-systems" target="_top">Wind River Linux</a>,
            <a class="ulink" href="https://www.yoctoproject.org/organization/mentor-graphics" target="_top">Mentor Embedded Linux</a>,
            <a class="ulink" href="https://www.yoctoproject.org/organization/enea-ab" target="_top">ENEA Linux</a>
            and <a class="ulink" href="https://www.yoctoproject.org/ecosystem/member-organizations" target="_top">others</a>.
            See the "<a class="link" href="#creating-your-own-distribution" title="5.14. Creating Your Own Distribution">Creating Your Own Distribution</a>"
            section for more information.
        </div></div><div class="section" title="1.2. What This Manual Provides"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="what-this-manual-provides">1.2. What This Manual Provides<span class="permalink"><a alt="Permalink" title="Permalink" href="#what-this-manual-provides">¶</a></span></h2></div></div></div><p>
            The following list describes what you can get from this manual:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Information that lets you get set
                    up to develop using the Yocto Project.</p></li><li class="listitem"><p>Information to help developers who are new to
                    the open source environment and to the distributed revision
                    control system Git, which the Yocto Project uses.
                    </p></li><li class="listitem"><p>An understanding of common end-to-end
                    development models and tasks.</p></li><li class="listitem"><p>Information about common development tasks
                    generally used during image development for
                    embedded devices.
                    </p></li><li class="listitem"><p>Information on using the Yocto Project
                    integration of the QuickEMUlator (QEMU), which lets you
                    simulate running on hardware an image you have built using
                    the OpenEmbedded build system.
                    </p></li><li class="listitem"><p>Many references to other sources of related
                    information.</p></li></ul></div><p>
        </p></div><div class="section" title="1.3. What this Manual Does Not Provide"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="what-this-manual-does-not-provide">1.3. What this Manual Does Not Provide<span class="permalink"><a alt="Permalink" title="Permalink" href="#what-this-manual-does-not-provide">¶</a></span></h2></div></div></div><p>
            This manual will not give you the following:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Step-by-step instructions when those instructions exist in other Yocto
                    Project documentation:</em></span>
                    For example, the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>
                    manual contains detailed instructions on how to install an
                    SDK, which is used to develop applications for target
                    hardware.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Reference material:</em></span>
                    This type of material resides in an appropriate reference manual.
                    For example, system variables are documented in the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html" target="_top">Yocto Project Reference Manual</a>.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Detailed public information that is not specific to the Yocto Project:</em></span>
                    For example, exhaustive information on how to use Git is covered better through the
                    Internet than in this manual.
                    </p></li></ul></div><p>
        </p></div><div class="section" title="1.4. Other Information"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="other-information">1.4. Other Information<span class="permalink"><a alt="Permalink" title="Permalink" href="#other-information">¶</a></span></h2></div></div></div><p>
            Because this manual presents overview information for many different
            topics, supplemental information is recommended for full
            comprehension.
            The following list presents other sources of information you might find helpful:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><a class="ulink" href="http://www.yoctoproject.org" target="_top">Yocto Project Website</a>:
                    </em></span> The home page for the Yocto Project provides lots of information on the project
                    as well as links to software and documentation.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html" target="_top">Yocto Project Quick Start</a>:</em></span>
                    This short document lets you get started
                    with the Yocto Project and quickly begin building an image.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html" target="_top">Yocto Project Reference Manual</a>:</em></span>
                    This manual is a reference
                    guide to the OpenEmbedded build system, which is based on BitBake.
                    The build system is sometimes referred to as "Poky".
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>:</em></span>
                    This guide provides information that lets you get going
                    with the standard or extensible SDK.
                    An SDK, with its cross-development toolchains, allows you
                    to develop projects inside or outside of the Yocto Project
                    environment.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html" target="_top">Yocto Project Board Support Package (BSP) Developer's Guide</a>:</em></span>
                    This guide defines the structure for BSP components.
                    Having a commonly understood structure encourages standardization.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html" target="_top">Yocto Project Linux Kernel Development Manual</a>:</em></span>
                    This manual describes how to work with Linux Yocto kernels as well as provides a bit
                    of conceptual information on the construction of the Yocto Linux kernel tree.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/profile-manual/profile-manual.html" target="_top">Yocto Project Profiling and Tracing Manual</a>:</em></span>
                    This manual presents a set of common and generally useful tracing and
                    profiling schemes along with their applications (as appropriate) to each tool.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/toaster-manual/toaster-manual.html" target="_top">Toaster User Manual</a>:</em></span>
                    This manual introduces and describes how to set up and use
                    Toaster, which is a web interface to the Yocto Project's
                    <a class="link" href="#build-system-term">OpenEmbedded Build System</a>.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.youtube.com/watch?v=3ZlOu-gLsh0" target="_top">
                    Eclipse IDE Yocto Plug-in</a>:</em></span>
                    A step-by-step instructional video that
                    demonstrates how an application developer uses Yocto Plug-in features within
                    the Eclipse IDE.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="https://wiki.yoctoproject.org/wiki/FAQ" target="_top">FAQ</a>:</em></span>
                    A list of commonly asked questions and their answers.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/downloads/core/pyro23" target="_top">Release Notes</a>:</em></span>
                    Features, updates and known issues for the current
                    release of the Yocto Project.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/tools-resources/projects/toaster" target="_top">Toaster</a>:</em></span>
                    An Application Programming Interface (API) and web-based
                    interface to the OpenEmbedded build system, which uses
                    BitBake, that reports build information.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/tools-resources/projects/build-appliance" target="_top">Build Appliance</a>:</em></span>
                    A virtual machine that
                    enables you to build and boot a custom embedded Linux image
                    with the Yocto Project using a non-Linux development system.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://bugzilla.yoctoproject.org" target="_top">Bugzilla</a>:</em></span>
                    The bug tracking application the Yocto Project uses.
                    If you find problems with the Yocto Project, you should report them using this
                    application.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Yocto Project Mailing Lists:</em></span>
                    To subscribe to the Yocto Project mailing
                    lists, click on the following URLs and follow the instructions:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><a class="ulink" href="http://lists.yoctoproject.org/listinfo/yocto" target="_top">http://lists.yoctoproject.org/listinfo/yocto</a>
                            for a Yocto Project Discussions mailing list.
                            </p></li><li class="listitem"><p><a class="ulink" href="http://lists.yoctoproject.org/listinfo/poky" target="_top">http://lists.yoctoproject.org/listinfo/poky</a>
                            for a Yocto Project Discussions mailing list about the
                            OpenEmbedded build system (Poky).
                            </p></li><li class="listitem"><p><a class="ulink" href="http://lists.yoctoproject.org/listinfo/yocto-announce" target="_top">http://lists.yoctoproject.org/listinfo/yocto-announce</a>
                            for a mailing list to receive official Yocto Project announcements
                            as well as Yocto Project milestones.
                            </p></li><li class="listitem"><p><a class="ulink" href="http://lists.yoctoproject.org/listinfo" target="_top">http://lists.yoctoproject.org/listinfo</a>
                            for a listing of all public mailing lists on
                            <code class="filename">lists.yoctoproject.org</code>.
                            </p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>Internet Relay Chat (IRC):</em></span>
                    Two IRC channels on freenode are available
                    for Yocto Project and Poky discussions: <code class="filename">#yocto</code> and
                    <code class="filename">#poky</code>, respectively.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.openembedded.org" target="_top">OpenEmbedded</a>:</em></span>
                    The build system used by the Yocto Project.
                    This project is the upstream, generic, embedded distribution
                    from which the Yocto Project derives its build system (Poky)
                    and to which it contributes.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.openembedded.org/wiki/BitBake" target="_top">BitBake</a>:</em></span>
                    The tool used by the OpenEmbedded build system
                    to process project metadata.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html" target="_top">BitBake User Manual:</a></em></span>
                    A comprehensive guide to the BitBake tool.
                    If you want information on BitBake, see this manual.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    <a class="ulink" href="http://wiki.qemu.org/Index.html" target="_top">Quick EMUlator (QEMU)</a>:</em></span>
                    An open-source machine emulator and virtualizer.
                    </p></li></ul></div><p>
        </p></div></div>

    <div class="chapter" title="Chapter 2. Getting Started with the Yocto Project" id="dev-manual-start"><div class="titlepage"><div><div><h2 class="title">Chapter 2. Getting Started with the Yocto Project<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-manual-start">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="#introducing-the-yocto-project">2.1. Introducing the Yocto Project</a></span></dt><dt><span class="section"><a href="#getting-setup">2.2. Getting Set Up</a></span></dt><dt><span class="section"><a href="#building-images">2.3. Building Images</a></span></dt><dt><span class="section"><a href="#flashing-images-using-bmaptool">2.4. Flashing Images Using <code class="filename">bmaptool</code></a></span></dt><dt><span class="section"><a href="#using-pre-built-binaries-and-qemu">2.5. Using Pre-Built Binaries and QEMU</a></span></dt></dl></div><p>
    This chapter introduces the Yocto Project and gives you an idea of what you need to get started.
    You can find enough information to set up your development host and build or use images for
    hardware supported by the Yocto Project by reading the
    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html" target="_top">Yocto Project Quick Start</a>.
</p><p>
    The remainder of this chapter summarizes what is in the Yocto Project Quick Start and provides
    some higher-level concepts you might want to consider.
</p><div class="section" title="2.1. Introducing the Yocto Project"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="introducing-the-yocto-project">2.1. Introducing the Yocto Project<span class="permalink"><a alt="Permalink" title="Permalink" href="#introducing-the-yocto-project">¶</a></span></h2></div></div></div><p>
        The Yocto Project is an open-source collaboration project focused on embedded Linux development.
        The project currently provides a build system that is
        referred to as the
        <a class="link" href="#build-system-term">OpenEmbedded build system</a>
        in the Yocto Project documentation.
        The Yocto Project provides various ancillary tools for the embedded developer
        and also features the Sato reference User Interface, which is optimized for
        stylus-driven, low-resolution screens.
    </p><p>
        You can use the OpenEmbedded build system, which uses
        <a class="link" href="#bitbake-term">BitBake</a>, to develop complete Linux
        images and associated user-space applications for architectures based
        on ARM, MIPS, PowerPC, x86 and x86-64.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            By default, using the Yocto Project creates a Poky distribution.
            However, you can create your own distribution by providing key
            <a class="link" href="#metadata">Metadata</a>.
            See the "<a class="link" href="#creating-your-own-distribution" title="5.14. Creating Your Own Distribution">Creating Your Own Distribution</a>"
            section for more information.
        </div><p>
        While the Yocto Project does not provide a strict testing framework,
        it does provide or generate for you artifacts that let you perform target-level and
        emulated testing and debugging.
        Additionally, if you are an <span class="trademark">Eclipse</span>™
        IDE user, you can install an Eclipse Yocto Plug-in to allow you to
        develop within that familiar environment.
    </p></div><div class="section" title="2.2. Getting Set Up"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="getting-setup">2.2. Getting Set Up<span class="permalink"><a alt="Permalink" title="Permalink" href="#getting-setup">¶</a></span></h2></div></div></div><p>
        Here is what you need to use the Yocto Project:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Host System:</em></span>  You should have a reasonably current
                Linux-based host system.
                You will have the best results with a recent release of Fedora,
                openSUSE, Debian, Ubuntu, or CentOS as these releases are frequently tested against the Yocto Project
                and officially supported.
                For a list of the distributions under validation and their status, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#detailed-supported-distros" target="_top">Supported Linux Distributions</a>" section
                in the Yocto Project Reference Manual and the wiki page at
                <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Distribution_Support" target="_top">Distribution Support</a>.</p><p>
                You should also have about 50 Gbytes of free disk space for building images.
                </p></li><li class="listitem"><p><span class="emphasis"><em>Packages:</em></span>  The OpenEmbedded build system
                requires that certain packages exist on your development system (e.g. Python 2.7).
                See "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#packages" target="_top">The Build Host Packages</a>"
                section in the Yocto Project Quick Start and the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#required-packages-for-the-host-development-system" target="_top">Required Packages for the Host Development System</a>"
                section in the Yocto Project Reference Manual for the exact
                package requirements and the installation commands to install
                them for the supported distributions.
                </p></li><li class="listitem"><p><a id="local-yp-release"></a><span class="emphasis"><em>Yocto Project Release:</em></span>
                You need a release of the Yocto Project locally installed on
                your development system.
                The documentation refers to this set of locally installed files
                as the <a class="link" href="#source-directory">Source Directory</a>.
                You create your Source Directory by using
                <a class="link" href="#git" title="3.6. Git">Git</a> to clone a local copy
                of the upstream <code class="filename">poky</code> repository,
                or by downloading and unpacking a tarball of an official
                Yocto Project release.
                The preferred method is to create a clone of the repository.
                </p><p>Working from a copy of the upstream repository allows you
                to contribute back into the Yocto Project or simply work with
                the latest software on a development branch.
                Because Git maintains and creates an upstream repository with
                a complete history of changes and you are working with a local
                clone of that repository, you have access to all the Yocto
                Project development branches and tag names used in the upstream
                repository.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>You can view the Yocto Project Source Repositories at
                    <a class="ulink" href="http://git.yoctoproject.org/cgit.cgi" target="_top">http://git.yoctoproject.org/cgit.cgi</a></div><p>The following transcript shows how to clone the
                <code class="filename">poky</code> Git repository into the current
                working directory.
                The command creates the local repository in a directory
                named <code class="filename">poky</code>.
                For information on Git used within the Yocto Project, see
                the "<a class="link" href="#git" title="3.6. Git">Git</a>" section.
                </p><pre class="literallayout">
     $ git clone git://git.yoctoproject.org/poky
     Cloning into 'poky'...
     remote: Counting objects: 226790, done.
     remote: Compressing objects: 100% (57465/57465), done.
     remote: Total 226790 (delta 165212), reused 225887 (delta 164327)
     Receiving objects: 100% (226790/226790), 100.98 MiB | 263 KiB/s, done.
     Resolving deltas: 100% (165212/165212), done.
                </pre><p>For another example of how to set up your own local Git
                repositories, see this
                <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Transcript:_from_git_checkout_to_meta-intel_BSP" target="_top">
                wiki page</a>, which describes how to create local
                Git repositories for both
                <code class="filename">poky</code> and <code class="filename">meta-intel</code>.
                </p><p>
                You can also get the Yocto Project Files by downloading
                Yocto Project releases from the
                <a class="ulink" href="http://www.yoctoproject.org" target="_top">Yocto Project website</a>.
                From the website, you just click "Downloads" in the navigation
                pane to the left to display all Yocto Project downloads.
                Current and archived releases are available for download.
                Nightly and developmental builds are also maintained at
                <a class="ulink" href="http://autobuilder.yoctoproject.org/pub/nightly/" target="_top">http://autobuilder.yoctoproject.org/pub/nightly/</a>.
                One final site you can visit for information on Yocto Project
                releases is the
                <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Releases" target="_top">Releases</a>
                wiki.
                </p></li><li class="listitem"><p><a id="local-kernel-files"></a><span class="emphasis"><em>Yocto Project Kernel:</em></span>
                If you are going to be making modifications to a supported Yocto Project kernel, you
                need to establish local copies of the source.
                You can find Git repositories of supported Yocto Project kernels organized under
                "Yocto Linux Kernel" in the Yocto Project Source Repositories at
                <a class="ulink" href="http://git.yoctoproject.org/cgit.cgi" target="_top">http://git.yoctoproject.org/cgit.cgi</a>.</p><p>This setup can involve creating a bare clone of the Yocto Project kernel and then
                copying that cloned repository.
                You can create the bare clone and the copy of the bare clone anywhere you like.
                For simplicity, it is recommended that you create these structures outside of the
                Source Directory, which is usually named <code class="filename">poky</code>.</p><p>As an example, the following transcript shows how to create the bare clone
                of the <code class="filename">linux-yocto-3.19</code> kernel and then create a copy of
                that clone.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>When you have a local Yocto Project kernel Git repository, you can
                reference that repository rather than the upstream Git repository as
                part of the <code class="filename">clone</code> command.
                Doing so can speed up the process.</div><p>In the following example, the bare clone is named
                <code class="filename">linux-yocto-3.19.git</code>, while the
                copy is named <code class="filename">my-linux-yocto-3.19-work</code>:
                </p><pre class="literallayout">
     $ git clone --bare git://git.yoctoproject.org/linux-yocto-3.19 linux-yocto-3.19.git
     Cloning into bare repository 'linux-yocto-3.19.git'...
     remote: Counting objects: 3983256, done.
     remote: Compressing objects: 100% (605006/605006), done.
     remote: Total 3983256 (delta 3352832), reused 3974503 (delta 3344079)
     Receiving objects: 100% (3983256/3983256), 843.66 MiB | 1.07 MiB/s, done.
     Resolving deltas: 100% (3352832/3352832), done.
     Checking connectivity... done.
                </pre><p>Now create a clone of the bare clone just created:
                </p><pre class="literallayout">
     $ git clone linux-yocto-3.19.git my-linux-yocto-3.19-work
     Cloning into 'my-linux-yocto-3.19-work'...
     done.
     Checking out files: 100% (48440/48440), done.
                </pre></li><li class="listitem"><p><a id="meta-yocto-kernel-extras-repo"></a><span class="emphasis"><em>
                The <code class="filename">meta-yocto-kernel-extras</code> Git Repository</em></span>:
                The <code class="filename">meta-yocto-kernel-extras</code> Git repository contains Metadata needed
                only if you are modifying and building the kernel image.
                In particular, it contains the kernel BitBake append (<code class="filename">.bbappend</code>)
                files that you
                edit to point to your locally modified kernel source files and to build the kernel
                image.
                Pointing to these local files is much more efficient than requiring a download of the
                kernel's source files from upstream each time you make changes to the kernel.</p><p>You can find the <code class="filename">meta-yocto-kernel-extras</code> Git Repository in the
                "Yocto Metadata Layers" area of the Yocto Project Source Repositories at
                <a class="ulink" href="http://git.yoctoproject.org/cgit.cgi" target="_top">http://git.yoctoproject.org/cgit.cgi</a>.
                It is good practice to create this Git repository inside the Source Directory.</p><p>Following is an example that creates the <code class="filename">meta-yocto-kernel-extras</code> Git
                repository inside the Source Directory, which is named <code class="filename">poky</code>
                in this case:
                </p><pre class="literallayout">
     $ cd ~/poky
     $ git clone git://git.yoctoproject.org/meta-yocto-kernel-extras meta-yocto-kernel-extras
     Cloning into 'meta-yocto-kernel-extras'...
     remote: Counting objects: 727, done.
     remote: Compressing objects: 100% (452/452), done.
     remote: Total 727 (delta 260), reused 719 (delta 252)
     Receiving objects: 100% (727/727), 536.36 KiB | 240 KiB/s, done.
     Resolving deltas: 100% (260/260), done.
               </pre></li><li class="listitem"><p><a id="supported-board-support-packages-(bsps)"></a><span class="emphasis"><em>Supported Board Support Packages (BSPs):</em></span>
                The Yocto Project supports many BSPs, which are maintained in
                their own layers or in layers designed to contain several
                BSPs.
                To get an idea of machine support through BSP layers, you can
                look at the
                <a class="ulink" href="http://downloads.yoctoproject.org/releases/yocto/yocto-2.3/machines" target="_top">index of machines</a>
                for the release.</p><p>The Yocto Project uses the following BSP layer naming
                scheme:
                </p><pre class="literallayout">
     meta-<em class="replaceable"><code>bsp_name</code></em>
                </pre><p>
                where <em class="replaceable"><code>bsp_name</code></em> is the recognized
                BSP name.
                Here is an example:
                </p><pre class="literallayout">
     meta-raspberrypi
                </pre><p>
                See the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-layers" target="_top">BSP Layers</a>"
                section in the Yocto Project Board Support Package (BSP)
                Developer's Guide for more information on BSP Layers.</p><p>A useful Git repository released with the Yocto
                Project is <code class="filename">meta-intel</code>, which is a
                parent layer that contains many supported
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-layers" target="_top">BSP Layers</a>.
                You can locate the <code class="filename">meta-intel</code> Git
                repository in the "Yocto Metadata Layers" area of the Yocto
                Project Source Repositories at
                <a class="ulink" href="http://git.yoctoproject.org/cgit.cgi" target="_top">http://git.yoctoproject.org/cgit.cgi</a>.</p><p>Using
                <a class="link" href="#git" title="3.6. Git">Git</a> to create a local clone of the
                upstream repository can be helpful if you are working with
                BSPs.
                Typically, you set up the <code class="filename">meta-intel</code>
                Git repository inside the Source Directory.
                For example, the following transcript shows the steps to clone
                <code class="filename">meta-intel</code>.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Be sure to work in the <code class="filename">meta-intel</code>
                    branch that matches your
                    <a class="link" href="#source-directory">Source Directory</a>
                    (i.e. <code class="filename">poky</code>) branch.
                    For example, if you have checked out the "master" branch
                    of <code class="filename">poky</code> and you are going to use
                    <code class="filename">meta-intel</code>, be sure to checkout the
                    "master" branch of <code class="filename">meta-intel</code>.
                </div><p>
                </p><pre class="literallayout">
     $ cd ~/poky
     $ git clone git://git.yoctoproject.org/meta-intel.git
     Cloning into 'meta-intel'...
     remote: Counting objects: 11917, done.
     remote: Compressing objects: 100% (3842/3842), done.
     remote: Total 11917 (delta 6840), reused 11699 (delta 6622)
     Receiving objects: 100% (11917/11917), 2.92 MiB | 2.88 MiB/s, done.
     Resolving deltas: 100% (6840/6840), done.
     Checking connectivity... done.
                </pre><p>The same
                <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Transcript:_from_git_checkout_to_meta-intel_BSP" target="_top">wiki page</a>
                referenced earlier covers how to set up the
                <code class="filename">meta-intel</code> Git repository.
                </p></li><li class="listitem"><p><span class="emphasis"><em>Eclipse Yocto Plug-in:</em></span>  If you are developing
                applications using the Eclipse Integrated Development Environment (IDE),
                you will need this plug-in.
                See the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html#setting-up-the-eclipse-ide" target="_top">Setting up the Eclipse IDE</a>"
                section in the Yocto Project Software Development Kit (SDK)
                Developer's Guide for more information.</p></li></ul></div><p>
    </p></div><div class="section" title="2.3. Building Images"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="building-images">2.3. Building Images<span class="permalink"><a alt="Permalink" title="Permalink" href="#building-images">¶</a></span></h2></div></div></div><p>
        The build process creates an entire Linux distribution, including the toolchain, from source.
        For more information on this topic, see the
        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#qs-building-images" target="_top">Building Images</a>"
        section in the Yocto Project Quick Start.
    </p><p>
        The build process is as follows:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Make sure you have set up the Source Directory described in the
                previous section.</p></li><li class="listitem"><p>Initialize the build environment by sourcing a build
                environment script (i.e.
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                or
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>).
                </p></li><li class="listitem"><p>Optionally ensure the <code class="filename">conf/local.conf</code> configuration file,
                which is found in the
                <a class="link" href="#build-directory">Build Directory</a>,
                is set up how you want it.
                This file defines many aspects of the build environment including
                the target machine architecture through the
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top">MACHINE</a></code> variable,
                the packaging format used during the build
                (<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_CLASSES" target="_top"><code class="filename">PACKAGE_CLASSES</code></a>),
                and a centralized tarball download directory through the
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DL_DIR" target="_top">DL_DIR</a></code> variable.</p></li><li class="listitem"><p>
                Build the image using the <code class="filename">bitbake</code> command.
                If you want information on BitBake, see the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html" target="_top">BitBake User Manual</a>.
                </p></li><li class="listitem"><p>Run the image either on the actual hardware or using the QEMU
                emulator.</p></li></ol></div><p>
    </p></div><div class="section" title="2.4. Flashing Images Using bmaptool"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="flashing-images-using-bmaptool">2.4. Flashing Images Using <code class="filename">bmaptool</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#flashing-images-using-bmaptool">¶</a></span></h2></div></div></div><p>
        An easy way to flash an image to a bootable device is to use
        <code class="filename">bmaptool</code>, which is integrated into the
        OpenEmbedded build system.
    </p><p>
        Following, is an example that shows how to flash a Wic image.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            You can use <code class="filename">bmaptool</code> to flash any
            type of image.
        </div><p>
        Use these steps to flash an image using
        <code class="filename">bmaptool</code>:
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            Unless you are able to install the
            <code class="filename">bmap-tools</code> package as mentioned in the note
            in the second bullet of step 3 further down, you will need to build
            <code class="filename">bmaptool</code> before using it.
            Build the tool using the following command:
            <pre class="literallayout">
     $ bitbake bmap-tools-native
            </pre></div><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                Add the following to your <code class="filename">local.conf</code>
                file:
                </p><pre class="literallayout">
     IMAGE_FSTYPES += "wic wic.bmap"
                </pre><p>
                </p></li><li class="listitem"><p>
                Either have your image ready (pre-built) or take the step
                build the image:
                </p><pre class="literallayout">
     $ bitbake <em class="replaceable"><code>image</code></em>
                </pre><p>
                </p></li><li class="listitem"><p>
                Flash the image to the media by using
                <code class="filename">bmaptool</code> depending on your particular
                setup:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        If you have write access to the media,
                        use this command form:
                        </p><pre class="literallayout">
     $ oe-run-native bmaptool copy ./tmp/deploy/images/qemux86-64/core-image-minimal-<em class="replaceable"><code>machine</code></em>.wic /dev/sd<em class="replaceable"><code>X</code></em>
                        </pre><p>
                        </p></li><li class="listitem"><p>
                        If you do not have write access to
                        the media, use the following
                        commands:
                        </p><pre class="literallayout">
     $ sudo bash
     $ PATH=tmp/sysroots/x86_64-linux/usr/bin/ bmaptool copy ./tmp/deploy/images/qemux86-64/core-image-minimal-<em class="replaceable"><code>machine</code></em>.wic /dev/sd<em class="replaceable"><code>X</code></em>
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            If you are using Ubuntu or Debian distributions,
                            you can install the
                            <code class="filename">bmap-tools</code> package using the
                            following command and then use the tool
                            without specifying
                            <code class="filename">PATH</code> even from the
                            root account:
                            <pre class="literallayout">
     $ sudo apt-get install bmap-tools
                            </pre></div><p>
                        </p></li></ul></div><p>
                </p></li></ol></div><p>
    </p><p>
        For help on the <code class="filename">bmaptool</code> command, use either of
        the following commands:
        </p><pre class="literallayout">
     $ bmaptool --help
     $ oe-run-native bmaptool --help
        </pre><p>
    </p></div><div class="section" title="2.5. Using Pre-Built Binaries and QEMU"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="using-pre-built-binaries-and-qemu">2.5. Using Pre-Built Binaries and QEMU<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-pre-built-binaries-and-qemu">¶</a></span></h2></div></div></div><p>
        Another option you have to get started is to use pre-built binaries.
        The Yocto Project provides many types of binaries with each release.
        See the "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-images" target="_top">Images</a>"
        chapter in the Yocto Project Reference Manual
        for descriptions of the types of binaries that ship with a Yocto Project
        release.
    </p><p>
        Using a pre-built binary is ideal for developing software
        applications to run on your target hardware.
        To do this, you need to be able to access the appropriate
        cross-toolchain tarball for the architecture on which you are
        developing.
        If you are using an SDK type image, the image ships with the complete
        toolchain native to the architecture (i.e. a toolchain designed to
        run on the
        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SDKMACHINE" target="_top"><code class="filename">SDKMACHINE</code></a>).
        If you are not using an SDK type image, you need to separately download
        and install the stand-alone Yocto Project cross-toolchain tarball.
        See the
        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html#sdk-appendix-obtain" target="_top">Obtaining the SDK</a>"
        appendix in the Yocto Project Software Development Kit (SDK)
        Developer's Guide for more information on locating and installing
        cross-toolchains.
    </p><p>
        Regardless of the type of image you are using, you need to download the pre-built kernel
        that you will boot in the QEMU emulator and then download and extract the target root
        filesystem for your target machine’s architecture.
        You can get architecture-specific binaries and file systems from
        <a class="ulink" href="http://downloads.yoctoproject.org/releases/yocto/yocto-2.3/machines" target="_top">machines</a>.
        You can get installation scripts for stand-alone toolchains from
        <a class="ulink" href="http://downloads.yoctoproject.org/releases/yocto/yocto-2.3/toolchain/" target="_top">toolchains</a>.
        Once you have all your files, you set up the environment to emulate the hardware
        by sourcing an environment setup script.
        Finally, you start the QEMU emulator.
        You can find details on all these steps in the
        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html#sdk-manual" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>.
        You can learn more about using QEMU with the Yocto Project in the
        "<a class="link" href="#dev-manual-qemu" title="Chapter 6. Using the Quick EMUlator (QEMU)">Using the Quick EMUlator (QEMU)</a>"
        section.
    </p><p>
        Using QEMU to emulate your hardware can result in speed issues
        depending on the target and host architecture mix.
        For example, using the <code class="filename">qemux86</code> image in the emulator
        on an Intel-based 32-bit (x86) host machine is fast because the target and
        host architectures match.
        On the other hand, using the <code class="filename">qemuarm</code> image on the same Intel-based
        host can be slower.
        But, you still achieve faithful emulation of ARM-specific issues.
    </p><p>
        To speed things up, the QEMU images support using <code class="filename">distcc</code>
        to call a cross-compiler outside the emulated system.
        If you used <code class="filename">runqemu</code> to start QEMU, and the
        <code class="filename">distccd</code> application is present on the host system, any
        BitBake cross-compiling toolchain available from the build system is automatically
        used from within QEMU simply by calling <code class="filename">distcc</code>.
        You can accomplish this by defining the cross-compiler variable
        (e.g. <code class="filename">export CC="distcc"</code>).
        Alternatively, if you are using a suitable SDK image or the appropriate
        stand-alone toolchain is present,
        the toolchain is also automatically used.
    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
        Several mechanisms exist that let you connect to the system running on the
        QEMU emulator:
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>QEMU provides a framebuffer interface that makes standard
                consoles available.</p></li><li class="listitem"><p>Generally, headless embedded devices have a serial port.
                If so, you can configure the operating system of the running image
                to use that port to run a console.
                The connection uses standard IP networking.</p></li><li class="listitem"><p>
                SSH servers exist in some QEMU images.
                The <code class="filename">core-image-sato</code> QEMU image has a
                Dropbear secure shell (SSH) server that runs with the root
                password disabled.
                The <code class="filename">core-image-full-cmdline</code> and
                <code class="filename">core-image-lsb</code> QEMU images
                have OpenSSH instead of Dropbear.
                Including these SSH servers allow you to use standard
                <code class="filename">ssh</code> and <code class="filename">scp</code> commands.
                The <code class="filename">core-image-minimal</code> QEMU image,
                however, contains no SSH server.
                </p></li><li class="listitem"><p>You can use a provided, user-space NFS server to boot the QEMU session
                using a local copy of the root filesystem on the host.
                In order to make this connection, you must extract a root filesystem tarball by using the
                <code class="filename">runqemu-extract-sdk</code> command.
                After running the command, you must then point the <code class="filename">runqemu</code>
                script to the extracted directory instead of a root filesystem image file.</p></li></ul></div></div></div></div>

    <div class="chapter" title="Chapter 3. The Yocto Project Open Source Development Environment" id="dev-manual-newbie"><div class="titlepage"><div><div><h2 class="title">Chapter 3. The Yocto Project Open Source Development Environment<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-manual-newbie">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="#open-source-philosophy">3.1. Open Source Philosophy</a></span></dt><dt><span class="section"><a href="#usingpoky-changes-collaborate">3.2. Using the Yocto Project in a Team Environment</a></span></dt><dd><dl><dt><span class="section"><a href="#best-practices-system-configurations">3.2.1. System Configurations</a></span></dt><dt><span class="section"><a href="#best-practices-source-control-management">3.2.2. Source Control Management (SCM)</a></span></dt><dt><span class="section"><a href="#best-practices-autobuilders">3.2.3. Autobuilders</a></span></dt><dt><span class="section"><a href="#best-practices-policies-and-change-flow">3.2.4. Policies and Change Flow</a></span></dt><dt><span class="section"><a href="#best-practices-summary">3.2.5. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#yocto-project-repositories">3.3. Yocto Project Source Repositories</a></span></dt><dt><span class="section"><a href="#yocto-project-terms">3.4. Yocto Project Terms</a></span></dt><dt><span class="section"><a href="#licensing">3.5. Licensing</a></span></dt><dt><span class="section"><a href="#git">3.6. Git</a></span></dt><dd><dl><dt><span class="section"><a href="#repositories-tags-and-branches">3.6.1. Repositories, Tags, and Branches</a></span></dt><dt><span class="section"><a href="#basic-commands">3.6.2. Basic Commands</a></span></dt></dl></dd><dt><span class="section"><a href="#workflows">3.7. Workflows</a></span></dt><dt><span class="section"><a href="#tracking-bugs">3.8. Tracking Bugs</a></span></dt><dt><span class="section"><a href="#how-to-submit-a-change">3.9. How to Submit a Change</a></span></dt><dd><dl><dt><span class="section"><a href="#submit-change-overview">3.9.1. Overview</a></span></dt><dt><span class="section"><a href="#submit-change-submissions-to-poky">3.9.2. Submissions to Poky</a></span></dt><dt><span class="section"><a href="#submit-change-submissions-to-other-layers">3.9.3. Submissions to Other Layers</a></span></dt><dt><span class="section"><a href="#submit-change-patch-submission-details">3.9.4. Patch Submission Details</a></span></dt><dt><span class="section"><a href="#pushing-a-change-upstream">3.9.5. Using Scripts to Push a Change Upstream and Request a Pull</a></span></dt><dt><span class="section"><a href="#submitting-a-patch">3.9.6. Using Email to Submit a Patch</a></span></dt></dl></dd></dl></div><p>
    This chapter helps you understand the Yocto Project as an open source development project.
    In general, working in an open source environment is very different from working in a
    closed, proprietary environment.
    Additionally, the Yocto Project uses specific tools and constructs as part of its development
    environment.
    This chapter specifically addresses open source philosophy, using the
    Yocto Project in a team environment, source repositories, Yocto Project
    terms, licensing, the open source distributed version control system Git,
    workflows, bug tracking, and how to submit changes.
</p><div class="section" title="3.1. Open Source Philosophy"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="open-source-philosophy">3.1. Open Source Philosophy<span class="permalink"><a alt="Permalink" title="Permalink" href="#open-source-philosophy">¶</a></span></h2></div></div></div><p>
        Open source philosophy is characterized by software development directed by peer production
        and collaboration through an active community of developers.
        Contrast this to the more standard centralized development models used by commercial software
        companies where a finite set of developers produces a product for sale using a defined set
        of procedures that ultimately result in an end product whose architecture and source material
        are closed to the public.
    </p><p>
        Open source projects conceptually have differing concurrent agendas, approaches, and production.
        These facets of the development process can come from anyone in the public (community) that has a
        stake in the software project.
        The open source environment contains new copyright, licensing, domain, and consumer issues
        that differ from the more traditional development environment.
        In an open source environment, the end product, source material, and documentation are
        all available to the public at no cost.
    </p><p>
        A benchmark example of an open source project is the Linux kernel, which was initially conceived
        and created by Finnish computer science student Linus Torvalds in 1991.
        Conversely, a good example of a non-open source project is the
        <span class="trademark">Windows</span>® family of operating
        systems developed by <span class="trademark">Microsoft</span>® Corporation.
    </p><p>
        Wikipedia has a good historical description of the Open Source Philosophy
        <a class="ulink" href="http://en.wikipedia.org/wiki/Open_source" target="_top">here</a>.
        You can also find helpful information on how to participate in the Linux Community
        <a class="ulink" href="http://ldn.linuxfoundation.org/book/how-participate-linux-community" target="_top">here</a>.
    </p></div><div class="section" title="3.2. Using the Yocto Project in a Team Environment"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="usingpoky-changes-collaborate">3.2. Using the Yocto Project in a Team Environment<span class="permalink"><a alt="Permalink" title="Permalink" href="#usingpoky-changes-collaborate">¶</a></span></h2></div></div></div><p>
        It might not be immediately clear how you can use the Yocto
        Project in a team environment, or scale it for a large team of
        developers.
        One of the strengths of the Yocto Project is that it is extremely
        flexible.
        Thus, you can adapt it to many different use cases and scenarios.
        However, these characteristics can cause a struggle if you are trying
        to create a working setup that scales across a large team.
    </p><p>
        To help with these types of situations, this section presents
        some of the project's most successful experiences,
        practices, solutions, and available technologies that work well.
        Keep in mind, the information here is a starting point.
        You can build off it and customize it to fit any
        particular working environment and set of practices.
    </p><div class="section" title="3.2.1. System Configurations"><div class="titlepage"><div><div><h3 class="title" id="best-practices-system-configurations">3.2.1. System Configurations<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-system-configurations">¶</a></span></h3></div></div></div><p>
            Systems across a large team should meet the needs of
            two types of developers: those working on the contents of the
            operating system image itself and those developing applications.
            Regardless of the type of developer, their workstations must
            be both reasonably powerful and run Linux.
        </p><div class="section" title="3.2.1.1. Application Development"><div class="titlepage"><div><div><h4 class="title" id="best-practices-application-development">3.2.1.1. Application Development<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-application-development">¶</a></span></h4></div></div></div><p>
                For developers who mainly do application level work
                on top of an existing software stack,
                the following list shows practices that work best.
                For information on using a Software Development Kit (SDK), see
                the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html#sdk-intro" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Use a pre-built toolchain that
                        contains the software stack itself.
                        Then, develop the application code on top of the
                        stack.
                        This method works well for small numbers of relatively
                        isolated applications.</p></li><li class="listitem"><p>When possible, use the Yocto Project
                        plug-in for the <span class="trademark">Eclipse</span>™ IDE
                        and SDK development practices.
                        For more information, see the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>".
                        </p></li><li class="listitem"><p>Keep your cross-development toolchains
                        updated.
                        You can do this through provisioning either as new
                        toolchain downloads or as updates through a package
                        update mechanism using <code class="filename">opkg</code>
                        to provide updates to an existing toolchain.
                        The exact mechanics of how and when to do this are a
                        question for local policy.</p></li><li class="listitem"><p>Use multiple toolchains installed locally
                        into different locations to allow development across
                        versions.</p></li></ul></div><p>
            </p></div><div class="section" title="3.2.1.2. Core System Development"><div class="titlepage"><div><div><h4 class="title" id="best-practices-core-system-development">3.2.1.2. Core System Development<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-core-system-development">¶</a></span></h4></div></div></div><p>
                For core system development, it is often best to have the
                build system itself available on the developer workstations
                so developers can run their own builds and directly
                rebuild the software stack.
                You should keep the core system unchanged as much as
                possible and do your work in layers on top of the core system.
                Doing so gives you a greater level of portability when
                upgrading to new versions of the core system or Board
                Support Packages (BSPs).
                You can share layers amongst the developers of a particular
                project and contain the policy configuration that defines
                the project.
            </p><p>
                Aside from the previous best practices, there exists a number
                of tips and tricks that can help speed up core development
                projects:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Use a
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#shared-state-cache" target="_top">Shared State Cache</a>
                        (sstate) among groups of developers who are on a
                        fast network.
                        The best way to share sstate is through a
                        Network File System (NFS) share.
                        The first user to build a given component for the
                        first time contributes that object to the sstate,
                        while subsequent builds from other developers then
                        reuse the object rather than rebuild it themselves.
                        </p><p>Although it is possible to use other protocols for the
                        sstate such as HTTP and FTP, you should avoid these.
                        Using HTTP limits the sstate to read-only and
                        FTP provides poor performance.
                        </p></li><li class="listitem"><p>Have autobuilders contribute to the sstate
                        pool similarly to how the developer workstations
                        contribute.
                        For information, see the
                        "<a class="link" href="#best-practices-autobuilders" title="3.2.3. Autobuilders">Autobuilders</a>"
                        section.</p></li><li class="listitem"><p>Build stand-alone tarballs that contain
                        "missing" system requirements if for some reason
                        developer workstations do not meet minimum system
                        requirements such as latest Python versions,
                        <code class="filename">chrpath</code>, or other tools.
                        You can install and relocate the tarball exactly as you
                        would the usual cross-development toolchain so that
                        all developers can meet minimum version requirements
                        on most distributions.</p></li><li class="listitem"><p>Use a small number of shared,
                        high performance systems for testing purposes
                        (e.g. dual, six-core Xeons with 24 Gbytes of RAM
                        and plenty of disk space).
                        Developers can use these systems for wider, more
                        extensive testing while they continue to develop
                        locally using their primary development system.
                        </p></li><li class="listitem"><p>Enable the PR Service when package feeds
                        need to be incremental with continually increasing
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top">PR</a>
                        values.
                        Typically, this situation occurs when you use or
                        publish package feeds and use a shared state.
                        You should enable the PR Service for all users who
                        use the shared state pool.
                        For more information on the PR Service, see the
                        "<a class="link" href="#working-with-a-pr-service" title="5.18.2.1. Working With a PR Service">Working With a PR Service</a>".
                        </p></li></ul></div><p>
            </p></div></div><div class="section" title="3.2.2. Source Control Management (SCM)"><div class="titlepage"><div><div><h3 class="title" id="best-practices-source-control-management">3.2.2. Source Control Management (SCM)<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-source-control-management">¶</a></span></h3></div></div></div><p>
            Keeping your
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/dev-manual/dev-manual.html#metadata" target="_top">Metadata</a>
            and any software you are developing under the
            control of an SCM system that is compatible
            with the OpenEmbedded build system is advisable.
            Of the SCMs BitBake supports, the
            Yocto Project team strongly recommends using
            <a class="link" href="#git" title="3.6. Git">Git</a>.
            Git is a distributed system that is easy to backup,
            allows you to work remotely, and then connects back to the
            infrastructure.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                For information about BitBake, see the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html" target="_top">BitBake User Manual</a>.
            </div><p>
        </p><p>
            It is relatively easy to set up Git services and create
            infrastructure like
            <a class="ulink" href="http://git.yoctoproject.org" target="_top">http://git.yoctoproject.org</a>,
            which is based on server software called
            <code class="filename">gitolite</code> with <code class="filename">cgit</code>
            being used to generate the web interface that lets you view the
            repositories.
            The <code class="filename">gitolite</code> software identifies users
            using SSH keys and allows branch-based
            access controls to repositories that you can control as little
            or as much as necessary.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            The setup of these services is beyond the scope of this manual.
            However, sites such as these exist that describe how to perform
            setup:
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://git-scm.com/book/ch4-8.html" target="_top">Git documentation</a>:
                    Describes how to install <code class="filename">gitolite</code>
                    on the server.</p></li><li class="listitem"><p><a class="ulink" href="http://sitaramc.github.com/gitolite/master-toc.html" target="_top">The <code class="filename">gitolite</code> master index</a>:
                    All topics for <code class="filename">gitolite</code>.
                    </p></li><li class="listitem"><p><a class="ulink" href="https://git.wiki.kernel.org/index.php/Interfaces,_frontends,_and_tools" target="_top">Interfaces, frontends, and tools</a>:
                    Documentation on how to create interfaces and frontends
                    for Git.</p></li></ul></div></div></div><div class="section" title="3.2.3. Autobuilders"><div class="titlepage"><div><div><h3 class="title" id="best-practices-autobuilders">3.2.3. Autobuilders<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-autobuilders">¶</a></span></h3></div></div></div><p>
            Autobuilders are often the core of a development project.
            It is here that changes from individual developers are brought
            together and centrally tested and subsequent decisions about
            releases can be made.
            Autobuilders also allow for "continuous integration" style
            testing of software components and regression identification
            and tracking.
        </p><p>
            See "<a class="ulink" href="http://autobuilder.yoctoproject.org" target="_top">Yocto Project Autobuilder</a>"
            for more information and links to buildbot.
            The Yocto Project team has found this implementation
            works well in this role.
            A public example of this is the Yocto Project
            Autobuilders, which we use to test the overall health of the
            project.
        </p><p>
            The features of this system are:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Highlights when commits break the build.
                    </p></li><li class="listitem"><p>Populates an sstate cache from which
                    developers can pull rather than requiring local
                    builds.</p></li><li class="listitem"><p>Allows commit hook triggers,
                    which trigger builds when commits are made.
                    </p></li><li class="listitem"><p>Allows triggering of automated image booting
                    and testing under the QuickEMUlator (QEMU).
                    </p></li><li class="listitem"><p>Supports incremental build testing and
                    from-scratch builds.</p></li><li class="listitem"><p>Shares output that allows developer
                    testing and historical regression investigation.
                    </p></li><li class="listitem"><p>Creates output that can be used for releases.
                    </p></li><li class="listitem"><p>Allows scheduling of builds so that resources
                    can be used efficiently.</p></li></ul></div><p>
        </p></div><div class="section" title="3.2.4. Policies and Change Flow"><div class="titlepage"><div><div><h3 class="title" id="best-practices-policies-and-change-flow">3.2.4. Policies and Change Flow<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-policies-and-change-flow">¶</a></span></h3></div></div></div><p>
            The Yocto Project itself uses a hierarchical structure and a
            pull model.
            Scripts exist to create and send pull requests
            (i.e. <code class="filename">create-pull-request</code> and
            <code class="filename">send-pull-request</code>).
            This model is in line with other open source projects where
            maintainers are responsible for specific areas of the project
            and a single maintainer handles the final "top-of-tree" merges.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            You can also use a more collective push model.
            The <code class="filename">gitolite</code> software supports both the
            push and pull models quite easily.
        </div><p>
            As with any development environment, it is important
            to document the policy used as well as any main project
            guidelines so they are understood by everyone.
            It is also a good idea to have well structured
            commit messages, which are usually a part of a project's
            guidelines.
            Good commit messages are essential when looking back in time and
            trying to understand why changes were made.
        </p><p>
            If you discover that changes are needed to the core layer of the
            project, it is worth sharing those with the community as soon
            as possible.
            Chances are if you have discovered the need for changes, someone
            else in the community needs them also.
        </p></div><div class="section" title="3.2.5. Summary"><div class="titlepage"><div><div><h3 class="title" id="best-practices-summary">3.2.5. Summary<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-summary">¶</a></span></h3></div></div></div><p>
            This section summarizes the key recommendations described in the
            previous sections:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Use <a class="link" href="#git" title="3.6. Git">Git</a>
                    as the source control system.</p></li><li class="listitem"><p>Maintain your Metadata in layers that make sense
                    for your situation.
                    See the "<a class="link" href="#understanding-and-creating-layers" title="5.1. Understanding and Creating Layers">Understanding
                    and Creating Layers</a>" section for more information on
                    layers.</p></li><li class="listitem"><p>
                    Separate the project's Metadata and code by using
                    separate Git repositories.
                    See the
                    "<a class="link" href="#yocto-project-repositories" title="3.3. Yocto Project Source Repositories">Yocto Project Source Repositories</a>"
                    section for information on these repositories.
                    See the
                    "<a class="link" href="#getting-setup" title="2.2. Getting Set Up">Getting Set Up</a>"
                    section for information on how to set up local Git
                    repositories for related upstream Yocto Project
                    Git repositories.
                    </p></li><li class="listitem"><p>Set up the directory for the shared state cache
                    (<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SSTATE_DIR" target="_top"><code class="filename">SSTATE_DIR</code></a>)
                    where it makes sense.
                    For example, set up the sstate cache on a system used
                    by developers in the same organization and share the
                    same source directories on their machines.
                    </p></li><li class="listitem"><p>Set up an Autobuilder and have it populate the
                    sstate cache and source directories.</p></li><li class="listitem"><p>The Yocto Project community encourages you
                    to send patches to the project to fix bugs or add features.
                    If you do submit patches, follow the project commit
                    guidelines for writing good commit messages.
                    See the "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
                    section.</p></li><li class="listitem"><p>Send changes to the core sooner than later
                    as others are likely to run into the same issues.
                    For some guidance on mailing lists to use, see the list in the
                    "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
                    section.
                    For a description of the available mailing lists, see the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#resources-mailinglist" target="_top">Mailing Lists</a>"
                    section in the Yocto Project Reference Manual.
                    </p></li></ul></div><p>
        </p></div></div><div class="section" title="3.3. Yocto Project Source Repositories"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="yocto-project-repositories">3.3. Yocto Project Source Repositories<span class="permalink"><a alt="Permalink" title="Permalink" href="#yocto-project-repositories">¶</a></span></h2></div></div></div><p>
        The Yocto Project team maintains complete source repositories for all
        Yocto Project files at
        <a class="ulink" href="http://git.yoctoproject.org/cgit/cgit.cgi" target="_top">http://git.yoctoproject.org/cgit/cgit.cgi</a>.
        This web-based source code browser is organized into categories by
        function such as IDE Plugins, Matchbox, Poky, Yocto Linux Kernel, and
        so forth.
        From the interface, you can click on any particular item in the "Name"
        column and see the URL at the bottom of the page that you need to clone
        a Git repository for that particular item.
        Having a local Git repository of the
        <a class="link" href="#source-directory">Source Directory</a>, which is
        usually named "poky", allows
        you to make changes, contribute to the history, and ultimately enhance
        the Yocto Project's tools, Board Support Packages, and so forth.
    </p><p>
        For any supported release of Yocto Project, you can also go to the
        <a class="ulink" href="http://www.yoctoproject.org" target="_top">Yocto Project Website</a> and
        select the "Downloads" tab and get a released tarball of the
        <code class="filename">poky</code> repository or any supported BSP tarballs.
        Unpacking these tarballs gives you a snapshot of the released
        files.
        </p><div class="note" title="Notes" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Notes</h3><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    The recommended method for setting up the Yocto Project
                    <a class="link" href="#source-directory">Source Directory</a>
                    and the files for supported BSPs
                    (e.g., <code class="filename">meta-intel</code>) is to use
                    <a class="link" href="#git" title="3.6. Git">Git</a> to create a local copy of
                    the upstream repositories.
                    </p></li><li class="listitem"><p>
                    Be sure to always work in matching branches for both
                    the selected BSP repository and the
                    <a class="link" href="#source-directory">Source Directory</a>
                    (i.e. <code class="filename">poky</code>) repository.
                    For example, if you have checked out the "master" branch
                    of <code class="filename">poky</code> and you are going to use
                    <code class="filename">meta-intel</code>, be sure to checkout the
                    "master" branch of <code class="filename">meta-intel</code>.
                    </p></li></ul></div></div><p>
    </p><p>
        In summary, here is where you can get the project files needed for development:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="source-repositories"></a><span class="emphasis"><em><a class="ulink" href="http://git.yoctoproject.org/cgit/cgit.cgi" target="_top">Source Repositories:</a></em></span>
                This area contains IDE Plugins, Matchbox, Poky, Poky Support, Tools, Yocto Linux Kernel, and Yocto
                Metadata Layers.
                You can create local copies of Git repositories for each of these areas.</p><p>
                </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 360px"><td align="center"><img src="figures/source-repos.png" align="middle" width="540" /></td></tr></table><p>
                </p></li><li class="listitem"><p><a id="index-downloads"></a><span class="emphasis"><em><a class="ulink" href="http://downloads.yoctoproject.org/releases/" target="_top">Index of /releases:</a></em></span>
                This is an index of releases such as
                the <span class="trademark">Eclipse</span>™
                Yocto Plug-in, miscellaneous support, Poky, Pseudo, installers for cross-development toolchains,
                and all released versions of Yocto Project in the form of images or tarballs.
                Downloading and extracting these files does not produce a local copy of the
                Git repository but rather a snapshot of a particular release or image.</p><p>
                </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 315px"><td align="center"><img src="figures/index-downloads.png" align="middle" height="315" /></td></tr></table><p>
                </p></li><li class="listitem"><p><span class="emphasis"><em>"Downloads" page for the
                <a class="ulink" href="http://www.yoctoproject.org" target="_top">Yocto Project Website</a>:</em></span>
                Access this page by going to the website and then selecting
                the "Downloads" tab.
                This page allows you to download any Yocto Project
                release or Board Support Package (BSP) in tarball form.
                The tarballs are similar to those found in the
                <a class="ulink" href="http://downloads.yoctoproject.org/releases/" target="_top">Index of /releases:</a> area.</p><p>
                </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 360px"><td align="center"><img src="figures/yp-download.png" align="middle" width="540" /></td></tr></table><p>
            </p></li></ul></div><p>
    </p></div><div class="section" title="3.4. Yocto Project Terms"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="yocto-project-terms">3.4. Yocto Project Terms<span class="permalink"><a alt="Permalink" title="Permalink" href="#yocto-project-terms">¶</a></span></h2></div></div></div><p>
        Following is a list of terms and definitions users new to the Yocto Project development
        environment might find helpful.
        While some of these terms are universal, the list includes them just in case:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Append Files:</em></span> Files that append build information to
                a recipe file.
                Append files are known as BitBake append files and <code class="filename">.bbappend</code> files.
                The OpenEmbedded build system expects every append file to have a corresponding
                recipe (<code class="filename">.bb</code>) file.
                Furthermore, the append file and corresponding recipe file
                must use the same root filename.
                The filenames can differ only in the file type suffix used (e.g.
                <code class="filename">formfactor_0.0.bb</code> and <code class="filename">formfactor_0.0.bbappend</code>).
                </p><p>Information in append files extends or overrides the
                information in the similarly-named recipe file.
                For an example of an append file in use, see the
                "<a class="link" href="#using-bbappend-files" title="5.1.6. Using .bbappend Files">Using .bbappend Files</a>" section.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Append files can also use wildcard patterns in their version numbers
                    so they can be applied to more than one version of the underlying recipe file.
                </div><p>
                </p></li><li class="listitem"><p><a id="bitbake-term"></a><span class="emphasis"><em>BitBake:</em></span>
                The task executor and scheduler used by the OpenEmbedded build
                system to build images.
                For more information on BitBake, see the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html" target="_top">BitBake User Manual</a>.
                </p></li><li class="listitem"><p><a id="build-directory"></a><span class="emphasis"><em>Build Directory:</em></span>
                This term refers to the area used by the OpenEmbedded build
                system for builds.
                The area is created when you <code class="filename">source</code> the
                setup environment script that is found in the Source Directory
                (i.e. <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                or
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>).
                The <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TOPDIR" target="_top"><code class="filename">TOPDIR</code></a>
                variable points to the Build Directory.</p><p>
                    You have a lot of flexibility when creating the Build
                    Directory.
                    Following are some examples that show how to create the
                    directory.
                    The examples assume your
                    <a class="link" href="#source-directory">Source Directory</a> is
                    named <code class="filename">poky</code>:
                   </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Create the Build Directory inside your
                            Source Directory and let the name of the Build
                            Directory default to <code class="filename">build</code>:
                            </p><pre class="literallayout">
     $ cd $HOME/poky
     $ source oe-init-build-env
                            </pre></li><li class="listitem"><p>Create the Build Directory inside your
                            home directory and specifically name it
                            <code class="filename">test-builds</code>:
                            </p><pre class="literallayout">
     $ cd $HOME
     $ source poky/oe-init-build-env test-builds
                            </pre></li><li class="listitem"><p>
                            Provide a directory path and
                            specifically name the Build Directory.
                            Any intermediate folders in the pathname must
                            exist.
                            This next example creates a Build Directory named
                            <code class="filename">YP-18.0.0</code>
                            in your home directory within the existing
                            directory <code class="filename">mybuilds</code>:
                            </p><pre class="literallayout">
     $cd $HOME
     $ source $HOME/poky/oe-init-build-env $HOME/mybuilds/YP-18.0.0
                            </pre></li></ul></div><p>
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        By default, the Build Directory contains
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TMPDIR" target="_top"><code class="filename">TMPDIR</code></a>,
                        which is a temporary directory the build system uses for
                        its work.
                        <code class="filename">TMPDIR</code> cannot be under NFS.
                        Thus, by default, the Build Directory cannot be under NFS.
                        However, if you need the Build Directory to be under NFS,
                        you can set this up by setting <code class="filename">TMPDIR</code>
                        in your <code class="filename">local.conf</code> file
                        to use a local drive.
                        Doing so effectively separates <code class="filename">TMPDIR</code>
                        from <code class="filename">TOPDIR</code>, which is the Build
                        Directory.
                    </div><p>
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Classes:</em></span> Files that provide for logic encapsulation
                and inheritance so that commonly used patterns can be defined once and then easily used
                in multiple recipes.
                For reference information on the Yocto Project classes, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes" target="_top">Classes</a>" chapter of the
                Yocto Project Reference Manual.
                Class files end with the <code class="filename">.bbclass</code> filename extension.
                </p></li><li class="listitem"><p><span class="emphasis"><em>Configuration File:</em></span>
                Configuration information in various <code class="filename">.conf</code>
                files provides global definitions of variables.
                The <code class="filename">conf/local.conf</code> configuration file in
                the
                <a class="link" href="#build-directory">Build Directory</a>
                contains user-defined variables that affect every build.
                The <code class="filename">meta-poky/conf/distro/poky.conf</code>
                configuration file defines Yocto "distro" configuration
                variables used only when building with this policy.
                Machine configuration files, which
                are located throughout the
                <a class="link" href="#source-directory">Source Directory</a>, define
                variables for specific hardware and are only used when building
                for that target (e.g. the
                <code class="filename">machine/beaglebone.conf</code> configuration
                file defines variables for the Texas Instruments ARM Cortex-A8
                development board).
                Configuration files end with a <code class="filename">.conf</code>
                filename extension.
                </p></li><li class="listitem"><p><a id="cross-development-toolchain"></a>
                <span class="emphasis"><em>Cross-Development Toolchain:</em></span>
                    In general, a cross-development toolchain is a collection of
                    software development tools and utilities that run on one
                    architecture and allow you to develop software for a
                    different, or targeted, architecture.
                    These toolchains contain cross-compilers, linkers, and
                    debuggers that are specific to the target architecture.
                </p><p>The Yocto Project supports two different cross-development
                    toolchains:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>A toolchain only used by and within
                            BitBake when building an image for a target
                            architecture.</p></li><li class="listitem"><p>A relocatable toolchain used outside of
                            BitBake by developers when developing applications
                            that will run on a targeted device.
                            </p></li></ul></div><p>
                </p><p>
                    Creation of these toolchains is simple and automated.
                    For information on toolchain concepts as they apply to the
                    Yocto Project, see the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#cross-development-toolchain-generation" target="_top">Cross-Development Toolchain Generation</a>"
                    section in the Yocto Project Reference Manual.
                    You can also find more information on using the
                    relocatable toolchain in the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>.
                </p></li><li class="listitem"><p><span class="emphasis"><em>Image:</em></span>
                An image is an artifact of the BitBake build process given
                a collection of recipes and related Metadata.
                Images are the binary output that run on specific hardware or
                QEMU and are used for specific use-cases.
                For a list of the supported image types that the Yocto Project provides, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-images" target="_top">Images</a>"
                chapter in the Yocto Project Reference Manual.</p></li><li class="listitem"><p><a id="layer"></a><span class="emphasis"><em>Layer:</em></span> A collection of recipes representing the core,
                a BSP, or an application stack.
                For a discussion specifically on BSP Layers, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-layers" target="_top">BSP Layers</a>"
                section in the Yocto Project Board Support Packages (BSP)
                Developer's Guide.</p></li><li class="listitem"><p><a id="metadata"></a><span class="emphasis"><em>Metadata:</em></span>
                The files that BitBake parses when building an image.
                In general, Metadata includes recipes, classes, and
                configuration files.
                In the context of the kernel ("kernel Metadata"),
                it refers to Metadata in the <code class="filename">meta</code>
                branches of the kernel source Git repositories.
                </p></li><li class="listitem"><p><a id="oe-core"></a><span class="emphasis"><em>OE-Core:</em></span> A core set of Metadata originating
                with OpenEmbedded (OE) that is shared between OE and the Yocto Project.
                This Metadata is found in the <code class="filename">meta</code> directory of the
                <a class="link" href="#source-directory">Source Directory</a>.</p></li><li class="listitem"><p><a id="build-system-term"></a><span class="emphasis"><em>OpenEmbedded Build System:</em></span>
                The build system specific to the Yocto Project.
                The OpenEmbedded build system is based on another project known
                as "Poky", which uses
                <a class="link" href="#bitbake-term">BitBake</a> as the task
                executor.
                Throughout the Yocto Project documentation set, the
                OpenEmbedded build system is sometimes referred to simply
                as "the build system".
                If other build systems, such as a host or target build system
                are referenced, the documentation clearly states the
                difference.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    For some historical information about Poky, see the
                    <a class="link" href="#poky">Poky</a> term.
                </div><p>
                </p></li><li class="listitem"><p><span class="emphasis"><em>Package:</em></span>
                In the context of the Yocto Project, this term refers to a
                recipe's packaged output produced by BitBake (i.e. a
                "baked recipe").
                A package is generally the compiled binaries produced from the
                recipe's sources.
                You "bake" something by running it through BitBake.</p><p>It is worth noting that the term "package" can, in general, have subtle
                meanings.  For example, the packages referred to in the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#packages" target="_top">The Build Host Packages</a>" section are
                compiled binaries that, when installed, add functionality to your Linux
                distribution.</p><p>Another point worth noting is that historically within the Yocto Project,
                recipes were referred to as packages - thus, the existence of several BitBake
                variables that are seemingly mis-named,
                (e.g. <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top"><code class="filename">PR</code></a>,
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>, and
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PE" target="_top"><code class="filename">PE</code></a>).
                </p></li><li class="listitem"><p><span class="emphasis"><em>Package Groups:</em></span>
                Arbitrary groups of software Recipes.
                You use package groups to hold recipes that, when built,
                usually accomplish a single task.
                For example, a package group could contain the recipes for a
                company’s proprietary or value-add software.
                Or, the package group could contain the recipes that enable
                graphics.
                A package group is really just another recipe.
                Because package group files are recipes, they end with the
                <code class="filename">.bb</code> filename extension.</p></li><li class="listitem"><p><a id="poky"></a><span class="emphasis"><em>Poky:</em></span>
                The term "poky" can mean several things.
                In its most general sense, it is an open-source
                project that was initially developed by OpenedHand.
                With OpenedHand, poky was developed off of the existing
                OpenEmbedded build system becoming a commercially
                supportable build system for embedded Linux.
                After Intel Corporation acquired OpenedHand, the
                project poky became the basis for the Yocto Project's
                build system.</p><p>Within the Yocto Project source repositories,
                <code class="filename">poky</code> exists as a separate Git
                repository you can clone to yield a local copy on your
                host system.
                Thus, "poky" can refer to the local copy of the Source
                Directory used for development within the Yocto
                Project.</p><p>Finally, "poky" can refer to the default
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO" target="_top"><code class="filename">DISTRO</code></a>
                (i.e. distribution) created when you use the Yocto
                Project in conjunction with the
                <code class="filename">poky</code> repository to build an image.
                </p></li><li class="listitem"><p><span class="emphasis"><em>Recipe:</em></span>
                A set of instructions for building packages.
                A recipe describes where you get source code, which patches
                to apply, how to configure the source, how to compile it and so on.
                Recipes also describe dependencies for libraries or for other
                recipes.
                Recipes represent the logical unit of execution, the software
                to build, the images to build, and use the
                <code class="filename">.bb</code> file extension.
                </p></li><li class="listitem"><p><a id="source-directory"></a><span class="emphasis"><em>Source Directory:</em></span>
                This term refers to the directory structure created as a result
                of creating a local copy of the <code class="filename">poky</code> Git
                repository <code class="filename">git://git.yoctoproject.org/poky</code>
                or expanding a released <code class="filename">poky</code> tarball.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Creating a local copy of the <code class="filename">poky</code>
                    Git repository is the recommended method for setting up
                    your Source Directory.
                </div><p>
                Sometimes you might hear the term "poky directory" used to refer
                to this directory structure.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    The OpenEmbedded build system does not support file or
                    directory names that contain spaces.
                    Be sure that the Source Directory you use does not contain
                    these types of names.
                </div><p>The Source Directory contains BitBake, Documentation,
                Metadata and other files that all support the Yocto Project.
                Consequently, you must have the Source Directory in place on
                your development system in order to do any development using
                the Yocto Project.</p><p>When you create a local copy of the Git repository, you
                can name the repository anything you like.
                Throughout much of the documentation, "poky"
                is used as the name of the top-level folder of the local copy of
                the poky Git repository.
                So, for example, cloning the <code class="filename">poky</code> Git
                repository results in a local Git repository whose top-level
                folder is also named "poky".</p><p>While it is not recommended that you use tarball expansion
                to set up the Source Directory, if you do, the top-level
                directory name of the Source Directory is derived from the
                Yocto Project release tarball.
                For example, downloading and unpacking
                <code class="filename">poky-pyro-18.0.0.tar.bz2</code> results in a
                Source Directory whose root folder is named
                <code class="filename">poky-pyro-18.0.0</code>.</p><p>It is important to understand the differences between the
                Source Directory created by unpacking a released tarball as
                compared to cloning
                <code class="filename">git://git.yoctoproject.org/poky</code>.
                When you unpack a tarball, you have an exact copy of the files
                based on the time of release - a fixed release point.
                Any changes you make to your local files in the Source Directory
                are on top of the release and will remain local only.
                On the other hand, when you clone the <code class="filename">poky</code>
                Git repository, you have an active development repository with
                access to the upstream repository's branches and tags.
                In this case, any local changes you make to the local
                Source Directory can be later applied to active development
                branches of the upstream <code class="filename">poky</code> Git
                repository.</p><p>For more information on concepts related to Git
                repositories, branches, and tags, see the
                "<a class="link" href="#repositories-tags-and-branches" title="3.6.1. Repositories, Tags, and Branches">Repositories, Tags, and Branches</a>"
                section.</p></li><li class="listitem"><p><span class="emphasis"><em>Task:</em></span>
                A unit of execution for BitBake (e.g.
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-compile" target="_top"><code class="filename">do_compile</code></a>,
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-fetch" target="_top"><code class="filename">do_fetch</code></a>,
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-patch" target="_top"><code class="filename">do_patch</code></a>,
                and so forth).
                </p></li><li class="listitem"><p><span class="emphasis"><em>Upstream:</em></span> A reference to source code or repositories
                that are not local to the development system but located in a master area that is controlled
                by the maintainer of the source code.
                For example, in order for a developer to work on a particular piece of code, they need to
                first get a copy of it from an "upstream" source.</p></li></ul></div><p>
    </p></div><div class="section" title="3.5. Licensing"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="licensing">3.5. Licensing<span class="permalink"><a alt="Permalink" title="Permalink" href="#licensing">¶</a></span></h2></div></div></div><p>
        Because open source projects are open to the public, they have different licensing structures in place.
        License evolution for both Open Source and Free Software has an interesting history.
        If you are interested in this history, you can find basic information here:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://en.wikipedia.org/wiki/Open-source_license" target="_top">Open source license history</a>
            </p></li><li class="listitem"><p><a class="ulink" href="http://en.wikipedia.org/wiki/Free_software_license" target="_top">Free software license
            history</a></p></li></ul></div><p>
    </p><p>
        In general, the Yocto Project is broadly licensed under the Massachusetts Institute of Technology
        (MIT) License.
        MIT licensing permits the reuse of software within proprietary software as long as the
        license is distributed with that software.
        MIT is also compatible with the GNU General Public License (GPL).
        Patches to the Yocto Project follow the upstream licensing scheme.
        You can find information on the MIT license
        <a class="ulink" href="http://www.opensource.org/licenses/mit-license.php" target="_top">here</a>.
        You can find information on the GNU GPL <a class="ulink" href="http://www.opensource.org/licenses/LGPL-3.0" target="_top">
        here</a>.
    </p><p>
        When you build an image using the Yocto Project, the build process uses a
        known list of licenses to ensure compliance.
        You can find this list in the
        <a class="link" href="#source-directory">Source Directory</a> at
        <code class="filename">meta/files/common-licenses</code>.
        Once the build completes, the list of all licenses found and used during that build are
        kept in the
        <a class="link" href="#build-directory">Build Directory</a> at
        <code class="filename">tmp/deploy/licenses</code>.
    </p><p>
        If a module requires a license that is not in the base list, the build process
        generates a warning during the build.
        These tools make it easier for a developer to be certain of the licenses with which
        their shipped products must comply.
        However, even with these tools it is still up to the developer to resolve potential licensing issues.
    </p><p>
        The base list of licenses used by the build process is a combination of the Software Package
        Data Exchange (SPDX) list and the Open Source Initiative (OSI) projects.
        <a class="ulink" href="http://spdx.org" target="_top">SPDX Group</a> is a working group of the Linux Foundation
        that maintains a specification
        for a standard format for communicating the components, licenses, and copyrights
        associated with a software package.
        <a class="ulink" href="http://opensource.org" target="_top">OSI</a> is a corporation dedicated to the Open Source
        Definition and the effort for reviewing and approving licenses that
        conform to the Open Source Definition (OSD).
    </p><p>
        You can find a list of the combined SPDX and OSI licenses that the
        Yocto Project uses in the
        <code class="filename">meta/files/common-licenses</code> directory in your
        <a class="link" href="#source-directory">Source Directory</a>.
    </p><p>
        For information that can help you maintain compliance with various
        open source licensing during the lifecycle of a product created using
        the Yocto Project, see the
        "<a class="link" href="#maintaining-open-source-license-compliance-during-your-products-lifecycle" title="5.29. Maintaining Open Source License Compliance During Your Product's Lifecycle">Maintaining Open Source License Compliance During Your Product's Lifecycle</a>"
        section.
    </p></div><div class="section" title="3.6. Git"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="git">3.6. Git<span class="permalink"><a alt="Permalink" title="Permalink" href="#git">¶</a></span></h2></div></div></div><p>
        The Yocto Project makes extensive use of Git,
        which is a free, open source distributed version control system.
        Git supports distributed development, non-linear development, and can handle large projects.
        It is best that you have some fundamental understanding of how Git tracks projects and
        how to work with Git if you are going to use the Yocto Project for development.
        This section provides a quick overview of how Git works and provides you with a summary
        of some essential Git commands.
    </p><p>
        For more information on Git, see
        <a class="ulink" href="http://git-scm.com/documentation" target="_top">http://git-scm.com/documentation</a>.
        If you need to download Git, go to <a class="ulink" href="http://git-scm.com/download" target="_top">http://git-scm.com/download</a>.
    </p><div class="section" title="3.6.1. Repositories, Tags, and Branches"><div class="titlepage"><div><div><h3 class="title" id="repositories-tags-and-branches">3.6.1. Repositories, Tags, and Branches<span class="permalink"><a alt="Permalink" title="Permalink" href="#repositories-tags-and-branches">¶</a></span></h3></div></div></div><p>
            As mentioned earlier in the section
            "<a class="link" href="#yocto-project-repositories" title="3.3. Yocto Project Source Repositories">Yocto Project Source Repositories</a>",
            the Yocto Project maintains source repositories at
            <a class="ulink" href="http://git.yoctoproject.org/cgit.cgi" target="_top">http://git.yoctoproject.org/cgit.cgi</a>.
            If you look at this web-interface of the repositories, each item is a separate
            Git repository.
        </p><p>
            Git repositories use branching techniques that track content change (not files)
            within a project (e.g. a new feature or updated documentation).
            Creating a tree-like structure based on project divergence allows for excellent historical
            information over the life of a project.
            This methodology also allows for an environment from which you can do lots of
            local experimentation on projects as you develop changes or new features.
        </p><p>
            A Git repository represents all development efforts for a given project.
            For example, the Git repository <code class="filename">poky</code> contains all changes
            and developments for Poky over the course of its entire life.
            That means that all changes that make up all releases are captured.
            The repository maintains a complete history of changes.
        </p><p>
            You can create a local copy of any repository by "cloning" it with the Git
            <code class="filename">clone</code> command.
            When you clone a Git repository, you end up with an identical copy of the
            repository on your development system.
            Once you have a local copy of a repository, you can take steps to develop locally.
            For examples on how to clone Git repositories, see the
            "<a class="link" href="#getting-setup" title="2.2. Getting Set Up">Getting Set Up</a>" section.
        </p><p>
            It is important to understand that Git tracks content change and
            not files.
            Git uses "branches" to organize different development efforts.
            For example, the <code class="filename">poky</code> repository has
            several branches that include the current
            <code class="filename">pyro</code> branch, the
            <code class="filename">master</code> branch, and many branches for past
            Yocto Project releases.
            You can see all the branches by going to
            <a class="ulink" href="http://git.yoctoproject.org/cgit.cgi/poky/" target="_top">http://git.yoctoproject.org/cgit.cgi/poky/</a> and
            clicking on the
            <code class="filename"><a class="ulink" href="http://git.yoctoproject.org/cgit.cgi/poky/refs/heads" target="_top">[...]</a></code>
            link beneath the "Branch" heading.
        </p><p>
            Each of these branches represents a specific area of development.
            The <code class="filename">master</code> branch represents the current or most recent
            development.
            All other branches represent offshoots of the <code class="filename">master</code>
            branch.
        </p><p>
            When you create a local copy of a Git repository, the copy has the same set
            of branches as the original.
            This means you can use Git to create a local working area (also called a branch)
            that tracks a specific development branch from the source Git repository.
            in other words, you can define your local Git environment to work on any development
            branch in the repository.
            To help illustrate, here is a set of commands that creates a local copy of the
            <code class="filename">poky</code> Git repository and then creates and checks out a local
            Git branch that tracks the Yocto Project 2.3 Release (Pyro) development:
            </p><pre class="literallayout">
     $ cd ~
     $ git clone git://git.yoctoproject.org/poky
     $ cd poky
     $ git checkout -b pyro origin/pyro
            </pre><p>
            In this example, the name of the top-level directory of your local
            <a class="link" href="#source-directory">Source Directory</a>
            is "poky" and the name of that local working area (local branch)
            you just created and checked out is "pyro".
            The files in your local repository now reflect the same files that
            are in the "pyro" development branch of the
            Yocto Project's "poky" upstream repository.
            It is important to understand that when you create and checkout a
            local working branch based on a branch name,
            your local environment matches the "tip" of that development branch
            at the time you created your local branch, which could be
            different from the files at the time of a similarly named release.
            In other words, creating and checking out a local branch based on
            the "pyro" branch name is not the same as
            cloning and checking out the "master" branch.
            Keep reading to see how you create a local snapshot of a Yocto
            Project Release.
        </p><p>
            Git uses "tags" to mark specific changes in a repository.
            Typically, a tag is used to mark a special point such as the final
            change before a project is released.
            You can see the tags used with the <code class="filename">poky</code> Git
            repository by going to
            <a class="ulink" href="http://git.yoctoproject.org/cgit.cgi/poky/" target="_top">http://git.yoctoproject.org/cgit.cgi/poky/</a> and
            clicking on the
            <code class="filename"><a class="ulink" href="http://git.yoctoproject.org/cgit.cgi/poky/refs/tags" target="_top">[...]</a></code>
            link beneath the "Tag" heading.
        </p><p>
            Some key tags are
            <code class="filename">dizzy-12.0.0</code>,
            <code class="filename">fido-13.0.0</code>,
            <code class="filename">jethro-14.0.0</code>, and
            <code class="filename">pyro-18.0.0</code>.
            These tags represent Yocto Project releases.
        </p><p>
            When you create a local copy of the Git repository, you also have access to all the
            tags.
            Similar to branches, you can create and checkout a local working Git branch based
            on a tag name.
            When you do this, you get a snapshot of the Git repository that reflects
            the state of the files when the change was made associated with that tag.
            The most common use is to checkout a working branch that matches a specific
            Yocto Project release.
            Here is an example:
            </p><pre class="literallayout">
     $ cd ~
     $ git clone git://git.yoctoproject.org/poky
     $ cd poky
     $ git checkout -b my-pyro-18.0.0 pyro-18.0.0
            </pre><p>
            In this example, the name of the top-level directory of your local Yocto Project
            Files Git repository is <code class="filename">poky</code>.
            And, the name of the local branch you have created and checked out is
            <code class="filename">my-pyro-18.0.0</code>.
            The files in your repository now exactly match the Yocto Project 2.3
            Release tag (<code class="filename">pyro-18.0.0</code>).
            It is important to understand that when you create and checkout a local
            working branch based on a tag, your environment matches a specific point
            in time and not the entire development branch.
        </p></div><div class="section" title="3.6.2. Basic Commands"><div class="titlepage"><div><div><h3 class="title" id="basic-commands">3.6.2. Basic Commands<span class="permalink"><a alt="Permalink" title="Permalink" href="#basic-commands">¶</a></span></h3></div></div></div><p>
            Git has an extensive set of commands that lets you manage changes and perform
            collaboration over the life of a project.
            Conveniently though, you can manage with a small set of basic operations and workflows
            once you understand the basic philosophy behind Git.
            You do not have to be an expert in Git to be functional.
            A good place to look for instruction on a minimal set of Git commands is
            <a class="ulink" href="http://git-scm.com/documentation" target="_top">here</a>.
            If you need to download Git, you can do so
            <a class="ulink" href="http://git-scm.com/download" target="_top">here</a>, although
            any reasonably current Linux distribution should already have an
            installable package for Git.
        </p><p>
            If you do not know much about Git, you should educate
            yourself by visiting the links previously mentioned.
        </p><p>
            The following list briefly describes some basic Git operations as a way to get started.
            As with any set of commands, this list (in most cases) simply shows the base command and
            omits the many arguments they support.
            See the Git documentation for complete descriptions and strategies on how to use these commands:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><code class="filename">git init</code>:</em></span> Initializes an empty Git repository.
                    You cannot use Git commands unless you have a <code class="filename">.git</code> repository.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git clone</code>:</em></span>
                    Creates a local clone of a Git repository.
                    During collaboration, this command allows you to create a
                    local Git repository that is on equal footing with a fellow
                    developer’s Git repository.
                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git add</code>:</em></span> Stages updated file contents
                    to the index that
                    Git uses to track changes.
                    You must stage all files that have changed before you can commit them.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git commit</code>:</em></span> Creates a "commit" that documents
                    the changes you made.
                    Commits are used for historical purposes, for determining if a maintainer of a project
                    will allow the change, and for ultimately pushing the change from your local Git repository
                    into the project’s upstream (or master) repository.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git status</code>:</em></span> Reports any modified files that
                    possibly need to be staged and committed.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git checkout</code> <em class="replaceable"><code>branch-name</code></em>:</em></span> Changes
                    your working branch.
                    This command is analogous to "cd".</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git checkout –b</code> <em class="replaceable"><code>working-branch</code></em>:</em></span> Creates
                    a working branch on your local machine where you can isolate work.
                    It is a good idea to use local branches when adding specific features or changes.
                    This way if you do not like what you have done you can easily get rid of the work.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git branch</code>:</em></span> Reports
                    existing local branches and
                    tells you the branch in which you are currently working.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git branch -D</code> <em class="replaceable"><code>branch-name</code></em>:</em></span>
                    Deletes an existing local branch.
                    You need to be in a local branch other than the one you are deleting
                    in order to delete <em class="replaceable"><code>branch-name</code></em>.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git pull</code>:</em></span> Retrieves information
                    from an upstream Git
                    repository and places it in your local Git repository.
                    You use this command to make sure you are synchronized with the repository
                    from which you are basing changes (.e.g. the master branch).</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git push</code>:</em></span>
                    Sends all your committed local changes to an upstream Git
                    repository (e.g. a contribution repository).
                    The maintainer of the project draws from these repositories
                    when adding changes to the project’s master repository or
                    other development branch.
                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git merge</code>:</em></span> Combines or adds changes from one
                    local branch of your repository with another branch.
                    When you create a local Git repository, the default branch is named "master".
                    A typical workflow is to create a temporary branch for isolated work, make and commit your
                    changes, switch to your local master branch, merge the changes from the temporary branch into the
                    local master branch, and then delete the temporary branch.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git cherry-pick</code>:</em></span> Choose and apply specific
                    commits from one branch into another branch.
                    There are times when you might not be able to merge all the changes in one branch with
                    another but need to pick out certain ones.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">gitk</code>:</em></span> Provides a GUI view of the branches
                    and changes in your local Git repository.
                    This command is a good way to graphically see where things have diverged in your
                    local repository.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git log</code>:</em></span> Reports a history of your changes to the
                    repository.</p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">git diff</code>:</em></span> Displays line-by-line differences
                    between your local working files and the same files in the upstream Git repository that your
                    branch currently tracks.</p></li></ul></div><p>
        </p></div></div><div class="section" title="3.7. Workflows"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="workflows">3.7. Workflows<span class="permalink"><a alt="Permalink" title="Permalink" href="#workflows">¶</a></span></h2></div></div></div><p>
        This section provides some overview on workflows using Git.
        In particular, the information covers basic practices that describe roles and actions in a
        collaborative development environment.
        Again, if you are familiar with this type of development environment, you might want to just
        skip this section.
    </p><p>
        The Yocto Project files are maintained using Git in a "master" branch whose Git history
        tracks every change and whose structure provides branches for all diverging functionality.
        Although there is no need to use Git, many open source projects do so.
        For the Yocto Project, a key individual called the "maintainer" is responsible for the "master"
        branch of a given Git repository.
        The "master" branch is the “upstream” repository where the final builds of the project occur.
        The maintainer is responsible for accepting changes from other developers and for
        organizing the underlying branch structure to reflect release strategies and so forth.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>For information on finding out who is responsible for (maintains)
            a particular area of code, see the
            "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
            section.
        </div><p>
    </p><p>
        The project also has an upstream contribution Git repository named
        <code class="filename">poky-contrib</code>.
        You can see all the branches in this repository using the web interface
        of the
        <a class="ulink" href="http://git.yoctoproject.org" target="_top">Source Repositories</a> organized
        within the "Poky Support" area.
        These branches temporarily hold changes to the project that have been
        submitted or committed by the Yocto Project development team and by
        community members who contribute to the project.
        The maintainer determines if the changes are qualified to be moved
        from the "contrib" branches into the "master" branch of the Git
        repository.
    </p><p>
        Developers (including contributing community members) create and maintain cloned repositories
        of the upstream "master" branch.
        These repositories are local to their development platforms and are used to develop changes.
        When a developer is satisfied with a particular feature or change, they "push" the changes
        to the appropriate "contrib" repository.
    </p><p>
        Developers are responsible for keeping their local repository up-to-date with "master".
        They are also responsible for straightening out any conflicts that might arise within files
        that are being worked on simultaneously by more than one person.
        All this work is done locally on the developer’s machines before anything is pushed to a
        "contrib" area and examined at the maintainer’s level.
    </p><p>
        A somewhat formal method exists by which developers commit changes and push them into the
        "contrib" area and subsequently request that the maintainer include them into "master"
        This process is called “submitting a patch” or "submitting a change."
        For information on submitting patches and changes, see the
        "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>" section.
    </p><p>
        To summarize the environment:  a single point of entry exists for
        changes into the project’s "master" branch of the Git repository,
        which is controlled by the project’s maintainer.
        And, a set of developers exist who independently develop, test, and
        submit changes to "contrib" areas for the maintainer to examine.
        The maintainer then chooses which changes are going to become a
        permanent part of the project.
    </p><p>
        </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 270px"><td align="left"><img src="figures/git-workflow.png" align="left" height="270" /></td></tr></table><p>
    </p><p>
        While each development environment is unique, there are some best practices or methods
        that help development run smoothly.
        The following list describes some of these practices.
        For more information about Git workflows, see the workflow topics in the
        <a class="ulink" href="http://book.git-scm.com" target="_top">Git Community Book</a>.
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Make Small Changes:</em></span> It is best to keep the changes you commit
                small as compared to bundling many disparate changes into a single commit.
                This practice not only keeps things manageable but also allows the maintainer
                to more easily include or refuse changes.</p><p>It is also good practice to leave the repository in a state that allows you to
                still successfully build your project.  In other words, do not commit half of a feature,
                then add the other half as a separate, later commit.
                Each commit should take you from one buildable project state to another
                buildable state.</p></li><li class="listitem"><p><span class="emphasis"><em>Use Branches Liberally:</em></span> It is very easy to create, use, and
                delete local branches in your working Git repository.
                You can name these branches anything you like.
                It is helpful to give them names associated with the particular feature or change
                on which you are working.
                Once you are done with a feature or change and have merged it
                into your local master branch, simply discard the temporary
                branch.</p></li><li class="listitem"><p><span class="emphasis"><em>Merge Changes:</em></span> The <code class="filename">git merge</code>
                command allows you to take the
                changes from one branch and fold them into another branch.
                This process is especially helpful when more than a single developer might be working
                on different parts of the same feature.
                Merging changes also automatically identifies any collisions or "conflicts"
                that might happen as a result of the same lines of code being altered by two different
                developers.</p></li><li class="listitem"><p><span class="emphasis"><em>Manage Branches:</em></span> Because branches are easy to use, you should
                use a system where branches indicate varying levels of code readiness.
                For example, you can have a "work" branch to develop in, a "test" branch where the code or
                change is tested, a "stage" branch where changes are ready to be committed, and so forth.
                As your project develops, you can merge code across the branches to reflect ever-increasing
                stable states of the development.</p></li><li class="listitem"><p><span class="emphasis"><em>Use Push and Pull:</em></span> The push-pull workflow is based on the
                concept of developers "pushing" local commits to a remote repository, which is
                usually a contribution repository.
                This workflow is also based on developers "pulling" known states of the project down into their
                local development repositories.
                The workflow easily allows you to pull changes submitted by other developers from the
                upstream repository into your work area ensuring that you have the most recent software
                on which to develop.
                The Yocto Project has two scripts named <code class="filename">create-pull-request</code> and
                <code class="filename">send-pull-request</code> that ship with the release to facilitate this
                workflow.
                You can find these scripts in the <code class="filename">scripts</code>
                folder of the
                <a class="link" href="#source-directory">Source Directory</a>.
                For information on how to use these scripts, see the
                "<a class="link" href="#pushing-a-change-upstream" title="3.9.5. Using Scripts to Push a Change Upstream and Request a Pull">Using Scripts to Push a Change Upstream and Request a Pull</a>" section.
                </p></li><li class="listitem"><p><span class="emphasis"><em>Patch Workflow:</em></span> This workflow allows you to notify the
                maintainer through an email that you have a change (or patch) you would like considered
                for the "master" branch of the Git repository.
                To send this type of change, you format the patch and then send the email using the Git commands
                <code class="filename">git format-patch</code> and <code class="filename">git send-email</code>.
                For information on how to use these scripts, see the
                "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
                section.
                </p></li></ul></div><p>
    </p></div><div class="section" title="3.8. Tracking Bugs"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="tracking-bugs">3.8. Tracking Bugs<span class="permalink"><a alt="Permalink" title="Permalink" href="#tracking-bugs">¶</a></span></h2></div></div></div><p>
        The Yocto Project uses its own implementation of
        <a class="ulink" href="http://www.bugzilla.org/about/" target="_top">Bugzilla</a> to track bugs.
        Implementations of Bugzilla work well for group development because they track bugs and code
        changes, can be used to communicate changes and problems with developers, can be used to
        submit and review patches, and can be used to manage quality assurance.
        The home page for the Yocto Project implementation of Bugzilla is
        <a class="ulink" href="http://bugzilla.yoctoproject.org" target="_top">http://bugzilla.yoctoproject.org</a>.
    </p><p>
        Sometimes it is helpful to submit, investigate, or track a bug against the Yocto Project itself
        such as when discovering an issue with some component of the build system that acts contrary
        to the documentation or your expectations.
        Following is the general procedure for submitting a new bug using the Yocto Project
        Bugzilla.
        You can find more information on defect management, bug tracking, and feature request
        processes all accomplished through the Yocto Project Bugzilla on the
        <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Bugzilla_Configuration_and_Bug_Tracking" target="_top">wiki page</a>.
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Always use the Yocto Project implementation of Bugzilla to submit
                a bug.</p></li><li class="listitem"><p>When submitting a new bug, be sure to choose the appropriate
                Classification, Product, and Component for which the issue was found.
                Defects for the Yocto Project fall into one of seven classifications:
                Yocto Project Components, Infrastructure, Build System &amp; Metadata,
                Documentation, QA/Testing, Runtime and Hardware.
                Each of these Classifications break down into multiple Products and, in some
                cases, multiple Components.</p></li><li class="listitem"><p>Use the bug form to choose the correct Hardware and Architecture
                for which the bug applies.</p></li><li class="listitem"><p>Indicate the Yocto Project version you were using when the issue
                occurred.</p></li><li class="listitem"><p>Be sure to indicate the Severity of the bug.
                Severity communicates how the bug impacted your work.</p></li><li class="listitem"><p>Select the appropriate "Documentation change" item
                for the bug.
                Fixing a bug may or may not affect the Yocto Project
                documentation.</p></li><li class="listitem"><p>Provide a brief summary of the issue.
                Try to limit your summary to just a line or two and be sure to capture the
                essence of the issue.</p></li><li class="listitem"><p>Provide a detailed description of the issue.
                You should provide as much detail as you can about the context, behavior, output,
                and so forth that surrounds the issue.
                You can even attach supporting files for output from logs by
                using the "Add an attachment" button.</p></li><li class="listitem"><p>Be sure to copy the appropriate people in the
                "CC List" for the bug.
                See the "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
                section for information about finding out who is responsible
                for code.</p></li><li class="listitem"><p>Submit the bug by clicking the "Submit Bug" button.</p></li></ol></div><p>
    </p></div><div class="section" title="3.9. How to Submit a Change"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="how-to-submit-a-change">3.9. How to Submit a Change<span class="permalink"><a alt="Permalink" title="Permalink" href="#how-to-submit-a-change">¶</a></span></h2></div></div></div><p>
        Contributions to the Yocto Project and OpenEmbedded are very welcome.
        Because the system is extremely configurable and flexible, we recognize that developers
        will want to extend, configure or optimize it for their specific uses.
        You should send patches to the appropriate mailing list so that they
        can be reviewed and merged by the appropriate maintainer.
    </p><div class="section" title="3.9.1. Overview"><div class="titlepage"><div><div><h3 class="title" id="submit-change-overview">3.9.1. Overview<span class="permalink"><a alt="Permalink" title="Permalink" href="#submit-change-overview">¶</a></span></h3></div></div></div><p>
            The Yocto Project uses a mailing list and patch-based workflow
            that is similar to the Linux kernel but contains important
            differences.
            In general, a mailing list exists through which you can submit
            patches.
            The specific mailing list you need to use depends on the
            location of the code you are changing.
            Each component (e.g. layer) should have a
            <code class="filename">README</code> file that indicates where to send
            the changes and which process to follow.
        </p><p>
            You can send the patch to the mailing list using whichever approach
            you feel comfortable with to generate the patch.
            Once sent, the patch is usually reviewed by the community at large.
            If somebody has concerns with the patch, they will usually voice
            their concern over the mailing list.
            If a patch does not receive any negative reviews, the maintainer of
            the affected layer typically takes the patch, tests it, and then
            based on successful testing, merges the patch.
        </p><p>
            Specific to OpenEmbedded-Core, two commonly used testing trees
            exist:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    <span class="emphasis"><em>"ross/mut" branch:</em></span>
                    The "mut" (master-under-test) tree
                    exists in the <code class="filename">poky-contrib</code> repository
                    in the
                    <a class="ulink" href="http://git.yoctoproject.org" target="_top">Yocto Project source repositories</a>.
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>"master-next" branch:</em></span>
                    This branch is part of the main
                    "poky" repository in the Yocto Project source repositories.
                    </p></li></ul></div><p>
            Maintainers use these branches to test submissions prior to merging
            patches.
            Thus, you can get an idea of the status of a patch based on
            whether the patch has been merged into one of these branches.
        </p><p>
            This system is imperfect and patches can sometimes get lost in the
            flow.
            Asking about the status of a patch is reasonable if the patch
            has been idle for a while with no feedback.
            The Yocto Project does have plans to use
            <a class="ulink" href="https://en.wikipedia.org/wiki/Patchwork_(software)" target="_top">Patchwork</a>
            to track the status of patches and also to automatically preview
            patches.
        </p><p>
            The following sections provide general instructions for both
            pushing changes upstream and for submitting changes as patches.
        </p></div><div class="section" title="3.9.2. Submissions to Poky"><div class="titlepage"><div><div><h3 class="title" id="submit-change-submissions-to-poky">3.9.2. Submissions to Poky<span class="permalink"><a alt="Permalink" title="Permalink" href="#submit-change-submissions-to-poky">¶</a></span></h3></div></div></div><p>
            The "poky" repository, which is the Yocto Project's reference build
            environment, is a hybrid repository that contains several
            individual pieces (e.g. BitBake, OpenEmbedded-Core, meta-yocto,
            documentation, and so forth) built using the combo-layer tool.
            The upstream location used for submitting changes varies by
            component:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    <span class="emphasis"><em>Core Metadata:</em></span>
                    Send your patch to the
                    <a class="ulink" href="http://lists.openembedded.org/mailman/listinfo/openembedded-core" target="_top">openembedded-core</a>
                    mailing list.  For example, a change to anything under
                    the <code class="filename">meta</code> or
                    <code class="filename">scripts</code> directories should be sent
                    to this mailing list.
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>BitBake:</em></span>
                    For changes to BitBake (i.e. anything under the
                    <code class="filename">bitbake</code> directory), send your patch
                    to the
                    <a class="ulink" href="http://lists.openembedded.org/mailman/listinfo/bitbake-devel" target="_top">bitbake-devel</a>
                    mailing list.
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>"meta-yocto-bsp" and "meta-poky" trees:</em></span>
                    These trees are
                    part of the "meta-yocto" repository in the Yocto Project
                    source repositories.
                    Use the
                    <a class="ulink" href="https://lists.yoctoproject.org/listinfo/poky" target="_top">poky</a>
                    mailing list.
                    </p></li></ul></div><p>
        </p></div><div class="section" title="3.9.3. Submissions to Other Layers"><div class="titlepage"><div><div><h3 class="title" id="submit-change-submissions-to-other-layers">3.9.3. Submissions to Other Layers<span class="permalink"><a alt="Permalink" title="Permalink" href="#submit-change-submissions-to-other-layers">¶</a></span></h3></div></div></div><p>
            For changes to other layers hosted in the Yocto Project source
            repositories (i.e. <code class="filename">yoctoproject.org</code>), tools,
            and the Yocto Project documentation, use the
            <a class="ulink" href="https://lists.yoctoproject.org/listinfo/yocto" target="_top">Yocto Project</a>
            general mailing list.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                Sometimes a layer's documentation specifies to use a
                particular mailing list.
                If so, use that list.
            </div><p>
            For additional recipes that do not fit into the core Metadata, you
            should determine which layer the recipe should go into and submit
            the change in the manner recommended by the documentation (e.g.
            the <code class="filename">README</code> file) supplied with the layer.
            If in doubt, please ask on the Yocto general mailing list or on
            the openembedded-devel mailing list.
        </p></div><div class="section" title="3.9.4. Patch Submission Details"><div class="titlepage"><div><div><h3 class="title" id="submit-change-patch-submission-details">3.9.4. Patch Submission Details<span class="permalink"><a alt="Permalink" title="Permalink" href="#submit-change-patch-submission-details">¶</a></span></h3></div></div></div><p>
            When submitting any change, you can check who you should be
            notifying.
            Use either of these methods to find out:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    <span class="emphasis"><em>Maintenance File:</em></span>
                    Examine the <code class="filename">maintainers.inc</code> file, which is
                    located in the
                    <a class="link" href="#source-directory">Source Directory</a>
                    at <code class="filename">meta-poky/conf/distro/include</code>, to
                    see who is responsible for code.
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Search by File:</em></span>
                    Using <a class="link" href="#git" title="3.6. Git">Git</a>, you can enter the
                    following command to bring up a short list of all commits
                    against a specific file:
                    </p><pre class="literallayout">
     git shortlog -- <em class="replaceable"><code>filename</code></em>
                    </pre><p>
                    Just provide the name of the file for which you are interested.
                    The information returned is not ordered by history but does
                    include a list of all committers grouped by name.
                    From the list, you can see who is responsible for the bulk of
                    the changes against the file.
                    </p></li></ul></div><p>
        </p><p>
            For a list of the Yocto Project and related mailing lists, see the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#resources-mailinglist" target="_top">Mailing lists</a>"
            section in the Yocto Project Reference Manual.
        </p><p>
            When you send a patch, be sure to include a "Signed-off-by:"
            line in the same style as required by the Linux kernel.
            Adding this line signifies that you, the submitter, have agreed
            to the Developer's Certificate of Origin 1.1 as follows:
            </p><pre class="literallayout">
     Developer's Certificate of Origin 1.1

     By making a contribution to this project, I certify that:

     (a) The contribution was created in whole or in part by me and I
         have the right to submit it under the open source license
         indicated in the file; or

     (b) The contribution is based upon previous work that, to the best
         of my knowledge, is covered under an appropriate open source
         license and I have the right under that license to submit that
         work with modifications, whether created in whole or in part
         by me, under the same open source license (unless I am
         permitted to submit under a different license), as indicated
         in the file; or

     (c) The contribution was provided directly to me by some other
         person who certified (a), (b) or (c) and I have not modified
         it.

     (d) I understand and agree that this project and the contribution
         are public and that a record of the contribution (including all
         personal information I submit with it, including my sign-off) is
         maintained indefinitely and may be redistributed consistent with
         this project or the open source license(s) involved.
            </pre><p>
        </p><p>
            In a collaborative environment, it is necessary to have some sort
            of standard or method through which you submit changes.
            Otherwise, things could get quite chaotic.
            One general practice to follow is to make small, controlled changes.
            Keeping changes small and isolated aids review, makes
            merging/rebasing easier and keeps the change history clean should
            anyone need to refer to it in future.
        </p><p>
            When you make a commit, you must follow certain standards
            established by the OpenEmbedded and Yocto Project development teams.
            For each commit, you must provide a single-line summary of the
            change and you should almost always provide a more detailed
            description of what you did (i.e. the body of the commit message).
            The only exceptions for not providing a detailed description would
            be if your change is a simple, self-explanatory change that needs
            no further description beyond the summary.
            Here are the guidelines for composing a commit message:
            </p><div class="itemizedlist"><em class="replaceable"><code>bug-id</code></em><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    Provide a single-line, short summary of the change.
                    This summary is typically viewable in the "shortlist" of
                    changes.
                    Thus, providing something short and descriptive that
                    gives the reader a summary of the change is useful when
                    viewing a list of many commits.
                    You should prefix this short description with the recipe
                    name (if changing a recipe), or else with the short form
                    path to the file being changed.
                    </p></li><li class="listitem"><p>
                    For the body of the commit message, provide detailed
                    information that describes what you changed, why you made
                    the change, and the approach you used.
                    It might also be helpful if you mention how you tested
                    the change.
                    Provide as much detail as you can in the body of the
                    commit message.
                    </p></li><li class="listitem"><p>
                    If the change addresses a specific bug or issue that is
                    associated with a bug-tracking ID, include a reference
                    to that ID in your detailed description.
                    For example, the Yocto Project uses a specific convention
                    for bug references - any commit that addresses a specific
                    bug should use the following form for the detailed
                    description:
                    </p><pre class="literallayout">
     Fixes [YOCTO #<em class="replaceable"><code>bug-id</code></em>]

     <em class="replaceable"><code>detailed description of change</code></em>
                    </pre><p>
                    </p></li></ul></div><p>
        </p><p>
            You can find more guidance on creating well-formed commit messages
            at this OpenEmbedded wiki page:
            <a class="ulink" href="http://www.openembedded.org/wiki/Commit_Patch_Message_Guidelines" target="_top">http://www.openembedded.org/wiki/Commit_Patch_Message_Guidelines</a>.
        </p></div><div class="section" title="3.9.5. Using Scripts to Push a Change Upstream and Request a Pull"><div class="titlepage"><div><div><h3 class="title" id="pushing-a-change-upstream">3.9.5. Using Scripts to Push a Change Upstream and Request a Pull<span class="permalink"><a alt="Permalink" title="Permalink" href="#pushing-a-change-upstream">¶</a></span></h3></div></div></div><p>
            The basic flow for pushing a change to an upstream "contrib" Git repository is as follows:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Make your changes in your local Git repository.</p></li><li class="listitem"><p>Stage your changes by using the <code class="filename">git add</code>
                    command on each file you changed.</p></li><li class="listitem"><p>
                    Commit the change by using the
                    <code class="filename">git commit</code> command.
                    Be sure to provide a commit message that follows the
                    project’s commit message standards as described earlier.
                    </p></li><li class="listitem"><p>
                    Push the change to the upstream "contrib" repository by
                    using the <code class="filename">git push</code> command.
                    </p></li><li class="listitem"><p>Notify the maintainer that you have pushed a change by making a pull
                    request.
                    The Yocto Project provides two scripts that conveniently let you generate and send
                    pull requests to the Yocto Project.
                    These scripts are <code class="filename">create-pull-request</code> and
                    <code class="filename">send-pull-request</code>.
                    You can find these scripts in the <code class="filename">scripts</code> directory
                    within the <a class="link" href="#source-directory">Source Directory</a>.</p><p>Using these scripts correctly formats the requests without introducing any
                    whitespace or HTML formatting.
                    The maintainer that receives your patches needs to be able to save and apply them
                    directly from your emails.
                    Using these scripts is the preferred method for sending patches.</p><p>For help on using these scripts, simply provide the
                    <code class="filename">-h</code> argument as follows:
                    </p><pre class="literallayout">
     $ poky/scripts/create-pull-request -h
     $ poky/scripts/send-pull-request -h
                    </pre></li></ul></div><p>
        </p><p>
            You can find general Git information on how to push a change upstream in the
            <a class="ulink" href="http://git-scm.com/book/en/v2/Distributed-Git-Distributed-Workflows" target="_top">Git Community Book</a>.
        </p></div><div class="section" title="3.9.6. Using Email to Submit a Patch"><div class="titlepage"><div><div><h3 class="title" id="submitting-a-patch">3.9.6. Using Email to Submit a Patch<span class="permalink"><a alt="Permalink" title="Permalink" href="#submitting-a-patch">¶</a></span></h3></div></div></div><p>
            You can submit patches without using the <code class="filename">create-pull-request</code> and
            <code class="filename">send-pull-request</code> scripts described in the previous section.
            However, keep in mind, the preferred method is to use the scripts.
        </p><p>
            Depending on the components changed, you need to submit the email to a specific
            mailing list.
            For some guidance on which mailing list to use, see the list in the
            "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
            section.
            For a description of the available mailing lists, see the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#resources-mailinglist" target="_top">Mailing Lists</a>"
            section in the Yocto Project Reference Manual.
        </p><p>
            Here is the general procedure on how to submit a patch through email without using the
            scripts:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Make your changes in your local Git repository.</p></li><li class="listitem"><p>Stage your changes by using the <code class="filename">git add</code>
                    command on each file you changed.</p></li><li class="listitem"><p>Commit the change by using the
                    <code class="filename">git commit --signoff</code> command.
                    Using the <code class="filename">--signoff</code> option identifies you as the person
                    making the change and also satisfies the Developer's Certificate of
                    Origin (DCO) shown earlier.</p><p>When you form a commit, you must follow certain standards established by the
                    Yocto Project development team.
                    See the earlier section
                    "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
                    for Yocto Project commit message standards.</p></li><li class="listitem"><p>Format the commit into an email message.
                    To format commits, use the <code class="filename">git format-patch</code> command.
                    When you provide the command, you must include a revision list or a number of patches
                    as part of the command.
                    For example, either of these two commands takes your most
                    recent single commit and formats it as an email message in
                    the current directory:
                    </p><pre class="literallayout">
     $ git format-patch -1
                    </pre><p>
                    or
                    </p><pre class="literallayout">
     $ git format-patch HEAD~
                    </pre><p>After the command is run, the current directory contains a
                    numbered <code class="filename">.patch</code> file for the commit.</p><p>If you provide several commits as part of the command,
                    the <code class="filename">git format-patch</code> command produces a
                    series of numbered files in the current directory – one for each commit.
                    If you have more than one patch, you should also use the
                    <code class="filename">--cover</code> option with the command, which generates a
                    cover letter as the first "patch" in the series.
                    You can then edit the cover letter to provide a description for
                    the series of patches.
                    For information on the <code class="filename">git format-patch</code> command,
                    see <code class="filename">GIT_FORMAT_PATCH(1)</code> displayed using the
                    <code class="filename">man git-format-patch</code> command.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>If you are or will be a frequent contributor to the Yocto Project
                    or to OpenEmbedded, you might consider requesting a contrib area and the
                    necessary associated rights.</div></li><li class="listitem"><p>Import the files into your mail client by using the
                    <code class="filename">git send-email</code> command.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>In order to use <code class="filename">git send-email</code>, you must have the
                    the proper Git packages installed.
                    For Ubuntu, Debian, and Fedora the package is <code class="filename">git-email</code>.</div><p>The <code class="filename">git send-email</code> command sends email by using a local
                    or remote Mail Transport Agent (MTA) such as
                    <code class="filename">msmtp</code>, <code class="filename">sendmail</code>, or through a direct
                    <code class="filename">smtp</code> configuration in your Git <code class="filename">config</code>
                    file.
                    If you are submitting patches through email only, it is very important
                    that you submit them without any whitespace or HTML formatting that
                    either you or your mailer introduces.
                    The maintainer that receives your patches needs to be able to save and
                    apply them directly from your emails.
                    A good way to verify that what you are sending will be applicable by the
                    maintainer is to do a dry run and send them to yourself and then
                    save and apply them as the maintainer would.</p><p>The <code class="filename">git send-email</code> command is the preferred method
                    for sending your patches since there is no risk of compromising whitespace
                    in the body of the message, which can occur when you use your own mail client.
                    The command also has several options that let you
                    specify recipients and perform further editing of the email message.
                    For information on how to use the <code class="filename">git send-email</code> command,
                    see <code class="filename">GIT-SEND-EMAIL(1)</code> displayed using
                    the <code class="filename">man git-send-email</code> command.
                    </p></li></ul></div><p>
        </p></div></div></div>

    <div class="chapter" title="Chapter 4. Common Development Models" id="dev-manual-model"><div class="titlepage"><div><div><h2 class="title">Chapter 4. Common Development Models<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-manual-model">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="#system-development-model">4.1. System Development Workflow</a></span></dt><dd><dl><dt><span class="section"><a href="#developing-a-board-support-package-bsp">4.1.1. Developing a Board Support Package (BSP)</a></span></dt><dt><span class="section"><a href="#modifying-the-kernel">4.1.2. Modifying the Kernel</a></span></dt></dl></dd><dt><span class="section"><a href="#application-development-workflow-using-an-sdk">4.2. Application Development Workflow Using an SDK</a></span></dt><dt><span class="section"><a href="#dev-modifying-source-code">4.3. Modifying Source Code</a></span></dt><dd><dl><dt><span class="section"><a href="#using-devtool-in-your-workflow">4.3.1. Using <code class="filename">devtool</code> in Your Workflow</a></span></dt><dt><span class="section"><a href="#using-a-quilt-workflow">4.3.2. Using Quilt in Your Workflow</a></span></dt><dt><span class="section"><a href="#finding-the-temporary-source-code">4.3.3. Finding Temporary Source Code</a></span></dt></dl></dd><dt><span class="section"><a href="#image-development-using-toaster">4.4. Image Development Using Toaster</a></span></dt><dt><span class="section"><a href="#platdev-appdev-devshell">4.5. Using a Development Shell</a></span></dt><dt><span class="section"><a href="#platdev-appdev-devpyshell">4.6. Using a Development Python Shell</a></span></dt></dl></div><p>
    Many development models exist for which you can use the Yocto Project.
    This chapter overviews simple methods that use tools provided by the
    Yocto Project:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>System Development:</em></span>
             System Development covers Board Support Package (BSP) development
             and kernel modification or configuration.
             For an example on how to create a BSP, see the
             "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#creating-a-new-bsp-layer-using-the-yocto-bsp-script" target="_top">Creating a New BSP Layer Using the yocto-bsp Script</a>"
             section in the Yocto Project Board Support Package (BSP)
             Developer's Guide.
             For more complete information on how to work with the kernel,
             see the
             <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html" target="_top">Yocto Project Linux Kernel Development Manual</a>.
             </p></li><li class="listitem"><p><span class="emphasis"><em>User Application Development:</em></span>
             User Application Development covers development of applications
             that you intend to run on target hardware.
             For information on how to set up your host development system for
             user-space application development, see the
             <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>.
             For a simple example of user-space application development using
             the <span class="trademark">Eclipse</span>™ IDE, see the
             "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html#sdk-developing-applications-using-eclipse" target="_top">Developing Applications Using <span class="trademark">Eclipse</span>™</a>" section.
             </p></li><li class="listitem"><p><span class="emphasis"><em>Temporary Source Code Modification:</em></span>
             Direct modification of temporary source code is a convenient
             development model to quickly iterate and develop towards a
             solution.
             Once you implement the solution, you should of course take
             steps to get the changes upstream and applied in the affected
             recipes.
             </p></li><li class="listitem"><p><span class="emphasis"><em>Image Development using Toaster:</em></span>
             You can use <a class="ulink" href="http://www.yoctoproject.org/Tools-resources/projects/toaster" target="_top">Toaster</a>
             to build custom operating system images within the build
             environment.
             Toaster provides an efficient interface to the OpenEmbedded build
             that allows you to start builds and examine build statistics.
             </p></li><li class="listitem"><p><span class="emphasis"><em>Using a Development Shell:</em></span>
             You can use a
             <a class="link" href="#platdev-appdev-devshell" title="4.5. Using a Development Shell"><code class="filename">devshell</code></a>
             to efficiently debug
             commands or simply edit packages.
             Working inside a development shell is a quick way to set up the
             OpenEmbedded build environment to work on parts of a project.
             </p></li></ul></div><p>
</p><div class="section" title="4.1. System Development Workflow"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="system-development-model">4.1. System Development Workflow<span class="permalink"><a alt="Permalink" title="Permalink" href="#system-development-model">¶</a></span></h2></div></div></div><p>
        System development involves modification or creation of an image that you want to run on
        a specific hardware target.
        Usually, when you want to create an image that runs on embedded hardware, the image does
        not require the same number of features that a full-fledged Linux distribution provides.
        Thus, you can create a much smaller image that is designed to use only the
        features for your particular hardware.
    </p><p>
        To help you understand how system development works in the Yocto Project, this section
        covers two types of image development:  BSP creation and kernel modification or
        configuration.
    </p><div class="section" title="4.1.1. Developing a Board Support Package (BSP)"><div class="titlepage"><div><div><h3 class="title" id="developing-a-board-support-package-bsp">4.1.1. Developing a Board Support Package (BSP)<span class="permalink"><a alt="Permalink" title="Permalink" href="#developing-a-board-support-package-bsp">¶</a></span></h3></div></div></div><p>
            A BSP is a collection of recipes that, when applied during a build, results in
            an image that you can run on a particular board.
            Thus, the package when compiled into the new image, supports the operation of the board.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            For a brief list of terms used when describing the development process in the Yocto Project,
            see the "<a class="link" href="#yocto-project-terms" title="3.4. Yocto Project Terms">Yocto Project Terms</a>" section.
        </div><p>
            The remainder of this section presents the basic
            steps used to create a BSP using the Yocto Project's
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#using-the-yocto-projects-bsp-tools" target="_top">BSP Tools</a>.
            Although not required for BSP creation, the
            <code class="filename">meta-intel</code> repository, which contains
            many BSPs supported by the Yocto Project, is part of the example.
        </p><p>
            For an example that shows how to create a new layer using the tools, see the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#creating-a-new-bsp-layer-using-the-yocto-bsp-script" target="_top">Creating a New BSP Layer Using the yocto-bsp Script</a>"
             section in the Yocto Project Board Support Package (BSP) Developer's Guide.
        </p><p>
            The following illustration and list summarize the BSP creation general workflow.
        </p><p>
            </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 630px"><td align="center"><img src="figures/bsp-dev-flow.png" align="middle" width="540" /></td></tr></table><p>
        </p><p>
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Set up your host development system to support
                    development using the Yocto Project</em></span>:  See the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#the-linux-distro" target="_top">The Linux Distribution</a>"
                    and the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#packages" target="_top">The Build Host Packages</a>" sections both
                    in the Yocto Project Quick Start for requirements.</p></li><li class="listitem"><p><span class="emphasis"><em>Establish a local copy of the project files on your
                    system</em></span>:  You need this <a class="link" href="#source-directory">Source
                    Directory</a> available on your host system.
                    Having these files on your system gives you access to the build
                    process and to the tools you need.
                    For information on how to set up the Source Directory,
                    see the
                    "<a class="link" href="#getting-setup" title="2.2. Getting Set Up">Getting Set Up</a>" section.</p></li><li class="listitem"><p><span class="emphasis"><em>Establish the <code class="filename">meta-intel</code>
                    repository on your system</em></span>:  Having local copies
                    of these supported BSP layers on your system gives you
                    access to layers you might be able to build on or modify
                    to create your BSP.
                    For information on how to get these files, see the
                    "<a class="link" href="#getting-setup" title="2.2. Getting Set Up">Getting Set Up</a>" section.</p></li><li class="listitem"><p><span class="emphasis"><em>Create your own BSP layer using the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#creating-a-new-bsp-layer-using-the-yocto-bsp-script" target="_top"><code class="filename">yocto-bsp</code></a> script</em></span>:
                    Layers are ideal for
                    isolating and storing work for a given piece of hardware.
                    A layer is really just a location or area in which you place
                    the recipes and configurations for your BSP.
                    In fact, a BSP is, in itself, a special type of layer.
                    The simplest way to create a new BSP layer that is compliant with the
                    Yocto Project is to use the <code class="filename">yocto-bsp</code> script.
                    For information about that script, see the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#creating-a-new-bsp-layer-using-the-yocto-bsp-script" target="_top">Creating a New BSP Layer Using the yocto-bsp Script</a>"
                    section in the Yocto Project Board Support (BSP) Developer's Guide.
                    </p><p>
                        Another example that illustrates a layer
                        is an application.
                        Suppose you are creating an application that has
                        library or other dependencies in order for it to
                        compile and run.
                        The layer, in this case, would be where all the
                        recipes that define those dependencies are kept.
                        The key point for a layer is that it is an isolated
                        area that contains all the relevant information for
                        the project that the OpenEmbedded build system knows
                        about.
                        For more information on layers, see the
                        "<a class="link" href="#understanding-and-creating-layers" title="5.1. Understanding and Creating Layers">Understanding and Creating Layers</a>"
                        section.
                        For more information on BSP layers, see the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-layers" target="_top">BSP Layers</a>"
                        section in the Yocto Project Board Support Package (BSP)
                        Developer's Guide.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
                                Five BSPs exist that are part of the Yocto Project release:
                                <code class="filename">beaglebone</code> (ARM),
                                <code class="filename">mpc8315e</code> (PowerPC),
                                and <code class="filename">edgerouter</code> (MIPS).
                                The recipes and configurations for these five BSPs
                                are located and dispersed within the
                                <a class="link" href="#source-directory">Source Directory</a>.
                            </p><p>
                                Three core Intel BSPs exist as part of the Yocto
                                Project release in the
                                <code class="filename">meta-intel</code> layer:
                                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">intel-core2-32</code>,
                                        which is a BSP optimized for the Core2 family of CPUs
                                        as well as all CPUs prior to the Silvermont core.
                                        </p></li><li class="listitem"><p><code class="filename">intel-corei7-64</code>,
                                        which is a BSP optimized for Nehalem and later
                                        Core and Xeon CPUs as well as Silvermont and later
                                        Atom CPUs, such as the Baytrail SoCs.
                                        </p></li><li class="listitem"><p><code class="filename">intel-quark</code>,
                                        which is a BSP optimized for the Intel Galileo
                                        gen1 &amp; gen2 development boards.
                                        </p></li></ul></div><p>
                            </p></div><p>
                    </p><p>When you set up a layer for a new BSP, you should follow a standard layout.
                    This layout is described in the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-filelayout" target="_top">Example Filesystem Layout</a>"
                    section of the Board Support Package (BSP) Development Guide.
                    In the standard layout, you will notice a suggested structure for recipes and
                    configuration information.
                    You can see the standard layout for a BSP by examining
                    any supported BSP found in the <code class="filename">meta-intel</code> layer inside
                    the Source Directory.</p></li><li class="listitem"><p><span class="emphasis"><em>Make configuration changes to your new BSP
                    layer</em></span>:  The standard BSP layer structure organizes the files you need
                    to edit in <code class="filename">conf</code> and several <code class="filename">recipes-*</code>
                    directories within the BSP layer.
                    Configuration changes identify where your new layer is on the local system
                    and identify which kernel you are going to use.
                    When you run the <code class="filename">yocto-bsp</code> script, you are able to interactively
                    configure many things for the BSP (e.g. keyboard, touchscreen, and so forth).
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Make recipe changes to your new BSP layer</em></span>:  Recipe
                    changes include altering recipes (<code class="filename">.bb</code> files), removing
                    recipes you do not use, and adding new recipes or append files
                    (<code class="filename">.bbappend</code>) that you need to support your hardware.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Prepare for the build</em></span>:  Once you have made all the
                    changes to your BSP layer, there remains a few things
                    you need to do for the OpenEmbedded build system in order for it to create your image.
                    You need to get the build environment ready by sourcing an environment setup script
                    (i.e. <code class="filename">oe-init-build-env</code> or
                    <code class="filename">oe-init-build-env-memres</code>)
                    and you need to be sure two key configuration files are configured appropriately:
                    the <code class="filename">conf/local.conf</code> and the
                    <code class="filename">conf/bblayers.conf</code> file.
                    You must make the OpenEmbedded build system aware of your new layer.
                    See the
                    "<a class="link" href="#enabling-your-layer" title="5.1.5. Enabling Your Layer">Enabling Your Layer</a>" section
                    for information on how to let the build system know about your new layer.</p><p>The entire process for building an image is overviewed in the section
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#qs-building-images" target="_top">Building Images</a>" section
                    of the Yocto Project Quick Start.
                    You might want to reference this information.</p></li><li class="listitem"><p><span class="emphasis"><em>Build the image</em></span>:  The OpenEmbedded build system
                    uses the BitBake tool to build images based on the type of image you want to create.
                    You can find more information about BitBake in the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html" target="_top">BitBake User Manual</a>.
                    </p><p>The build process supports several types of images to satisfy different needs.
                    See the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-images" target="_top">Images</a>" chapter
                    in the Yocto Project Reference Manual for information on
                    supported images.</p></li></ol></div><p>
        </p><p>
            You can view a video presentation on "Building Custom Embedded Images with Yocto"
            at <a class="ulink" href="http://free-electrons.com/blog/elc-2011-videos" target="_top">Free Electrons</a>.
            After going to the page, just search for "Embedded".
            You can also find supplemental information in the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html" target="_top">
            Yocto Project Board Support Package (BSP) Developer's Guide</a>.
            Finally, there is helpful material and links on this
            <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Transcript:_creating_one_generic_Atom_BSP_from_another" target="_top">wiki page</a>.
            Although a bit dated, you might find the information on the wiki
            helpful.
       </p></div><div class="section" title="4.1.2. Modifying the Kernel"><div class="titlepage"><div><div><h3 class="title" id="modifying-the-kernel">4.1.2. <a id="kernel-spot"></a>Modifying the Kernel<span class="permalink"><a alt="Permalink" title="Permalink" href="#modifying-the-kernel">¶</a></span></h3></div></div></div><p>
            Kernel modification involves changing the Yocto Project kernel, which could involve changing
            configuration options as well as adding new kernel recipes.
            Configuration changes can be added in the form of configuration fragments, while recipe
            modification comes through the kernel's <code class="filename">recipes-kernel</code> area
            in a kernel layer you create.
        </p><p>
            The remainder of this section presents a high-level overview of the Yocto Project
            kernel architecture and the steps to modify the kernel.
            You can reference the
            "<a class="link" href="#patching-the-kernel" title="5.12. Patching the Kernel">Patching the Kernel</a>" section
            for an example that changes the source code of the kernel.
            For information on how to configure the kernel, see the
            "<a class="link" href="#configuring-the-kernel" title="5.11. Configuring the Kernel">Configuring the Kernel</a>" section.
            For more information on the kernel and on modifying the kernel, see the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html" target="_top">Yocto Project Linux Kernel Development Manual</a>.
        </p><div class="section" title="4.1.2.1. Kernel Overview"><div class="titlepage"><div><div><h4 class="title" id="kernel-overview">4.1.2.1. Kernel Overview<span class="permalink"><a alt="Permalink" title="Permalink" href="#kernel-overview">¶</a></span></h4></div></div></div><p>
                Traditionally, when one thinks of a patched kernel, they think of a base kernel
                source tree and a fixed structure that contains kernel patches.
                The Yocto Project, however, employs mechanisms that, in a sense, result in a kernel source
                generator.
                By the end of this section, this analogy will become clearer.
            </p><p>
                You can find a web interface to the Yocto Project kernel source repositories at
                <a class="ulink" href="http://git.yoctoproject.org" target="_top">http://git.yoctoproject.org</a>.
                If you look at the interface, you will see to the left a grouping of
                Git repositories titled "Yocto Linux Kernel."
                Within this group, you will find several kernels supported by
                the Yocto Project:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>
                        <code class="filename">linux-yocto-3.14</code></em></span> - The
                        stable Yocto Project kernel to use with the Yocto
                        Project Releases 1.6 and 1.7.
                        This kernel is based on the Linux 3.14 released kernel.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>
                        <code class="filename">linux-yocto-3.17</code></em></span> - An
                        additional, unsupported Yocto Project kernel used with
                        the Yocto Project Release 1.7.
                        This kernel is based on the Linux 3.17 released kernel.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>
                        <code class="filename">linux-yocto-3.19</code></em></span> - The
                        stable Yocto Project kernel to use with the Yocto
                        Project Release 1.8.
                        This kernel is based on the Linux 3.19 released kernel.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>
                        <code class="filename">linux-yocto-4.1</code></em></span> - The
                        stable Yocto Project kernel to use with the Yocto
                        Project Release 2.0.
                        This kernel is based on the Linux 4.1 released kernel.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>
                        <code class="filename">linux-yocto-4.4</code></em></span> - The
                        stable Yocto Project kernel to use with the Yocto
                        Project Release 2.1.
                        This kernel is based on the Linux 4.4 released kernel.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>
                        <code class="filename">linux-yocto-dev</code></em></span> - A
                        development kernel based on the latest upstream release
                        candidate available.
                        </p></li></ul></div><p>
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Long Term Support Initiative (LTSI) for Yocto Project kernels
                    is as follows:
                    <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>For Yocto Project releases 1.7, 1.8, and 2.0,
                            the LTSI kernel is <code class="filename">linux-yocto-3.14</code>.
                            </p></li><li class="listitem"><p>For Yocto Project release 2.1, the
                            LTSI kernel is <code class="filename">linux-yocto-4.1</code>.
                            </p></li></ul></div></div><p>
            </p><p>
                The kernels are maintained using the Git revision control system
                that structures them using the familiar "tree", "branch", and "leaf" scheme.
                Branches represent diversions from general code to more specific code, while leaves
                represent the end-points for a complete and unique kernel whose source files,
                when gathered from the root of the tree to the leaf, accumulate to create the files
                necessary for a specific piece of hardware and its features.
                The following figure displays this concept:
            </p><p>
                </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 540px"><td align="center"><img src="figures/kernel-overview-1.png" align="middle" /></td></tr></table><p>
            </p><p>

            </p><p>
                Within the figure, the "Kernel.org Branch Point" represents the point in the tree
                where a supported base kernel is modified from the Linux kernel.
                For example, this could be the branch point for the <code class="filename">linux-yocto-3.19</code>
                kernel.
                Thus, everything further to the right in the structure is based on the
                <code class="filename">linux-yocto-3.19</code> kernel.
                Branch points to the right in the figure represent where the
                <code class="filename">linux-yocto-3.19</code> kernel is modified for specific hardware
                or types of kernels, such as real-time kernels.
                Each leaf thus represents the end-point for a kernel designed to run on a specific
                targeted device.
            </p><p>

            </p><p>
                The overall result is a Git-maintained repository from which all the supported
                kernel types can be derived for all the supported devices.
                A big advantage to this scheme is the sharing of common features by keeping them in
                "larger" branches within the tree.
                This practice eliminates redundant storage of similar features shared among kernels.
            </p><p>

            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                Keep in mind the figure does not take into account all the supported Yocto
                Project kernel types, but rather shows a single generic kernel just for conceptual purposes.
                Also keep in mind that this structure represents the Yocto Project source repositories
                that are either pulled from during the build or established on the host development system
                prior to the build by either cloning a particular kernel's Git repository or by
                downloading and unpacking a tarball.
            </div><p>

            </p><p>
                Upstream storage of all the available kernel source code is one thing, while
                representing and using the code on your host development system is another.
                Conceptually, you can think of the kernel source repositories as all the
                source files necessary for all the supported kernels.
                As a developer, you are just interested in the source files for the kernel on
                which you are working.
                And, furthermore, you need them available on your host system.
            </p><p>

            </p><p>
                Kernel source code is available on your host system a couple of different
                ways.
                If you are working in the kernel all the time, you probably would want
                to set up your own local Git repository of the kernel tree.
                If you just need to make some patches to the kernel, you can access
                temporary kernel source files that were extracted and used
                during a build.
                We will just talk about working with the temporary source code.
                For more information on how to get kernel source code onto your
                host system, see the
                "<a class="link" href="#local-kernel-files">Yocto Project Kernel</a>"
                bulleted item earlier in the manual.
            </p><p>

            </p><p>
                What happens during the build?
                When you build the kernel on your development system, all files needed for the build
                are taken from the source repositories pointed to by the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a> variable
                and gathered in a temporary work area
                where they are subsequently used to create the unique kernel.
                Thus, in a sense, the process constructs a local source tree specific to your
                kernel to generate the new kernel image - a source generator if you will.
            </p><p>
                The following figure shows the temporary file structure
                created on your host system when the build occurs.
                This
                <a class="link" href="#build-directory">Build Directory</a> contains all the
                source files used during the build.
            </p><p>
                </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 450px"><td align="center"><img src="figures/kernel-overview-2-generic.png" align="middle" /></td></tr></table><p>
            </p><p>
                Again, for additional information on the Yocto Project kernel's
                architecture and its branching strategy, see the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html" target="_top">Yocto Project Linux Kernel Development Manual</a>.
                You can also reference the
                "<a class="link" href="#patching-the-kernel" title="5.12. Patching the Kernel">Patching the Kernel</a>"
                section for a detailed example that modifies the kernel.
            </p></div><div class="section" title="4.1.2.2. Kernel Modification Workflow"><div class="titlepage"><div><div><h4 class="title" id="kernel-modification-workflow">4.1.2.2. Kernel Modification Workflow<span class="permalink"><a alt="Permalink" title="Permalink" href="#kernel-modification-workflow">¶</a></span></h4></div></div></div><p>
                This illustration and the following list summarizes the kernel modification general workflow.
            </p><p>
                </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 450px"><td align="center"><img src="figures/kernel-dev-flow.png" align="middle" width="540" /></td></tr></table><p>
            </p><p>
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Set up your host development system to support
                        development using the Yocto Project</em></span>:  See
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#the-linux-distro" target="_top">The Linux Distribution</a>" and
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#packages" target="_top">The Build Host Packages</a>" sections both
                        in the Yocto Project Quick Start for requirements.</p></li><li class="listitem"><p><span class="emphasis"><em>Establish a local copy of project files on your
                        system</em></span>:  Having the <a class="link" href="#source-directory">Source
                        Directory</a> on your system gives you access to the build process and tools
                        you need.
                        For information on how to get these files, see the bulleted item
                        "<a class="link" href="#local-yp-release">Yocto Project Release</a>" earlier in this manual.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Establish the temporary kernel source files</em></span>:
                        Temporary kernel source files are kept in the
                        <a class="link" href="#build-directory">Build Directory</a>
                        created by the
                        OpenEmbedded build system when you run BitBake.
                        If you have never built the kernel in which you are
                        interested, you need to run an initial build to
                        establish local kernel source files.</p><p>If you are building an image for the first time, you need to get the build
                        environment ready by sourcing an environment setup script
                        (i.e. <code class="filename">oe-init-build-env</code> or
                        <code class="filename">oe-init-build-env-memres</code>).
                        You also need to be sure two key configuration files
                        (<code class="filename">local.conf</code> and <code class="filename">bblayers.conf</code>)
                        are configured appropriately.</p><p>The entire process for building an image is overviewed in the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#qs-building-images" target="_top">Building Images</a>"
                        section of the Yocto Project Quick Start.
                        You might want to reference this information.
                        You can find more information on BitBake in the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html" target="_top">BitBake User Manual</a>.
                        </p><p>The build process supports several types of images to satisfy different needs.
                        See the "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-images" target="_top">Images</a>" chapter in
                        the Yocto Project Reference Manual for information on supported images.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Make changes to the kernel source code if
                        applicable</em></span>:  Modifying the kernel does not always mean directly
                        changing source files.
                        However, if you have to do this, you make the changes to the files in the
                        Build Directory.</p></li><li class="listitem"><p><span class="emphasis"><em>Make kernel configuration changes if applicable</em></span>:
                        If your situation calls for changing the kernel's
                        configuration, you can use
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html#generating-configuration-files" target="_top"><code class="filename">menuconfig</code></a>,
                        which allows you to interactively develop and test the
                        configuration changes you are making to the kernel.
                        Saving changes you make with
                        <code class="filename">menuconfig</code> updates
                        the kernel's <code class="filename">.config</code> file.
                        </p><div class="note" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
                            Try to resist the temptation to directly edit an
                            existing <code class="filename">.config</code> file, which is
                            found in the Build Directory at
                            <code class="filename">tmp/sysroots/<em class="replaceable"><code>machine-name</code></em>/kernel</code>.
                            Doing so, can produce unexpected results when the
                            OpenEmbedded build system regenerates the configuration
                            file.
                        </div><p>
                        Once you are satisfied with the configuration
                        changes made using <code class="filename">menuconfig</code>
                        and you have saved them, you can directly compare the
                        resulting <code class="filename">.config</code> file against an
                        existing original and gather those changes into a
                        <a class="link" href="#creating-config-fragments" title="5.11.3. Creating Configuration Fragments">configuration fragment file</a>
                        to be referenced from within the kernel's
                        <code class="filename">.bbappend</code> file.</p><p>Additionally, if you are working in a BSP layer
                        and need to modify the BSP's kernel's configuration,
                        you can use the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#managing-kernel-patches-and-config-items-with-yocto-kernel" target="_top"><code class="filename">yocto-kernel</code></a>
                        script as well as <code class="filename">menuconfig</code>.
                        The <code class="filename">yocto-kernel</code> script lets
                        you interactively set up kernel configurations.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Rebuild the kernel image with your changes</em></span>:
                        Rebuilding the kernel image applies your changes.
                        </p></li></ol></div><p>
            </p></div></div></div><div class="section" title="4.2. Application Development Workflow Using an SDK"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="application-development-workflow-using-an-sdk">4.2. Application Development Workflow Using an SDK<span class="permalink"><a alt="Permalink" title="Permalink" href="#application-development-workflow-using-an-sdk">¶</a></span></h2></div></div></div><p>
        Standard and extensible Software Development Kits (SDK) make it easy
        to develop applications inside or outside of the Yocto Project
        development environment.
        Tools exist to help the application developer during any phase
        of development.
        For information on how to install and use an SDK, see the
        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html#sdk-intro" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>.
    </p></div><div class="section" title="4.3. Modifying Source Code"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="dev-modifying-source-code">4.3. Modifying Source Code<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-modifying-source-code">¶</a></span></h2></div></div></div><p>
        A common development workflow consists of modifying project source
        files that are external to the Yocto Project and then integrating
        that project's build output into an image built using the
        OpenEmbedded build system.
        Given this scenario, development engineers typically want to stick
        to their familiar project development tools and methods, which allows
        them to just focus on the project.
    </p><p>
        Several workflows exist that allow you to develop, build, and test
        code that is going to be integrated into an image built using the
        OpenEmbedded build system.
        This section describes two:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><code class="filename">devtool</code>:</em></span>
                A set of tools to aid in working on the source code built by
                the OpenEmbedded build system.
                Section
                "<a class="link" href="#using-devtool-in-your-workflow" title="4.3.1. Using devtool in Your Workflow">Using <code class="filename">devtool</code> in Your Workflow</a>"
                describes this workflow.
                If you want more information that showcases the workflow, click
                <a class="ulink" href="https://drive.google.com/a/linaro.org/file/d/0B3KGzY5fW7laTDVxUXo3UDRvd2s/view" target="_top">here</a>
                for a presentation by Trevor Woerner that, while somewhat dated,
                provides detailed background information and a complete
                working tutorial.
                </p></li><li class="listitem"><p><span class="emphasis"><em><a class="ulink" href="http://savannah.nongnu.org/projects/quilt" target="_top">Quilt</a>:</em></span>
                A powerful tool that allows you to capture source
                code changes without having a clean source tree.
                While Quilt is not the preferred workflow of the two, this
                section includes it for users that are committed to using
                the tool.
                See the
                "<a class="link" href="#using-a-quilt-workflow" title="4.3.2. Using Quilt in Your Workflow">Using Quilt in Your Workflow</a>"
                section for more information.
                </p></li></ul></div><p>
    </p><div class="section" title="4.3.1. Using devtool in Your Workflow"><div class="titlepage"><div><div><h3 class="title" id="using-devtool-in-your-workflow">4.3.1. Using <code class="filename">devtool</code> in Your Workflow<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-devtool-in-your-workflow">¶</a></span></h3></div></div></div><p>
            As mentioned earlier, <code class="filename">devtool</code> helps
            you easily develop projects whose build output must be part of
            an image built using the OpenEmbedded build system.
        </p><p>
            Three entry points exist that allow you to develop using
            <code class="filename">devtool</code>:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><code class="filename">devtool add</code></em></span>
                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">devtool modify</code></em></span>
                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">devtool upgrade</code></em></span>
                    </p></li></ul></div><p>
        </p><p>
            The remainder of this section presents these workflows.
            See the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-devtool-reference" target="_top"><code class="filename">devtool</code> Quick Reference</a>"
            in the Yocto Project Reference Manual for a
            <code class="filename">devtool</code> quick reference.
        </p><div class="section" title="4.3.1.1. Use devtool add to Add an Application"><div class="titlepage"><div><div><h4 class="title" id="use-devtool-to-integrate-new-code">4.3.1.1. Use <code class="filename">devtool add</code> to Add an Application<span class="permalink"><a alt="Permalink" title="Permalink" href="#use-devtool-to-integrate-new-code">¶</a></span></h4></div></div></div><p>
                The <code class="filename">devtool add</code> command generates
                a new recipe based on existing source code.
                This command takes advantage of the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/dev-manual/dev-manual.html#devtool-the-workspace-layer-structure" target="_top">workspace</a>
                layer that many <code class="filename">devtool</code> commands
                use.
                The command is flexible enough to allow you to extract source
                code into both the workspace or a separate local Git repository
                and to use existing code that does not need to be extracted.
            </p><p>
                Depending on your particular scenario, the arguments and options
                you use with <code class="filename">devtool add</code> form different
                combinations.
                The following diagram shows common development flows
                you would use with the <code class="filename">devtool add</code>
                command:
            </p><p>
                <img src="figures/devtool-add-flow.png" align="middle" />
            </p><p>
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Generating the New Recipe</em></span>:
                        The top part of the flow shows three scenarios by which
                        you could use <code class="filename">devtool add</code> to
                        generate a recipe based on existing source code.</p><p>In a shared development environment, it is
                        typical where other developers are responsible for
                        various areas of source code.
                        As a developer, you are probably interested in using
                        that source code as part of your development using
                        the Yocto Project.
                        All you need is access to the code, a recipe, and a
                        controlled area in which to do your work.</p><p>Within the diagram, three possible scenarios
                        feed into the <code class="filename">devtool add</code> workflow:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Left</em></span>:
                                The left scenario represents a common situation
                                where the source code does not exist locally
                                and needs to be extracted.
                                In this situation, you just let it get
                                extracted to the default workspace - you do not
                                want it in some specific location outside of the
                                workspace.
                                Thus, everything you need will be located in the
                                workspace:
                                </p><pre class="literallayout">
     $ devtool add <em class="replaceable"><code>recipe fetchuri</code></em>
                                </pre><p>
                                With this command, <code class="filename">devtool</code>
                                creates a recipe and an append file in the
                                workspace as well as extracts the upstream
                                source files into a local Git repository also
                                within the <code class="filename">sources</code> folder.
                                </p></li><li class="listitem"><p><span class="emphasis"><em>Middle</em></span>:
                                The middle scenario also represents a situation where
                                the source code does not exist locally.
                                In this case, the code is again upstream
                                and needs to be extracted to some
                                local area - this time outside of the default
                                workspace.
                                If required, <code class="filename">devtool</code>
                                always creates
                                a Git repository locally during the extraction.
                                Furthermore, the first positional argument
                                <em class="replaceable"><code>srctree</code></em> in this case
                                identifies where the
                                <code class="filename">devtool add</code> command
                                will locate the extracted code outside of the
                                workspace:
                                </p><pre class="literallayout">
     $ devtool add <em class="replaceable"><code>recipe srctree fetchuri</code></em>
                                </pre><p>
                                In summary, the source code is pulled from
                                <em class="replaceable"><code>fetchuri</code></em> and extracted
                                into the location defined by
                                <em class="replaceable"><code>srctree</code></em> as a local
                                Git repository.</p><p>Within workspace, <code class="filename">devtool</code>
                                creates both the recipe and an append file
                                for the recipe.
                                </p></li><li class="listitem"><p><span class="emphasis"><em>Right</em></span>:
                                The right scenario represents a situation
                                where the source tree (srctree) has been
                                previously prepared outside of the
                                <code class="filename">devtool</code> workspace.
                                </p><p>The following command names the recipe
                                and identifies where the existing source tree
                                is located:
                                </p><pre class="literallayout">
     $ devtool add <em class="replaceable"><code>recipe srctree</code></em>
                                </pre><p>
                                The command examines the source code and creates
                                a recipe for it placing the recipe into the
                                workspace.</p><p>Because the extracted source code already exists,
                                <code class="filename">devtool</code> does not try to
                                relocate it into the workspace - just the new
                                the recipe is placed in the workspace.</p><p>Aside from a recipe folder, the command
                                also creates an append folder and places an initial
                                <code class="filename">*.bbappend</code> within.
                                </p></li></ul></div><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Edit the Recipe</em></span>:
                        At this point, you can use <code class="filename">devtool edit-recipe</code>
                        to open up the editor as defined by the
                        <code class="filename">$EDITOR</code> environment variable
                        and modify the file:
                        </p><pre class="literallayout">
     $ devtool edit-recipe <em class="replaceable"><code>recipe</code></em>
                        </pre><p>
                        From within the editor, you can make modifications to the
                        recipe that take affect when you build it later.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Build the Recipe or Rebuild the Image</em></span>:
                        At this point in the flow, the next step you
                        take depends on what you are going to do with
                        the new code.</p><p>If you need to take the build output and eventually
                        move it to the target hardware, you would use
                        <code class="filename">devtool build</code>:
                        </p><pre class="literallayout">
     $ devtool build <em class="replaceable"><code>recipe</code></em>
                        </pre><p>On the other hand, if you want an image to
                        contain the recipe's packages for immediate deployment
                        onto a device (e.g. for testing purposes), you can use
                        the <code class="filename">devtool build-image</code> command:
                        </p><pre class="literallayout">
     $ devtool build-image <em class="replaceable"><code>image</code></em>
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Deploy the Build Output</em></span>:
                        When you use the <code class="filename">devtool build</code>
                        command to build out your recipe, you probably want to
                        see if the resulting build output works as expected on target
                        hardware.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            This step assumes you have a previously built
                            image that is already either running in QEMU or
                            running on actual hardware.
                            Also, it is assumed that for deployment of the image
                            to the target, SSH is installed in the image and if
                            the image is running on real hardware that you have
                            network access to and from your development machine.
                        </div><p>
                        You can deploy your build output to that target hardware by
                        using the <code class="filename">devtool deploy-target</code> command:
                        </p><pre class="literallayout">
     $ devtool deploy-target <em class="replaceable"><code>recipe target</code></em>
                        </pre><p>
                        The <em class="replaceable"><code>target</code></em> is a live target machine
                        running as an SSH server.</p><p>You can, of course, also deploy the image you build
                        using the <code class="filename">devtool build-image</code> command
                        to actual hardware.
                        However, <code class="filename">devtool</code> does not provide a
                        specific command that allows you to do this.
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em>Finish Your Work With the Recipe</em></span>:
                        The <code class="filename">devtool finish</code> command creates
                        any patches corresponding to commits in the local
                        Git repository, moves the new recipe to a more permanent
                        layer, and then resets the recipe so that the recipe is
                        built normally rather than from the workspace.
                        </p><pre class="literallayout">
     $ devtool finish <em class="replaceable"><code>recipe layer</code></em>
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            Any changes you want to turn into patches must be
                            committed to the Git repository in the source tree.
                        </div><p>As mentioned, the <code class="filename">devtool finish</code>
                        command moves the final recipe to its permanent layer.
                        </p><p>As a final process of the
                        <code class="filename">devtool finish</code> command, the state
                        of the standard layers and the upstream source is
                        restored so that you can build the recipe from those
                        areas rather than the workspace.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            You can use the <code class="filename">devtool reset</code>
                            command to put things back should you decide you
                            do not want to proceed with your work.
                            If you do use this command, realize that the source
                            tree is preserved.
                        </div><p>
                        </p></li></ol></div><p>
            </p></div><div class="section" title="4.3.1.2. Use devtool modify to Modify the Source of an Existing Component"><div class="titlepage"><div><div><h4 class="title" id="devtool-use-devtool-modify-to-enable-work-on-code-associated-with-an-existing-recipe">4.3.1.2. Use <code class="filename">devtool modify</code> to Modify the Source of an Existing Component<span class="permalink"><a alt="Permalink" title="Permalink" href="#devtool-use-devtool-modify-to-enable-work-on-code-associated-with-an-existing-recipe">¶</a></span></h4></div></div></div><p>
                The <code class="filename">devtool modify</code> command prepares the
                way to work on existing code that already has a recipe in
                place.
                The command is flexible enough to allow you to extract code,
                specify the existing recipe, and keep track of and gather any
                patch files from other developers that are
                associated with the code.
            </p><p>
                Depending on your particular scenario, the arguments and options
                you use with <code class="filename">devtool modify</code> form different
                combinations.
                The following diagram shows common development flows
                you would use with the <code class="filename">devtool modify</code>
                command:
            </p><p>
                <img src="figures/devtool-modify-flow.png" align="middle" />
            </p><p>
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Preparing to Modify the Code</em></span>:
                        The top part of the flow shows three scenarios by which
                        you could use <code class="filename">devtool modify</code> to
                        prepare to work on source files.
                        Each scenario assumes the following:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The recipe exists in some layer external
                                to the <code class="filename">devtool</code> workspace.
                                </p></li><li class="listitem"><p>The source files exist upstream in an
                                un-extracted state or locally in a previously
                                extracted state.
                                </p></li></ul></div><p>
                        The typical situation is where another developer has
                        created some layer for use with the Yocto Project and
                        their recipe already resides in that layer.
                        Furthermore, their source code is readily available
                        either upstream or locally.
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Left</em></span>:
                                The left scenario represents a common situation
                                where the source code does not exist locally
                                and needs to be extracted.
                                In this situation, the source is extracted
                                into the default workspace location.
                                The recipe, in this scenario, is in its own
                                layer outside the workspace
                                (i.e.
                                <code class="filename">meta-</code><em class="replaceable"><code>layername</code></em>).
                                </p><p>The following command identifies the recipe
                                and by default extracts the source files:
                                </p><pre class="literallayout">
     $ devtool modify <em class="replaceable"><code>recipe</code></em>
                                </pre><p>
                                Once <code class="filename">devtool</code>locates the recipe,
                                it uses the
                                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                                variable to locate the source code and
                                any local patch files from other developers are
                                located.
                                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                                    You cannot provide an URL for
                                    <em class="replaceable"><code>srctree</code></em> when using the
                                    <code class="filename">devtool modify</code> command.
                                </div><p>
                                With this scenario, however, since no
                                <em class="replaceable"><code>srctree</code></em> argument exists, the
                                <code class="filename">devtool modify</code> command by default
                                extracts the source files to a Git structure.
                                Furthermore, the location for the extracted source is the
                                default area within the workspace.
                                The result is that the command sets up both the source
                                code and an append file within the workspace with the
                                recipe remaining in its original location.
                                </p></li><li class="listitem"><p><span class="emphasis"><em>Middle</em></span>:
                                The middle scenario represents a situation where
                                the source code also does not exist locally.
                                In this case, the code is again upstream
                                and needs to be extracted to some
                                local area as a Git repository.
                                The recipe, in this scenario, is again in its own
                                layer outside the workspace.</p><p>The following command tells
                                <code class="filename">devtool</code> what recipe with
                                which to work and, in this case, identifies a local
                                area for the extracted source files that is outside
                                of the default workspace:
                                </p><pre class="literallayout">
     $ devtool modify <em class="replaceable"><code>recipe srctree</code></em>
                                </pre><p>
                                As with all extractions, the command uses
                                the recipe's <code class="filename">SRC_URI</code> to locate the
                                source files.
                                Once the files are located, the command by default
                                extracts them.
                                Providing the <em class="replaceable"><code>srctree</code></em>
                                argument instructs <code class="filename">devtool</code> where
                                place the extracted source.</p><p>Within workspace, <code class="filename">devtool</code>
                                creates an append file for the recipe.
                                The recipe remains in its original location but
                                the source files are extracted to the location you
                                provided with <em class="replaceable"><code>srctree</code></em>.
                                </p></li><li class="listitem"><p><span class="emphasis"><em>Right</em></span>:
                                The right scenario represents a situation
                                where the source tree
                                (<em class="replaceable"><code>srctree</code></em>) exists as a
                                previously extracted Git structure outside of
                                the <code class="filename">devtool</code> workspace.
                                In this example, the recipe also exists
                                elsewhere in its own layer.
                                </p><p>The following command tells
                                <code class="filename">devtool</code> the recipe
                                with which to work, uses the "-n" option to indicate
                                source does not need to be extracted, and uses
                                <em class="replaceable"><code>srctree</code></em> to point to the
                                previously extracted source files:
                                </p><pre class="literallayout">
     $ devtool modify -n <em class="replaceable"><code>recipe srctree</code></em>
                                </pre><p>
                                </p><p>Once the command finishes, it creates only
                                an append file for the recipe in the workspace.
                                The recipe and the source code remain in their
                                original locations.
                                </p></li></ul></div><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Edit the Source</em></span>:
                        Once you have used the <code class="filename">devtool modify</code>
                        command, you are free to make changes to the source
                        files.
                        You can use any editor you like to make and save
                        your source code modifications.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Build the Recipe</em></span>:
                        Once you have updated the source files, you can build
                        the recipe.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Deploy the Build Output</em></span>:
                        When you use the <code class="filename">devtool build</code>
                        command to build out your recipe, you probably want to see
                        if the resulting build output works as expected on target
                        hardware.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            This step assumes you have a previously built
                            image that is already either running in QEMU or
                            running on actual hardware.
                            Also, it is assumed that for deployment of the image
                            to the target, SSH is installed in the image and if
                            the image is running on real hardware that you have
                            network access to and from your development machine.
                        </div><p>
                        You can deploy your build output to that target hardware by
                        using the <code class="filename">devtool deploy-target</code> command:
                        </p><pre class="literallayout">
     $ devtool deploy-target <em class="replaceable"><code>recipe target</code></em>
                        </pre><p>
                        The <em class="replaceable"><code>target</code></em> is a live target machine
                        running as an SSH server.</p><p>You can, of course, also deploy the image you build
                        using the <code class="filename">devtool build-image</code> command
                        to actual hardware.
                        However, <code class="filename">devtool</code> does not provide a
                        specific command that allows you to do this.
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em>Finish Your Work With the Recipe</em></span>:
                        The <code class="filename">devtool finish</code> command creates
                        any patches corresponding to commits in the local
                        Git repository, updates the recipe to point to them
                        (or creates a <code class="filename">.bbappend</code> file to do
                        so, depending on the specified destination layer), and
                        then resets the recipe so that the recipe is built normally
                        rather than from the workspace.
                        </p><pre class="literallayout">
     $ devtool finish <em class="replaceable"><code>recipe layer</code></em>
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            Any changes you want to turn into patches must be
                            committed to the Git repository in the source tree.
                        </div><p>Because there is no need to move the recipe,
                        <code class="filename">devtool finish</code> either updates the
                        original recipe in the original layer or the command
                        creates a <code class="filename">.bbappend</code> in a different
                        layer as provided by <em class="replaceable"><code>layer</code></em>.
                        </p><p>As a final process of the
                        <code class="filename">devtool finish</code> command, the state
                        of the standard layers and the upstream source is
                        restored so that you can build the recipe from those
                        areas rather than the workspace.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            You can use the <code class="filename">devtool reset</code>
                            command to put things back should you decide you
                            do not want to proceed with your work.
                            If you do use this command, realize that the source
                            tree is preserved.
                        </div><p>
                        </p></li></ol></div><p>
            </p></div><div class="section" title="4.3.1.3. Use devtool upgrade to Create a Version of the Recipe that Supports a Newer Version of the Software"><div class="titlepage"><div><div><h4 class="title" id="devtool-use-devtool-upgrade-to-create-a-version-of-the-recipe-that-supports-a-newer-version-of-the-software">4.3.1.3. Use <code class="filename">devtool upgrade</code> to Create a Version of the Recipe that Supports a Newer Version of the Software<span class="permalink"><a alt="Permalink" title="Permalink" href="#devtool-use-devtool-upgrade-to-create-a-version-of-the-recipe-that-supports-a-newer-version-of-the-software">¶</a></span></h4></div></div></div><p>
                The <code class="filename">devtool upgrade</code> command updates
                an existing recipe so that you can build it for an updated
                set of source files.
                The command is flexible enough to allow you to specify
                source code revision and versioning schemes, extract code into
                or out of the <code class="filename">devtool</code> workspace, and
                work with any source file forms that the fetchers support.
            </p><p>
                Depending on your particular scenario, the arguments and options
                you use with <code class="filename">devtool upgrade</code> form different
                combinations.
                The following diagram shows a common development flow
                you would use with the <code class="filename">devtool modify</code>
                command:
            </p><p>
                <img src="figures/devtool-upgrade-flow.png" align="middle" />
            </p><p>
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Initiate the Upgrade</em></span>:
                        The top part of the flow shows a typical scenario by which
                        you could use <code class="filename">devtool upgrade</code>.
                        The following conditions exist:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The recipe exists in some layer external
                                to the <code class="filename">devtool</code> workspace.
                                </p></li><li class="listitem"><p>The source files for the new release
                                exist adjacent to the same location pointed to by
                                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                                in the recipe (e.g. a tarball with the new version
                                number in the name, or as a different revision in
                                the upstream Git repository).
                                </p></li></ul></div><p>
                        A common situation is where third-party software has
                        undergone a revision so that it has been upgraded.
                        The recipe you have access to is likely in your own layer.
                        Thus, you need to upgrade the recipe to use the
                        newer version of the software:
                        </p><pre class="literallayout">
     $ devtool upgrade -V <em class="replaceable"><code>version recipe</code></em>
                        </pre><p>
                        By default, the <code class="filename">devtool upgrade</code> command
                        extracts source code into the <code class="filename">sources</code>
                        directory in the workspace.
                        If you want the code extracted to any other location, you
                        need to provide the <em class="replaceable"><code>srctree</code></em>
                        positional argument with the command as follows:
                        </p><pre class="literallayout">
     $ devtool upgrade -V <em class="replaceable"><code>version recipe srctree</code></em>
                        </pre><p>
                        Also, in this example, the "-V" option is used to specify
                        the new version.
                        If the source files pointed to by the
                        <code class="filename">SRC_URI</code> statement in the recipe are
                        in a Git repository, you must provide the "-S" option and
                        specify a revision for the software.</p><p>Once <code class="filename">devtool</code> locates the recipe,
                        it uses the <code class="filename">SRC_URI</code> variable to locate
                        the source code and any local patch files from other
                        developers are located.
                        The result is that the command sets up the source
                        code, the new version of the recipe, and an append file
                        all within the workspace.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Resolve any Conflicts created by the Upgrade</em></span>:
                        At this point, there could be some conflicts due to the
                        software being upgraded to a new version.
                        This would occur if your recipe specifies some patch files in
                        <code class="filename">SRC_URI</code> that conflict with changes
                        made in the new version of the software.
                        If this is the case, you need to resolve the conflicts
                        by editing the source and following the normal
                        <code class="filename">git rebase</code> conflict resolution
                        process.</p><p>Before moving onto the next step, be sure to resolve any
                        such conflicts created through use of a newer or different
                        version of the software.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Build the Recipe</em></span>:
                        Once you have your recipe in order, you can build it.
                        You can either use <code class="filename">devtool build</code> or
                        <code class="filename">bitbake</code>.
                        Either method produces build output that is stored
                        in
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TMPDIR" target="_top"><code class="filename">TMPDIR</code></a>.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Deploy the Build Output</em></span>:
                        When you use the <code class="filename">devtool build</code>
                        command or <code class="filename">bitbake</code> to build out your
                        recipe, you probably want to see if the resulting build
                        output works as expected on target hardware.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            This step assumes you have a previously built
                            image that is already either running in QEMU or
                            running on actual hardware.
                            Also, it is assumed that for deployment of the image
                            to the target, SSH is installed in the image and if
                            the image is running on real hardware that you have
                            network access to and from your development machine.
                        </div><p>
                        You can deploy your build output to that target hardware by
                        using the <code class="filename">devtool deploy-target</code> command:
                        </p><pre class="literallayout">
     $ devtool deploy-target <em class="replaceable"><code>recipe target</code></em>
                        </pre><p>
                        The <em class="replaceable"><code>target</code></em> is a live target machine
                        running as an SSH server.</p><p>You can, of course, also deploy the image you build
                        using the <code class="filename">devtool build-image</code> command
                        to actual hardware.
                        However, <code class="filename">devtool</code> does not provide a
                        specific command that allows you to do this.
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em>Finish Your Work With the Recipe</em></span>:
                        The <code class="filename">devtool finish</code> command creates
                        any patches corresponding to commits in the local
                        Git repository, moves the new recipe to a more permanent
                        layer, and then resets the recipe so that the recipe is
                        built normally rather than from the workspace.
                        If you specify a destination layer that is the same as
                        the original source, then the old version of the
                        recipe and associated files will be removed prior to
                        adding the new version.
                        </p><pre class="literallayout">
     $ devtool finish <em class="replaceable"><code>recipe layer</code></em>
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            Any changes you want to turn into patches must be
                            committed to the Git repository in the source tree.
                        </div><p>As a final process of the
                        <code class="filename">devtool finish</code> command, the state
                        of the standard layers and the upstream source is
                        restored so that you can build the recipe from those
                        areas rather than the workspace.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            You can use the <code class="filename">devtool reset</code>
                            command to put things back should you decide you
                            do not want to proceed with your work.
                            If you do use this command, realize that the source
                            tree is preserved.
                        </div><p>
                        </p></li></ol></div><p>
            </p></div></div><div class="section" title="4.3.2. Using Quilt in Your Workflow"><div class="titlepage"><div><div><h3 class="title" id="using-a-quilt-workflow">4.3.2. Using Quilt in Your Workflow<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-a-quilt-workflow">¶</a></span></h3></div></div></div><p>
            <a class="ulink" href="http://savannah.nongnu.org/projects/quilt" target="_top">Quilt</a>
            is a powerful tool that allows you to capture source code changes
            without having a clean source tree.
            This section outlines the typical workflow you can use to modify
            source code, test changes, and then preserve the changes in the
            form of a patch all using Quilt.
            </p><div class="note" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>
                With regard to preserving changes to source files if you
                clean a recipe or have <code class="filename">rm_work</code> enabled,
                the workflow described in the
                "<a class="link" href="#using-devtool-in-your-workflow" title="4.3.1. Using devtool in Your Workflow">Using <code class="filename">devtool</code> in Your Workflow</a>"
                section is a safer development flow than than the flow that
                uses Quilt.
            </div><p>
        </p><p>
            Follow these general steps:
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Find the Source Code:</em></span>
                    Temporary source code used by the OpenEmbedded build system
                    is kept in the
                    <a class="link" href="#build-directory">Build Directory</a>.
                    See the
                    "<a class="link" href="#finding-the-temporary-source-code" title="4.3.3. Finding Temporary Source Code">Finding Temporary Source Code</a>"
                    section to learn how to locate the directory that has the
                    temporary source code for a particular package.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Change Your Working Directory:</em></span>
                    You need to be in the directory that has the temporary source code.
                    That directory is defined by the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a>
                    variable.</p></li><li class="listitem"><p><span class="emphasis"><em>Create a New Patch:</em></span>
                    Before modifying source code, you need to create a new patch.
                    To create a new patch file, use <code class="filename">quilt new</code> as below:
                    </p><pre class="literallayout">
     $ quilt new my_changes.patch
                    </pre></li><li class="listitem"><p><span class="emphasis"><em>Notify Quilt and Add Files:</em></span>
                    After creating the patch, you need to notify Quilt about the files
                    you plan to edit.
                    You notify Quilt by adding the files to the patch you just created:
                    </p><pre class="literallayout">
     $ quilt add file1.c file2.c file3.c
                    </pre><p>
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Edit the Files:</em></span>
                    Make your changes in the source code to the files you added
                    to the patch.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Test Your Changes:</em></span>
                    Once you have modified the source code, the easiest way to
                    your changes is by calling the
                    <code class="filename">do_compile</code> task as shown in the
                    following example:
                    </p><pre class="literallayout">
     $ bitbake -c compile -f <em class="replaceable"><code>package</code></em>
                    </pre><p>
                    The <code class="filename">-f</code> or <code class="filename">--force</code>
                    option forces the specified task to execute.
                    If you find problems with your code, you can just keep editing and
                    re-testing iteratively until things work as expected.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>All the modifications you make to the temporary source code
                    disappear once you run the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-clean" target="_top"><code class="filename">do_clean</code></a>
                    or
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-cleanall" target="_top"><code class="filename">do_cleanall</code></a>
                    tasks using BitBake (i.e.
                    <code class="filename">bitbake -c clean <em class="replaceable"><code>package</code></em></code>
                    and
                    <code class="filename">bitbake -c cleanall <em class="replaceable"><code>package</code></em></code>).
                    Modifications will also disappear if you use the <code class="filename">rm_work</code>
                    feature as described in the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/yocto-project-qs/yocto-project-qs.html#qs-building-images" target="_top">Building Images</a>"
                    section of the Yocto Project Quick Start.
                    </div></li><li class="listitem"><p><span class="emphasis"><em>Generate the Patch:</em></span>
                    Once your changes work as expected, you need to use Quilt to generate the final patch that
                    contains all your modifications.
                    </p><pre class="literallayout">
     $ quilt refresh
                    </pre><p>
                    At this point, the <code class="filename">my_changes.patch</code> file has all your edits made
                    to the <code class="filename">file1.c</code>, <code class="filename">file2.c</code>, and
                    <code class="filename">file3.c</code> files.</p><p>You can find the resulting patch file in the <code class="filename">patches/</code>
                    subdirectory of the source (<code class="filename">S</code>) directory.</p></li><li class="listitem"><p><span class="emphasis"><em>Copy the Patch File:</em></span>
                    For simplicity, copy the patch file into a directory named <code class="filename">files</code>,
                    which you can create in the same directory that holds the recipe
                    (<code class="filename">.bb</code>) file or the
                    append (<code class="filename">.bbappend</code>) file.
                    Placing the patch here guarantees that the OpenEmbedded build system will find
                    the patch.
                    Next, add the patch into the
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top">SRC_URI</a></code>
                    of the recipe.
                    Here is an example:
                    </p><pre class="literallayout">
     SRC_URI += "file://my_changes.patch"
                    </pre></li></ol></div><p>
        </p></div><div class="section" title="4.3.3. Finding Temporary Source Code"><div class="titlepage"><div><div><h3 class="title" id="finding-the-temporary-source-code">4.3.3. Finding Temporary Source Code<span class="permalink"><a alt="Permalink" title="Permalink" href="#finding-the-temporary-source-code">¶</a></span></h3></div></div></div><p>
            You might find it helpful during development to modify the
            temporary source code used by recipes to build packages.
            For example, suppose you are developing a patch and you need to
            experiment a bit to figure out your solution.
            After you have initially built the package, you can iteratively
            tweak the source code, which is located in the
            <a class="link" href="#build-directory">Build Directory</a>, and then
            you can force a re-compile and quickly test your altered code.
            Once you settle on a solution, you can then preserve your changes
            in the form of patches.
            If you are using Quilt for development, see the
            "<a class="link" href="#using-a-quilt-workflow" title="4.3.2. Using Quilt in Your Workflow">Using Quilt in Your Workflow</a>"
            section for more information.
        </p><p>
            During a build, the unpacked temporary source code used by recipes
            to build packages is available in the Build Directory as
            defined by the
            <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top">S</a></code> variable.
            Below is the default value for the <code class="filename">S</code> variable as defined in the
            <code class="filename">meta/conf/bitbake.conf</code> configuration file in the
            <a class="link" href="#source-directory">Source Directory</a>:
            </p><pre class="literallayout">
     S = "${WORKDIR}/${BP}"
            </pre><p>
            You should be aware that many recipes override the <code class="filename">S</code> variable.
            For example, recipes that fetch their source from Git usually set
            <code class="filename">S</code> to <code class="filename">${WORKDIR}/git</code>.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                The
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BP" target="_top"><code class="filename">BP</code></a>
                represents the base recipe name, which consists of the name and version:
                <pre class="literallayout">
     BP = "${BPN}-${PV}"
                </pre></div><p>
        </p><p>
            The path to the work directory for the recipe
            (<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WORKDIR" target="_top"><code class="filename">WORKDIR</code></a>)
            is defined as follows:
            </p><pre class="literallayout">
     ${TMPDIR}/work/${MULTIMACH_TARGET_SYS}/${PN}/${EXTENDPE}${PV}-${PR}
            </pre><p>
            The actual directory depends on several things:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TMPDIR" target="_top"><code class="filename">TMPDIR</code></a>:
                    The top-level build output directory</li><li class="listitem"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MULTIMACH_TARGET_SYS" target="_top"><code class="filename">MULTIMACH_TARGET_SYS</code></a>:
                    The target system identifier</li><li class="listitem"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a>:
                    The recipe name</li><li class="listitem"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTENDPE" target="_top"><code class="filename">EXTENDPE</code></a>:
                    The epoch - (if
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PE" target="_top"><code class="filename">PE</code></a>
                    is not specified, which is usually the case for most
                    recipes, then <code class="filename">EXTENDPE</code> is blank)</li><li class="listitem"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>:
                    The recipe version</li><li class="listitem"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top"><code class="filename">PR</code></a>:
                    The recipe revision</li></ul></div><p>
        </p><p>
            As an example, assume a Source Directory top-level folder
            named <code class="filename">poky</code>, a default Build Directory at
            <code class="filename">poky/build</code>, and a
            <code class="filename">qemux86-poky-linux</code> machine target
            system.
            Furthermore, suppose your recipe is named
            <code class="filename">foo_1.3.0.bb</code>.
            In this case, the work directory the build system uses to
            build the package would be as follows:
            </p><pre class="literallayout">
     poky/build/tmp/work/qemux86-poky-linux/foo/1.3.0-r0
            </pre><p>
        </p><p>
            Now that you know where to locate the directory that has the
            temporary source code, you can use a Quilt as described in section
            "<a class="link" href="#using-a-quilt-workflow" title="4.3.2. Using Quilt in Your Workflow">Using Quilt in Your Workflow</a>"
            to make your edits, test the changes, and preserve the changes in
            the form of patches.
        </p></div></div><div class="section" title="4.4. Image Development Using Toaster"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="image-development-using-toaster">4.4. Image Development Using Toaster<span class="permalink"><a alt="Permalink" title="Permalink" href="#image-development-using-toaster">¶</a></span></h2></div></div></div><p>
        Toaster is a web interface to the Yocto Project's OpenEmbedded build
        system.
        You can initiate builds using Toaster as well as examine the results
        and statistics of builds.
        See the
        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/toaster-manual/toaster-manual.html#toaster-manual-intro" target="_top">Toaster User Manual</a>
        for information on how to set up and use Toaster to build images.
    </p></div><div class="section" title="4.5. Using a Development Shell"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="platdev-appdev-devshell">4.5. Using a Development Shell<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-appdev-devshell">¶</a></span></h2></div></div></div><p>
        When debugging certain commands or even when just editing packages,
        <code class="filename">devshell</code> can be a useful tool.
        When you invoke <code class="filename">devshell</code>, all tasks up to and
        including
        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-patch" target="_top"><code class="filename">do_patch</code></a>
        are run for the specified target.
        Then, a new terminal is opened and you are placed in
        <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a><code class="filename">}</code>,
        the source directory.
        In the new terminal, all the OpenEmbedded build-related environment variables are
        still defined so you can use commands such as <code class="filename">configure</code> and
        <code class="filename">make</code>.
        The commands execute just as if the OpenEmbedded build system were executing them.
        Consequently, working this way can be helpful when debugging a build or preparing
        software to be used with the OpenEmbedded build system.
    </p><p>
        Following is an example that uses <code class="filename">devshell</code> on a target named
        <code class="filename">matchbox-desktop</code>:
        </p><pre class="literallayout">
     $ bitbake matchbox-desktop -c devshell
        </pre><p>
    </p><p>
        This command spawns a terminal with a shell prompt within the OpenEmbedded build environment.
        The <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-OE_TERMINAL" target="_top"><code class="filename">OE_TERMINAL</code></a>
        variable controls what type of shell is opened.
    </p><p>
        For spawned terminals, the following occurs:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The <code class="filename">PATH</code> variable includes the
                cross-toolchain.</p></li><li class="listitem"><p>The <code class="filename">pkgconfig</code> variables find the correct
                <code class="filename">.pc</code> files.</p></li><li class="listitem"><p>The <code class="filename">configure</code> command finds the
                Yocto Project site files as well as any other necessary files.</p></li></ul></div><p>
    </p><p>
        Within this environment, you can run configure or compile
        commands as if they were being run by
        the OpenEmbedded build system itself.
        As noted earlier, the working directory also automatically changes to the
        Source Directory (<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a>).
    </p><p>
        To manually run a specific task using <code class="filename">devshell</code>,
        run the corresponding <code class="filename">run.*</code> script in
        the
        <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WORKDIR" target="_top"><code class="filename">WORKDIR</code></a><code class="filename">}/temp</code>
        directory (e.g.,
        <code class="filename">run.do_configure.</code><em class="replaceable"><code>pid</code></em>).
        If a task's script does not exist, which would be the case if the task was
        skipped by way of the sstate cache, you can create the task by first running
        it outside of the <code class="filename">devshell</code>:
        </p><pre class="literallayout">
     $ bitbake -c <em class="replaceable"><code>task</code></em>
        </pre><p>
        </p><div class="note" title="Notes" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Notes</h3><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Execution of a task's <code class="filename">run.*</code>
                    script and BitBake's execution of a task are identical.
                    In other words, running the script re-runs the task
                    just as it would be run using the
                    <code class="filename">bitbake -c</code> command.
                    </p></li><li class="listitem"><p>Any <code class="filename">run.*</code> file that does not
                    have a <code class="filename">.pid</code> extension is a
                    symbolic link (symlink) to the most recent version of that
                    file.
                    </p></li></ul></div></div><p>
    </p><p>
        Remember, that the <code class="filename">devshell</code> is a mechanism that allows
        you to get into the BitBake task execution environment.
        And as such, all commands must be called just as BitBake would call them.
        That means you need to provide the appropriate options for
        cross-compilation and so forth as applicable.
    </p><p>
        When you are finished using <code class="filename">devshell</code>, exit the shell
        or close the terminal window.
    </p><div class="note" title="Notes" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Notes</h3><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                It is worth remembering that when using <code class="filename">devshell</code>
                you need to use the full compiler name such as <code class="filename">arm-poky-linux-gnueabi-gcc</code>
                instead of just using <code class="filename">gcc</code>.
                The same applies to other applications such as <code class="filename">binutils</code>,
                <code class="filename">libtool</code> and so forth.
                BitBake sets up environment variables such as <code class="filename">CC</code>
                to assist applications, such as <code class="filename">make</code> to find the correct tools.
                </p></li><li class="listitem"><p>
                It is also worth noting that <code class="filename">devshell</code> still works over
                X11 forwarding and similar situations.
                </p></li></ul></div></div></div><div class="section" title="4.6. Using a Development Python Shell"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="platdev-appdev-devpyshell">4.6. Using a Development Python Shell<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-appdev-devpyshell">¶</a></span></h2></div></div></div><p>
        Similar to working within a development shell as described in
        the previous section, you can also spawn and work within an
        interactive Python development shell.
        When debugging certain commands or even when just editing packages,
        <code class="filename">devpyshell</code> can be a useful tool.
        When you invoke <code class="filename">devpyshell</code>, all tasks up to and
        including
        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-patch" target="_top"><code class="filename">do_patch</code></a>
        are run for the specified target.
        Then a new terminal is opened.
        Additionally, key Python objects and code are available in the same
        way they are to BitBake tasks, in particular, the data store 'd'.
        So, commands such as the following are useful when exploring the data
        store and running functions:
        </p><pre class="literallayout">
     pydevshell&gt; d.getVar("STAGING_DIR", True)
     '/media/build1/poky/build/tmp/sysroots'
     pydevshell&gt; d.getVar("STAGING_DIR", False)
     '${TMPDIR}/sysroots'
     pydevshell&gt; d.setVar("FOO", "bar")
     pydevshell&gt; d.getVar("FOO", True)
     'bar'
     pydevshell&gt; d.delVar("FOO")
     pydevshell&gt; d.getVar("FOO", True)
     pydevshell&gt; bb.build.exec_func("do_unpack", d)
     pydevshell&gt;
        </pre><p>
        The commands execute just as if the OpenEmbedded build system were executing them.
        Consequently, working this way can be helpful when debugging a build or preparing
        software to be used with the OpenEmbedded build system.
    </p><p>
        Following is an example that uses <code class="filename">devpyshell</code> on a target named
        <code class="filename">matchbox-desktop</code>:
        </p><pre class="literallayout">
     $ bitbake matchbox-desktop -c devpyshell
        </pre><p>
    </p><p>
        This command spawns a terminal and places you in an interactive
        Python interpreter within the OpenEmbedded build environment.
        The <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-OE_TERMINAL" target="_top"><code class="filename">OE_TERMINAL</code></a>
        variable controls what type of shell is opened.
    </p><p>
        When you are finished using <code class="filename">devpyshell</code>, you
        can exit the shell either by using Ctrl+d or closing the terminal
        window.
    </p></div></div>

    <div class="chapter" title="Chapter 5. Common Tasks" id="extendpoky"><div class="titlepage"><div><div><h2 class="title">Chapter 5. Common Tasks<span class="permalink"><a alt="Permalink" title="Permalink" href="#extendpoky">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="#understanding-and-creating-layers">5.1. Understanding and Creating Layers</a></span></dt><dd><dl><dt><span class="section"><a href="#yocto-project-layers">5.1.1. Layers</a></span></dt><dt><span class="section"><a href="#creating-your-own-layer">5.1.2. Creating Your Own Layer</a></span></dt><dt><span class="section"><a href="#best-practices-to-follow-when-creating-layers">5.1.3. Best Practices to Follow When Creating Layers</a></span></dt><dt><span class="section"><a href="#making-sure-your-layer-is-compatible-with-yocto-project">5.1.4. Making Sure Your Layer is Compatible With Yocto Project</a></span></dt><dt><span class="section"><a href="#enabling-your-layer">5.1.5. Enabling Your Layer</a></span></dt><dt><span class="section"><a href="#using-bbappend-files">5.1.6. Using .bbappend Files</a></span></dt><dt><span class="section"><a href="#prioritizing-your-layer">5.1.7. Prioritizing Your Layer</a></span></dt><dt><span class="section"><a href="#managing-layers">5.1.8. Managing Layers</a></span></dt><dt><span class="section"><a href="#creating-a-general-layer-using-the-yocto-layer-script">5.1.9. Creating a General Layer Using the yocto-layer Script</a></span></dt></dl></dd><dt><span class="section"><a href="#usingpoky-extend-customimage">5.2. Customizing Images</a></span></dt><dd><dl><dt><span class="section"><a href="#usingpoky-extend-customimage-localconf">5.2.1. Customizing Images Using <code class="filename">local.conf</code></a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-imagefeatures">5.2.2. Customizing Images Using Custom <code class="filename">IMAGE_FEATURES</code> and
                <code class="filename">EXTRA_IMAGE_FEATURES</code></a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-custombb">5.2.3. Customizing Images Using Custom .bb Files</a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-customtasks">5.2.4. Customizing Images Using Custom Package Groups</a></span></dt><dt><span class="section"><a href="#usingpoky-extend-customimage-image-name">5.2.5. Customizing an Image Hostname</a></span></dt></dl></dd><dt><span class="section"><a href="#new-recipe-writing-a-new-recipe">5.3. Writing a New Recipe</a></span></dt><dd><dl><dt><span class="section"><a href="#new-recipe-overview">5.3.1. Overview</a></span></dt><dt><span class="section"><a href="#new-recipe-locate-or-automatically-create-a-base-recipe">5.3.2. Locate or Automatically Create a Base Recipe</a></span></dt><dt><span class="section"><a href="#new-recipe-storing-and-naming-the-recipe">5.3.3. Storing and Naming the Recipe</a></span></dt><dt><span class="section"><a href="#understanding-recipe-syntax">5.3.4. Understanding Recipe Syntax</a></span></dt><dt><span class="section"><a href="#new-recipe-running-a-build-on-the-recipe">5.3.5. Running a Build on the Recipe</a></span></dt><dt><span class="section"><a href="#new-recipe-fetching-code">5.3.6. Fetching Code</a></span></dt><dt><span class="section"><a href="#new-recipe-unpacking-code">5.3.7. Unpacking Code</a></span></dt><dt><span class="section"><a href="#new-recipe-patching-code">5.3.8. Patching Code</a></span></dt><dt><span class="section"><a href="#new-recipe-licensing">5.3.9. Licensing</a></span></dt><dt><span class="section"><a href="#new-dependencies">5.3.10. Dependencies</a></span></dt><dt><span class="section"><a href="#new-recipe-configuring-the-recipe">5.3.11. Configuring the Recipe</a></span></dt><dt><span class="section"><a href="#new-recipe-using-headers-to-interface-with-devices">5.3.12. Using Headers to Interface with Devices</a></span></dt><dt><span class="section"><a href="#new-recipe-compilation">5.3.13. Compilation</a></span></dt><dt><span class="section"><a href="#new-recipe-installing">5.3.14. Installing</a></span></dt><dt><span class="section"><a href="#new-recipe-enabling-system-services">5.3.15. Enabling System Services</a></span></dt><dt><span class="section"><a href="#new-recipe-packaging">5.3.16. Packaging</a></span></dt><dt><span class="section"><a href="#new-sharing-files-between-recipes">5.3.17. Sharing Files Between Recipes</a></span></dt><dt><span class="section"><a href="#properly-versioning-pre-release-recipes">5.3.18. Properly Versioning Pre-Release Recipes</a></span></dt><dt><span class="section"><a href="#new-recipe-post-installation-scripts">5.3.19. Post-Installation Scripts</a></span></dt><dt><span class="section"><a href="#new-recipe-testing">5.3.20. Testing</a></span></dt><dt><span class="section"><a href="#new-recipe-testing-examples">5.3.21. Examples</a></span></dt><dt><span class="section"><a href="#following-recipe-style-guidelines">5.3.22. Following Recipe Style Guidelines</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-newmachine">5.4. Adding a New Machine</a></span></dt><dd><dl><dt><span class="section"><a href="#platdev-newmachine-conffile">5.4.1. Adding the Machine Configuration File</a></span></dt><dt><span class="section"><a href="#platdev-newmachine-kernel">5.4.2. Adding a Kernel for the Machine</a></span></dt><dt><span class="section"><a href="#platdev-newmachine-formfactor">5.4.3. Adding a Formfactor Configuration File</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-building-targets-with-multiple-configurations">5.5. Building Targets with Multiple Configurations</a></span></dt><dt><span class="section"><a href="#platdev-working-with-libraries">5.6. Working With Libraries</a></span></dt><dd><dl><dt><span class="section"><a href="#including-static-library-files">5.6.1. Including Static Library Files</a></span></dt><dt><span class="section"><a href="#combining-multiple-versions-library-files-into-one-image">5.6.2. Combining Multiple Versions of Library Files into One Image</a></span></dt><dt><span class="section"><a href="#installing-multiple-versions-of-the-same-library">5.6.3. Installing Multiple Versions of the Same Library</a></span></dt></dl></dd><dt><span class="section"><a href="#enabling-gobject-introspection-support">5.7. Enabling GObject Introspection Support</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-the-generation-of-introspection-data">5.7.1. Enabling the Generation of Introspection Data</a></span></dt><dt><span class="section"><a href="#disabling-the-generation-of-introspection-data">5.7.2. Disabling the Generation of Introspection Data</a></span></dt><dt><span class="section"><a href="#testing-that-introspection-works-in-an-image">5.7.3. Testing that Introspection Works in an Image</a></span></dt><dt><span class="section"><a href="#known-issues">5.7.4. Known Issues</a></span></dt></dl></dd><dt><span class="section"><a href="#dev-optionally-using-an-external-toolchain">5.8. Optionally Using an External Toolchain</a></span></dt><dt><span class="section"><a href="#creating-partitioned-images">5.9. Creating Partitioned Images</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-wic-images-oe">5.9.1. Creating Partitioned Images</a></span></dt><dt><span class="section"><a href="#create-wic-images-wic">5.9.2. Using OpenEmbedded Image Creator Wic to Generate Partitioned Images</a></span></dt></dl></dd><dt><span class="section"><a href="#building-an-initramfs-image">5.10. Building an Initial RAM Filesystem (initramfs) Image</a></span></dt><dt><span class="section"><a href="#configuring-the-kernel">5.11. Configuring the Kernel</a></span></dt><dd><dl><dt><span class="section"><a href="#using-menuconfig">5.11.1. Using  <code class="filename">menuconfig</code></a></span></dt><dt><span class="section"><a href="#creating-a-defconfig-file">5.11.2. Creating a  <code class="filename">defconfig</code> File</a></span></dt><dt><span class="section"><a href="#creating-config-fragments">5.11.3. Creating Configuration Fragments</a></span></dt><dt><span class="section"><a href="#fine-tuning-the-kernel-configuration-file">5.11.4. Fine-Tuning the Kernel Configuration File</a></span></dt><dt><span class="section"><a href="#determining-hardware-and-non-hardware-features-for-the-kernel-configuration-audit-phase">5.11.5. Determining Hardware and Non-Hardware Features for the Kernel Configuration Audit Phase</a></span></dt></dl></dd><dt><span class="section"><a href="#patching-the-kernel">5.12. Patching the Kernel</a></span></dt><dd><dl><dt><span class="section"><a href="#create-a-layer-for-your-changes">5.12.1. Create a Layer for your Changes</a></span></dt><dt><span class="section"><a href="#finding-the-kernel-source-code">5.12.2. Finding the Kernel Source Code</a></span></dt><dt><span class="section"><a href="#creating-the-patch">5.12.3. Creating the Patch</a></span></dt><dt><span class="section"><a href="#set-up-your-layer-for-the-build">5.12.4. Set Up Your Layer for the Build</a></span></dt><dt><span class="section"><a href="#set-up-for-the-build">5.12.5. Set Up for the Build</a></span></dt><dt><span class="section"><a href="#build-the-modified-qemu-kernel-image">5.12.6. Build the Modified QEMU Kernel Image</a></span></dt><dt><span class="section"><a href="#boot-the-image-and-verify-your-changes">5.12.7. Boot the Image and Verify Your Changes</a></span></dt></dl></dd><dt><span class="section"><a href="#making-images-more-secure">5.13. Making Images More Secure</a></span></dt><dd><dl><dt><span class="section"><a href="#general-considerations">5.13.1. General Considerations</a></span></dt><dt><span class="section"><a href="#security-flags">5.13.2. Security Flags</a></span></dt><dt><span class="section"><a href="#considerations-specific-to-the-openembedded-build-system">5.13.3. Considerations Specific to the OpenEmbedded Build System</a></span></dt><dt><span class="section"><a href="#tools-for-hardening-your-image">5.13.4. Tools for Hardening Your Image</a></span></dt></dl></dd><dt><span class="section"><a href="#creating-your-own-distribution">5.14. Creating Your Own Distribution</a></span></dt><dt><span class="section"><a href="#creating-a-custom-template-configuration-directory">5.15. Creating a Custom Template Configuration Directory</a></span></dt><dt><span class="section"><a href="#building-a-tiny-system">5.16. Building a Tiny System</a></span></dt><dd><dl><dt><span class="section"><a href="#tiny-system-overview">5.16.1. Overview</a></span></dt><dt><span class="section"><a href="#goals-and-guiding-principles">5.16.2. Goals and Guiding Principles</a></span></dt><dt><span class="section"><a href="#understand-what-gives-your-image-size">5.16.3. Understand What Contributes to Your Image Size</a></span></dt><dt><span class="section"><a href="#trim-the-root-filesystem">5.16.4. Trim the Root Filesystem</a></span></dt><dt><span class="section"><a href="#trim-the-kernel">5.16.5. Trim the Kernel</a></span></dt><dt><span class="section"><a href="#remove-package-management-requirements">5.16.6. Remove Package Management Requirements</a></span></dt><dt><span class="section"><a href="#look-for-other-ways-to-minimize-size">5.16.7. Look for Other Ways to Minimize Size</a></span></dt><dt><span class="section"><a href="#iterate-on-the-process">5.16.8. Iterate on the Process</a></span></dt></dl></dd><dt><span class="section"><a href="#building-images-for-more-than-one-machine">5.17. Building Images for More than One Machine</a></span></dt><dt><span class="section"><a href="#working-with-packages">5.18. Working with Packages</a></span></dt><dd><dl><dt><span class="section"><a href="#excluding-packages-from-an-image">5.18.1. Excluding Packages from an Image</a></span></dt><dt><span class="section"><a href="#incrementing-a-binary-package-version">5.18.2. Incrementing a Package Version</a></span></dt><dt><span class="section"><a href="#handling-optional-module-packaging">5.18.3. Handling Optional Module Packaging</a></span></dt><dt><span class="section"><a href="#using-runtime-package-management">5.18.4. Using Runtime Package Management</a></span></dt><dt><span class="section"><a href="#generating-and-using-signed-packages">5.18.5. Generating and Using Signed Packages</a></span></dt><dt><span class="section"><a href="#testing-packages-with-ptest">5.18.6. Testing Packages With ptest</a></span></dt></dl></dd><dt><span class="section"><a href="#working-with-source-files">5.19. Working with Source Files</a></span></dt><dd><dl><dt><span class="section"><a href="#setting-up-effective-mirrors">5.19.1. Setting up Effective Mirrors</a></span></dt><dt><span class="section"><a href="#getting-source-files-and-suppressing-the-build">5.19.2. Getting Source Files and Suppressing the Build</a></span></dt></dl></dd><dt><span class="section"><a href="#building-software-from-an-external-source">5.20. Building Software from an External Source</a></span></dt><dt><span class="section"><a href="#selecting-an-initialization-manager">5.21. Selecting an Initialization Manager</a></span></dt><dd><dl><dt><span class="section"><a href="#using-systemd-exclusively">5.21.1. Using systemd Exclusively</a></span></dt><dt><span class="section"><a href="#using-systemd-for-the-main-image-and-using-sysvinit-for-the-rescue-image">5.21.2. Using systemd for the Main Image and Using SysVinit for the Rescue Image</a></span></dt></dl></dd><dt><span class="section"><a href="#selecting-dev-manager">5.22. Selecting a Device Manager</a></span></dt><dd><dl><dt><span class="section"><a href="#static-dev-management">5.22.1. Using Persistent and Pre-Populated<code class="filename">/dev</code></a></span></dt><dt><span class="section"><a href="#devtmpfs-dev-management">5.22.2. Using <code class="filename">devtmpfs</code> and a Device Manager</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-appdev-srcrev">5.23. Using an External SCM</a></span></dt><dt><span class="section"><a href="#creating-a-read-only-root-filesystem">5.24. Creating a Read-Only Root Filesystem</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-the-root-filesystem">5.24.1. Creating the Root Filesystem</a></span></dt><dt><span class="section"><a href="#post-installation-scripts">5.24.2. Post-Installation Scripts</a></span></dt><dt><span class="section"><a href="#areas-with-write-access">5.24.3. Areas With Write Access</a></span></dt></dl></dd><dt><span class="section"><a href="#performing-automated-runtime-testing">5.25. Performing Automated Runtime Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-tests">5.25.1. Enabling Tests</a></span></dt><dt><span class="section"><a href="#qemu-image-running-tests">5.25.2. Running Tests</a></span></dt><dt><span class="section"><a href="#exporting-tests">5.25.3. Exporting Tests</a></span></dt><dt><span class="section"><a href="#qemu-image-writing-new-tests">5.25.4. Writing New Tests</a></span></dt><dt><span class="section"><a href="#installing-packages-in-the-dut-without-the-package-manager">5.25.5. Installing Packages in the DUT Without the Package Manager</a></span></dt></dl></dd><dt><span class="section"><a href="#platdev-gdb-remotedebug">5.26. Debugging With the GNU Project Debugger (GDB) Remotely</a></span></dt><dt><span class="section"><a href="#debugging-with-the-gnu-project-debugger-gdb-on-the-target">5.27. Debugging with the GNU Project Debugger (GDB) on the Target</a></span></dt><dt><span class="section"><a href="#debugging-parallel-make-races">5.28. Debugging Parallel Make Races</a></span></dt><dd><dl><dt><span class="section"><a href="#the-failure">5.28.1. The Failure</a></span></dt><dt><span class="section"><a href="#reproducing-the-error">5.28.2. Reproducing the Error</a></span></dt><dt><span class="section"><a href="#creating-a-patch-for-the-fix">5.28.3. Creating a Patch for the Fix</a></span></dt><dt><span class="section"><a href="#testing-the-build">5.28.4. Testing the Build</a></span></dt></dl></dd><dt><span class="section"><a href="#maintaining-open-source-license-compliance-during-your-products-lifecycle">5.29. Maintaining Open Source License Compliance During Your Product's Lifecycle</a></span></dt><dd><dl><dt><span class="section"><a href="#providing-the-source-code">5.29.1. Providing the Source Code</a></span></dt><dt><span class="section"><a href="#providing-license-text">5.29.2. Providing License Text</a></span></dt><dt><span class="section"><a href="#providing-compilation-scripts-and-source-code-modifications">5.29.3. Providing Compilation Scripts and Source Code Modifications</a></span></dt></dl></dd><dt><span class="section"><a href="#using-the-error-reporting-tool">5.30. Using the Error Reporting Tool</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-and-using-the-tool">5.30.1. Enabling and Using the Tool</a></span></dt><dt><span class="section"><a href="#disabling-the-tool">5.30.2. Disabling the Tool</a></span></dt><dt><span class="section"><a href="#setting-up-your-own-error-reporting-server">5.30.3. Setting Up Your Own Error Reporting Server</a></span></dt></dl></dd></dl></div><p>
        This chapter describes fundamental procedures such as creating layers,
        adding new software packages, extending or customizing images,
        porting work to new hardware (adding a new machine), and so forth.
        You will find that the procedures documented here occur often in the
        development cycle using the Yocto Project.
    </p><div class="section" title="5.1. Understanding and Creating Layers"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="understanding-and-creating-layers">5.1. Understanding and Creating Layers<span class="permalink"><a alt="Permalink" title="Permalink" href="#understanding-and-creating-layers">¶</a></span></h2></div></div></div><p>
            The OpenEmbedded build system supports organizing
            <a class="link" href="#metadata">Metadata</a> into multiple layers.
            Layers allow you to isolate different types of customizations from
            each other.
            You might find it tempting to keep everything in one layer when
            working on a single project.
            However, the more modular your Metadata, the easier
            it is to cope with future changes.
        </p><p>
            To illustrate how layers are used to keep things modular, consider
            machine customizations.
            These types of customizations typically reside in a special layer,
            rather than a general layer, called a Board Support Package (BSP)
            Layer.
            Furthermore, the machine customizations should be isolated from
            recipes and Metadata that support a new GUI environment,
            for example.
            This situation gives you a couple of layers: one for the machine
            configurations, and one for the GUI environment.
            It is important to understand, however, that the BSP layer can
            still make machine-specific additions to recipes within the GUI
            environment layer without polluting the GUI layer itself
            with those machine-specific changes.
            You can accomplish this through a recipe that is a BitBake append
            (<code class="filename">.bbappend</code>) file, which is described later
            in this section.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                For general information on BSP layer structure, see the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp" target="_top">Board Support Packages (BSP) - Developer's Guide</a>.
            </div><p>
        </p><p>
        </p><div class="section" title="5.1.1. Layers"><div class="titlepage"><div><div><h3 class="title" id="yocto-project-layers">5.1.1. Layers<span class="permalink"><a alt="Permalink" title="Permalink" href="#yocto-project-layers">¶</a></span></h3></div></div></div><p>
                The <a class="link" href="#source-directory">Source Directory</a>
                contains both general layers and BSP
                layers right out of the box.
                You can easily identify layers that ship with a
                Yocto Project release in the Source Directory by their
                folder names.
                Folders that represent layers typically have names that begin with
                the string <code class="filename">meta-</code>.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    It is not a requirement that a layer name begin with the
                    prefix <code class="filename">meta-</code>, but it is a commonly
                    accepted standard in the Yocto Project community.
                </div><p>
                For example, when you set up the Source Directory structure,
                you will see several layers:
                <code class="filename">meta</code>,
                <code class="filename">meta-skeleton</code>,
                <code class="filename">meta-selftest</code>,
                <code class="filename">meta-poky</code>, and
                <code class="filename">meta-yocto-bsp</code>.
                Each of these folders represents a distinct layer.
            </p><p>
                As another example, if you set up a local copy of the
                <code class="filename">meta-intel</code> Git repository
                and then explore the folder of that general layer,
                you will discover many Intel-specific BSP layers inside.
                For more information on BSP layers, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-layers" target="_top">BSP Layers</a>"
                section in the Yocto Project Board Support Package (BSP)
                Developer's Guide.
            </p></div><div class="section" title="5.1.2. Creating Your Own Layer"><div class="titlepage"><div><div><h3 class="title" id="creating-your-own-layer">5.1.2. Creating Your Own Layer<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-your-own-layer">¶</a></span></h3></div></div></div><p>
                It is very easy to create your own layers to use with the
                OpenEmbedded build system.
                The Yocto Project ships with scripts that speed up creating
                general layers and BSP layers.
                This section describes the steps you perform by hand to create
                a layer so that you can better understand them.
                For information about the layer-creation scripts, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#creating-a-new-bsp-layer-using-the-yocto-bsp-script" target="_top">Creating a New BSP Layer Using the yocto-bsp Script</a>"
                section in the Yocto Project Board Support Package (BSP)
                Developer's Guide and the
                "<a class="link" href="#creating-a-general-layer-using-the-yocto-layer-script" title="5.1.9. Creating a General Layer Using the yocto-layer Script">Creating a General Layer Using the yocto-layer Script</a>"
                section further down in this manual.
            </p><p>
                Follow these general steps to create your layer:
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Check Existing Layers:</em></span>
                        Before creating a new layer, you should be sure someone
                        has not already created a layer containing the Metadata
                        you need.
                        You can see the
                        <a class="ulink" href="http://layers.openembedded.org/layerindex/layers/" target="_top"><code class="filename">OpenEmbedded Metadata Index</code></a>
                        for a list of layers from the OpenEmbedded community
                        that can be used in the Yocto Project.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Create a Directory:</em></span>
                        Create the directory for your layer.
                        While not strictly required, prepend the name of the
                        folder with the string <code class="filename">meta-</code>.
                        For example:
                        </p><pre class="literallayout">
     meta-mylayer
     meta-GUI_xyz
     meta-mymachine
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Create a Layer Configuration
                       File:</em></span>
                       Inside your new layer folder, you need to create a
                       <code class="filename">conf/layer.conf</code> file.
                       It is easiest to take an existing layer configuration
                       file and copy that to your layer's
                       <code class="filename">conf</code> directory and then modify the
                       file as needed.</p><p>The
                       <code class="filename">meta-yocto-bsp/conf/layer.conf</code> file
                       demonstrates the required syntax:
                       </p><pre class="literallayout">
     # We have a conf and classes directory, add to BBPATH
     BBPATH .= ":${LAYERDIR}"

     # We have recipes-* directories, add to BBFILES
     BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \
                 ${LAYERDIR}/recipes-*/*/*.bbappend"

     BBFILE_COLLECTIONS += "yoctobsp"
     BBFILE_PATTERN_yoctobsp = "^${LAYERDIR}/"
     BBFILE_PRIORITY_yoctobsp = "5"
     LAYERVERSION_yoctobsp = "3"
                        </pre><p>Here is an explanation of the example:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The configuration and
                                classes directory is appended to
                                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBPATH" target="_top"><code class="filename">BBPATH</code></a>.
                                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                                    All non-distro layers, which include all BSP
                                    layers, are expected to append the layer
                                    directory to the
                                    <code class="filename">BBPATH</code>.
                                    On the other hand, distro layers, such as
                                    <code class="filename">meta-poky</code>, can choose
                                    to enforce their own precedence over
                                    <code class="filename">BBPATH</code>.
                                    For an example of that syntax, see the
                                    <code class="filename">layer.conf</code> file for
                                    the <code class="filename">meta-poky</code> layer.
                                </div></li><li class="listitem"><p>The recipes for the layers are
                                appended to
                                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBFILES" target="_top">BBFILES</a></code>.
                                </p></li><li class="listitem"><p>The
                                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBFILE_COLLECTIONS" target="_top">BBFILE_COLLECTIONS</a></code>
                                variable is then appended with the layer name.
                                </p></li><li class="listitem"><p>The
                                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBFILE_PATTERN" target="_top">BBFILE_PATTERN</a></code>
                                variable is set to a regular expression and is
                                used to match files from
                                <code class="filename">BBFILES</code> into a particular
                                layer.
                                In this case,
                                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LAYERDIR" target="_top">LAYERDIR</a></code>
                                is used to make <code class="filename">BBFILE_PATTERN</code> match within the
                                layer's path.</p></li><li class="listitem"><p>The
                                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBFILE_PRIORITY" target="_top">BBFILE_PRIORITY</a></code>
                                variable then assigns a priority to the layer.
                                Applying priorities is useful in situations
                                where the same recipe might appear in multiple
                                layers and allows you to choose the layer
                                that takes precedence.</p></li><li class="listitem"><p>The
                                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LAYERVERSION" target="_top">LAYERVERSION</a></code>
                                variable optionally specifies the version of a
                                layer as a single number.</p></li></ul></div><p>Note the use of the
                        <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LAYERDIR" target="_top">LAYERDIR</a></code>
                        variable, which expands to the directory of the current
                        layer.</p><p>Through the use of the <code class="filename">BBPATH</code>
                        variable, BitBake locates class files
                        (<code class="filename">.bbclass</code>),
                        configuration files, and files that are included
                        with <code class="filename">include</code> and
                        <code class="filename">require</code> statements.
                        For these cases, BitBake uses the first file that
                        matches the name found in <code class="filename">BBPATH</code>.
                        This is similar to the way the <code class="filename">PATH</code>
                        variable is used for binaries.
                        It is recommended, therefore, that you use unique
                        class and configuration
                        filenames in your custom layer.</p></li><li class="listitem"><p><span class="emphasis"><em>Add Content:</em></span> Depending
                        on the type of layer, add the content.
                        If the layer adds support for a machine, add the machine
                        configuration in a <code class="filename">conf/machine/</code>
                        file within the layer.
                        If the layer adds distro policy, add the distro
                        configuration in a <code class="filename">conf/distro/</code>
                        file within the layer.
                        If the layer introduces new recipes, put the recipes
                        you need in <code class="filename">recipes-*</code>
                        subdirectories within the layer.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>In order to be compliant with the Yocto Project,
                            a layer must contain a
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-filelayout-readme" target="_top">README file.</a></div><p>
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em>Optionally Test for Compatibility:</em></span>
                        If you want permission to use the Yocto Project
                        Compatibility logo with your layer or application that
                        uses your layer, perform the steps to apply for
                        compatibility.
                        See the
                        "<a class="link" href="#making-sure-your-layer-is-compatible-with-yocto-project" title="5.1.4. Making Sure Your Layer is Compatible With Yocto Project">Making Sure Your Layer is Compatible With Yocto Project</a>"
                        section for more information.
                        </p></li></ol></div><p>
            </p></div><div class="section" title="5.1.3. Best Practices to Follow When Creating Layers"><div class="titlepage"><div><div><h3 class="title" id="best-practices-to-follow-when-creating-layers">5.1.3. Best Practices to Follow When Creating Layers<span class="permalink"><a alt="Permalink" title="Permalink" href="#best-practices-to-follow-when-creating-layers">¶</a></span></h3></div></div></div><p>
                To create layers that are easier to maintain and that will
                not impact builds for other machines, you should consider the
                information in the following sections.
            </p><div class="section" title="5.1.3.1. Avoid &quot;Overlaying&quot; Entire Recipes"><div class="titlepage"><div><div><h4 class="title" id="avoid-overlaying-entire-recipes">5.1.3.1. Avoid "Overlaying" Entire Recipes<span class="permalink"><a alt="Permalink" title="Permalink" href="#avoid-overlaying-entire-recipes">¶</a></span></h4></div></div></div><p>
                    Avoid "overlaying" entire recipes from other layers in your
                    configuration.
                    In other words, do not copy an entire recipe into your
                    layer and then modify it.
                    Rather, use an append file (<code class="filename">.bbappend</code>)
                    to override
                    only those parts of the original recipe you need to modify.
                </p></div><div class="section" title="5.1.3.2. Avoid Duplicating Include Files"><div class="titlepage"><div><div><h4 class="title" id="avoid-duplicating-include-files">5.1.3.2. Avoid Duplicating Include Files<span class="permalink"><a alt="Permalink" title="Permalink" href="#avoid-duplicating-include-files">¶</a></span></h4></div></div></div><p>
                    Avoid duplicating include files.
                    Use append files (<code class="filename">.bbappend</code>)
                    for each recipe
                    that uses an include file.
                    Or, if you are introducing a new recipe that requires
                    the included file, use the path relative to the original
                    layer directory to refer to the file.
                    For example, use
                    <code class="filename">require recipes-core/</code><em class="replaceable"><code>package</code></em><code class="filename">/</code><em class="replaceable"><code>file</code></em><code class="filename">.inc</code>
                    instead of <code class="filename">require </code><em class="replaceable"><code>file</code></em><code class="filename">.inc</code>.
                    If you're finding you have to overlay the include file,
                    it could indicate a deficiency in the include file in
                    the layer to which it originally belongs.
                    If this is the case, you should try to address that
                    deficiency instead of overlaying the include file.
                    For example, you could address this by getting the
                    maintainer of the include file to add a variable or
                    variables to make it easy to override the parts needing
                    to be overridden.
                </p></div><div class="section" title="5.1.3.3. Structure Your Layers"><div class="titlepage"><div><div><h4 class="title" id="structure-your-layers">5.1.3.3. Structure Your Layers<span class="permalink"><a alt="Permalink" title="Permalink" href="#structure-your-layers">¶</a></span></h4></div></div></div><p>
                    Proper use of overrides within append files and placement
                    of machine-specific files within your layer can ensure that
                    a build is not using the wrong Metadata and negatively
                    impacting a build for a different machine.
                    Following are some examples:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Modifying Variables to Support
                            a Different Machine:</em></span>
                            Suppose you have a layer named
                            <code class="filename">meta-one</code> that adds support
                            for building machine "one".
                            To do so, you use an append file named
                            <code class="filename">base-files.bbappend</code> and
                            create a dependency on "foo" by altering the
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>
                            variable:
                            </p><pre class="literallayout">
     DEPENDS = "foo"
                            </pre><p>
                            The dependency is created during any build that
                            includes the layer
                            <code class="filename">meta-one</code>.
                            However, you might not want this dependency
                            for all machines.
                            For example, suppose you are building for
                            machine "two" but your
                            <code class="filename">bblayers.conf</code> file has the
                            <code class="filename">meta-one</code> layer included.
                            During the build, the
                            <code class="filename">base-files</code> for machine
                            "two" will also have the dependency on
                            <code class="filename">foo</code>.</p><p>To make sure your changes apply only when
                            building machine "one", use a machine override
                            with the <code class="filename">DEPENDS</code> statement:
                            </p><pre class="literallayout">
     DEPENDS_one = "foo"
                            </pre><p>
                            You should follow the same strategy when using
                            <code class="filename">_append</code> and
                            <code class="filename">_prepend</code> operations:
                            </p><pre class="literallayout">
     DEPENDS_append_one = " foo"
     DEPENDS_prepend_one = "foo "
                            </pre><p>
                            As an actual example, here's a line from the recipe
                            for gnutls, which adds dependencies on
                            "argp-standalone" when building with the musl C
                            library:
                            </p><pre class="literallayout">
     DEPENDS_append_libc-musl = " argp-standalone"
                            </pre><p>
                            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                                Avoiding "+=" and "=+" and using
                                machine-specific
                                <code class="filename">_append</code>
                                and <code class="filename">_prepend</code> operations
                                is recommended as well.
                            </div></li><li class="listitem"><p><span class="emphasis"><em>Place Machine-Specific Files
                            in Machine-Specific Locations:</em></span>
                            When you have a base recipe, such as
                            <code class="filename">base-files.bb</code>, that
                            contains a
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                            statement to a file, you can use an append file
                            to cause the build to use your own version of
                            the file.
                            For example, an append file in your layer at
                            <code class="filename">meta-one/recipes-core/base-files/base-files.bbappend</code>
                            could extend
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESPATH" target="_top"><code class="filename">FILESPATH</code></a>
                            using
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESEXTRAPATHS" target="_top"><code class="filename">FILESEXTRAPATHS</code></a>
                            as follows:
                            </p><pre class="literallayout">
     FILESEXTRAPATHS_prepend := "${THISDIR}/${BPN}:"
                            </pre><p>
                            The build for machine "one" will pick up your
                            machine-specific file as long as you have the
                            file in
                            <code class="filename">meta-one/recipes-core/base-files/base-files/</code>.
                            However, if you are building for a different
                            machine and the
                            <code class="filename">bblayers.conf</code> file includes
                            the <code class="filename">meta-one</code> layer and
                            the location of your machine-specific file is
                            the first location where that file is found
                            according to <code class="filename">FILESPATH</code>,
                            builds for all machines will also use that
                            machine-specific file.</p><p>You can make sure that a machine-specific
                            file is used for a particular machine by putting
                            the file in a subdirectory specific to the
                            machine.
                            For example, rather than placing the file in
                            <code class="filename">meta-one/recipes-core/base-files/base-files/</code>
                            as shown above, put it in
                            <code class="filename">meta-one/recipes-core/base-files/base-files/one/</code>.
                            Not only does this make sure the file is used
                            only when building for machine "one", but the
                            build process locates the file more quickly.</p><p>In summary, you need to place all files
                            referenced from <code class="filename">SRC_URI</code>
                            in a machine-specific subdirectory within the
                            layer in order to restrict those files to
                            machine-specific builds.</p></li></ul></div><p>
                </p></div><div class="section" title="5.1.3.4. Other Recommendations"><div class="titlepage"><div><div><h4 class="title" id="other-recommendations">5.1.3.4. Other Recommendations<span class="permalink"><a alt="Permalink" title="Permalink" href="#other-recommendations">¶</a></span></h4></div></div></div><p>
                    We also recommend the following:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>If you want permission to use the
                            Yocto Project Compatibility logo with your layer
                            or application that uses your layer, perform the
                            steps to apply for compatibility.
                            See the
                            "<a class="link" href="#making-sure-your-layer-is-compatible-with-yocto-project" title="5.1.4. Making Sure Your Layer is Compatible With Yocto Project">Making Sure Your Layer is Compatible With Yocto Project</a>"
                            section for more information.
                            </p></li><li class="listitem"><p>Store custom layers in a Git repository
                            that uses the
                            <code class="filename">meta-<em class="replaceable"><code>layer_name</code></em></code> format.
                            </p></li><li class="listitem"><p>Clone the repository alongside other
                            <code class="filename">meta</code> directories in the
                            <a class="link" href="#source-directory">Source Directory</a>.
                            </p></li></ul></div><p>
                     Following these recommendations keeps your Source Directory and
                     its configuration entirely inside the Yocto Project's core
                     base.
                </p></div></div><div class="section" title="5.1.4. Making Sure Your Layer is Compatible With Yocto Project"><div class="titlepage"><div><div><h3 class="title" id="making-sure-your-layer-is-compatible-with-yocto-project">5.1.4. Making Sure Your Layer is Compatible With Yocto Project<span class="permalink"><a alt="Permalink" title="Permalink" href="#making-sure-your-layer-is-compatible-with-yocto-project">¶</a></span></h3></div></div></div><p>
                When you create a layer used with the Yocto Project, it is
                advantageous to make sure that the layer interacts well with
                existing Yocto Project layers (i.e. the layer is compatible
                with the Yocto Project).
                Ensuring compatibility makes the layer easy to be consumed
                by others in the Yocto Project community and allows you
                permission to use the Yocto Project Compatibility logo.
            </p><p>
                Version 1.0 of the Yocto Project Compatibility Program has
                been in existence for a number of releases.
                This version of the program consists of the layer application
                process that requests permission to use the Yocto Project
                Compatibility logo for your layer and application.
                You can find version 1.0 of the form at
                <a class="ulink" href="https://www.yoctoproject.org/webform/yocto-project-compatible-registration" target="_top">https://www.yoctoproject.org/webform/yocto-project-compatible-registration</a>.
                To be granted permission to use the logo, you need to be able
                to answer "Yes" to the questions or have an acceptable
                explanation for any questions answered "No".
            </p><p>
                A second version (2.0) of the Yocto Project Compatibility
                Program is currently under development.
                Included as part of version 2.0 (and currently available) is
                the <code class="filename">yocto-compat-layer.py</code> script.
                When run against a layer, this script tests the layer against
                tighter constraints based on experiences of how layers have
                worked in the real world and where pitfalls have been found.
            </p><p>
                Part of the 2.0 version of the program that is not currently
                available but is in development is an updated compatibility
                application form.
                This updated form, among other questions, specifically
                asks if your layer has passed the test using the
                <code class="filename">yocto-compat-layer.py</code> script.
                </p><div class="note" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>
                    Even though the updated application form is currently
                    unavailable for version 2.0 of the Yocto Project
                    Compatibility Program, the
                    <code class="filename">yocto-compat-layer.py</code> script is
                    available in OE-Core.
                    You can use the script to assess the status of your
                    layers in advance of the 2.0 release of the program.
                </div><p>
            </p><p>
                The remainder of this section presents information on the
                version 1.0 registration form and on the
                <code class="filename">yocto-compat-layer.py</code> script.
            </p><div class="section" title="5.1.4.1. Yocto Project Compatibility Program Application"><div class="titlepage"><div><div><h4 class="title" id="yocto-project-compatibility-program-application">5.1.4.1. Yocto Project Compatibility Program Application<span class="permalink"><a alt="Permalink" title="Permalink" href="#yocto-project-compatibility-program-application">¶</a></span></h4></div></div></div><p>
                    Use the 1.0 version of the form to apply for your
                    layer's compatibility approval.
                    Upon successful application, you can use the Yocto
                    Project Compatibility logo with your layer and the
                    application that uses your layer.
                </p><p>
                    To access the form, use this link:
                    <a class="ulink" href="https://www.yoctoproject.org/webform/yocto-project-compatible-registration" target="_top">https://www.yoctoproject.org/webform/yocto-project-compatible-registration</a>.
                    Follow the instructions on the form to complete your
                    application.
                </p><p>
                    The application consists of the following sections:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <span class="emphasis"><em>Contact Information:</em></span>
                            Provide your contact information as the fields
                            require.
                            Along with your information, provide the
                            released versions of the Yocto Project for which
                            your layer is compatible.
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Acceptance Criteria:</em></span>
                            Provide "Yes" or "No" answers for each of the
                            items in the checklist.
                            Space exists at the bottom of the form for any
                            explanations for items for which you answered "No".
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Recommendations:</em></span>
                            Provide answers for the questions regarding Linux
                            kernel use and build success.
                            </p></li></ul></div><p>
                </p></div><div class="section" title="5.1.4.2. yocto-compat-layer.py Script"><div class="titlepage"><div><div><h4 class="title" id="yocto-compat-layer-py-script">5.1.4.2. <code class="filename">yocto-compat-layer.py</code> Script<span class="permalink"><a alt="Permalink" title="Permalink" href="#yocto-compat-layer-py-script">¶</a></span></h4></div></div></div><p>
                    The <code class="filename">yocto-compat-layer.py</code> script,
                    which is currently available, provides you a way to
                    assess how compatible your layer is with the Yocto
                    Project.
                    You should run this script prior to using the form to
                    apply for compatibility as described in the previous
                    section.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        Because the script is part of the 2.0 release of the
                        Yocto Project Compatibility Program, you are not
                        required to successfully run your layer against it
                        in order to be granted compatibility status.
                        However, it is a good idea as it promotes
                        well-behaved layers and gives you an idea of where your
                        layer stands regarding compatibility.
                    </div><p>
                </p><p>
                    The script divides tests into three areas: COMMON, BSD,
                    and DISTRO.
                    For example, given a distribution layer (DISTRO), the
                    layer must pass both the COMMON and DISTRO related tests.
                    Furthermore, if your layer is a BSP layer, the layer must
                    pass the COMMON and BSP set of tests.
                </p><p>
                    To execute the script, enter the following commands from
                    your build directory:
                    </p><pre class="literallayout">
     $ source oe-init-build-env
     $ yocto-compat-layer.py <em class="replaceable"><code>your_layer_directory</code></em>
                    </pre><p>
                    Be sure to provide the actual directory for your layer
                    as part of the command.
                </p><p>
                    Entering the command causes the script to determine the
                    type of layer and then to execute a set of specific
                    tests against the layer.
                    The following list overviews the test:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <code class="filename">common.test_readme</code>:
                            Tests if a <code class="filename">README</code> file
                            exists in the layer and the file is not empty.
                            </p></li><li class="listitem"><p>
                            <code class="filename">common.test_parse</code>:
                            Tests to make sure that BitBake can parse the
                            files without error (i.e.
                            <code class="filename">bitbake -p</code>).
                            </p></li><li class="listitem"><p>
                            <code class="filename">common.test_show_environment</code>:
                            Tests that the global or per-recipe environment
                            is in order without errors (i.e.
                            <code class="filename">bitbake -e</code>).
                            </p></li><li class="listitem"><p>
                            <code class="filename">common.test_signatures</code>:
                            Tests to be sure that BSP and DISTRO layers do not
                            come with recipes that change signatures.
                            </p></li><li class="listitem"><p>
                            <code class="filename">bsp.test_bsp_defines_machines</code>:
                            Tests if a BSP layer has machine configurations.
                            </p></li><li class="listitem"><p>
                            <code class="filename">bsp.test_bsp_no_set_machine</code>:
                            Tests to ensure a BSP layer does not set the
                            machine when the layer is added.
                            </p></li><li class="listitem"><p>
                            <code class="filename">distro.test_distro_defines_distros</code>:
                            Tests if a DISTRO layer has distro configurations.
                            </p></li><li class="listitem"><p>
                            <code class="filename">distro.test_distro_no_set_distro</code>:
                            Tests to ensure a DISTRO layer does not set the
                            distribution when the layer is added.
                            </p></li></ul></div><p>
                </p></div></div><div class="section" title="5.1.5. Enabling Your Layer"><div class="titlepage"><div><div><h3 class="title" id="enabling-your-layer">5.1.5. Enabling Your Layer<span class="permalink"><a alt="Permalink" title="Permalink" href="#enabling-your-layer">¶</a></span></h3></div></div></div><p>
                Before the OpenEmbedded build system can use your new layer,
                you need to enable it.
                To enable your layer, simply add your layer's path to the
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBLAYERS" target="_top">BBLAYERS</a></code>
                variable in your <code class="filename">conf/bblayers.conf</code> file,
                which is found in the
                <a class="link" href="#build-directory">Build Directory</a>.
                The following example shows how to enable a layer named
                <code class="filename">meta-mylayer</code>:
                </p><pre class="literallayout">
     LCONF_VERSION = "6"

     BBPATH = "${TOPDIR}"
     BBFILES ?= ""

     BBLAYERS ?= " \
       $HOME/poky/meta \
       $HOME/poky/meta-poky \
       $HOME/poky/meta-yocto-bsp \
       $HOME/poky/meta-mylayer \
       "
                </pre><p>
            </p><p>
                BitBake parses each <code class="filename">conf/layer.conf</code> file
                as specified in the <code class="filename">BBLAYERS</code> variable
                within the <code class="filename">conf/bblayers.conf</code> file.
                During the processing of each
                <code class="filename">conf/layer.conf</code> file, BitBake adds the
                recipes, classes and configurations contained within the
                particular layer to the source directory.
            </p></div><div class="section" title="5.1.6. Using .bbappend Files"><div class="titlepage"><div><div><h3 class="title" id="using-bbappend-files">5.1.6. Using .bbappend Files<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-bbappend-files">¶</a></span></h3></div></div></div><p>
                Recipes used to append Metadata to other recipes are called
                BitBake append files.
                BitBake append files use the <code class="filename">.bbappend</code> file
                type suffix, while the corresponding recipes to which Metadata
                is being appended use the <code class="filename">.bb</code> file type
                suffix.
            </p><p>
                A <code class="filename">.bbappend</code> file allows your layer to make
                additions or changes to the content of another layer's recipe
                without having to copy the other recipe into your layer.
                Your <code class="filename">.bbappend</code> file resides in your layer,
                while the main <code class="filename">.bb</code> recipe file to
                which you are appending Metadata resides in a different layer.
            </p><p>
                Append files must have the same root names as their corresponding
                recipes.
                For example, the append file
                <code class="filename">someapp_2.3.bbappend</code> must apply to
                <code class="filename">someapp_2.3.bb</code>.
                This means the original recipe and append file names are version
                number-specific.
                If the corresponding recipe is renamed to update to a newer
                version, the corresponding <code class="filename">.bbappend</code> file must
                be renamed (and possibly updated) as well.
                During the build process, BitBake displays an error on starting
                if it detects a <code class="filename">.bbappend</code> file that does
                not have a corresponding recipe with a matching name.
                See the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BB_DANGLINGAPPENDS_WARNONLY" target="_top"><code class="filename">BB_DANGLINGAPPENDS_WARNONLY</code></a>
                variable for information on how to handle this error.
            </p><p>
                Being able to append information to an existing recipe not only
                avoids duplication, but also automatically applies recipe
                changes in a different layer to your layer.
                If you were copying recipes, you would have to manually merge
                changes as they occur.
            </p><p>
                As an example, consider the main formfactor recipe and a
                corresponding formfactor append file both from the
                <a class="link" href="#source-directory">Source Directory</a>.
                Here is the main formfactor recipe, which is named
                <code class="filename">formfactor_0.0.bb</code> and located in the
                "meta" layer at
                <code class="filename">meta/recipes-bsp/formfactor</code>:
                </p><pre class="literallayout">
     SUMMARY = "Device formfactor information"
     SECTION = "base"
     LICENSE = "MIT"
     LIC_FILES_CHKSUM = "file://${COREBASE}/LICENSE;md5=4d92cd373abda3937c2bc47fbc49d690 \
                    file://${COREBASE}/meta/COPYING.MIT;md5=3da9cfbcb788c80a0384361b4de20420"
     PR = "r45"

     SRC_URI = "file://config file://machconfig"
     S = "${WORKDIR}"

     PACKAGE_ARCH = "${MACHINE_ARCH}"
     INHIBIT_DEFAULT_DEPS = "1"

     do_install() {
	     # Install file only if it has contents
             install -d ${D}${sysconfdir}/formfactor/
             install -m 0644 ${S}/config ${D}${sysconfdir}/formfactor/
	     if [ -s "${S}/machconfig" ]; then
	             install -m 0644 ${S}/machconfig ${D}${sysconfdir}/formfactor/
	     fi
     }
                </pre><p>
                In the main recipe, note the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                variable, which tells the OpenEmbedded build system where to
                find files during the build.
            </p><p>
                Following is the append file, which is named
                <code class="filename">formfactor_0.0.bbappend</code> and is from the
                Raspberry Pi BSP Layer named
                <code class="filename">meta-raspberrypi</code>.
                The file is in <code class="filename">recipes-bsp/formfactor</code>:
                </p><pre class="literallayout">
     FILESEXTRAPATHS_prepend := "${THISDIR}/${PN}:"
                </pre><p>
            </p><p>
                By default, the build system uses the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESPATH" target="_top"><code class="filename">FILESPATH</code></a>
                variable to locate files.
                This append file extends the locations by setting the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESEXTRAPATHS" target="_top"><code class="filename">FILESEXTRAPATHS</code></a>
                variable.
                Setting this variable in the <code class="filename">.bbappend</code>
                file is the most reliable and recommended method for adding
                directories to the search path used by the build system
                to find files.
            </p><p>
                The statement in this example extends the directories to include
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-THISDIR" target="_top"><code class="filename">THISDIR</code></a><code class="filename">}/${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a><code class="filename">}</code>,
                which resolves to a directory named
                <code class="filename">formfactor</code> in the same directory
                in which the append file resides (i.e.
                <code class="filename">meta-raspberrypi/recipes-bsp/formfactor/formfactor</code>.
                This implies that you must have the supporting directory
                structure set up that will contain any files or patches you
                will be including from the layer.
            </p><p>
                Using the immediate expansion assignment operator
                <code class="filename">:=</code> is important because of the reference to
                <code class="filename">THISDIR</code>.
                The trailing colon character is important as it ensures that
                items in the list remain colon-separated.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
                        BitBake automatically defines the
                        <code class="filename">THISDIR</code> variable.
                        You should never set this variable yourself.
                        Using "_prepend" as part of the
                        <code class="filename">FILESEXTRAPATHS</code> ensures your path
                        will be searched prior to other paths in the final
                        list.
                    </p><p>
                        Also, not all append files add extra files.
                        Many append files simply exist to add build options
                        (e.g. <code class="filename">systemd</code>).
                        For these cases, your append file would not even
                        use the <code class="filename">FILESEXTRAPATHS</code> statement.
                    </p></div><p>
            </p></div><div class="section" title="5.1.7. Prioritizing Your Layer"><div class="titlepage"><div><div><h3 class="title" id="prioritizing-your-layer">5.1.7. Prioritizing Your Layer<span class="permalink"><a alt="Permalink" title="Permalink" href="#prioritizing-your-layer">¶</a></span></h3></div></div></div><p>
                Each layer is assigned a priority value.
                Priority values control which layer takes precedence if there
                are recipe files with the same name in multiple layers.
                For these cases, the recipe file from the layer with a higher
                priority number takes precedence.
                Priority values also affect the order in which multiple
                <code class="filename">.bbappend</code> files for the same recipe are
                applied.
                You can either specify the priority manually, or allow the
                build system to calculate it based on the layer's dependencies.
            </p><p>
                To specify the layer's priority manually, use the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBFILE_PRIORITY" target="_top"><code class="filename">BBFILE_PRIORITY</code></a>
                variable.
                For example:
                </p><pre class="literallayout">
     BBFILE_PRIORITY_mylayer = "1"
                </pre><p>
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>It is possible for a recipe with a lower version number
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>
                in a layer that has a higher priority to take precedence.</p><p>Also, the layer priority does not currently affect the
                precedence order of <code class="filename">.conf</code>
                or <code class="filename">.bbclass</code> files.
                Future versions of BitBake might address this.</p></div></div><div class="section" title="5.1.8. Managing Layers"><div class="titlepage"><div><div><h3 class="title" id="managing-layers">5.1.8. Managing Layers<span class="permalink"><a alt="Permalink" title="Permalink" href="#managing-layers">¶</a></span></h3></div></div></div><p>
                You can use the BitBake layer management tool to provide a view
                into the structure of recipes across a multi-layer project.
                Being able to generate output that reports on configured layers
                with their paths and priorities and on
                <code class="filename">.bbappend</code> files and their applicable
                recipes can help to reveal potential problems.
            </p><p>
                Use the following form when running the layer management tool.
                </p><pre class="literallayout">
     $ bitbake-layers <em class="replaceable"><code>command</code></em> [<em class="replaceable"><code>arguments</code></em>]
                </pre><p>
                The following list describes the available commands:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename"><span class="emphasis"><em>help:</em></span></code>
                        Displays general help or help on a specified command.
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>show-layers:</em></span></code>
                        Shows the current configured layers.
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>show-recipes:</em></span></code>
                        Lists available recipes and the layers that provide them.
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>show-overlayed:</em></span></code>
                        Lists overlayed recipes.
                        A recipe is overlayed when a recipe with the same name
                        exists in another layer that has a higher layer
                        priority.
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>show-appends:</em></span></code>
                        Lists <code class="filename">.bbappend</code> files and the
                        recipe files to which they apply.
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>show-cross-depends:</em></span></code>
                        Lists dependency relationships between recipes that
                        cross layer boundaries.
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>add-layer:</em></span></code>
                        Adds a layer to <code class="filename">bblayers.conf</code>.
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>remove-layer:</em></span></code>
                        Removes a layer from <code class="filename">bblayers.conf</code>
                        </p></li><li class="listitem"><p><code class="filename"><span class="emphasis"><em>flatten:</em></span></code>
                        Flattens the layer configuration into a separate output
                        directory.
                        Flattening your layer configuration builds a "flattened"
                        directory that contains the contents of all layers,
                        with any overlayed recipes removed and any
                        <code class="filename">.bbappend</code> files appended to the
                        corresponding recipes.
                        You might have to perform some manual cleanup of the
                        flattened layer as follows:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Non-recipe files (such as patches)
                                are overwritten.
                                The flatten command shows a warning for these
                                files.
                                </p></li><li class="listitem"><p>Anything beyond the normal layer
                                setup has been added to the
                                <code class="filename">layer.conf</code> file.
                                Only the lowest priority layer's
                                <code class="filename">layer.conf</code> is used.
                                </p></li><li class="listitem"><p>Overridden and appended items from
                                <code class="filename">.bbappend</code> files need to be
                                cleaned up.
                                The contents of each
                                <code class="filename">.bbappend</code> end up in the
                                flattened recipe.
                                However, if there are appended or changed
                                variable values, you need to tidy these up
                                yourself.
                                Consider the following example.
                                Here, the <code class="filename">bitbake-layers</code>
                                command adds the line
                                <code class="filename">#### bbappended ...</code> so that
                                you know where the following lines originate:
                                </p><pre class="literallayout">
     ...
     DESCRIPTION = "A useful utility"
     ...
     EXTRA_OECONF = "--enable-something"
     ...

     #### bbappended from meta-anotherlayer ####

     DESCRIPTION = "Customized utility"
     EXTRA_OECONF += "--enable-somethingelse"
                                </pre><p>
                                Ideally, you would tidy up these utilities as
                                follows:
                                </p><pre class="literallayout">
     ...
     DESCRIPTION = "Customized utility"
     ...
     EXTRA_OECONF = "--enable-something --enable-somethingelse"
     ...
                                </pre></li></ul></div></li></ul></div><p>
            </p></div><div class="section" title="5.1.9. Creating a General Layer Using the yocto-layer Script"><div class="titlepage"><div><div><h3 class="title" id="creating-a-general-layer-using-the-yocto-layer-script">5.1.9. Creating a General Layer Using the yocto-layer Script<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-a-general-layer-using-the-yocto-layer-script">¶</a></span></h3></div></div></div><p>
                The <code class="filename">yocto-layer</code> script simplifies
                creating a new general layer.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    For information on BSP layers, see the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-layers" target="_top">BSP Layers</a>"
                    section in the Yocto Project Board Specific (BSP)
                    Developer's Guide.
                </div><p>
                The default mode of the script's operation is to prompt you for
                information needed to generate the layer:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The layer priority.
                        </p></li><li class="listitem"><p>Whether or not to create a sample recipe.
                        </p></li><li class="listitem"><p>Whether or not to create a sample
                        append file.
                        </p></li></ul></div><p>
            </p><p>
                Use the <code class="filename">yocto-layer create</code> sub-command
                to create a new general layer.
                In its simplest form, you can create a layer as follows:
                </p><pre class="literallayout">
     $ yocto-layer create mylayer
                </pre><p>
                The previous example creates a layer named
                <code class="filename">meta-mylayer</code> in the current directory.
            </p><p>
                As the <code class="filename">yocto-layer create</code> command runs,
                default values for the prompts appear in brackets.
                Pressing enter without supplying anything for the prompts
                or pressing enter and providing an invalid response causes the
                script to accept the default value.
                Once the script completes, the new layer
                is created in the current working directory.
                The script names the layer by prepending
                <code class="filename">meta-</code> to the name you provide.
            </p><p>
                Minimally, the script creates the following within the layer:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>The <code class="filename">conf</code>
                        directory:</em></span>
                        This directory contains the layer's configuration file.
                        The root name for the file is the same as the root name
                        your provided for the layer (e.g.
                        <code class="filename"><em class="replaceable"><code>layer</code></em>.conf</code>).
                        </p></li><li class="listitem"><p><span class="emphasis"><em>The
                        <code class="filename">COPYING.MIT</code> file:</em></span>
                        The copyright and use notice for the software.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>The <code class="filename">README</code>
                        file:</em></span>
                        A file describing the contents of your new layer.
                        </p></li></ul></div><p>
            </p><p>
                If you choose to generate a sample recipe file, the script
                prompts you for the name for the recipe and then creates it
                in <code class="filename"><em class="replaceable"><code>layer</code></em>/recipes-example/example/</code>.
                The script creates a <code class="filename">.bb</code> file and a
                directory, which contains a sample
                <code class="filename">helloworld.c</code> source file, along with
                a sample patch file.
                If you do not provide a recipe name, the script uses
                "example".
            </p><p>
                If you choose to generate a sample append file, the script
                prompts you for the name for the file and then creates it
                in <code class="filename"><em class="replaceable"><code>layer</code></em>/recipes-example-bbappend/example-bbappend/</code>.
                The script creates a <code class="filename">.bbappend</code> file and a
                directory, which contains a sample patch file.
                If you do not provide a recipe name, the script uses
                "example".
                The script also prompts you for the version of the append file.
                The version should match the recipe to which the append file
                is associated.
            </p><p>
                The easiest way to see how the <code class="filename">yocto-layer</code>
                script works is to experiment with the script.
                You can also read the usage information by entering the
                following:
                </p><pre class="literallayout">
     $ yocto-layer help
                </pre><p>
            </p><p>
                Once you create your general layer, you must add it to your
                <code class="filename">bblayers.conf</code> file.
                Here is an example where a layer named
                <code class="filename">meta-mylayer</code> is added:
                </p><pre class="literallayout">
     BBLAYERS = ?" \
        /usr/local/src/yocto/meta \
        /usr/local/src/yocto/meta-poky \
        /usr/local/src/yocto/meta-yocto-bsp \
        /usr/local/src/yocto/meta-mylayer \
        "
                </pre><p>
                Adding the layer to this file enables the build system to
                locate the layer during the build.
                </p></div></div><div class="section" title="5.2. Customizing Images"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="usingpoky-extend-customimage">5.2. Customizing Images<span class="permalink"><a alt="Permalink" title="Permalink" href="#usingpoky-extend-customimage">¶</a></span></h2></div></div></div><p>
            You can customize images to satisfy particular requirements.
            This section describes several methods and provides guidelines for each.
        </p><div class="section" title="5.2.1. Customizing Images Using local.conf"><div class="titlepage"><div><div><h3 class="title" id="usingpoky-extend-customimage-localconf">5.2.1. Customizing Images Using <code class="filename">local.conf</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#usingpoky-extend-customimage-localconf">¶</a></span></h3></div></div></div><p>
                Probably the easiest way to customize an image is to add a
                package by way of the <code class="filename">local.conf</code>
                configuration file.
                Because it is limited to local use, this method generally only
                allows you to add packages and is not as flexible as creating
                your own customized image.
                When you add packages using local variables this way, you need
                to realize that these variable changes are in effect for every
                build and consequently affect all images, which might not
                be what you require.
            </p><p>
                To add a package to your image using the local configuration
                file, use the
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_INSTALL" target="_top">IMAGE_INSTALL</a></code>
                variable with the <code class="filename">_append</code> operator:
                </p><pre class="literallayout">
     IMAGE_INSTALL_append = " strace"
                </pre><p>
                Use of the syntax is important - specifically, the space between
                the quote and the package name, which is
                <code class="filename">strace</code> in this example.
                This space is required since the <code class="filename">_append</code>
                operator does not add the space.
            </p><p>
                Furthermore, you must use <code class="filename">_append</code> instead
                of the <code class="filename">+=</code> operator if you want to avoid
                ordering issues.
                The reason for this is because doing so unconditionally appends
                to the variable and avoids ordering problems due to the
                variable being set in image recipes and
                <code class="filename">.bbclass</code> files with operators like
                <code class="filename">?=</code>.
                Using <code class="filename">_append</code> ensures the operation takes
                affect.
            </p><p>
                As shown in its simplest use,
                <code class="filename">IMAGE_INSTALL_append</code> affects all images.
                It is possible to extend the syntax so that the variable
                applies to a specific image only.
                Here is an example:
                </p><pre class="literallayout">
     IMAGE_INSTALL_append_pn-core-image-minimal = " strace"
                </pre><p>
                This example adds <code class="filename">strace</code> to the
                <code class="filename">core-image-minimal</code> image only.
            </p><p>
                You can add packages using a similar approach through the
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-CORE_IMAGE_EXTRA_INSTALL" target="_top">CORE_IMAGE_EXTRA_INSTALL</a></code>
                variable.
                If you use this variable, only
                <code class="filename">core-image-*</code> images are affected.
            </p></div><div class="section" title="5.2.2. Customizing Images Using Custom IMAGE_FEATURES and EXTRA_IMAGE_FEATURES"><div class="titlepage"><div><div><h3 class="title" id="usingpoky-extend-customimage-imagefeatures">5.2.2. Customizing Images Using Custom <code class="filename">IMAGE_FEATURES</code> and
                <code class="filename">EXTRA_IMAGE_FEATURES</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#usingpoky-extend-customimage-imagefeatures">¶</a></span></h3></div></div></div><p>
                Another method for customizing your image is to enable or
                disable high-level image features by using the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>
                and <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTRA_IMAGE_FEATURES" target="_top"><code class="filename">EXTRA_IMAGE_FEATURES</code></a>
                variables.
                Although the functions for both variables are nearly equivalent,
                best practices dictate using <code class="filename">IMAGE_FEATURES</code>
                from within a recipe and using
                <code class="filename">EXTRA_IMAGE_FEATURES</code> from within
                your <code class="filename">local.conf</code> file, which is found in the
                <a class="link" href="#build-directory">Build Directory</a>.
            </p><p>
                To understand how these features work, the best reference is
                <code class="filename">meta/classes/core-image.bbclass</code>.
                This class lists out the available
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>
                of which most map to package groups while some, such as
                <code class="filename">debug-tweaks</code> and
                <code class="filename">read-only-rootfs</code>, resolve as general
                configuration settings.
            </p><p>
                In summary, the file looks at the contents of the
                <code class="filename">IMAGE_FEATURES</code> variable and then maps
                or configures the feature accordingly.
                Based on this information, the build system automatically
                adds the appropriate packages or configurations to the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_INSTALL" target="_top"><code class="filename">IMAGE_INSTALL</code></a>
                variable.
                Effectively, you are enabling extra features by extending the
                class or creating a custom class for use with specialized image
                <code class="filename">.bb</code> files.
            </p><p>
                Use the <code class="filename">EXTRA_IMAGE_FEATURES</code> variable
                from within your local configuration file.
                Using a separate area from which to enable features with
                this variable helps you avoid overwriting the features in the
                image recipe that are enabled with
                <code class="filename">IMAGE_FEATURES</code>.
                The value of <code class="filename">EXTRA_IMAGE_FEATURES</code> is added
                to <code class="filename">IMAGE_FEATURES</code> within
                <code class="filename">meta/conf/bitbake.conf</code>.
            </p><p>
                To illustrate how you can use these variables to modify your
                image, consider an example that selects the SSH server.
                The Yocto Project ships with two SSH servers you can use
                with your images: Dropbear and OpenSSH.
                Dropbear is a minimal SSH server appropriate for
                resource-constrained environments, while OpenSSH is a
                well-known standard SSH server implementation.
                By default, the <code class="filename">core-image-sato</code> image
                is configured to use Dropbear.
                The <code class="filename">core-image-full-cmdline</code> and
                <code class="filename">core-image-lsb</code> images both
                include OpenSSH.
                The <code class="filename">core-image-minimal</code> image does not
                contain an SSH server.
            </p><p>
                You can customize your image and change these defaults.
                Edit the <code class="filename">IMAGE_FEATURES</code> variable
                in your recipe or use the
                <code class="filename">EXTRA_IMAGE_FEATURES</code> in your
                <code class="filename">local.conf</code> file so that it configures the
                image you are working with to include
                <code class="filename">ssh-server-dropbear</code> or
                <code class="filename">ssh-server-openssh</code>.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                See the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-images" target="_top">Images</a>"
                section in the Yocto Project Reference Manual for a complete
                list of image features that ship with the Yocto Project.
            </div></div><div class="section" title="5.2.3. Customizing Images Using Custom .bb Files"><div class="titlepage"><div><div><h3 class="title" id="usingpoky-extend-customimage-custombb">5.2.3. Customizing Images Using Custom .bb Files<span class="permalink"><a alt="Permalink" title="Permalink" href="#usingpoky-extend-customimage-custombb">¶</a></span></h3></div></div></div><p>
                You can also customize an image by creating a custom recipe
                that defines additional software as part of the image.
                The following example shows the form for the two lines you need:
                </p><pre class="literallayout">
     IMAGE_INSTALL = "packagegroup-core-x11-base package1 package2"

     inherit core-image
                </pre><p>
            </p><p>
                Defining the software using a custom recipe gives you total
                control over the contents of the image.
                It is important to use the correct names of packages in the
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_INSTALL" target="_top">IMAGE_INSTALL</a></code>
                variable.
                You must use the OpenEmbedded notation and not the Debian notation for the names
                (e.g. <code class="filename">glibc-dev</code> instead of <code class="filename">libc6-dev</code>).
            </p><p>
                The other method for creating a custom image is to base it on an existing image.
                For example, if you want to create an image based on <code class="filename">core-image-sato</code>
                but add the additional package <code class="filename">strace</code> to the image,
                copy the <code class="filename">meta/recipes-sato/images/core-image-sato.bb</code> to a
                new <code class="filename">.bb</code> and add the following line to the end of the copy:
                </p><pre class="literallayout">
     IMAGE_INSTALL += "strace"
                </pre><p>
            </p></div><div class="section" title="5.2.4. Customizing Images Using Custom Package Groups"><div class="titlepage"><div><div><h3 class="title" id="usingpoky-extend-customimage-customtasks">5.2.4. Customizing Images Using Custom Package Groups<span class="permalink"><a alt="Permalink" title="Permalink" href="#usingpoky-extend-customimage-customtasks">¶</a></span></h3></div></div></div><p>
                For complex custom images, the best approach for customizing
                an image is to create a custom package group recipe that is
                used to build the image or images.
                A good example of a package group recipe is
                <code class="filename">meta/recipes-core/packagegroups/packagegroup-base.bb</code>.
            </p><p>
                If you examine that recipe, you see that the
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES" target="_top">PACKAGES</a></code>
                variable lists the package group packages to produce.
                The <code class="filename">inherit packagegroup</code> statement
                sets appropriate default values and automatically adds
                <code class="filename">-dev</code>, <code class="filename">-dbg</code>, and
                <code class="filename">-ptest</code> complementary packages for each
                package specified in the <code class="filename">PACKAGES</code>
                statement.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    The <code class="filename">inherit packages</code> should be
                    located near the top of the recipe, certainly before
                    the <code class="filename">PACKAGES</code> statement.
                </div><p>
            </p><p>
                For each package you specify in <code class="filename">PACKAGES</code>,
                you can use
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RDEPENDS" target="_top">RDEPENDS</a></code>
                and
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RRECOMMENDS" target="_top">RRECOMMENDS</a></code>
                entries to provide a list of packages the parent task package
                should contain.
                You can see examples of these further down in the
                <code class="filename">packagegroup-base.bb</code> recipe.
            </p><p>
                Here is a short, fabricated example showing the same basic
                pieces:
                </p><pre class="literallayout">
     DESCRIPTION = "My Custom Package Groups"

     inherit packagegroup

     PACKAGES = "\
         packagegroup-custom-apps \
         packagegroup-custom-tools \
         "

     RDEPENDS_packagegroup-custom-apps = "\
         dropbear \
         portmap \
         psplash"

     RDEPENDS_packagegroup-custom-tools = "\
         oprofile \
         oprofileui-server \
         lttng-tools"

     RRECOMMENDS_packagegroup-custom-tools = "\
         kernel-module-oprofile"
                </pre><p>
            </p><p>
                In the previous example, two package group packages are created with their dependencies and their
                recommended package dependencies listed: <code class="filename">packagegroup-custom-apps</code>, and
                <code class="filename">packagegroup-custom-tools</code>.
                To build an image using these package group packages, you need to add
                <code class="filename">packagegroup-custom-apps</code> and/or
                <code class="filename">packagegroup-custom-tools</code> to
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_INSTALL" target="_top">IMAGE_INSTALL</a></code>.
                For other forms of image dependencies see the other areas of this section.
            </p></div><div class="section" title="5.2.5. Customizing an Image Hostname"><div class="titlepage"><div><div><h3 class="title" id="usingpoky-extend-customimage-image-name">5.2.5. Customizing an Image Hostname<span class="permalink"><a alt="Permalink" title="Permalink" href="#usingpoky-extend-customimage-image-name">¶</a></span></h3></div></div></div><p>
                By default, the configured hostname (i.e.
                <code class="filename">/etc/hostname</code>) in an image is the
                same as the machine name.
                For example, if
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                equals "qemux86", the configured hostname written to
                <code class="filename">/etc/hostname</code> is "qemux86".
            </p><p>
                You can customize this name by altering the value of the
                "hostname" variable in the
                <code class="filename">base-files</code> recipe using either
                an append file or a configuration file.
                Use the following in an append file:
                </p><pre class="literallayout">
     hostname="myhostname"
                </pre><p>
                Use the following in a configuration file:
                </p><pre class="literallayout">
     hostname_pn-base-files = "myhostname"
                </pre><p>
            </p><p>
                Changing the default value of the variable "hostname" can be
                useful in certain situations.
                For example, suppose you need to do extensive testing on an
                image and you would like to easily identify the image
                under test from existing images with typical default
                hostnames.
                In this situation, you could change the default hostname to
                "testme", which results in all the images using the name
                "testme".
                Once testing is complete and you do not need to rebuild the
                image for test any longer, you can easily reset the default
                hostname.
            </p><p>
                Another point of interest is that if you unset the variable,
                the image will have no default hostname in the filesystem.
                Here is an example that unsets the variable in a
                configuration file:
                </p><pre class="literallayout">
     hostname_pn-base-files = ""
                </pre><p>
                Having no default hostname in the filesystem is suitable for
                environments that use dynamic hostnames such as virtual
                machines.
            </p></div></div><div class="section" title="5.3. Writing a New Recipe"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="new-recipe-writing-a-new-recipe">5.3. Writing a New Recipe<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-writing-a-new-recipe">¶</a></span></h2></div></div></div><p>
            Recipes (<code class="filename">.bb</code> files) are fundamental components
            in the Yocto Project environment.
            Each software component built by the OpenEmbedded build system
            requires a recipe to define the component.
            This section describes how to create, write, and test a new
            recipe.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                For information on variables that are useful for recipes and
                for information about recipe naming issues, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-varlocality-recipe-required" target="_top">Required</a>"
                section of the Yocto Project Reference Manual.
            </div><p>
        </p><div class="section" title="5.3.1. Overview"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-overview">5.3.1. Overview<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-overview">¶</a></span></h3></div></div></div><p>
                The following figure shows the basic process for creating a
                new recipe.
                The remainder of the section provides details for the steps.
                </p><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr style="height: 630px"><td align="center"><img src="figures/recipe-workflow.png" align="middle" width="540" /></td></tr></table><p>
            </p></div><div class="section" title="5.3.2. Locate or Automatically Create a Base Recipe"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-locate-or-automatically-create-a-base-recipe">5.3.2. Locate or Automatically Create a Base Recipe<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-locate-or-automatically-create-a-base-recipe">¶</a></span></h3></div></div></div><p>
                You can always write a recipe from scratch.
                However, three choices exist that can help you quickly get a
                start on a new recipe:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        <span class="emphasis"><em><code class="filename">devtool add</code>:</em></span>
                        A command that assists in creating a recipe and
                        an environment conducive to development.
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em><code class="filename">recipetool create</code>:</em></span>
                        A command provided by the Yocto Project that automates
                        creation of a base recipe based on the source
                        files.
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em>Existing Recipes:</em></span>
                        Location and modification of an existing recipe that is
                        similar in function to the recipe you need.
                        </p></li></ul></div><p>
            </p><div class="section" title="5.3.2.1. Creating the Base Recipe Using devtool add"><div class="titlepage"><div><div><h4 class="title" id="new-recipe-creating-the-base-recipe-using-devtool">5.3.2.1. Creating the Base Recipe Using <code class="filename">devtool add</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-creating-the-base-recipe-using-devtool">¶</a></span></h4></div></div></div><p>
                    The <code class="filename">devtool add</code> command uses the same
                    logic for auto-creating the recipe as
                    <code class="filename">recipetool create</code>, which is listed
                    below.
                    Additionally, however, <code class="filename">devtool add</code>
                    sets up an environment that makes it easy for you to
                    patch the source and to make changes to the recipe as
                    is often necessary when adding a recipe to build a new
                    piece of software to be included in a build.
                </p><p>
                    You can find a complete description of the
                    <code class="filename">devtool add</code> command in the
                    "<a class="link" href="#use-devtool-to-integrate-new-code" title="4.3.1.1. Use devtool add to Add an Application">Use <code class="filename">devtool add</code> to Add an Application</a>"
                    section.
                </p></div><div class="section" title="5.3.2.2. Creating the Base Recipe Using recipetool create"><div class="titlepage"><div><div><h4 class="title" id="new-recipe-creating-the-base-recipe-using-recipetool">5.3.2.2. Creating the Base Recipe Using <code class="filename">recipetool create</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-creating-the-base-recipe-using-recipetool">¶</a></span></h4></div></div></div><p>
                    <code class="filename">recipetool create</code> automates creation
                    of a base recipe given a set of source code files.
                    As long as you can extract or point to the source files,
                    the tool will construct a recipe and automatically
                    configure all pre-build information into the recipe.
                    For example, suppose you have an application that builds
                    using Autotools.
                    Creating the base recipe using
                    <code class="filename">recipetool</code> results in a recipe
                    that has the pre-build dependencies, license requirements,
                    and checksums configured.
                </p><p>
                    To run the tool, you just need to be in your
                    <a class="link" href="#build-directory">Build Directory</a>
                    and have sourced the build environment setup script
                    (i.e.
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                    or
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>).
                    Here is the basic <code class="filename">recipetool</code> syntax:
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        Running <code class="filename">recipetool -h</code> or
                        <code class="filename">recipetool create -h</code> produces the
                        Python-generated help, which presented differently
                        than what follows here.
                    </div><p>
                    </p><pre class="literallayout">
     recipetool -h
     recipetool create [-h]
     recipetool [-d] [-q] [--color auto | always | never ] create -o <em class="replaceable"><code>OUTFILE</code></em> [-m] [-x <em class="replaceable"><code>EXTERNALSRC</code></em>] <em class="replaceable"><code>source</code></em>

          -d       Enables debug output.
          -q       Outputs only errors (quiet mode).
          --color  Colorizes the output automatically, always, or never.
          -h       Displays Python generated syntax for recipetool.
          create   Causes recipetool to create a base recipe.  The create
                   command is further defined with these options:

                   -o <em class="replaceable"><code>OUTFILE</code></em>      Specifies the full path and filename for the generated
                                   recipe.
                   -m              Causes the recipe to be machine-specific rather than
                                   architecture-specific (default).
                   -x <em class="replaceable"><code>EXTERNALSRC</code></em>  Fetches and extracts source files from <em class="replaceable"><code>source</code></em>
                                   and places them in <em class="replaceable"><code>EXTERNALSRC</code></em>.
                                   <em class="replaceable"><code>source</code></em> must be a URL.
                   -h              Displays Python-generated syntax for create.
                   <em class="replaceable"><code>source</code></em>          Specifies the source code on which to base the
                                   recipe.
                    </pre><p>
                </p><p>
                    Running <code class="filename">recipetool create -o</code> <em class="replaceable"><code>OUTFILE</code></em>
                    creates the base recipe and locates it properly in the
                    layer that contains your source files.
                    Following are some syntax examples:
                </p><p>
                    Use this syntax to generate a recipe based on <em class="replaceable"><code>source</code></em>.
                    Once generated, the recipe resides in the existing source
                    code layer:
                    </p><pre class="literallayout">
     recipetool create -o <em class="replaceable"><code>OUTFILE</code></em> <em class="replaceable"><code>source</code></em>
                    </pre><p>
                    Use this syntax to generate a recipe using code that you
                    extract from <em class="replaceable"><code>source</code></em>.
                    The extracted code is placed in its own layer defined
                    by <em class="replaceable"><code>EXTERNALSRC</code></em>.
                    </p><pre class="literallayout">
     recipetool create -o <em class="replaceable"><code>OUTFILE</code></em> -x <em class="replaceable"><code>EXTERNALSRC</code></em> <em class="replaceable"><code>source</code></em>
                    </pre><p>
                    Use this syntax to generate a recipe based on <em class="replaceable"><code>source</code></em>.
                    The options direct <code class="filename">recipetool</code> to
                    generate debugging information.
                    Once generated, the recipe resides in the existing source
                    code layer:
                    </p><pre class="literallayout">
     recipetool create -d -o <em class="replaceable"><code>OUTFILE</code></em> <em class="replaceable"><code>source</code></em>
                    </pre><p>
                </p></div><div class="section" title="5.3.2.3. Locating and Using a Similar Recipe"><div class="titlepage"><div><div><h4 class="title" id="new-recipe-locating-and-using-a-similar-recipe">5.3.2.3. Locating and Using a Similar Recipe<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-locating-and-using-a-similar-recipe">¶</a></span></h4></div></div></div><p>
                    Before writing a recipe from scratch, it is often useful to
                    discover whether someone else has already written one that
                    meets (or comes close to meeting) your needs.
                    The Yocto Project and OpenEmbedded communities maintain many
                    recipes that might be candidates for what you are doing.
                    You can find a good central index of these recipes in the
                    <a class="ulink" href="http://layers.openembedded.org" target="_top">OpenEmbedded metadata index</a>.
                </p><p>
                    Working from an existing recipe or a skeleton recipe is the
                    best way to get started.
                    Here are some points on both methods:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Locate and modify a recipe that
                            is close to what you want to do:</em></span>
                            This method works when you are familiar with the
                            current recipe space.
                            The method does not work so well for those new to
                            the Yocto Project or writing recipes.</p><p>Some risks associated with this method are
                            using a recipe that has areas totally unrelated to
                            what you are trying to accomplish with your recipe,
                            not recognizing areas of the recipe that you might
                            have to add from scratch, and so forth.
                            All these risks stem from unfamiliarity with the
                            existing recipe space.</p></li><li class="listitem"><p><span class="emphasis"><em>Use and modify the following
                            skeleton recipe:</em></span>
                            If for some reason you do not want to use
                            <code class="filename">recipetool</code> and you cannot
                            find an existing recipe that is close to meeting
                            your needs, you can use the following structure to
                            provide the fundamental areas of a new recipe.
                            </p><pre class="literallayout">
     DESCRIPTION = ""
     HOMEPAGE = ""
     LICENSE = ""
     SECTION = ""
     DEPENDS = ""
     LIC_FILES_CHKSUM = ""

     SRC_URI = ""
                            </pre><p>
                            </p></li></ul></div><p>
                </p></div></div><div class="section" title="5.3.3. Storing and Naming the Recipe"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-storing-and-naming-the-recipe">5.3.3. Storing and Naming the Recipe<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-storing-and-naming-the-recipe">¶</a></span></h3></div></div></div><p>
                Once you have your base recipe, you should put it in your
                own layer and name it appropriately.
                Locating it correctly ensures that the OpenEmbedded build
                system can find it when you use BitBake to process the
                recipe.
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Storing Your Recipe:</em></span>
                    The OpenEmbedded build system locates your recipe
                    through the layer's <code class="filename">conf/layer.conf</code>
                    file and the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBFILES" target="_top"><code class="filename">BBFILES</code></a>
                    variable.
                    This variable sets up a path from which the build system can
                    locate recipes.
                    Here is the typical use:
                    </p><pre class="literallayout">
     BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \
                 ${LAYERDIR}/recipes-*/*/*.bbappend"
                    </pre><p>
                    Consequently, you need to be sure you locate your new recipe
                    inside your layer such that it can be found.</p><p>You can find more information on how layers are
                    structured in the
                    "<a class="link" href="#understanding-and-creating-layers" title="5.1. Understanding and Creating Layers">Understanding and Creating Layers</a>"
                    section.</p></li><li class="listitem"><p><span class="emphasis"><em>Naming Your Recipe:</em></span>
                    When you name your recipe, you need to follow this naming
                    convention:
                    </p><pre class="literallayout">
     <em class="replaceable"><code>basename</code></em>_<em class="replaceable"><code>version</code></em>.bb
                    </pre><p>
                    Use lower-cased characters and do not include the reserved
                    suffixes <code class="filename">-native</code>,
                    <code class="filename">-cross</code>, <code class="filename">-initial</code>,
                    or <code class="filename">-dev</code> casually (i.e. do not use them
                    as part of your recipe name unless the string applies).
                    Here are some examples:
                    </p><pre class="literallayout">
     cups_1.7.0.bb
     gawk_4.0.2.bb
     irssi_0.8.16-rc1.bb
                    </pre></li></ul></div></div><div class="section" title="5.3.4. Understanding Recipe Syntax"><div class="titlepage"><div><div><h3 class="title" id="understanding-recipe-syntax">5.3.4. Understanding Recipe Syntax<span class="permalink"><a alt="Permalink" title="Permalink" href="#understanding-recipe-syntax">¶</a></span></h3></div></div></div><p>
                Understanding recipe file syntax is important for
                writing recipes.
                The following list overviews the basic items that make up a
                BitBake recipe file.
                For more complete BitBake syntax descriptions, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html#bitbake-user-manual-metadata" target="_top">Syntax and Operators</a>"
                chapter of the BitBake User Manual.
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Variable Assignments and Manipulations:</em></span>
                        Variable assignments allow a value to be assigned to a
                        variable.
                        The assignment can be static text or might include
                        the contents of other variables.
                        In addition to the assignment, appending and prepending
                        operations are also supported.</p><p>The following example shows some of the ways
                        you can use variables in recipes:
                        </p><pre class="literallayout">
     S = "${WORKDIR}/postfix-${PV}"
     CFLAGS += "-DNO_ASM"
     SRC_URI_append = " file://fixup.patch"
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Functions:</em></span>
                        Functions provide a series of actions to be performed.
                        You usually use functions to override the default
                        implementation of a task function or to complement
                        a default function (i.e. append or prepend to an
                        existing function).
                        Standard functions use <code class="filename">sh</code> shell
                        syntax, although access to OpenEmbedded variables and
                        internal methods are also available.</p><p>The following is an example function from the
                        <code class="filename">sed</code> recipe:
                        </p><pre class="literallayout">
     do_install () {
         autotools_do_install
         install -d ${D}${base_bindir}
         mv ${D}${bindir}/sed ${D}${base_bindir}/sed
         rmdir ${D}${bindir}/
     }
                        </pre><p>
                        It is also possible to implement new functions that
                        are called between existing tasks as long as the
                        new functions are not replacing or complementing the
                        default functions.
                        You can implement functions in Python
                        instead of shell.
                        Both of these options are not seen in the majority of
                        recipes.</p></li><li class="listitem"><p><span class="emphasis"><em>Keywords:</em></span>
                        BitBake recipes use only a few keywords.
                        You use keywords to include common
                        functions (<code class="filename">inherit</code>), load parts
                        of a recipe from other files
                        (<code class="filename">include</code> and
                        <code class="filename">require</code>) and export variables
                        to the environment (<code class="filename">export</code>).</p><p>The following example shows the use of some of
                        these keywords:
                        </p><pre class="literallayout">
     export POSTCONF = "${STAGING_BINDIR}/postconf"
     inherit autoconf
     require otherfile.inc
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Comments:</em></span>
                        Any lines that begin with the hash character
                        (<code class="filename">#</code>) are treated as comment lines
                        and are ignored:
                        </p><pre class="literallayout">
     # This is a comment
                        </pre><p>
                        </p></li></ul></div><p>
            </p><p>
                This next list summarizes the most important and most commonly
                used parts of the recipe syntax.
                For more information on these parts of the syntax, you can
                reference the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html#bitbake-user-manual-metadata" target="_top">Syntax and Operators</a>
                chapter in the BitBake User Manual.
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Line Continuation: <code class="filename">\</code></em></span> -
                        Use the backward slash (<code class="filename">\</code>)
                        character to split a statement over multiple lines.
                        Place the slash character at the end of the line that
                        is to be continued on the next line:
                        </p><pre class="literallayout">
     VAR = "A really long \
            line"
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            You cannot have any characters including spaces
                            or tabs after the slash character.
                        </div><p>
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em>Using Variables: <code class="filename">${...}</code></em></span> -
                        Use the <code class="filename">${<em class="replaceable"><code>VARNAME</code></em>}</code> syntax to
                        access the contents of a variable:
                        </p><pre class="literallayout">
     SRC_URI = "${SOURCEFORGE_MIRROR}/libpng/zlib-${PV}.tar.gz"
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            It is important to understand that the value of a
                            variable expressed in this form does not get
                            substituted automatically.
                            The expansion of these expressions happens
                            on-demand later (e.g. usually when a function that
                            makes reference to the variable executes).
                            This behavior ensures that the values are most
                            appropriate for the context in which they are
                            finally used.
                            On the rare occasion that you do need the variable
                            expression to be expanded immediately, you can use
                            the <code class="filename">:=</code> operator instead of
                            <code class="filename">=</code> when you make the
                            assignment, but this is not generally needed.
                        </div><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Quote All Assignments: <code class="filename">"<em class="replaceable"><code>value</code></em>"</code></em></span> -
                        Use double quotes around the value in all variable
                        assignments.
                        </p><pre class="literallayout">
     VAR1 = "${OTHERVAR}"
     VAR2 = "The version is ${PV}"
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Conditional Assignment: <code class="filename">?=</code></em></span> -
                        Conditional assignment is used to assign a value to
                        a variable, but only when the variable is currently
                        unset.
                        Use the question mark followed by the equal sign
                        (<code class="filename">?=</code>) to make a "soft" assignment
                        used for conditional assignment.
                        Typically, "soft" assignments are used in the
                        <code class="filename">local.conf</code> file for variables
                        that are allowed to come through from the external
                        environment.
                        </p><p>Here is an example where
                        <code class="filename">VAR1</code> is set to "New value" if
                        it is currently empty.
                        However, if <code class="filename">VAR1</code> has already been
                        set, it remains unchanged:
                        </p><pre class="literallayout">
     VAR1 ?= "New value"
                        </pre><p>
                        In this next example, <code class="filename">VAR1</code>
                        is left with the value "Original value":
                        </p><pre class="literallayout">
     VAR1 = "Original value"
     VAR1 ?= "New value"
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Appending: <code class="filename">+=</code></em></span> -
                        Use the plus character followed by the equals sign
                        (<code class="filename">+=</code>) to append values to existing
                        variables.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            This operator adds a space between the existing
                            content of the variable and the new content.
                        </div><p>Here is an example:
                        </p><pre class="literallayout">
     SRC_URI += "file://fix-makefile.patch"
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Prepending: <code class="filename">=+</code></em></span> -
                        Use the equals sign followed by the plus character
                        (<code class="filename">=+</code>) to prepend values to existing
                        variables.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            This operator adds a space between the new content
                            and the existing content of the variable.
                        </div><p>Here is an example:
                        </p><pre class="literallayout">
     VAR =+ "Starts"
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Appending: <code class="filename">_append</code></em></span> -
                        Use the <code class="filename">_append</code> operator to
                        append values to existing variables.
                        This operator does not add any additional space.
                        Also, the operator is applied after all the
                        <code class="filename">+=</code>, and
                        <code class="filename">=+</code> operators have been applied and
                        after all <code class="filename">=</code> assignments have
                        occurred.
                        </p><p>The following example shows the space being
                        explicitly added to the start to ensure the appended
                        value is not merged with the existing value:
                        </p><pre class="literallayout">
     SRC_URI_append = " file://fix-makefile.patch"
                        </pre><p>
                        You can also use the <code class="filename">_append</code>
                        operator with overrides, which results in the actions
                        only being performed for the specified target or
                        machine:
                        </p><pre class="literallayout">
     SRC_URI_append_sh4 = " file://fix-makefile.patch"
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Prepending: <code class="filename">_prepend</code></em></span> -
                        Use the <code class="filename">_prepend</code> operator to
                        prepend values to existing variables.
                        This operator does not add any additional space.
                        Also, the operator is applied after all the
                        <code class="filename">+=</code>, and
                        <code class="filename">=+</code> operators have been applied and
                        after all <code class="filename">=</code> assignments have
                        occurred.
                        </p><p>The following example shows the space being
                        explicitly added to the end to ensure the prepended
                        value is not merged with the existing value:
                        </p><pre class="literallayout">
     CFLAGS_prepend = "-I${S}/myincludes "
                        </pre><p>
                        You can also use the <code class="filename">_prepend</code>
                        operator with overrides, which results in the actions
                        only being performed for the specified target or
                        machine:
                        </p><pre class="literallayout">
     CFLAGS_prepend_sh4 = "-I${S}/myincludes "
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Overrides:</em></span> -
                        You can use overrides to set a value conditionally,
                        typically based on how the recipe is being built.
                        For example, to set the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-KBRANCH" target="_top"><code class="filename">KBRANCH</code></a>
                        variable's value to "standard/base" for any target
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>,
                        except for qemuarm where it should be set to
                        "standard/arm-versatile-926ejs", you would do the
                        following:
                        </p><pre class="literallayout">
     KBRANCH = "standard/base"
     KBRANCH_qemuarm  = "standard/arm-versatile-926ejs"
                        </pre><p>
                        Overrides are also used to separate alternate values
                        of a variable in other situations.
                        For example, when setting variables such as
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILES" target="_top"><code class="filename">FILES</code></a>
                        and
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RDEPENDS" target="_top"><code class="filename">RDEPENDS</code></a>
                        that are specific to individual packages produced by
                        a recipe, you should always use an override that
                        specifies the name of the package.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Indentation:</em></span>
                        Use spaces for indentation rather than than tabs.
                        For shell functions, both currently work.
                        However, it is a policy decision of the Yocto Project
                        to use tabs in shell functions.
                        Realize that some layers have a policy to use spaces
                        for all indentation.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Using Python for Complex Operations: <code class="filename">${@<em class="replaceable"><code>python_code</code></em>}</code></em></span> -
                        For more advanced processing, it is possible to use
                        Python code during variable assignments (e.g.
                        search and replacement on a variable).</p><p>You indicate Python code using the
                        <code class="filename">${@<em class="replaceable"><code>python_code</code></em>}</code>
                        syntax for the variable assignment:
                        </p><pre class="literallayout">
     SRC_URI = "ftp://ftp.info-zip.org/pub/infozip/src/zip${@d.getVar('PV',1).replace('.', '')}.tgz
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Shell Function Syntax:</em></span>
                        Write shell functions as if you were writing a shell
                        script when you describe a list of actions to take.
                        You should ensure that your script works with a generic
                        <code class="filename">sh</code> and that it does not require
                        any <code class="filename">bash</code> or other shell-specific
                        functionality.
                        The same considerations apply to various system
                        utilities (e.g. <code class="filename">sed</code>,
                        <code class="filename">grep</code>, <code class="filename">awk</code>,
                        and so forth) that you might wish to use.
                        If in doubt, you should check with multiple
                        implementations - including those from BusyBox.
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.3.5. Running a Build on the Recipe"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-running-a-build-on-the-recipe">5.3.5. Running a Build on the Recipe<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-running-a-build-on-the-recipe">¶</a></span></h3></div></div></div><p>
                Creating a new recipe is usually an iterative process that
                requires using BitBake to process the recipe multiple times in
                order to progressively discover and add information to the
                recipe file.
            </p><p>
                Assuming you have sourced a build environment setup script (i.e.
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                or
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>)
                and you are in the
                <a class="link" href="#build-directory">Build Directory</a>,
                use BitBake to process your recipe.
                All you need to provide is the
                <code class="filename"><em class="replaceable"><code>basename</code></em></code> of the recipe as described
                in the previous section:
                </p><pre class="literallayout">
     $ bitbake <em class="replaceable"><code>basename</code></em>
                </pre><p>

            </p><p>
                During the build, the OpenEmbedded build system creates a
                temporary work directory for each recipe
                (<code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WORKDIR" target="_top"><code class="filename">WORKDIR</code></a><code class="filename">}</code>)
                where it keeps extracted source files, log files, intermediate
                compilation and packaging files, and so forth.
            </p><p>
                The path to the per-recipe temporary work directory depends
                on the context in which it is being built.
                The quickest way to find this path is to have BitBake return it
                by running the following:
                </p><pre class="literallayout">
     $ bitbake -e <em class="replaceable"><code>basename</code></em> | grep ^WORKDIR=
                </pre><p>
                As an example, assume a Source Directory top-level folder named
                <code class="filename">poky</code>, a default Build Directory at
                <code class="filename">poky/build</code>, and a
                <code class="filename">qemux86-poky-linux</code> machine target system.
                Furthermore, suppose your recipe is named
                <code class="filename">foo_1.3.0.bb</code>.
                In this case, the work directory the build system uses to
                build the package would be as follows:
                </p><pre class="literallayout">
     poky/build/tmp/work/qemux86-poky-linux/foo/1.3.0-r0
                </pre><p>
                Inside this directory you can find sub-directories such as
                <code class="filename">image</code>, <code class="filename">packages-split</code>,
                and <code class="filename">temp</code>.
                After the build, you can examine these to determine how well
                the build went.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    You can find log files for each task in the recipe's
                    <code class="filename">temp</code> directory (e.g.
                    <code class="filename">poky/build/tmp/work/qemux86-poky-linux/foo/1.3.0-r0/temp</code>).
                    Log files are named <code class="filename">log.<em class="replaceable"><code>taskname</code></em></code>
                    (e.g. <code class="filename">log.do_configure</code>,
                    <code class="filename">log.do_fetch</code>, and
                    <code class="filename">log.do_compile</code>).
                </div><p>
            </p><p>
                You can find more information about the build process in the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#closer-look" target="_top">A Closer Look at the Yocto Project Development Environment</a>"
                chapter of the Yocto Project Reference Manual.
            </p></div><div class="section" title="5.3.6. Fetching Code"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-fetching-code">5.3.6. Fetching Code<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-fetching-code">¶</a></span></h3></div></div></div><p>
                The first thing your recipe must do is specify how to fetch
                the source files.
                Fetching is controlled mainly through the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                variable.
                Your recipe must have a <code class="filename">SRC_URI</code> variable
                that points to where the source is located.
                For a graphical representation of source locations, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#sources-dev-environment" target="_top">Sources</a>"
                section in the Yocto Project Reference Manual.
            </p><p>
                The
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-fetch" target="_top"><code class="filename">do_fetch</code></a>
                task uses the prefix of each entry in the
                <code class="filename">SRC_URI</code> variable value to determine which
                fetcher to use to get your source files.
                It is the <code class="filename">SRC_URI</code> variable that triggers
                the fetcher.
                The
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-patch" target="_top"><code class="filename">do_patch</code></a>
                task uses the variable after source is fetched to apply
                patches.
                The OpenEmbedded build system uses
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESOVERRIDES" target="_top"><code class="filename">FILESOVERRIDES</code></a>
                for scanning directory locations for local files in
                <code class="filename">SRC_URI</code>.
            </p><p>
                The <code class="filename">SRC_URI</code> variable in your recipe must
                define each unique location for your source files.
                It is good practice to not hard-code pathnames in an URL used
                in <code class="filename">SRC_URI</code>.
                Rather than hard-code these paths, use
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a><code class="filename">}</code>,
                which causes the fetch process to use the version specified in
                the recipe filename.
                Specifying the version in this manner means that upgrading the
                recipe to a future version is as simple as renaming the recipe
                to match the new version.
            </p><p>
                Here is a simple example from the
                <code class="filename">meta/recipes-devtools/cdrtools/cdrtools-native_3.01a20.bb</code>
                recipe where the source comes from a single tarball.
                Notice the use of the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>
                variable:
                </p><pre class="literallayout">
     SRC_URI = "ftp://ftp.berlios.de/pub/cdrecord/alpha/cdrtools-${PV}.tar.bz2"
                </pre><p>
            </p><p>
                Files mentioned in <code class="filename">SRC_URI</code> whose names end
                in a typical archive extension (e.g. <code class="filename">.tar</code>,
                <code class="filename">.tar.gz</code>, <code class="filename">.tar.bz2</code>,
                <code class="filename">.zip</code>, and so forth), are automatically
                extracted during the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-unpack" target="_top"><code class="filename">do_unpack</code></a>
                task.
                For another example that specifies these types of files, see
                the
                "<a class="link" href="#new-recipe-autotooled-package" title="5.3.21.2. Autotooled Package">Autotooled Package</a>"
                section.
            </p><p>
                Another way of specifying source is from an SCM.
                For Git repositories, you must specify
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRCREV" target="_top"><code class="filename">SRCREV</code></a>
                and you should specify
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>
                to include the revision with
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRCPV" target="_top"><code class="filename">SRCPV</code></a>.
                Here is an example from the recipe
                <code class="filename">meta/recipes-kernel/blktrace/blktrace_git.bb</code>:
                </p><pre class="literallayout">
     SRCREV = "d6918c8832793b4205ed3bfede78c2f915c23385"

     PR = "r6"
     PV = "1.0.5+git${SRCPV}"

     SRC_URI = "git://git.kernel.dk/blktrace.git \
                file://ldflags.patch"
                </pre><p>
            </p><p>
                If your <code class="filename">SRC_URI</code> statement includes
                URLs pointing to individual files fetched from a remote server
                other than a version control system, BitBake attempts to
                verify the files against checksums defined in your recipe to
                ensure they have not been tampered with or otherwise modified
                since the recipe was written.
                Two checksums are used:
                <code class="filename">SRC_URI[md5sum]</code> and
                <code class="filename">SRC_URI[sha256sum]</code>.
            </p><p>
                If your <code class="filename">SRC_URI</code> variable points to
                more than a single URL (excluding SCM URLs), you need to
                provide the <code class="filename">md5</code> and
                <code class="filename">sha256</code> checksums for each URL.
                For these cases, you provide a name for each URL as part of
                the <code class="filename">SRC_URI</code> and then reference that name
                in the subsequent checksum statements.
                Here is an example:
                </p><pre class="literallayout">
     SRC_URI = "${DEBIAN_MIRROR}/main/a/apmd/apmd_3.2.2.orig.tar.gz;name=tarball \
                ${DEBIAN_MIRROR}/main/a/apmd/apmd_${PV}.diff.gz;name=patch"

     SRC_URI[tarball.md5sum] = "b1e6309e8331e0f4e6efd311c2d97fa8"
     SRC_URI[tarball.sha256sum] = "7f7d9f60b7766b852881d40b8ff91d8e39fccb0d1d913102a5c75a2dbb52332d"

     SRC_URI[patch.md5sum] = "57e1b689264ea80f78353519eece0c92"
     SRC_URI[patch.sha256sum] = "7905ff96be93d725544d0040e425c42f9c05580db3c272f11cff75b9aa89d430"
                </pre><p>
            </p><p>
                Proper values for <code class="filename">md5</code> and
                <code class="filename">sha256</code> checksums might be available
                with other signatures on the download page for the upstream
                source (e.g. <code class="filename">md5</code>,
                <code class="filename">sha1</code>, <code class="filename">sha256</code>,
                <code class="filename">GPG</code>, and so forth).
                Because the OpenEmbedded build system only deals with
                <code class="filename">sha256sum</code> and <code class="filename">md5sum</code>,
                you should verify all the signatures you find by hand.
            </p><p>
                If no <code class="filename">SRC_URI</code> checksums are specified
                when you attempt to build the recipe, or you provide an
                incorrect checksum, the build will produce an error for each
                missing or incorrect checksum.
                As part of the error message, the build system provides
                the checksum string corresponding to the fetched file.
                Once you have the correct checksums, you can copy and paste
                them into your recipe and then run the build again to continue.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    As mentioned, if the upstream source provides signatures
                    for verifying the downloaded source code, you should
                    verify those manually before setting the checksum values
                    in the recipe and continuing with the build.
                </div><p>
            </p><p>
                This final example is a bit more complicated and is from the
                <code class="filename">meta/recipes-sato/rxvt-unicode/rxvt-unicode_9.20.bb</code>
                recipe.
                The example's <code class="filename">SRC_URI</code> statement identifies
                multiple files as the source files for the recipe: a tarball, a
                patch file, a desktop file, and an icon.
                </p><pre class="literallayout">
     SRC_URI = "http://dist.schmorp.de/rxvt-unicode/Attic/rxvt-unicode-${PV}.tar.bz2 \
                file://xwc.patch \
                file://rxvt.desktop \
                file://rxvt.png"
                </pre><p>
            </p><p>
                When you specify local files using the
                <code class="filename">file://</code> URI protocol, the build system
                fetches files from the local machine.
                The path is relative to the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESPATH" target="_top"><code class="filename">FILESPATH</code></a>
                variable and searches specific directories in a certain order:
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BP" target="_top"><code class="filename">BP</code></a><code class="filename">}</code>,
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BPN" target="_top"><code class="filename">BPN</code></a><code class="filename">}</code>,
                and <code class="filename">files</code>.
                The directories are assumed to be subdirectories of the
                directory in which the recipe or append file resides.
                For another example that specifies these types of files, see the
                "<a class="link" href="#new-recipe-single-c-file-package-hello-world" title="5.3.21.1. Single .c File Package (Hello World!)">Single .c File Package (Hello World!)</a>"
                section.
            </p><p>
                The previous example also specifies a patch file.
                Patch files are files whose names usually end in
                <code class="filename">.patch</code> or <code class="filename">.diff</code> but
                can end with compressed suffixes such as
                <code class="filename">diff.gz</code> and
                <code class="filename">patch.bz2</code>, for example.
                The build system automatically applies patches as described
                in the
                "<a class="link" href="#new-recipe-patching-code" title="5.3.8. Patching Code">Patching Code</a>" section.
            </p></div><div class="section" title="5.3.7. Unpacking Code"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-unpacking-code">5.3.7. Unpacking Code<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-unpacking-code">¶</a></span></h3></div></div></div><p>
                During the build, the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-unpack" target="_top"><code class="filename">do_unpack</code></a>
                task unpacks the source with
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a><code class="filename">}</code>
                pointing to where it is unpacked.
            </p><p>
                If you are fetching your source files from an upstream source
                archived tarball and the tarball's internal structure matches
                the common convention of a top-level subdirectory named
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BPN" target="_top"><code class="filename">BPN</code></a><code class="filename">}-${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a><code class="filename">}</code>,
                then you do not need to set <code class="filename">S</code>.
                However, if <code class="filename">SRC_URI</code> specifies to fetch
                source from an archive that does not use this convention,
                or from an SCM like Git or Subversion, your recipe needs to
                define <code class="filename">S</code>.
            </p><p>
                If processing your recipe using BitBake successfully unpacks
                the source files, you need to be sure that the directory
                pointed to by <code class="filename">${S}</code> matches the structure
                of the source.
            </p></div><div class="section" title="5.3.8. Patching Code"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-patching-code">5.3.8. Patching Code<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-patching-code">¶</a></span></h3></div></div></div><p>
                Sometimes it is necessary to patch code after it has been
                fetched.
                Any files mentioned in <code class="filename">SRC_URI</code> whose
                names end in <code class="filename">.patch</code> or
                <code class="filename">.diff</code> or compressed versions of these
                suffixes (e.g. <code class="filename">diff.gz</code> are treated as
                patches.
                The
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-patch" target="_top"><code class="filename">do_patch</code></a>
                task automatically applies these patches.
            </p><p>
                The build system should be able to apply patches with the "-p1"
                option (i.e. one directory level in the path will be stripped
                off).
                If your patch needs to have more directory levels stripped off,
                specify the number of levels using the "striplevel" option in
                the <code class="filename">SRC_URI</code> entry for the patch.
                Alternatively, if your patch needs to be applied in a specific
                subdirectory that is not specified in the patch file, use the
                "patchdir" option in the entry.
            </p><p>
                As with all local files referenced in
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                using <code class="filename">file://</code>, you should place
                patch files in a directory next to the recipe either
                named the same as the base name of the recipe
                (<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BP" target="_top"><code class="filename">BP</code></a>
                and
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BPN" target="_top"><code class="filename">BPN</code></a>)
                or "files".
            </p></div><div class="section" title="5.3.9. Licensing"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-licensing">5.3.9. Licensing<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-licensing">¶</a></span></h3></div></div></div><p>
                Your recipe needs to have both the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LICENSE" target="_top"><code class="filename">LICENSE</code></a>
                and
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LIC_FILES_CHKSUM" target="_top"><code class="filename">LIC_FILES_CHKSUM</code></a>
                variables:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><code class="filename">LICENSE</code>:</em></span>
                        This variable specifies the license for the software.
                        If you do not know the license under which the software
                        you are building is distributed, you should go to the
                        source code and look for that information.
                        Typical files containing this information include
                        <code class="filename">COPYING</code>,
                        <code class="filename">LICENSE</code>, and
                        <code class="filename">README</code> files.
                        You could also find the information near the top of
                        a source file.
                        For example, given a piece of software licensed under
                        the GNU General Public License version 2, you would
                        set <code class="filename">LICENSE</code> as follows:
                        </p><pre class="literallayout">
     LICENSE = "GPLv2"
                        </pre><p>The licenses you specify within
                        <code class="filename">LICENSE</code> can have any name as long
                        as you do not use spaces, since spaces are used as
                        separators between license names.
                        For standard licenses, use the names of the files in
                        <code class="filename">meta/files/common-licenses/</code>
                        or the <code class="filename">SPDXLICENSEMAP</code> flag names
                        defined in <code class="filename">meta/conf/licenses.conf</code>.
                        </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">LIC_FILES_CHKSUM</code>:</em></span>
                        The OpenEmbedded build system uses this variable to
                        make sure the license text has not changed.
                        If it has, the build produces an error and it affords
                        you the chance to figure it out and correct the problem.
                        </p><p>You need to specify all applicable licensing
                        files for the software.
                        At the end of the configuration step, the build process
                        will compare the checksums of the files to be sure
                        the text has not changed.
                        Any differences result in an error with the message
                        containing the current checksum.
                        For more explanation and examples of how to set the
                        <code class="filename">LIC_FILES_CHKSUM</code> variable, see the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#usingpoky-configuring-LIC_FILES_CHKSUM" target="_top">Tracking License Changes</a>"
                        section in the Yocto Project Reference Manual.</p><p>To determine the correct checksum string, you
                        can list the appropriate files in the
                        <code class="filename">LIC_FILES_CHKSUM</code> variable with
                        incorrect md5 strings, attempt to build the software,
                        and then note the resulting error messages that will
                        report the correct md5 strings.
                        See the
                        "<a class="link" href="#new-recipe-fetching-code" title="5.3.6. Fetching Code">Fetching Code</a>"
                        section for additional information.
                    </p><p>
                        Here is an example that assumes the software has a
                        <code class="filename">COPYING</code> file:
                        </p><pre class="literallayout">
     LIC_FILES_CHKSUM = "file://COPYING;md5=xxx"
                        </pre><p>
                        When you try to build the software, the build system
                        will produce an error and give you the correct string
                        that you can substitute into the recipe file for a
                        subsequent build.
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.3.10. Dependencies"><div class="titlepage"><div><div><h3 class="title" id="new-dependencies">5.3.10. Dependencies<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-dependencies">¶</a></span></h3></div></div></div><p>
                Most software packages have a short list of other packages
                that they require, which are called dependencies.
                These dependencies fall into two main categories: build-time
                dependencies, which are required when the software is built;
                and runtime dependencies, which are required to be installed
                on the target in order for the software to run.
            </p><p>
                Within a recipe, you specify build-time dependencies using the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>
                variable.
                Although nuances exist, items specified in
                <code class="filename">DEPENDS</code> should be names of other recipes.
                It is important that you specify all build-time dependencies
                explicitly.
                If you do not, due to the parallel nature of BitBake's
                execution, you can end up with a race condition where the
                dependency is present for one task of a recipe (e.g.
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-configure" target="_top"><code class="filename">do_configure</code></a>)
                and then gone when the next task runs (e.g.
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-compile" target="_top"><code class="filename">do_compile</code></a>).
            </p><p>
                Another consideration is that configure scripts might
                automatically check for optional dependencies and enable
                corresponding functionality if those dependencies are found.
                This behavior means that to ensure deterministic results and
                thus avoid more race conditions, you need to either explicitly
                specify these dependencies as well, or tell the configure
                script explicitly to disable the functionality.
                If you wish to make a recipe that is more generally useful
                (e.g. publish the recipe in a layer for others to use),
                instead of hard-disabling the functionality, you can use the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGECONFIG" target="_top"><code class="filename">PACKAGECONFIG</code></a>
                variable to allow functionality and the corresponding
                dependencies to be enabled and disabled easily by other
                users of the recipe.
            </p><p>
                Similar to build-time dependencies, you specify runtime
                dependencies through a variable -
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RDEPENDS" target="_top"><code class="filename">RDEPENDS</code></a>,
                which is package-specific.
                All variables that are package-specific need to have the name
                of the package added to the end as an override.
                Since the main package for a recipe has the same name as the
                recipe, and the recipe's name can be found through the
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a><code class="filename">}</code>
                variable, then you specify the dependencies for the main
                package by setting <code class="filename">RDEPENDS_${PN}</code>.
                If the package were named <code class="filename">${PN}-tools</code>,
                then you would set <code class="filename">RDEPENDS_${PN}-tools</code>,
                and so forth.
            </p><p>
                Some runtime dependencies will be set automatically at
                packaging time.
                These dependencies include any shared library dependencies
                (i.e. if a package "example" contains "libexample" and
                another package "mypackage" contains a binary that links to
                "libexample" then the OpenEmbedded build system will
                automatically add a runtime dependency to "mypackage" on
                "example").
                See the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#automatically-added-runtime-dependencies" target="_top">Automatically Added Runtime Dependencies</a>"
                in the Yocto Project Reference Manual for further details.
            </p></div><div class="section" title="5.3.11. Configuring the Recipe"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-configuring-the-recipe">5.3.11. Configuring the Recipe<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-configuring-the-recipe">¶</a></span></h3></div></div></div><p>
                Most software provides some means of setting build-time
                configuration options before compilation.
                Typically, setting these options is accomplished by running a
                configure script with some options, or by modifying a build
                configuration file.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    As of Yocto Project Release 1.7, some of the core recipes
                    that package binary configuration scripts now disable the
                    scripts due to the scripts previously requiring error-prone
                    path substitution.
                    The OpenEmbedded build system uses
                    <code class="filename">pkg-config</code> now, which is much more
                    robust.
                    You can find a list of the <code class="filename">*-config</code>
                    scripts that are disabled list in the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#migration-1.7-binary-configuration-scripts-disabled" target="_top">Binary Configuration Scripts Disabled</a>"
                    section in the Yocto Project Reference Manual.
                </div><p>
            </p><p>
                A major part of build-time configuration is about checking for
                build-time dependencies and possibly enabling optional
                functionality as a result.
                You need to specify any build-time dependencies for the
                software you are building in your recipe's
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>
                value, in terms of other recipes that satisfy those
                dependencies.
                You can often find build-time or runtime
                dependencies described in the software's documentation.
            </p><p>
                The following list provides configuration items of note based
                on how your software is built:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Autotools:</em></span>
                        If your source files have a
                        <code class="filename">configure.ac</code> file, then your
                        software is built using Autotools.
                        If this is the case, you just need to worry about
                        modifying the configuration.</p><p>When using Autotools, your recipe needs to inherit
                        the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-autotools" target="_top"><code class="filename">autotools</code></a>
                        class and your recipe does not have to contain a
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-configure" target="_top"><code class="filename">do_configure</code></a>
                        task.
                        However, you might still want to make some adjustments.
                        For example, you can set
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTRA_OECONF" target="_top"><code class="filename">EXTRA_OECONF</code></a>
                        or
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGECONFIG_CONFARGS" target="_top"><code class="filename">PACKAGECONFIG_CONFARGS</code></a>
                        to pass any needed configure options that are specific
                        to the recipe.</p></li><li class="listitem"><p><span class="emphasis"><em>CMake:</em></span>
                        If your source files have a
                        <code class="filename">CMakeLists.txt</code> file, then your
                        software is built using CMake.
                        If this is the case, you just need to worry about
                        modifying the configuration.</p><p>When you use CMake, your recipe needs to inherit
                        the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-cmake" target="_top"><code class="filename">cmake</code></a>
                        class and your recipe does not have to contain a
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-configure" target="_top"><code class="filename">do_configure</code></a>
                        task.
                        You can make some adjustments by setting
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTRA_OECMAKE" target="_top"><code class="filename">EXTRA_OECMAKE</code></a>
                        to pass any needed configure options that are specific
                        to the recipe.</p></li><li class="listitem"><p><span class="emphasis"><em>Other:</em></span>
                        If your source files do not have a
                        <code class="filename">configure.ac</code> or
                        <code class="filename">CMakeLists.txt</code> file, then your
                        software is built using some method other than Autotools
                        or CMake.
                        If this is the case, you normally need to provide a
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-configure" target="_top"><code class="filename">do_configure</code></a>
                        task in your recipe
                        unless, of course, there is nothing to configure.
                        </p><p>Even if your software is not being built by
                        Autotools or CMake, you still might not need to deal
                        with any configuration issues.
                        You need to determine if configuration is even a required step.
                        You might need to modify a Makefile or some configuration file
                        used for the build to specify necessary build options.
                        Or, perhaps you might need to run a provided, custom
                        configure script with the appropriate options.</p><p>For the case involving a custom configure
                        script, you would run
                        <code class="filename">./configure --help</code> and look for
                        the options you need to set.</p></li></ul></div><p>
            </p><p>
                Once configuration succeeds, it is always good practice to
                look at the <code class="filename">log.do_configure</code> file to
                ensure that the appropriate options have been enabled and no
                additional build-time dependencies need to be added to
                <code class="filename">DEPENDS</code>.
                For example, if the configure script reports that it found
                something not mentioned in <code class="filename">DEPENDS</code>, or
                that it did not find something that it needed for some
                desired optional functionality, then you would need to add
                those to <code class="filename">DEPENDS</code>.
                Looking at the log might also reveal items being checked for,
                enabled, or both that you do not want, or items not being found
                that are in <code class="filename">DEPENDS</code>, in which case
                you would need to look at passing extra options to the
                configure script as needed.
                For reference information on configure options specific to the
                software you are building, you can consult the output of the
                <code class="filename">./configure --help</code> command within
                <code class="filename">${S}</code> or consult the software's upstream
                documentation.
            </p></div><div class="section" title="5.3.12. Using Headers to Interface with Devices"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-using-headers-to-interface-with-devices">5.3.12. Using Headers to Interface with Devices<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-using-headers-to-interface-with-devices">¶</a></span></h3></div></div></div><p>
                If your recipe builds an application that needs to
                communicate with some device or needs an API into a custom
                kernel, you will need to provide appropriate header files.
                Under no circumstances should you ever modify the existing
                <code class="filename">meta/recipes-kernel/linux-libc-headers/linux-libc-headers.inc</code>
                file.
                These headers are used to build <code class="filename">libc</code> and
                must not be compromised with custom or machine-specific
                header information.
                If you customize <code class="filename">libc</code> through modified
                headers all other applications that use
                <code class="filename">libc</code> thus become affected.
                </p><div class="note" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
                    Never copy and customize the <code class="filename">libc</code>
                    header file (i.e.
                    <code class="filename">meta/recipes-kernel/linux-libc-headers/linux-libc-headers.inc</code>).
                </div><p>
                The correct way to interface to a device or custom kernel is
                to use a separate package that provides the additional headers
                for the driver or other unique interfaces.
                When doing so, your application also becomes responsible for
                creating a dependency on that specific provider.
            </p><p>
                Consider the following:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        Never modify
                        <code class="filename">linux-libc-headers.inc</code>.
                        Consider that file to be part of the
                        <code class="filename">libc</code> system, and not something
                        you use to access the kernel directly.
                        You should access <code class="filename">libc</code> through
                        specific <code class="filename">libc</code> calls.
                        </p></li><li class="listitem"><p>
                        Applications that must talk directly to devices
                        should either provide necessary headers themselves,
                        or establish a dependency on a special headers package
                        that is specific to that driver.
                        </p></li></ul></div><p>
            </p><p>
                For example, suppose you want to modify an existing header
                that adds I/O control or network support.
                If the modifications are used by a small number programs,
                providing a unique version of a header is easy and has little
                impact.
                When doing so, bear in mind the guidelines in the previous
                list.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    If for some reason your changes need to modify the behavior
                    of the <code class="filename">libc</code>, and subsequently all
                    other applications on the system, use a
                    <code class="filename">.bbappend</code> to modify the
                    <code class="filename">linux-kernel-headers.inc</code> file.
                    However, take care to not make the changes
                    machine specific.
                </div><p>
            </p><p>
                Consider a case where your kernel is older and you need
                an older <code class="filename">libc</code> ABI.
                The headers installed by your recipe should still be a
                standard mainline kernel, not your own custom one.
            </p><p>
                When you use custom kernel headers you need to get them from
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-STAGING_KERNEL_DIR" target="_top"><code class="filename">STAGING_KERNEL_DIR</code></a>,
                which is the directory with kernel headers that are
                required to build out-of-tree modules.
                Your recipe will also need the following:
                </p><pre class="literallayout">
     do_configure[depends] += "virtual/kernel:do_shared_workdir"
                </pre><p>
            </p></div><div class="section" title="5.3.13. Compilation"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-compilation">5.3.13. Compilation<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-compilation">¶</a></span></h3></div></div></div><p>
                During a build, the <code class="filename">do_compile</code> task
                happens after source is fetched, unpacked, and configured.
                If the recipe passes through <code class="filename">do_compile</code>
                successfully, nothing needs to be done.
            </p><p>
                However, if the compile step fails, you need to diagnose the
                failure.
                Here are some common issues that cause failures.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    For cases where improper paths are detected for
                    configuration files or for when libraries/headers cannot
                    be found, be sure you are using the more robust
                    <code class="filename">pkg-config</code>.
                    See the note in section
                    "<a class="link" href="#new-recipe-configuring-the-recipe" title="5.3.11. Configuring the Recipe">Configuring the Recipe</a>"
                    for additional information.
                </div><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Parallel build failures:</em></span>
                        These failures manifest themselves as intermittent
                        errors, or errors reporting that a file or directory
                        that should be created by some other part of the build
                        process could not be found.
                        This type of failure can occur even if, upon inspection,
                        the file or directory does exist after the build has
                        failed, because that part of the build process happened
                        in the wrong order.</p><p>To fix the problem, you need to either satisfy
                        the missing dependency in the Makefile or whatever
                        script produced the Makefile, or (as a workaround)
                        set
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PARALLEL_MAKE" target="_top"><code class="filename">PARALLEL_MAKE</code></a>
                        to an empty string:
                        </p><pre class="literallayout">
     PARALLEL_MAKE = ""
                        </pre><p>
                            For information on parallel Makefile issues, see the
                            "<a class="link" href="#debugging-parallel-make-races" title="5.28. Debugging Parallel Make Races">Debugging Parallel Make Races</a>"
                            section.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Improper host path usage:</em></span>
                        This failure applies to recipes building for the target
                        or <code class="filename">nativesdk</code> only.
                        The failure occurs when the compilation process uses
                        improper headers, libraries, or other files from the
                        host system when cross-compiling for the target.
                        </p><p>To fix the problem, examine the
                        <code class="filename">log.do_compile</code> file to identify
                        the host paths being used (e.g.
                        <code class="filename">/usr/include</code>,
                        <code class="filename">/usr/lib</code>, and so forth) and then
                        either add configure options, apply a patch, or do both.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Failure to find required
                        libraries/headers:</em></span>
                        If a build-time dependency is missing because it has
                        not been declared in
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>,
                        or because the dependency exists but the path used by
                        the build process to find the file is incorrect and the
                        configure step did not detect it, the compilation
                        process could fail.
                        For either of these failures, the compilation process
                        notes that files could not be found.
                        In these cases, you need to go back and add additional
                        options to the configure script as well as possibly
                        add additional build-time dependencies to
                        <code class="filename">DEPENDS</code>.</p><p>Occasionally, it is necessary to apply a patch
                        to the source to ensure the correct paths are used.
                        If you need to specify paths to find files staged
                        into the sysroot from other recipes, use the variables
                        that the OpenEmbedded build system provides
                        (e.g.
                        <code class="filename">STAGING_BINDIR</code>,
                        <code class="filename">STAGING_INCDIR</code>,
                        <code class="filename">STAGING_DATADIR</code>, and so forth).

                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.3.14. Installing"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-installing">5.3.14. Installing<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-installing">¶</a></span></h3></div></div></div><p>
                During <code class="filename">do_install</code>, the task copies the
                built files along with their hierarchy to locations that
                would mirror their locations on the target device.
                The installation process copies files from the
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a><code class="filename">}</code>,
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-B" target="_top"><code class="filename">B</code></a><code class="filename">}</code>,
                and
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WORKDIR" target="_top"><code class="filename">WORKDIR</code></a><code class="filename">}</code>
                directories to the
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-D" target="_top"><code class="filename">D</code></a><code class="filename">}</code>
                directory to create the structure as it should appear on the
                target system.
            </p><p>
                How your software is built affects what you must do to be
                sure your software is installed correctly.
                The following list describes what you must do for installation
                depending on the type of build system used by the software
                being built:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Autotools and CMake:</em></span>
                        If the software your recipe is building uses Autotools
                        or CMake, the OpenEmbedded build
                        system understands how to install the software.
                        Consequently, you do not have to have a
                        <code class="filename">do_install</code> task as part of your
                        recipe.
                        You just need to make sure the install portion of the
                        build completes with no issues.
                        However, if you wish to install additional files not
                        already being installed by
                        <code class="filename">make install</code>, you should do this
                        using a <code class="filename">do_install_append</code> function
                        using the install command as described in
                        the "Manual" bulleted item later in this list.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Other (using
                        <code class="filename">make install</code>):</em></span>
                        You need to define a
                        <code class="filename">do_install</code> function in your
                        recipe.
                        The function should call
                        <code class="filename">oe_runmake install</code> and will likely
                        need to pass in the destination directory as well.
                        How you pass that path is dependent on how the
                        <code class="filename">Makefile</code> being run is written
                        (e.g. <code class="filename">DESTDIR=${D}</code>,
                        <code class="filename">PREFIX=${D}</code>,
                        <code class="filename">INSTALLROOT=${D}</code>, and so forth).
                        </p><p>For an example recipe using
                        <code class="filename">make install</code>, see the
                        "<a class="link" href="#new-recipe-makefile-based-package" title="5.3.21.3. Makefile-Based Package">Makefile-Based Package</a>"
                        section.</p></li><li class="listitem"><p><span class="emphasis"><em>Manual:</em></span>
                        You need to define a
                        <code class="filename">do_install</code> function in your
                        recipe.
                        The function must first use
                        <code class="filename">install -d</code> to create the
                        directories under
                        <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-D" target="_top"><code class="filename">D</code></a><code class="filename">}</code>.
                        Once the directories exist, your function can use
                        <code class="filename">install</code> to manually install the
                        built software into the directories.</p><p>You can find more information on
                        <code class="filename">install</code> at
                        <a class="ulink" href="http://www.gnu.org/software/coreutils/manual/html_node/install-invocation.html" target="_top">http://www.gnu.org/software/coreutils/manual/html_node/install-invocation.html</a>.
                        </p></li></ul></div><p>
            </p><p>
                For the scenarios that do not use Autotools or
                CMake, you need to track the installation
                and diagnose and fix any issues until everything installs
                correctly.
                You need to look in the default location of
                <code class="filename">${D}</code>, which is
                <code class="filename">${WORKDIR}/image</code>, to be sure your
                files have been installed correctly.
            </p><div class="note" title="Notes" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Notes</h3><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        During the installation process, you might need to
                        modify some of the installed files to suit the target
                        layout.
                        For example, you might need to replace hard-coded paths
                        in an initscript with values of variables provided by
                        the build system, such as replacing
                        <code class="filename">/usr/bin/</code> with
                        <code class="filename">${bindir}</code>.
                        If you do perform such modifications during
                        <code class="filename">do_install</code>, be sure to modify the
                        destination file after copying rather than before
                        copying.
                        Modifying after copying ensures that the build system
                        can re-execute <code class="filename">do_install</code> if
                        needed.
                        </p></li><li class="listitem"><p>
                        <code class="filename">oe_runmake install</code>, which can be
                        run directly or can be run indirectly by the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-autotools" target="_top"><code class="filename">autotools</code></a>
                        and
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-cmake" target="_top"><code class="filename">cmake</code></a>
                        classes, runs <code class="filename">make install</code> in
                        parallel.
                        Sometimes, a Makefile can have missing dependencies
                        between targets that can result in race conditions.
                        If you experience intermittent failures during
                        <code class="filename">do_install</code>, you might be able to
                        work around them by disabling parallel Makefile
                        installs by adding the following to the recipe:
                        </p><pre class="literallayout">
     PARALLEL_MAKEINST = ""
                        </pre><p>
                        See
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PARALLEL_MAKEINST" target="_top"><code class="filename">PARALLEL_MAKEINST</code></a>
                        for additional information.
                        </p></li></ul></div></div></div><div class="section" title="5.3.15. Enabling System Services"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-enabling-system-services">5.3.15. Enabling System Services<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-enabling-system-services">¶</a></span></h3></div></div></div><p>
                If you want to install a service, which is a process that
                usually starts on boot and runs in the background, then
                you must include some additional definitions in your recipe.
            </p><p>
                If you are adding services and the service initialization
                script or the service file itself is not installed, you must
                provide for that installation in your recipe using a
                <code class="filename">do_install_append</code> function.
                If your recipe already has a <code class="filename">do_install</code>
                function, update the function near its end rather than
                adding an additional <code class="filename">do_install_append</code>
                function.
            </p><p>
                When you create the installation for your services, you need
                to accomplish what is normally done by
                <code class="filename">make install</code>.
                In other words, make sure your installation arranges the output
                similar to how it is arranged on the target system.
            </p><p>
                The OpenEmbedded build system provides support for starting
                services two different ways:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>SysVinit:</em></span>
                        SysVinit is a system and service manager that
                        manages the init system used to control the very basic
                        functions of your system.
                        The init program is the first program
                        started by the Linux kernel when the system boots.
                        Init then controls the startup, running and shutdown
                        of all other programs.</p><p>To enable a service using SysVinit, your recipe
                        needs to inherit the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-update-rc.d" target="_top"><code class="filename">update-rc.d</code></a>
                        class.
                        The class helps facilitate safely installing the
                        package on the target.</p><p>You will need to set the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INITSCRIPT_PACKAGES" target="_top"><code class="filename">INITSCRIPT_PACKAGES</code></a>,
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INITSCRIPT_NAME" target="_top"><code class="filename">INITSCRIPT_NAME</code></a>,
                        and
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INITSCRIPT_PARAMS" target="_top"><code class="filename">INITSCRIPT_PARAMS</code></a>
                        variables within your recipe.</p></li><li class="listitem"><p><span class="emphasis"><em>systemd:</em></span>
                        System Management Daemon (systemd) was designed to
                        replace SysVinit and to provide
                        enhanced management of services.
                        For more information on systemd, see the systemd
                        homepage at
                        <a class="ulink" href="http://freedesktop.org/wiki/Software/systemd/" target="_top">http://freedesktop.org/wiki/Software/systemd/</a>.
                        </p><p>To enable a service using systemd, your recipe
                        needs to inherit the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-systemd" target="_top"><code class="filename">systemd</code></a>
                        class.
                        See the <code class="filename">systemd.bbclass</code> file
                        located in your
                        <a class="link" href="#source-directory">Source Directory</a>.
                        section for more information.
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.3.16. Packaging"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-packaging">5.3.16. Packaging<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-packaging">¶</a></span></h3></div></div></div><p>
                Successful packaging is a combination of automated processes
                performed by the OpenEmbedded build system and some
                specific steps you need to take.
                The following list describes the process:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Splitting Files</em></span>:
                        The <code class="filename">do_package</code> task splits the
                        files produced by the recipe into logical components.
                        Even software that produces a single binary might
                        still have debug symbols, documentation, and other
                        logical components that should be split out.
                        The <code class="filename">do_package</code> task ensures
                        that files are split up and packaged correctly.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Running QA Checks</em></span>:
                        The
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-insane" target="_top"><code class="filename">insane</code></a>
                        class adds a step to
                        the package generation process so that output quality
                        assurance checks are generated by the OpenEmbedded
                        build system.
                        This step performs a range of checks to be sure the
                        build's output is free of common problems that show
                        up during runtime.
                        For information on these checks, see the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-insane" target="_top"><code class="filename">insane</code></a>
                        class and the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-qa-checks" target="_top">QA Error and Warning Messages</a>"
                        chapter in the Yocto Project Reference Manual.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Hand-Checking Your Packages</em></span>:
                        After you build your software, you need to be sure
                        your packages are correct.
                        Examine the
                        <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WORKDIR" target="_top"><code class="filename">WORKDIR</code></a><code class="filename">}/packages-split</code>
                        directory and make sure files are where you expect
                        them to be.
                        If you discover problems, you can set
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES" target="_top"><code class="filename">PACKAGES</code></a>,
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILES" target="_top"><code class="filename">FILES</code></a>,
                        <code class="filename">do_install(_append)</code>, and so forth as
                        needed.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Splitting an Application into Multiple Packages</em></span>:
                        If you need to split an application into several
                        packages, see the
                        "<a class="link" href="#splitting-an-application-into-multiple-packages" title="5.3.21.4. Splitting an Application into Multiple Packages">Splitting an Application into Multiple Packages</a>"
                        section for an example.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Installing a Post-Installation Script</em></span>:
                        For an example showing how to install a
                        post-installation script, see the
                        "<a class="link" href="#new-recipe-post-installation-scripts" title="5.3.19. Post-Installation Scripts">Post-Installation Scripts</a>"
                        section.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Marking Package Architecture</em></span>:
                        Depending on what your recipe is building and how it
                        is configured, it might be important to mark the
                        packages produced as being specific to a particular
                        machine, or to mark them as not being specific to
                        a particular machine or architecture at all.</p><p>By default, packages apply to any machine with the
                        same architecture as the target machine.
                        When a recipe produces packages that are
                        machine-specific (e.g. the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                        value is passed into the configure script or a patch
                        is applied only for a particular machine), you should
                        mark them as such by adding the following to the
                        recipe:
                        </p><pre class="literallayout">
     PACKAGE_ARCH = "${MACHINE_ARCH}"
                        </pre><p>On the other hand, if the recipe produces packages
                        that do not contain anything specific to the target
                        machine or architecture at all (e.g. recipes
                        that simply package script files or configuration
                        files), you should use the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-allarch" target="_top"><code class="filename">allarch</code></a>
                        class to do this for you by adding this to your
                        recipe:
                        </p><pre class="literallayout">
     inherit allarch
                        </pre><p>
                        Ensuring that the package architecture is correct is
                        not critical while you are doing the first few builds
                        of your recipe.
                        However, it is important in order
                        to ensure that your recipe rebuilds (or does not
                        rebuild) appropriately in response to changes in
                        configuration, and to ensure that you get the
                        appropriate packages installed on the target machine,
                        particularly if you run separate builds for more
                        than one target machine.
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.3.17. Sharing Files Between Recipes"><div class="titlepage"><div><div><h3 class="title" id="new-sharing-files-between-recipes">5.3.17. Sharing Files Between Recipes<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-sharing-files-between-recipes">¶</a></span></h3></div></div></div><p>
                Recipes often need to use files provided by other recipes on
                the build host.
                For example, an application linking to a common library needs
                access to the library itself and its associated headers.
                The way this access is accomplished is by populating sysroot
                with files.
                Each recipe has two sysroots in its work directory, one for
                target files
                (<code class="filename">recipe-sysroot</code>) and one for files that
                are native to the build host
                (<code class="filename">recipe-sysroot-native</code>).
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    You could find the term "staging" used within the Yocto
                    project regarding files populating sysroot (e.g. the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-STAGING_DIR" target="_top"><code class="filename">STAGING_DIR</code></a>
                    variable).
                </div><p>
            </p><p>
                Recipes should never populate the sysroot directly (i.e. write
                files into sysroot).
                Instead, files should be installed into standard locations
                during the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-install" target="_top"><code class="filename">do_install</code></a>
                task within the
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-D" target="_top"><code class="filename">D</code></a><code class="filename">}</code>
                directory.
                The reason for this limitation is that almost all files that
                populate the sysroot are cataloged in manifests in order to
                ensure the files can be removed later when a recipe is either
                modified or removed.
                Thus, the sysroot is able to remain free from stale files.
            </p><p>
                A subset of the files installed by the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-install" target="_top"><code class="filename">do_install</code></a>
                task are used by the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-populate_sysroot" target="_top"><code class="filename">do_populate_sysroot</code></a>
                task as defined by the the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SYSROOT_DIRS" target="_top"><code class="filename">SYSROOT_DIRS</code></a>
                variable to automatically populate the sysroot.
                It is possible to modify the list of directories that populate
                the sysroot.
                The following example shows how you could add the
                <code class="filename">/opt</code> directory to the list of
                directories:
                </p><pre class="literallayout">
     SYSROOT_DIRS += "/opt"
                </pre><p>
            </p><p>
                for a more complete description of the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-populate_sysroot" target="_top"><code class="filename">do_populate_sysroot</code></a>
                task and its associated functions, see the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-staging" target="_top"><code class="filename">staging</code></a>
                class.
            </p></div><div class="section" title="5.3.18. Properly Versioning Pre-Release Recipes"><div class="titlepage"><div><div><h3 class="title" id="properly-versioning-pre-release-recipes">5.3.18. Properly Versioning Pre-Release Recipes<span class="permalink"><a alt="Permalink" title="Permalink" href="#properly-versioning-pre-release-recipes">¶</a></span></h3></div></div></div><p>
                Sometimes the name of a recipe can lead to versioning
                problems when the recipe is upgraded to a final release.
                For example, consider the
                <code class="filename">irssi_0.8.16-rc1.bb</code> recipe file in
                the list of example recipes in the
                "<a class="link" href="#new-recipe-storing-and-naming-the-recipe" title="5.3.3. Storing and Naming the Recipe">Storing and Naming the Recipe</a>"
                section.
                This recipe is at a release candidate stage (i.e.
                "rc1").
                When the recipe is released, the recipe filename becomes
                <code class="filename">irssi_0.8.16.bb</code>.
                The version change from <code class="filename">0.8.16-rc1</code>
                to <code class="filename">0.8.16</code> is seen as a decrease by the
                build system and package managers, so the resulting packages
                will not correctly trigger an upgrade.
            </p><p>
                In order to ensure the versions compare properly, the
                recommended convention is to set
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>
                within the recipe to
                "<em class="replaceable"><code>previous_version</code></em>+<em class="replaceable"><code>current_version</code></em>".
                You can use an additional variable so that you can use the
                current version elsewhere.
                Here is an example:
                </p><pre class="literallayout">
     REALPV = "0.8.16-rc1"
     PV = "0.8.15+${REALPV}"
                </pre><p>
            </p></div><div class="section" title="5.3.19. Post-Installation Scripts"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-post-installation-scripts">5.3.19. Post-Installation Scripts<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-post-installation-scripts">¶</a></span></h3></div></div></div><p>
                Post-installation scripts run immediately after installing
                a package on the target or during image creation when a
                package is included in an image.
                To add a post-installation script to a package, add a
                <code class="filename">pkg_postinst_</code><em class="replaceable"><code>PACKAGENAME</code></em><code class="filename">()</code> function to
                the recipe file (<code class="filename">.bb</code>) and replace
                <em class="replaceable"><code>PACKAGENAME</code></em> with the name of the package
                you want to attach to the <code class="filename">postinst</code>
                script.
                To apply the post-installation script to the main package
                for the recipe, which is usually what is required, specify
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a><code class="filename">}</code>
                in place of <em class="replaceable"><code>PACKAGENAME</code></em>.
            </p><p>
                A post-installation function has the following structure:
                </p><pre class="literallayout">
     pkg_postinst_<em class="replaceable"><code>PACKAGENAME</code></em>() {
     # Commands to carry out
     }
                </pre><p>
            </p><p>
                The script defined in the post-installation function is
                called when the root filesystem is created.
                If the script succeeds, the package is marked as installed.
                If the script fails, the package is marked as unpacked and
                the script is executed when the image boots again.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Any RPM post-installation script that runs on the target
                    should return a 0 exit code.
                    RPM does not allow non-zero exit codes for these scripts,
                    and the RPM package manager will cause the package to fail
                    installation on the target.
                </div><p>
            </p><p>
                Sometimes it is necessary for the execution of a
                post-installation script to be delayed until the first boot.
                For example, the script might need to be executed on the
                device itself.
                To delay script execution until boot time, use the following
                structure in the post-installation script:
                </p><pre class="literallayout">
     pkg_postinst_<em class="replaceable"><code>PACKAGENAME</code></em>() {
     if [ x"$D" = "x" ]; then
          # Actions to carry out on the device go here
     else
          exit 1
     fi
     }
                </pre><p>
            </p><p>
                The previous example delays execution until the image boots
                again because the environment variable <code class="filename">D</code>
                points to the directory containing the image when
                the root filesystem is created at build time but is unset
                when executed on the first boot.
            </p><p>
                If you have recipes that use <code class="filename">pkg_postinst</code>
                scripts and they require the use of non-standard native
                tools that have dependencies during rootfs construction, you
                need to use the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_WRITE_DEPS" target="_top"><code class="filename">PACKAGE_WRITE_DEPS</code></a>
                variable in your recipe to list these tools.
                If you do not use this variable, the tools might be missing and
                execution of the post-installation script is deferred until
                first boot.
                Deferring the script to first boot is undesirable and for
                read-only rootfs impossible.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                Equivalent support for pre-install, pre-uninstall, and
                post-uninstall scripts exist by way of
                <code class="filename">pkg_preinst</code>,
                <code class="filename">pkg_prerm</code>, and
                <code class="filename">pkg_postrm</code>, respectively.
                These scrips work in exactly the same way as does
                <code class="filename">pkg_postinst</code> with the exception that they
                run at different times.
                Also, because of when they run, they are not applicable to
                being run at image creation time like
                <code class="filename">pkg_postinst</code>.
            </div></div><div class="section" title="5.3.20. Testing"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-testing">5.3.20. Testing<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-testing">¶</a></span></h3></div></div></div><p>
                The final step for completing your recipe is to be sure that
                the software you built runs correctly.
                To accomplish runtime testing, add the build's output
                packages to your image and test them on the target.
            </p><p>
                For information on how to customize your image by adding
                specific packages, see the
                "<a class="link" href="#usingpoky-extend-customimage" title="5.2. Customizing Images">Customizing Images</a>"
                section.
            </p></div><div class="section" title="5.3.21. Examples"><div class="titlepage"><div><div><h3 class="title" id="new-recipe-testing-examples">5.3.21. Examples<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-testing-examples">¶</a></span></h3></div></div></div><p>
                To help summarize how to write a recipe, this section provides
                some examples given various scenarios:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Recipes that use local files</p></li><li class="listitem"><p>Using an Autotooled package</p></li><li class="listitem"><p>Using a Makefile-based package</p></li><li class="listitem"><p>Splitting an application into multiple packages</p></li><li class="listitem"><p>Adding binaries to an image</p></li></ul></div><p>
            </p><div class="section" title="5.3.21.1. Single .c File Package (Hello World!)"><div class="titlepage"><div><div><h4 class="title" id="new-recipe-single-c-file-package-hello-world">5.3.21.1. Single .c File Package (Hello World!)<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-single-c-file-package-hello-world">¶</a></span></h4></div></div></div><p>
                    Building an application from a single file that is stored
                    locally (e.g. under <code class="filename">files</code>) requires
                    a recipe that has the file listed in the
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top">SRC_URI</a></code>
                    variable.
                    Additionally, you need to manually write the
                    <code class="filename">do_compile</code> and
                    <code class="filename">do_install</code> tasks.
                    The <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top">S</a></code>
                    variable defines the directory containing the source code,
                    which is set to
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WORKDIR" target="_top"><code class="filename">WORKDIR</code></a>
                    in this case - the directory BitBake uses for the build.
                    </p><pre class="literallayout">
     SUMMARY = "Simple helloworld application"
     SECTION = "examples"
     LICENSE = "MIT"
     LIC_FILES_CHKSUM = "file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302"

     SRC_URI = "file://helloworld.c"

     S = "${WORKDIR}"

     do_compile() {
     	${CC} helloworld.c -o helloworld
     }

     do_install() {
     	install -d ${D}${bindir}
     	install -m 0755 helloworld ${D}${bindir}
     }
                    </pre><p>
                </p><p>
                    By default, the <code class="filename">helloworld</code>,
                    <code class="filename">helloworld-dbg</code>, and
                    <code class="filename">helloworld-dev</code> packages are built.
                    For information on how to customize the packaging process,
                    see the
                    "<a class="link" href="#splitting-an-application-into-multiple-packages" title="5.3.21.4. Splitting an Application into Multiple Packages">Splitting an Application into Multiple Packages</a>"
                    section.
                </p></div><div class="section" title="5.3.21.2. Autotooled Package"><div class="titlepage"><div><div><h4 class="title" id="new-recipe-autotooled-package">5.3.21.2. Autotooled Package<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-autotooled-package">¶</a></span></h4></div></div></div><p>
                    Applications that use Autotools such as <code class="filename">autoconf</code> and
                    <code class="filename">automake</code> require a recipe that has a source archive listed in
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top">SRC_URI</a></code> and
                    also inherit the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-autotools" target="_top"><code class="filename">autotools</code></a>
                    class, which contains the definitions of all the steps
                    needed to build an Autotool-based application.
                    The result of the build is automatically packaged.
                    And, if the application uses NLS for localization, packages with local information are
                    generated (one package per language).
                    Following is one example: (<code class="filename">hello_2.3.bb</code>)
                    </p><pre class="literallayout">
     SUMMARY = "GNU Helloworld application"
     SECTION = "examples"
     LICENSE = "GPLv2+"
     LIC_FILES_CHKSUM = "file://COPYING;md5=751419260aa954499f7abaabaa882bbe"

     SRC_URI = "${GNU_MIRROR}/hello/hello-${PV}.tar.gz"

     inherit autotools gettext
                     </pre><p>
                </p><p>
                    The variable
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LIC_FILES_CHKSUM" target="_top">LIC_FILES_CHKSUM</a></code>
                    is used to track source license changes as described in the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#usingpoky-configuring-LIC_FILES_CHKSUM" target="_top">Tracking License Changes</a>" section.
                    You can quickly create Autotool-based recipes in a manner similar to the previous example.
                </p></div><div class="section" title="5.3.21.3. Makefile-Based Package"><div class="titlepage"><div><div><h4 class="title" id="new-recipe-makefile-based-package">5.3.21.3. Makefile-Based Package<span class="permalink"><a alt="Permalink" title="Permalink" href="#new-recipe-makefile-based-package">¶</a></span></h4></div></div></div><p>
                    Applications that use GNU <code class="filename">make</code> also require a recipe that has
                    the source archive listed in
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top">SRC_URI</a></code>.
                    You do not need to add a <code class="filename">do_compile</code> step since by default BitBake
                    starts the <code class="filename">make</code> command to compile the application.
                    If you need additional <code class="filename">make</code> options, you should store them in the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTRA_OEMAKE" target="_top"><code class="filename">EXTRA_OEMAKE</code></a>
                    or
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGECONFIG_CONFARGS" target="_top"><code class="filename">PACKAGECONFIG_CONFARGS</code></a>
                    variables.
                    BitBake passes these options into the GNU <code class="filename">make</code> invocation.
                    Note that a <code class="filename">do_install</code> task is still required.
                    Otherwise, BitBake runs an empty <code class="filename">do_install</code> task by default.
                </p><p>
                    Some applications might require extra parameters to be passed to the compiler.
                    For example, the application might need an additional header path.
                    You can accomplish this by adding to the
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-CFLAGS" target="_top">CFLAGS</a></code> variable.
                    The following example shows this:
                    </p><pre class="literallayout">
     CFLAGS_prepend = "-I ${S}/include "
                    </pre><p>
                </p><p>
                In the following example, <code class="filename">mtd-utils</code> is a makefile-based package:
                    </p><pre class="literallayout">
     SUMMARY = "Tools for managing memory technology devices"
     SECTION = "base"
     DEPENDS = "zlib lzo e2fsprogs util-linux"
     HOMEPAGE = "http://www.linux-mtd.infradead.org/"
     LICENSE = "GPLv2+"
     LIC_FILES_CHKSUM = "file://COPYING;md5=0636e73ff0215e8d672dc4c32c317bb3 \
                         file://include/common.h;beginline=1;endline=17;md5=ba05b07912a44ea2bf81ce409380049c"

     # Use the latest version at 26 Oct, 2013
     SRCREV = "9f107132a6a073cce37434ca9cda6917dd8d866b"
     SRC_URI = "git://git.infradead.org/mtd-utils.git \
                     file://add-exclusion-to-mkfs-jffs2-git-2.patch \
     "

     PV = "1.5.1+git${SRCPV}"

     S = "${WORKDIR}/git"

     EXTRA_OEMAKE = "'CC=${CC}' 'RANLIB=${RANLIB}' 'AR=${AR}' 'CFLAGS=${CFLAGS} -I${S}/include -DWITHOUT_XATTR' 'BUILDDIR=${S}'"

     do_install () {
             oe_runmake install DESTDIR=${D} SBINDIR=${sbindir} MANDIR=${mandir} INCLUDEDIR=${includedir}
     }

     PACKAGES =+ "mtd-utils-jffs2 mtd-utils-ubifs mtd-utils-misc"

     FILES_mtd-utils-jffs2 = "${sbindir}/mkfs.jffs2 ${sbindir}/jffs2dump ${sbindir}/jffs2reader ${sbindir}/sumtool"
     FILES_mtd-utils-ubifs = "${sbindir}/mkfs.ubifs ${sbindir}/ubi*"
     FILES_mtd-utils-misc = "${sbindir}/nftl* ${sbindir}/ftl* ${sbindir}/rfd* ${sbindir}/doc* ${sbindir}/serve_image ${sbindir}/recv_image"

     PARALLEL_MAKE = ""

     BBCLASSEXTEND = "native"
                    </pre><p>
                </p></div><div class="section" title="5.3.21.4. Splitting an Application into Multiple Packages"><div class="titlepage"><div><div><h4 class="title" id="splitting-an-application-into-multiple-packages">5.3.21.4. Splitting an Application into Multiple Packages<span class="permalink"><a alt="Permalink" title="Permalink" href="#splitting-an-application-into-multiple-packages">¶</a></span></h4></div></div></div><p>
                    You can use the variables
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES" target="_top">PACKAGES</a></code> and
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILES" target="_top">FILES</a></code>
                    to split an application into multiple packages.
                </p><p>
                    Following is an example that uses the <code class="filename">libxpm</code> recipe.
                    By default, this recipe generates a single package that contains the library along
                    with a few binaries.
                    You can modify the recipe to split the binaries into separate packages:
                    </p><pre class="literallayout">
     require xorg-lib-common.inc

     SUMMARY = "Xpm: X Pixmap extension library"
     LICENSE = "BSD"
     LIC_FILES_CHKSUM = "file://COPYING;md5=51f4270b012ecd4ab1a164f5f4ed6cf7"
     DEPENDS += "libxext libsm libxt"
     PE = "1"

     XORG_PN = "libXpm"

     PACKAGES =+ "sxpm cxpm"
     FILES_cxpm = "${bindir}/cxpm"
     FILES_sxpm = "${bindir}/sxpm"
                    </pre><p>
                </p><p>
                    In the previous example, we want to ship the <code class="filename">sxpm</code>
                    and <code class="filename">cxpm</code> binaries in separate packages.
                    Since <code class="filename">bindir</code> would be packaged into the main
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top">PN</a></code>
                    package by default, we prepend the <code class="filename">PACKAGES</code>
                    variable so additional package names are added to the start of list.
                    This results in the extra <code class="filename">FILES_*</code>
                    variables then containing information that define which files and
                    directories go into which packages.
                    Files included by earlier packages are skipped by latter packages.
                    Thus, the main <code class="filename">PN</code> package
                    does not include the above listed files.
                </p></div><div class="section" title="5.3.21.5. Packaging Externally Produced Binaries"><div class="titlepage"><div><div><h4 class="title" id="packaging-externally-produced-binaries">5.3.21.5. Packaging Externally Produced Binaries<span class="permalink"><a alt="Permalink" title="Permalink" href="#packaging-externally-produced-binaries">¶</a></span></h4></div></div></div><p>
                    Sometimes, you need to add pre-compiled binaries to an
                    image.
                    For example, suppose that binaries for proprietary code
                    exist, which are created by a particular division of a
                    company.
                    Your part of the company needs to use those binaries as
                    part of an image that you are building using the
                    OpenEmbedded build system.
                    Since you only have the binaries and not the source code,
                    you cannot use a typical recipe that expects to fetch the
                    source specified in
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                    and then compile it.
                </p><p>
                    One method is to package the binaries and then install them
                    as part of the image.
                    Generally, it is not a good idea to package binaries
                    since, among other things, it can hinder the ability to
                    reproduce builds and could lead to compatibility problems
                    with ABI in the future.
                    However, sometimes you have no choice.
                </p><p>
                    The easiest solution is to create a recipe that uses
                    the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-bin-package" target="_top"><code class="filename">bin_package</code></a>
                    class and to be sure that you are using default locations
                    for build artifacts.
                    In most cases, the <code class="filename">bin_package</code> class
                    handles "skipping" the configure and compile steps as well
                    as sets things up to grab packages from the appropriate
                    area.
                    In particular, this class sets <code class="filename">noexec</code>
                    on both the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-configure" target="_top"><code class="filename">do_configure</code></a>
                    and
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-compile" target="_top"><code class="filename">do_compile</code></a>
                    tasks, sets
                    <code class="filename">FILES_${PN}</code> to "/" so that it picks
                    up all files, and sets up a
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-install" target="_top"><code class="filename">do_install</code></a>
                    task, which effectively copies all files from
                    <code class="filename">${S}</code> to <code class="filename">${D}</code>.
                    The <code class="filename">bin_package</code> class works well when
                    the files extracted into <code class="filename">${S}</code> are
                    already laid out in the way they should be laid out
                    on the target.
                    For more information on these variables, see the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILES" target="_top"><code class="filename">FILES</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a>,
                    and
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-D" target="_top"><code class="filename">D</code></a>
                    variables in the Yocto Project Reference Manual's variable
                    glossary.
                    </p><div class="note" title="Notes" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Notes</h3><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                                Using
                                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>
                                is a good idea even for components distributed
                                in binary form, and is often necessary for
                                shared libraries.
                                For a shared library, listing the library
                                dependencies in
                                <code class="filename">DEPENDS</code> makes sure that
                                the libraries are available in the staging
                                sysroot when other recipes link against the
                                library, which might be necessary for
                                successful linking.
                                </p></li><li class="listitem"><p>
                                Using <code class="filename">DEPENDS</code> also
                                allows runtime dependencies between packages
                                to be added automatically.
                                See the
                                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#automatically-added-runtime-dependencies" target="_top">Automatically Added Runtime Dependencies</a>"
                                section in the Yocto Project Reference Manual
                                for more information.
                                </p></li></ul></div></div><p>
                </p><p>
                    If you cannot use the <code class="filename">bin_package</code>
                    class, you need to be sure you are doing the following:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            Create a recipe where the
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-configure" target="_top"><code class="filename">do_configure</code></a>
                            and
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-compile" target="_top"><code class="filename">do_compile</code></a>
                            tasks do nothing:
                            It is usually sufficient to just not define these
                            tasks in the recipe, because the default
                            implementations do nothing unless a Makefile is
                            found in
                            <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a><code class="filename">}</code>.
                            </p><p>If
                            <code class="filename">${S}</code> might contain a Makefile,
                            or if you inherit some class that replaces
                            <code class="filename">do_configure</code> and
                            <code class="filename">do_compile</code> with custom
                            versions, then you can use the
                            <code class="filename">[</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html#variable-flags" target="_top"><code class="filename">noexec</code></a><code class="filename">]</code>
                            flag to turn the tasks into no-ops, as follows:
                            </p><pre class="literallayout">
     do_configure[noexec] = "1"
     do_compile[noexec] = "1"
                            </pre><p>
                            Unlike
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bitbake-user-manual/bitbake-user-manual.html#deleting-a-task" target="_top"><code class="filename">deleting the tasks</code></a>,
                            using the flag preserves the dependency chain from
                            the
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-fetch" target="_top"><code class="filename">do_fetch</code></a>,                     <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-unpack" target="_top"><code class="filename">do_unpack</code></a>,
                            and
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-patch" target="_top"><code class="filename">do_patch</code></a>
                            tasks to the
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-install" target="_top"><code class="filename">do_install</code></a>
                            task.
                            </p></li><li class="listitem"><p>Make sure your
                            <code class="filename">do_install</code> task installs the
                            binaries appropriately.
                            </p></li><li class="listitem"><p>Ensure that you set up
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILES" target="_top"><code class="filename">FILES</code></a>
                            (usually
                            <code class="filename">FILES_${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a><code class="filename">}</code>)
                            to point to the files you have installed, which of
                            course depends on where you have installed them
                            and whether those files are in different locations
                            than the defaults.
                            </p></li></ul></div><p>
                </p></div></div><div class="section" title="5.3.22. Following Recipe Style Guidelines"><div class="titlepage"><div><div><h3 class="title" id="following-recipe-style-guidelines">5.3.22. Following Recipe Style Guidelines<span class="permalink"><a alt="Permalink" title="Permalink" href="#following-recipe-style-guidelines">¶</a></span></h3></div></div></div><p>
                When writing recipes, it is good to conform to existing
                style guidelines.
                The
                <a class="ulink" href="http://www.openembedded.org/wiki/Styleguide" target="_top">OpenEmbedded Styleguide</a>
                wiki page provides rough guidelines for preferred recipe style.
            </p><p>
                It is common for existing recipes to deviate a bit from this
                style.
                However, aiming for at least a consistent style is a good idea.
                Some practices, such as omitting spaces around
                <code class="filename">=</code> operators in assignments or ordering
                recipe components in an erratic way, are widely seen as poor
                style.
            </p></div></div><div class="section" title="5.4. Adding a New Machine"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="platdev-newmachine">5.4. Adding a New Machine<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-newmachine">¶</a></span></h2></div></div></div><p>
            Adding a new machine to the Yocto Project is a straightforward
            process.
            This section describes how to add machines that are similar
            to those that the Yocto Project already supports.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                Although well within the capabilities of the Yocto Project,
                adding a totally new architecture might require
                changes to <code class="filename">gcc/glibc</code> and to the site
                information, which is beyond the scope of this manual.
            </div><p>
        </p><p>
            For a complete example that shows how to add a new machine,
            see the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#creating-a-new-bsp-layer-using-the-yocto-bsp-script" target="_top">Creating a New BSP Layer Using the yocto-bsp Script</a>"
            section in the Yocto Project Board Support Package (BSP) Developer's Guide.
        </p><div class="section" title="5.4.1. Adding the Machine Configuration File"><div class="titlepage"><div><div><h3 class="title" id="platdev-newmachine-conffile">5.4.1. Adding the Machine Configuration File<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-newmachine-conffile">¶</a></span></h3></div></div></div><p>
                To add a new machine, you need to add a new machine
                configuration file to the layer's
                <code class="filename">conf/machine</code> directory.
                This configuration file provides details about the device
                you are adding.
            </p><p>
                The OpenEmbedded build system uses the root name of the
                machine configuration file to reference the new machine.
                For example, given a machine configuration file named
                <code class="filename">crownbay.conf</code>, the build system
                recognizes the machine as "crownbay".
            </p><p>
                The most important variables you must set in your machine
                configuration file or include from a lower-level configuration
                file are as follows:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TARGET_ARCH" target="_top">TARGET_ARCH</a></code>
                        (e.g. "arm")</p></li><li class="listitem"><p><code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PREFERRED_PROVIDER" target="_top">PREFERRED_PROVIDER</a>_virtual/kernel</code>
                        </p></li><li class="listitem"><p><code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE_FEATURES" target="_top">MACHINE_FEATURES</a></code>
                        (e.g. "apm screen wifi")</p></li></ul></div><p>
            </p><p>
                You might also need these variables:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SERIAL_CONSOLES" target="_top">SERIAL_CONSOLES</a></code>
                        (e.g. "115200;ttyS0 115200;ttyS1")</p></li><li class="listitem"><p><code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-KERNEL_IMAGETYPE" target="_top">KERNEL_IMAGETYPE</a></code>
                        (e.g. "zImage")</p></li><li class="listitem"><p><code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FSTYPES" target="_top">IMAGE_FSTYPES</a></code>
                        (e.g. "tar.gz jffs2")</p></li></ul></div><p>
            </p><p>
                You can find full details on these variables in the reference
                section.
                You can leverage existing machine <code class="filename">.conf</code>
                files from <code class="filename">meta-yocto-bsp/conf/machine/</code>.
            </p></div><div class="section" title="5.4.2. Adding a Kernel for the Machine"><div class="titlepage"><div><div><h3 class="title" id="platdev-newmachine-kernel">5.4.2. Adding a Kernel for the Machine<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-newmachine-kernel">¶</a></span></h3></div></div></div><p>
                The OpenEmbedded build system needs to be able to build a kernel
                for the machine.
                You need to either create a new kernel recipe for this machine,
                or extend an existing kernel recipe.
                You can find several kernel recipe examples in the
                Source Directory at
                <code class="filename">meta/recipes-kernel/linux</code>
                that you can use as references.
            </p><p>
                If you are creating a new kernel recipe, normal recipe-writing
                rules apply for setting up a
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top">SRC_URI</a></code>.
                Thus, you need to specify any necessary patches and set
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top">S</a></code>
                to point at the source code.
                You need to create a <code class="filename">do_configure</code> task that
                configures the unpacked kernel with a
                <code class="filename">defconfig</code> file.
                You can do this by using a <code class="filename">make defconfig</code>
                command or, more commonly, by copying in a suitable
                <code class="filename">defconfig</code> file and then running
                <code class="filename">make oldconfig</code>.
                By making use of <code class="filename">inherit kernel</code> and
                potentially some of the <code class="filename">linux-*.inc</code> files,
                most other functionality is centralized and the defaults of the
                class normally work well.
            </p><p>
                If you are extending an existing kernel recipe, it is usually
                a matter of adding a suitable <code class="filename">defconfig</code>
                file.
                The file needs to be added into a location similar to
                <code class="filename">defconfig</code> files used for other machines
                in a given kernel recipe.
                A possible way to do this is by listing the file in the
                <code class="filename">SRC_URI</code> and adding the machine to the
                expression in
                <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-COMPATIBLE_MACHINE" target="_top">COMPATIBLE_MACHINE</a></code>:
                </p><pre class="literallayout">
     COMPATIBLE_MACHINE = '(qemux86|qemumips)'
                </pre><p>
                For more information on <code class="filename">defconfig</code> files,
                see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html#changing-the-configuration" target="_top">Changing the Configuration</a>"
                section in the Yocto Project Linux Kernel Development Manual.
            </p></div><div class="section" title="5.4.3. Adding a Formfactor Configuration File"><div class="titlepage"><div><div><h3 class="title" id="platdev-newmachine-formfactor">5.4.3. Adding a Formfactor Configuration File<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-newmachine-formfactor">¶</a></span></h3></div></div></div><p>
                A formfactor configuration file provides information about the
                target hardware for which the image is being built and information that
                the build system cannot obtain from other sources such as the kernel.
                Some examples of information contained in a formfactor configuration file include
                framebuffer orientation, whether or not the system has a keyboard,
                the positioning of the keyboard in relation to the screen, and
                the screen resolution.
            </p><p>
                The build system uses reasonable defaults in most cases.
                However, if customization is
                necessary, you need to create a <code class="filename">machconfig</code> file
                in the <code class="filename">meta/recipes-bsp/formfactor/files</code>
                directory.
                This directory contains directories for specific machines such as
                <code class="filename">qemuarm</code> and <code class="filename">qemux86</code>.
                For information about the settings available and the defaults, see the
                <code class="filename">meta/recipes-bsp/formfactor/files/config</code> file found in the
                same area.
            </p><p>
                Following is an example for "qemuarm" machine:
                </p><pre class="literallayout">
     HAVE_TOUCHSCREEN=1
     HAVE_KEYBOARD=1

     DISPLAY_CAN_ROTATE=0
     DISPLAY_ORIENTATION=0
     #DISPLAY_WIDTH_PIXELS=640
     #DISPLAY_HEIGHT_PIXELS=480
     #DISPLAY_BPP=16
     DISPLAY_DPI=150
     DISPLAY_SUBPIXEL_ORDER=vrgb
                </pre><p>
            </p></div></div><div class="section" title="5.5. Building Targets with Multiple Configurations"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="platdev-building-targets-with-multiple-configurations">5.5. Building Targets with Multiple Configurations<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-building-targets-with-multiple-configurations">¶</a></span></h2></div></div></div><p>
            Bitbake also has functionality that allows you to build
            multiple targets at the same time, where each target uses
            a different configuration.
        </p><p>
            In order to accomplish this, you setup each of the configurations
            you need to use in parallel by placing the configuration files in
            your current build directory alongside the usual
            <code class="filename">local.conf</code> file.
        </p><p>
            Follow these guidelines to create an environment that supports
            multiple configurations:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    <span class="emphasis"><em>Create Configuration Files</em></span>:
                    You need to create a single configuration file for each
                    configuration for which you want to add support.
                    These files would contain lines such as the following:
                    </p><pre class="literallayout">
     MACHINE = "A"
                    </pre><p>
                    The files would contain any other variables that can
                    be set and built in the same directory.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        You can change the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TMPDIR" target="_top"><code class="filename">TMPDIR</code></a>
                        to not conflict.
                    </div><p>
                    Furthermore, the configuration file must be located in the
                    current build directory in a directory named
                    <code class="filename">multiconfig</code> under the build's
                    <code class="filename">conf</code> directory where
                    <code class="filename">local.conf</code> resides.
                    The reason for this restriction is because the
                    <code class="filename">BBPATH</code> variable is not constructed
                    until the layers are parsed.
                    Consequently, using the configuration file as a
                    pre-configuration file is not possible unless it is
                    located in the current working directory.
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Add the BitBake Multi-Config Variable to you Local Configuration File</em></span>:
                    Use the
                    <code class="filename">BBMULTICONFIG</code>
                    variable in your <code class="filename">conf/local.conf</code>
                    configuration file to specify each separate configuration.
                    For example, the following line tells BitBake it should load
                    <code class="filename">conf/multiconfig/configA.conf</code>,
                    <code class="filename">conf/multiconfig/configB.conf</code>, and
                    <code class="filename">conf/multiconfig/configC.conf</code>.
                    </p><pre class="literallayout">
     BBMULTICONFIG = "configA configB configC"
                    </pre><p>
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Launch BitBake</em></span>:
                    Use the following BitBake command form to launch the
                    build:
                    </p><pre class="literallayout">
     $ bitbake [multiconfig:<em class="replaceable"><code>multiconfigname</code></em>:]<em class="replaceable"><code>target</code></em> [[[multiconfig:<em class="replaceable"><code>multiconfigname</code></em>:]<em class="replaceable"><code>target</code></em>] ... ]
                    </pre><p>
                    Following is an example that supports building a minimal
                    image for configuration A alongside a standard
                    <code class="filename">core-image-sato</code>, which takes its
                    configuration from <code class="filename">local.conf</code>:
                    </p><pre class="literallayout">
     $ bitbake multiconfig:configA:core-image-minimal core-image-sato
                    </pre><p>
                    </p></li></ul></div><p>
        </p><p>
            Support for multiple configurations in this current release of
            the Yocto Project (Pyro 2.3) has some known issues:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    No inter-multi-configuration dependencies exist.
                    </p></li><li class="listitem"><p>
                    Shared State (sstate) optimizations do not exist.
                    Consequently, if the build uses the same object twice
                    in, for example, two different
                    <code class="filename">TMPDIR</code> directories, the build
                    will either load from an existing sstate cache at the
                    start or build the object twice.
                    </p></li></ul></div><p>
        </p></div><div class="section" title="5.6. Working With Libraries"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="platdev-working-with-libraries">5.6. Working With Libraries<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-working-with-libraries">¶</a></span></h2></div></div></div><p>
            Libraries are an integral part of your system.
            This section describes some common practices you might find
            helpful when working with libraries to build your system:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="#including-static-library-files" title="5.6.1. Including Static Library Files">How to include static library files</a>
                    </p></li><li class="listitem"><p><a class="link" href="#combining-multiple-versions-library-files-into-one-image" title="5.6.2. Combining Multiple Versions of Library Files into One Image">How to use the Multilib feature to combine multiple versions of library files into a single image</a>
                    </p></li><li class="listitem"><p><a class="link" href="#installing-multiple-versions-of-the-same-library" title="5.6.3. Installing Multiple Versions of the Same Library">How to install multiple versions of the same library in parallel on the same system</a>
                    </p></li></ul></div><p>
        </p><div class="section" title="5.6.1. Including Static Library Files"><div class="titlepage"><div><div><h3 class="title" id="including-static-library-files">5.6.1. Including Static Library Files<span class="permalink"><a alt="Permalink" title="Permalink" href="#including-static-library-files">¶</a></span></h3></div></div></div><p>
                If you are building a library and the library offers static linking, you can control
                which static library files (<code class="filename">*.a</code> files) get included in the
                built library.
            </p><p>
                The <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES" target="_top"><code class="filename">PACKAGES</code></a>
                and <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILES" target="_top"><code class="filename">FILES_*</code></a>
                variables in the
                <code class="filename">meta/conf/bitbake.conf</code> configuration file define how files installed
                by the <code class="filename">do_install</code> task are packaged.
                By default, the <code class="filename">PACKAGES</code> variable includes
                <code class="filename">${PN}-staticdev</code>, which represents all static library files.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Some previously released versions of the Yocto Project
                    defined the static library files through
                    <code class="filename">${PN}-dev</code>.
                </div><p>
                Following is part of the BitBake configuration file, where
                you can see how the static library files are defined:
                </p><pre class="literallayout">
     PACKAGE_BEFORE_PN ?= ""
     PACKAGES = "${PN}-dbg ${PN}-staticdev ${PN}-dev ${PN}-doc ${PN}-locale ${PACKAGE_BEFORE_PN} ${PN}"
     PACKAGES_DYNAMIC = "^${PN}-locale-.*"
     FILES = ""

     FILES_${PN} = "${bindir}/* ${sbindir}/* ${libexecdir}/* ${libdir}/lib*${SOLIBS} \
                 ${sysconfdir} ${sharedstatedir} ${localstatedir} \
                 ${base_bindir}/* ${base_sbindir}/* \
                 ${base_libdir}/*${SOLIBS} \
                 ${base_prefix}/lib/udev/rules.d ${prefix}/lib/udev/rules.d \
                 ${datadir}/${BPN} ${libdir}/${BPN}/* \
                 ${datadir}/pixmaps ${datadir}/applications \
                 ${datadir}/idl ${datadir}/omf ${datadir}/sounds \
                 ${libdir}/bonobo/servers"

     FILES_${PN}-bin = "${bindir}/* ${sbindir}/*"

     FILES_${PN}-doc = "${docdir} ${mandir} ${infodir} ${datadir}/gtk-doc \
                 ${datadir}/gnome/help"
     SECTION_${PN}-doc = "doc"

     FILES_SOLIBSDEV ?= "${base_libdir}/lib*${SOLIBSDEV} ${libdir}/lib*${SOLIBSDEV}"
     FILES_${PN}-dev = "${includedir} ${FILES_SOLIBSDEV} ${libdir}/*.la \
                     ${libdir}/*.o ${libdir}/pkgconfig ${datadir}/pkgconfig \
                     ${datadir}/aclocal ${base_libdir}/*.o \
                     ${libdir}/${BPN}/*.la ${base_libdir}/*.la"
     SECTION_${PN}-dev = "devel"
     ALLOW_EMPTY_${PN}-dev = "1"
     RDEPENDS_${PN}-dev = "${PN} (= ${EXTENDPKGV})"

     FILES_${PN}-staticdev = "${libdir}/*.a ${base_libdir}/*.a ${libdir}/${BPN}/*.a"
     SECTION_${PN}-staticdev = "devel"
     RDEPENDS_${PN}-staticdev = "${PN}-dev (= ${EXTENDPKGV})"
                </pre><p>
            </p></div><div class="section" title="5.6.2. Combining Multiple Versions of Library Files into One Image"><div class="titlepage"><div><div><h3 class="title" id="combining-multiple-versions-library-files-into-one-image">5.6.2. Combining Multiple Versions of Library Files into One Image<span class="permalink"><a alt="Permalink" title="Permalink" href="#combining-multiple-versions-library-files-into-one-image">¶</a></span></h3></div></div></div><p>
                The build system offers the ability to build libraries with different
                target optimizations or architecture formats and combine these together
                into one system image.
                You can link different binaries in the image
                against the different libraries as needed for specific use cases.
                This feature is called "Multilib."
            </p><p>
                An example would be where you have most of a system compiled in 32-bit
                mode using 32-bit libraries, but you have something large, like a database
                engine, that needs to be a 64-bit application and uses 64-bit libraries.
                Multilib allows you to get the best of both 32-bit and 64-bit libraries.
            </p><p>
                While the Multilib feature is most commonly used for 32 and 64-bit differences,
                the approach the build system uses facilitates different target optimizations.
                You could compile some binaries to use one set of libraries and other binaries
                to use a different set of libraries.
                The libraries could differ in architecture, compiler options, or other
                optimizations.
            </p><p>
                Several examples exist in the
                <code class="filename">meta-skeleton</code> layer found in the
               <a class="link" href="#source-directory">Source Directory</a>:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">conf/multilib-example.conf</code>
                        configuration file</p></li><li class="listitem"><p><code class="filename">conf/multilib-example2.conf</code>
                        configuration file</p></li><li class="listitem"><p><code class="filename">recipes-multilib/images/core-image-multilib-example.bb</code>
                        recipe</p></li></ul></div><p>
            </p><div class="section" title="5.6.2.1. Preparing to Use Multilib"><div class="titlepage"><div><div><h4 class="title" id="preparing-to-use-multilib">5.6.2.1. Preparing to Use Multilib<span class="permalink"><a alt="Permalink" title="Permalink" href="#preparing-to-use-multilib">¶</a></span></h4></div></div></div><p>
                    User-specific requirements drive the Multilib feature.
                    Consequently, there is no one "out-of-the-box" configuration that likely
                    exists to meet your needs.
                </p><p>
                    In order to enable Multilib, you first need to ensure your recipe is
                    extended to support multiple libraries.
                    Many standard recipes are already extended and support multiple libraries.
                    You can check in the <code class="filename">meta/conf/multilib.conf</code>
                    configuration file in the
                    <a class="link" href="#source-directory">Source Directory</a> to see how this is
                    done using the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBCLASSEXTEND" target="_top"><code class="filename">BBCLASSEXTEND</code></a>
                    variable.
                    Eventually, all recipes will be covered and this list will
                    not be needed.
                </p><p>
                    For the most part, the Multilib class extension works automatically to
                    extend the package name from <code class="filename">${PN}</code> to
                    <code class="filename">${MLPREFIX}${PN}</code>, where <code class="filename">MLPREFIX</code>
                    is the particular multilib (e.g. "lib32-" or "lib64-").
                    Standard variables such as
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RDEPENDS" target="_top"><code class="filename">RDEPENDS</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RPROVIDES" target="_top"><code class="filename">RPROVIDES</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RRECOMMENDS" target="_top"><code class="filename">RRECOMMENDS</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES" target="_top"><code class="filename">PACKAGES</code></a>, and
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES_DYNAMIC" target="_top"><code class="filename">PACKAGES_DYNAMIC</code></a>
                    are automatically extended by the system.
                    If you are extending any manual code in the recipe, you can use the
                    <code class="filename">${MLPREFIX}</code> variable to ensure those names are extended
                    correctly.
                    This automatic extension code resides in <code class="filename">multilib.bbclass</code>.
                </p></div><div class="section" title="5.6.2.2. Using Multilib"><div class="titlepage"><div><div><h4 class="title" id="using-multilib">5.6.2.2. Using Multilib<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-multilib">¶</a></span></h4></div></div></div><p>
                    After you have set up the recipes, you need to define the actual
                    combination of multiple libraries you want to build.
                    You accomplish this through your <code class="filename">local.conf</code>
                    configuration file in the
                    <a class="link" href="#build-directory">Build Directory</a>.
                    An example configuration would be as follows:
                    </p><pre class="literallayout">
     MACHINE = "qemux86-64"
     require conf/multilib.conf
     MULTILIBS = "multilib:lib32"
     DEFAULTTUNE_virtclass-multilib-lib32 = "x86"
     IMAGE_INSTALL_append = " lib32-glib-2.0"
                    </pre><p>
                    This example enables an
                    additional library named <code class="filename">lib32</code> alongside the
                    normal target packages.
                    When combining these "lib32" alternatives, the example uses "x86" for tuning.
                    For information on this particular tuning, see
                    <code class="filename">meta/conf/machine/include/ia32/arch-ia32.inc</code>.
                </p><p>
                    The example then includes <code class="filename">lib32-glib-2.0</code>
                    in all the images, which illustrates one method of including a
                    multiple library dependency.
                    You can use a normal image build to include this dependency,
                    for example:
                    </p><pre class="literallayout">
     $ bitbake core-image-sato
                    </pre><p>
                    You can also build Multilib packages specifically with a command like this:
                    </p><pre class="literallayout">
     $ bitbake lib32-glib-2.0
                    </pre><p>
                </p></div><div class="section" title="5.6.2.3. Additional Implementation Details"><div class="titlepage"><div><div><h4 class="title" id="additional-implementation-details">5.6.2.3. Additional Implementation Details<span class="permalink"><a alt="Permalink" title="Permalink" href="#additional-implementation-details">¶</a></span></h4></div></div></div><p>
                    Generic implementation details as well as details that are
                    specific to package management systems exist.
                    Following are implementation details that exist regardless
                    of the package management system:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The typical convention used for the
                            class extension code as used by
                            Multilib assumes that all package names specified
                            in
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES" target="_top"><code class="filename">PACKAGES</code></a>
                            that contain <code class="filename">${PN}</code> have
                            <code class="filename">${PN}</code> at the start of the name.
                            When that convention is not followed and
                            <code class="filename">${PN}</code> appears at
                            the middle or the end of a name, problems occur.
                            </p></li><li class="listitem"><p>The
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TARGET_VENDOR" target="_top"><code class="filename">TARGET_VENDOR</code></a>
                            value under Multilib will be extended to
                            "-<em class="replaceable"><code>vendor</code></em>ml<em class="replaceable"><code>multilib</code></em>"
                            (e.g. "-pokymllib32" for a "lib32" Multilib with
                            Poky).
                            The reason for this slightly unwieldy contraction
                            is that any "-" characters in the vendor
                            string presently break Autoconf's
                            <code class="filename">config.sub</code>, and
                            other separators are problematic for different
                            reasons.
                            </p></li></ul></div><p>
                </p><p>
                    For the RPM Package Management System, the following implementation details
                    exist:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A unique architecture is defined for the Multilib packages,
                            along with creating a unique deploy folder under
                            <code class="filename">tmp/deploy/rpm</code> in the
                            <a class="link" href="#build-directory">Build Directory</a>.
                            For example, consider <code class="filename">lib32</code> in a
                            <code class="filename">qemux86-64</code> image.
                            The possible architectures in the system are "all", "qemux86_64",
                            "lib32_qemux86_64", and "lib32_x86".</p></li><li class="listitem"><p>The <code class="filename">${MLPREFIX}</code> variable is stripped from
                            <code class="filename">${PN}</code> during RPM packaging.
                            The naming for a normal RPM package and a Multilib RPM package in a
                            <code class="filename">qemux86-64</code> system resolves to something similar to
                            <code class="filename">bash-4.1-r2.x86_64.rpm</code> and
                            <code class="filename">bash-4.1.r2.lib32_x86.rpm</code>, respectively.
                            </p></li><li class="listitem"><p>When installing a Multilib image, the RPM backend first
                            installs the base image and then installs the Multilib libraries.
                            </p></li><li class="listitem"><p>The build system relies on RPM to resolve the identical files in the
                            two (or more) Multilib packages.</p></li></ul></div><p>
                </p><p>
                    For the IPK Package Management System, the following implementation details exist:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The <code class="filename">${MLPREFIX}</code> is not stripped from
                            <code class="filename">${PN}</code> during IPK packaging.
                            The naming for a normal RPM package and a Multilib IPK package in a
                            <code class="filename">qemux86-64</code> system resolves to something like
                            <code class="filename">bash_4.1-r2.x86_64.ipk</code> and
                            <code class="filename">lib32-bash_4.1-rw_x86.ipk</code>, respectively.
                            </p></li><li class="listitem"><p>The IPK deploy folder is not modified with
                            <code class="filename">${MLPREFIX}</code> because packages with and without
                            the Multilib feature can exist in the same folder due to the
                            <code class="filename">${PN}</code> differences.</p></li><li class="listitem"><p>IPK defines a sanity check for Multilib installation
                            using certain rules for file comparison, overridden, etc.
                            </p></li></ul></div><p>
                </p></div></div><div class="section" title="5.6.3. Installing Multiple Versions of the Same Library"><div class="titlepage"><div><div><h3 class="title" id="installing-multiple-versions-of-the-same-library">5.6.3. Installing Multiple Versions of the Same Library<span class="permalink"><a alt="Permalink" title="Permalink" href="#installing-multiple-versions-of-the-same-library">¶</a></span></h3></div></div></div><p>
                Situations can exist where you need to install and use
                multiple versions of the same library on the same system
                at the same time.
                These situations almost always exist when a library API
                changes and you have multiple pieces of software that
                depend on the separate versions of the library.
                To accommodate these situations, you can install multiple
                versions of the same library in parallel on the same system.
            </p><p>
                The process is straightforward as long as the libraries use
                proper versioning.
                With properly versioned libraries, all you need to do to
                individually specify the libraries is create separate,
                appropriately named recipes where the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a> part of the
                name includes a portion that differentiates each library version
                (e.g.the major part of the version number).
                Thus, instead of having a single recipe that loads one version
                of a library (e.g. <code class="filename">clutter</code>), you provide
                multiple recipes that result in different versions
                of the libraries you want.
                As an example, the following two recipes would allow the
                two separate versions of the <code class="filename">clutter</code>
                library to co-exist on the same system:
                </p><pre class="literallayout">
     clutter-1.6_1.6.20.bb
     clutter-1.8_1.8.4.bb
                </pre><p>
                Additionally, if you have other recipes that depend on a given
                library, you need to use the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>
                variable to create the dependency.
                Continuing with the same example, if you want to have a recipe
                depend on the 1.8 version of the <code class="filename">clutter</code>
                library, use the following in your recipe:
                </p><pre class="literallayout">
     DEPENDS = "clutter-1.8"
                </pre><p>
            </p></div></div><div class="section" title="5.7. Enabling GObject Introspection Support"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="enabling-gobject-introspection-support">5.7. Enabling GObject Introspection Support<span class="permalink"><a alt="Permalink" title="Permalink" href="#enabling-gobject-introspection-support">¶</a></span></h2></div></div></div><p>
            <a class="ulink" href="https://wiki.gnome.org/Projects/GObjectIntrospection" target="_top">GObject introspection</a>
            is the standard mechanism for accessing GObject-based software
            from runtime environments.
            GObject is a feature of the GLib library that provides an object
            framework for the GNOME desktop and related software.
            GObject Introspection adds information to GObject that allows
            objects created within it to be represented across different
            programming languages.
            If you want to construct GStreamer pipelines using Python, or
            control UPnP infrastructure using Javascript and GUPnP,
            GObject introspection is the only way to do it.
        </p><p>
            This section describes the Yocto Project support for generating
            and packaging GObject introspection data.
            GObject introspection data is a description of the
            API provided by libraries built on top of GLib framework,
            and, in particular, that framework's GObject mechanism.
            GObject Introspection Repository (GIR) files go to
            <code class="filename">-dev</code> packages,
            <code class="filename">typelib</code> files go to main packages as they
            are packaged together with libraries that are introspected.
        </p><p>
            The data is generated when building such a library, by linking
            the library with a small executable binary that asks the library
            to describe itself, and then executing the binary and
            processing its output.
        </p><p>
            Generating this data in a cross-compilation environment
            is difficult because the library is produced for the target
            architecture, but its code needs to be executed on the build host.
            This problem is solved with the OpenEmbedded build system by
            running the code through QEMU, which allows precisely that.
            Unfortunately, QEMU does not always work perfectly as mentioned
            in the xxx section.
        </p><div class="section" title="5.7.1. Enabling the Generation of Introspection Data"><div class="titlepage"><div><div><h3 class="title" id="enabling-the-generation-of-introspection-data">5.7.1. Enabling the Generation of Introspection Data<span class="permalink"><a alt="Permalink" title="Permalink" href="#enabling-the-generation-of-introspection-data">¶</a></span></h3></div></div></div><p>
                Enabling the generation of introspection data (GIR files)
                in your library package involves the following:
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                        Inherit the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-gobject-introspection" target="_top"><code class="filename">gobject-introspection</code></a>
                        class.
                        </p></li><li class="listitem"><p>
                        Make sure introspection is not disabled anywhere in
                        the recipe or from anything the recipe includes.
                        Also, make sure that "gobject-introspection-data" is
                        not in
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_FEATURES_BACKFILL_CONSIDERED" target="_top"><code class="filename">DISTRO_FEATURES_BACKFILL_CONSIDERED</code></a>
                        and that "qemu-usermode" is not in
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE_FEATURES_BACKFILL_CONSIDERED" target="_top"><code class="filename">MACHINE_FEATURES_BACKFILL_CONSIDERED</code></a>.
                        If either of these conditions exist, nothing will
                        happen.
                        </p></li><li class="listitem"><p>
                        Try to build the recipe.
                        If you encounter build errors that look like
                        something is unable to find
                        <code class="filename">.so</code> libraries, check where these
                        libraries are located in the source tree and add
                        the following to the recipe:
                        </p><pre class="literallayout">
     GIR_EXTRA_LIBS_PATH = "${B}/<em class="replaceable"><code>something</code></em>/.libs"
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            See recipes in the <code class="filename">oe-core</code>
                            repository that use that
                            <code class="filename">GIR_EXTRA_LIBS_PATH</code> variable
                            as an example.
                        </div><p>
                        </p></li><li class="listitem"><p>
                        Look for any other errors, which probably mean that
                        introspection support in a package is not entirely
                        standard, and thus breaks down in a cross-compilation
                        environment.
                        For such cases, custom-made fixes are needed.
                        A good place to ask and receive help in these cases
                        is the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#resources-mailinglist" target="_top">Yocto Project mailing lists</a>.
                        </p></li></ol></div><p>
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Using a library that no longer builds against the latest
                    Yocto Project release and prints introspection related
                    errors is a good candidate for the previous procedure.
                </div><p>
            </p></div><div class="section" title="5.7.2. Disabling the Generation of Introspection Data"><div class="titlepage"><div><div><h3 class="title" id="disabling-the-generation-of-introspection-data">5.7.2. Disabling the Generation of Introspection Data<span class="permalink"><a alt="Permalink" title="Permalink" href="#disabling-the-generation-of-introspection-data">¶</a></span></h3></div></div></div><p>
                You might find that you do not want to generate
                introspection data.
                Or, perhaps QEMU does not work on your build host and
                target architecture combination.
                If so, you can use either of the following methods to
                disable GIR file generations:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        Add the following to your distro configuration:
                        </p><pre class="literallayout">
     DISTRO_FEATURES_BACKFILL_CONSIDERED = "gobject-introspection-data"
                        </pre><p>
                        Adding this statement disables generating
                        introspection data using QEMU but will still enable
                        building introspection tools and libraries
                        (i.e. building them does not require the use of QEMU).
                        </p></li><li class="listitem"><p>
                        Add the following to your machine configuration:
                        </p><pre class="literallayout">
     MACHINE_FEATURES_BACKFILL_CONSIDERED = "qemu-usermode"
                        </pre><p>
                        Adding this statement disables the use of QEMU
                        when building packages for your machine.
                        Currently, this feature is used only by introspection
                        recipes and has the same effect as the previously
                        described option.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            Future releases of the Yocto Project might have
                            other features affected by this option.
                        </div><p>
                        </p></li></ul></div><p>
                If you disable introspection data, you can still
                obtain it through other means such as copying the data
                from a suitable sysroot, or by generating it on the
                target hardware.
                The OpenEmbedded build system does not currently
                provide specific support for these techniques.
            </p></div><div class="section" title="5.7.3. Testing that Introspection Works in an Image"><div class="titlepage"><div><div><h3 class="title" id="testing-that-introspection-works-in-an-image">5.7.3. Testing that Introspection Works in an Image<span class="permalink"><a alt="Permalink" title="Permalink" href="#testing-that-introspection-works-in-an-image">¶</a></span></h3></div></div></div><p>
                Use the following procedure to test if generating
                introspection data is working in an image:
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                        Make sure that "gobject-introspection-data" is not in
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_FEATURES_BACKFILL_CONSIDERED" target="_top"><code class="filename">DISTRO_FEATURES_BACKFILL_CONSIDERED</code></a>
                        and that "qemu-usermode" is not in
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE_FEATURES_BACKFILL_CONSIDERED" target="_top"><code class="filename">MACHINE_FEATURES_BACKFILL_CONSIDERED</code></a>.
                        </p></li><li class="listitem"><p>
                        Build <code class="filename">core-image-sato</code>.
                        </p></li><li class="listitem"><p>
                        Launch a Terminal and then start Python in the
                        terminal.
                        </p></li><li class="listitem"><p>
                        Enter the following in the terminal:
                        </p><pre class="literallayout">
     &gt;&gt;&gt; from gi.repository import GLib
     &gt;&gt;&gt; GLib.get_host_name()
                        </pre><p>
                        </p></li><li class="listitem"><p>
                        For something a little more advanced, enter the
                        following:
                        </p><pre class="literallayout">
     http://python-gtk-3-tutorial.readthedocs.org/en/latest/introduction.html
                        </pre><p>
                        </p></li></ol></div><p>
            </p></div><div class="section" title="5.7.4. Known Issues"><div class="titlepage"><div><div><h3 class="title" id="known-issues">5.7.4. Known Issues<span class="permalink"><a alt="Permalink" title="Permalink" href="#known-issues">¶</a></span></h3></div></div></div><p>
                The following know issues exist for
                GObject Introspection Support:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        <code class="filename">qemu-ppc64</code> immediately crashes.
                        Consequently, you cannot build introspection data on
                        that architecture.
                        </p></li><li class="listitem"><p>
                        x32 is not supported by QEMU.
                        Consequently, introspection data is disabled.
                        </p></li><li class="listitem"><p>
                        musl causes transient GLib binaries to crash on
                        assertion failures.
                        Consequently, generating introspection data is
                        disabled.
                        </p></li><li class="listitem"><p>
                        Because QEMU is not able to run the binaries correctly,
                        introspection is disabled for some specific packages
                        under specific architectures (e.g.
                        <code class="filename">gcr</code>,
                        <code class="filename">libsecret</code>, and
                        <code class="filename">webkit</code>).
                        </p></li><li class="listitem"><p>
                        QEMU usermode might not work properly when running
                        64-bit binaries under 32-bit host machines.
                        In particular, "qemumips64" is known to not work under
                        i686.
                        </p></li></ul></div><p>
            </p></div></div><div class="section" title="5.8. Optionally Using an External Toolchain"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="dev-optionally-using-an-external-toolchain">5.8. Optionally Using an External Toolchain<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-optionally-using-an-external-toolchain">¶</a></span></h2></div></div></div><p>
            You might want to use an external toolchain as part of your
            development.
            If this is the case, the fundamental steps you need to accomplish
            are as follows:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    Understand where the installed toolchain resides.
                    For cases where you need to build the external toolchain,
                    you would need to take separate steps to build and install
                    the toolchain.
                    </p></li><li class="listitem"><p>
                    Make sure you add the layer that contains the toolchain to
                    your <code class="filename">bblayers.conf</code> file through the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBLAYERS" target="_top"><code class="filename">BBLAYERS</code></a>
                    variable.
                    </p></li><li class="listitem"><p>
                    Set the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTERNAL_TOOLCHAIN" target="_top"><code class="filename">EXTERNAL_TOOLCHAIN</code></a>
                    variable in your <code class="filename">local.conf</code> file
                    to the location in which you installed the toolchain.
                    </p></li></ul></div><p>
            A good example of an external toolchain used with the Yocto Project
            is <span class="trademark">Mentor Graphics</span>®
            Sourcery G++ Toolchain.
            You can see information on how to use that particular layer in the
            <code class="filename">README</code> file at
            <a class="ulink" href="http://github.com/MentorEmbedded/meta-sourcery/" target="_top">http://github.com/MentorEmbedded/meta-sourcery/</a>.
            You can find further information by reading about the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TCMODE" target="_top"><code class="filename">TCMODE</code></a>
            variable in the Yocto Project Reference Manual's variable glossary.
        </p></div><div class="section" title="5.9. Creating Partitioned Images"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="creating-partitioned-images">5.9. Creating Partitioned Images<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-partitioned-images">¶</a></span></h2></div></div></div><p>
            Creating an image for a particular hardware target using the
            OpenEmbedded build system does not necessarily mean you can boot
            that image as is on your device.
            Physical devices accept and boot images in various ways depending
            on the specifics of the device.
            Usually, information about the hardware can tell you what image
            format the device requires.
            Should your device require multiple partitions on an SD card, flash,
            or an HDD, you can use the OpenEmbedded Image Creator,
	        Wic, to create the properly partitioned image.
        </p><p>
            You can generate partitioned images
            (<em class="replaceable"><code>image</code></em><code class="filename">.wic</code>)
            two ways: using the OpenEmbedded build system and by running
            the OpenEmbedded Image Creator Wic directly.
            The former way is preferable as it is easier to use and understand.
        </p><div class="section" title="5.9.1. Creating Partitioned Images"><div class="titlepage"><div><div><h3 class="title" id="creating-wic-images-oe">5.9.1. Creating Partitioned Images<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-wic-images-oe">¶</a></span></h3></div></div></div><p>
                The OpenEmbedded build system can generate
                partitioned images the same way as it generates
                any other image type.
                To generate a partitioned image, you need to modify
                two variables.
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        Include "wic" as part of the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FSTYPES" target="_top"><code class="filename">IMAGE_FSTYPES</code></a>
                        variable.
                        </p></li><li class="listitem"><p>
                        Include the name of the
                        <a class="link" href="#openembedded-kickstart-wks-reference" title="5.9.2.8. OpenEmbedded Kickstart (.wks) Reference">wic kickstart file</a>
                        as part of the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WKS_FILE" target="_top"><code class="filename">WKS_FILE</code></a>
                        variable
                        </p></li></ul></div><p>
                Further steps to generate a partitioned image
                are the same as for any other image type.
                For information on image types, see the
                "<a class="link" href="#building-images" title="2.3. Building Images">Building Images</a>"
                section.
            </p></div><div class="section" title="5.9.2. Using OpenEmbedded Image Creator Wic to Generate Partitioned Images"><div class="titlepage"><div><div><h3 class="title" id="create-wic-images-wic">5.9.2. Using OpenEmbedded Image Creator Wic to Generate Partitioned Images<span class="permalink"><a alt="Permalink" title="Permalink" href="#create-wic-images-wic">¶</a></span></h3></div></div></div><p>
                The <code class="filename">wic</code> command generates partitioned
                images from existing OpenEmbedded build artifacts.
                Image generation is driven by partitioning commands
                contained in an Openembedded kickstart file
                (<code class="filename">.wks</code>) specified either directly on
                the command line or as one of a selection of canned
                <code class="filename">.wks</code> files as shown with the
                <code class="filename">wic list images</code> command in the
                "<a class="link" href="#using-a-provided-kickstart-file" title="5.9.2.5. Using an Existing Kickstart File">Using an Existing Kickstart File</a>"
                section.
                When you apply the command to a given set of build
                artifacts, the result is an image or set of images that
                can be directly written onto media and used on a particular
                system.
            </p><p>
                The <code class="filename">wic</code> command and the infrastructure
                it is based on is by definition incomplete.
                The purpose of the command is to allow the generation of
                customized images, and as such, was designed to be
                completely extensible through a plug-in interface.
                See the
                "<a class="link" href="#openembedded-kickstart-plugins" title="5.9.2.7. Plug-ins">Plug-ins</a>"
                section for information on these plug-ins.
            </p><p>
                This section provides some background information on Wic,
                describes what you need to have in
                place to run the tool, provides instruction on how to use
                the <code class="filename">wic</code> utility,
                and provides several examples.
            </p><div class="section" title="5.9.2.1. Background"><div class="titlepage"><div><div><h4 class="title" id="wic-background">5.9.2.1. Background<span class="permalink"><a alt="Permalink" title="Permalink" href="#wic-background">¶</a></span></h4></div></div></div><p>
                    This section provides some background on the
                    <code class="filename">wic</code> utility.
                    While none of this information is required to use
                    Wic, you might find it interesting.
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            The name "Wic" is derived from OpenEmbedded
                            Image Creator (oeic).
                            The "oe" diphthong in "oeic" was promoted to the
                            letter "w", because "oeic" is both difficult to
                            remember and to pronounce.
                            </p></li><li class="listitem"><p>
                            Wic is loosely based on the
                            Meego Image Creator (<code class="filename">mic</code>)
                            framework.
                            The Wic implementation has been
                            heavily modified to make direct use of OpenEmbedded
                            build artifacts instead of package installation and
                            configuration, which are already incorporated within
                            the OpenEmbedded artifacts.
                            </p></li><li class="listitem"><p>
                            Wic is a completely independent
                            standalone utility that initially provides
                            easier-to-use and more flexible replacements for an
                            existing functionality in OE Core's
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-image-live" target="_top"><code class="filename">image-live</code></a>
                            class and <code class="filename">mkefidisk.sh</code> script.
                            The difference between
                            Wic and those examples is
                            that with Wic the
                            functionality of those scripts is implemented
                            by a general-purpose partitioning language, which is
                            based on Redhat kickstart syntax.</p></li></ul></div><p>
                </p></div><div class="section" title="5.9.2.2. Requirements"><div class="titlepage"><div><div><h4 class="title" id="wic-requirements">5.9.2.2. Requirements<span class="permalink"><a alt="Permalink" title="Permalink" href="#wic-requirements">¶</a></span></h4></div></div></div><p>
                    In order to use the <code class="filename">wic</code> utility
                    with the OpenEmbedded Build system, your system needs
                    to meet the following requirements:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The Linux distribution on your
                            development host must support the Yocto Project.
                            See the
                            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#detailed-supported-distros" target="_top">Supported Linux Distributions</a>"
                            section in the Yocto Project Reference Manual for
                            the list of distributions that support the
                            Yocto Project.
                            </p></li><li class="listitem"><p>
                            The standard system utilities, such as
                            <code class="filename">cp</code>, must be installed on your
                            development host system.
                            </p></li><li class="listitem"><p>
                            You need to have the build artifacts already
                            available, which typically means that you must
                            have already created an image using the
                            Openembedded build system (e.g.
                            <code class="filename">core-image-minimal</code>).
                            While it might seem redundant to generate an image
                            in order to create an image using
                            Wic, the current version of
                            Wic requires the artifacts
                            in the form generated by the build system.
                            </p></li><li class="listitem"><p>
                            You must build several native tools, which are tools
                            built to run on the build system:
                            </p><pre class="literallayout">
     $ bitbake parted-native dosfstools-native mtools-native
                            </pre><p>
                            </p></li><li class="listitem"><p>
                            You must have sourced one of the build environment
                            setup scripts (i.e.
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                            or
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>)
                            found in the
                            <a class="link" href="#build-directory">Build Directory</a>.
                            </p></li></ul></div><p>
                </p></div><div class="section" title="5.9.2.3. Getting Help"><div class="titlepage"><div><div><h4 class="title" id="wic-getting-help">5.9.2.3. Getting Help<span class="permalink"><a alt="Permalink" title="Permalink" href="#wic-getting-help">¶</a></span></h4></div></div></div><p>
                    You can get general help for the <code class="filename">wic</code>
                    command by entering the <code class="filename">wic</code> command
                    by itself or by entering the command with a help argument
                    as follows:
                    </p><pre class="literallayout">
     $ wic -h
     $ wic --help
                    </pre><p>
                </p><p>
                    Currently, Wic supports two commands:
                    <code class="filename">create</code> and <code class="filename">list</code>.
                    You can get help for these commands as follows:
                    </p><pre class="literallayout">
     $ wic help <em class="replaceable"><code>command</code></em>
                    with <em class="replaceable"><code>command</code></em> being either
                    <code class="filename">create</code> or <code class="filename">list</code>.
                    </pre><p>
                </p><p>
                    You can also get detailed help on a number of topics
                    from the help system.
                    The output of <code class="filename">wic --help</code>
                    displays a list of available help
                    topics under a "Help topics" heading.
                    You can have the help system display the help text for
                    a given topic by prefacing the topic with
                    <code class="filename">wic help</code>:
                    </p><pre class="literallayout">
     $ wic help <em class="replaceable"><code>help_topic</code></em>
                    </pre><p>
                </p><p>
                    You can find out more about the images
                    Wic creates using the existing
                    kickstart files with the following form of the command:
                    </p><pre class="literallayout">
     $ wic list <em class="replaceable"><code>image</code></em> help
                    </pre><p>
                    with <code class="filename"><em class="replaceable"><code>image</code></em></code>
                    being either <code class="filename">directdisk</code> or
                    <code class="filename">mkefidisk</code>.
                </p></div><div class="section" title="5.9.2.4. Operational Modes"><div class="titlepage"><div><div><h4 class="title" id="operational-modes">5.9.2.4. Operational Modes<span class="permalink"><a alt="Permalink" title="Permalink" href="#operational-modes">¶</a></span></h4></div></div></div><p>
                    You can use Wic in two different
                    modes, depending on how much control you need for
                    specifying the Openembedded build artifacts that are
                    used for creating the image: Raw and Cooked:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <span class="emphasis"><em>Raw Mode:</em></span>
                            You explicitly specify build artifacts through
                            command-line arguments.
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Cooked Mode:</em></span>
                            The current
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                            setting and image name are used to automatically
                            locate and provide the build artifacts.
                            </p></li></ul></div><p>
                </p><p>
                    Regardless of the mode you use, you need to have the build
                    artifacts ready and available.
                    Additionally, the environment must be set up using the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                    or
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>
                    script found in the
                    <a class="link" href="#build-directory">Build Directory</a>.
                </p><div class="section" title="5.9.2.4.1. Raw Mode"><div class="titlepage"><div><div><h5 class="title" id="raw-mode">5.9.2.4.1. Raw Mode<span class="permalink"><a alt="Permalink" title="Permalink" href="#raw-mode">¶</a></span></h5></div></div></div><p>
                        The general form of the
                        <code class="filename">wic</code> command in raw mode is:
                        </p><pre class="literallayout">
     $ wic create <em class="replaceable"><code>image_name</code></em>.wks [<em class="replaceable"><code>options</code></em>] [...]

       Where:

          <em class="replaceable"><code>image_name</code></em>.wks
             An OpenEmbedded kickstart file.  You can provide
             your own custom file or use a file from a set of
             existing files as described by further options.

          -o <em class="replaceable"><code>OUTDIR</code></em>, --outdir=<em class="replaceable"><code>OUTDIR</code></em>
             The name of a directory in which to create image.

          -i <em class="replaceable"><code>PROPERTIES_FILE</code></em>, --infile=<em class="replaceable"><code>PROPERTIES_FILE</code></em>
             The name of a file containing the values for image
             properties as a JSON file.

          -e <em class="replaceable"><code>IMAGE_NAME</code></em>, --image-name=<em class="replaceable"><code>IMAGE_NAME</code></em>
             The name of the image from which to use the artifacts
             (e.g. <code class="filename">core-image-sato</code>).

          -r <em class="replaceable"><code>ROOTFS_DIR</code></em>, --rootfs-dir=<em class="replaceable"><code>ROOTFS_DIR</code></em>
             The path to the <code class="filename">/rootfs</code> directory to use as the
             <code class="filename">.wks</code> rootfs source.

          -b <em class="replaceable"><code>BOOTIMG_DIR</code></em>, --bootimg-dir=<em class="replaceable"><code>BOOTIMG_DIR</code></em>
             The path to the directory containing the boot artifacts
             (e.g. <code class="filename">/EFI</code> or <code class="filename">/syslinux</code>) to use as the <code class="filename">.wks</code> bootimg
             source.

          -k <em class="replaceable"><code>KERNEL_DIR</code></em>, --kernel-dir=<em class="replaceable"><code>KERNEL_DIR</code></em>
             The path to the directory containing the kernel to use
             in the <code class="filename">.wks</code> boot image.

          -n <em class="replaceable"><code>NATIVE_SYSROOT</code></em>, --native-sysroot=<em class="replaceable"><code>NATIVE_SYSROOT</code></em>
             The path to the native sysroot containing the tools to use
             to build the image.

          -s, --skip-build-check
              Skips the build check.

          -D, --debug
              Output debug information.
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            You do not need root privileges to run
                            Wic.
                            In fact, you should not run as root when using the
                            utility.
                        </div><p>
                    </p></div><div class="section" title="5.9.2.4.2. Cooked Mode"><div class="titlepage"><div><div><h5 class="title" id="cooked-mode">5.9.2.4.2. Cooked Mode<span class="permalink"><a alt="Permalink" title="Permalink" href="#cooked-mode">¶</a></span></h5></div></div></div><p>
                        The general form of the <code class="filename">wic</code> command
                        using Cooked Mode is:
                        </p><pre class="literallayout">
     $ wic create <em class="replaceable"><code>kickstart_file</code></em> -e <em class="replaceable"><code>image_name</code></em>

       Where:

           <em class="replaceable"><code>kickstart_file</code></em>
               An OpenEmbedded kickstart file. You can provide your own
               custom file or a supplied file.

           <em class="replaceable"><code>image_name</code></em>
               Specifies the image built using the OpenEmbedded build
               system.
                        </pre><p>
                        This form is the simplest and most user-friendly, as it
                        does not require specifying all individual parameters.
                        All you need to provide is your own
                        <code class="filename">.wks</code> file or one provided with the
                        release.
                    </p></div></div><div class="section" title="5.9.2.5. Using an Existing Kickstart File"><div class="titlepage"><div><div><h4 class="title" id="using-a-provided-kickstart-file">5.9.2.5. Using an Existing Kickstart File<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-a-provided-kickstart-file">¶</a></span></h4></div></div></div><p>
                    If you do not want to create your own
                    <code class="filename">.wks</code> file, you can use an existing
                    file provided by the Wic installation.
                    Use the following command to list the available files:
                    </p><pre class="literallayout">
     $ wic list images
     directdisk Create a 'pcbios' direct disk image
     mkefidisk Create an EFI disk image
                    </pre><p>
                    When you use an existing file, you do not have to use the
                    <code class="filename">.wks</code> extension.
                    Here is an example in Raw Mode that uses the
                    <code class="filename">directdisk</code> file:
                    </p><pre class="literallayout">
     $ wic create directdisk -r <em class="replaceable"><code>rootfs_dir</code></em> -b <em class="replaceable"><code>bootimg_dir</code></em> \
           -k <em class="replaceable"><code>kernel_dir</code></em> -n <em class="replaceable"><code>native_sysroot</code></em>
                    </pre><p>
                </p><p>
                    Here are the actual partition language commands
                    used in the <code class="filename">mkefidisk.wks</code> file to
                    generate an image:
                    </p><pre class="literallayout">
     # short-description: Create an EFI disk image
     # long-description: Creates a partitioned EFI disk image that the user
     # can directly dd to boot media.

     part /boot --source bootimg-efi --ondisk sda --label msdos --active --align 1024

     part / --source rootfs --ondisk sda --fstype=ext3 --label platform --align 1024

     part swap --ondisk sda --size 44 --label swap1 --fstype=swap

     bootloader  --timeout=10  --append="rootwait rootfstype=ext3 console=ttyPCH0,115200 console=tty0 vmalloc=256MB snd-hda-intel.enable_msi=0"
                    </pre><p>
                </p></div><div class="section" title="5.9.2.6. Examples"><div class="titlepage"><div><div><h4 class="title" id="wic-usage-examples">5.9.2.6. Examples<span class="permalink"><a alt="Permalink" title="Permalink" href="#wic-usage-examples">¶</a></span></h4></div></div></div><p>
                    This section provides several examples that show how to use
                    the <code class="filename">wic</code> utility.
                    All the examples assume the list of requirements in the
                    "<a class="link" href="#wic-requirements" title="5.9.2.2. Requirements">Requirements</a>"
                    section have been met.
                    The examples assume the previously generated image is
                    <code class="filename">core-image-minimal</code>.
                </p><div class="section" title="5.9.2.6.1. Generate an Image using an Existing Kickstart File"><div class="titlepage"><div><div><h5 class="title" id="generate-an-image-using-a-provided-kickstart-file">5.9.2.6.1. Generate an Image using an Existing Kickstart File<span class="permalink"><a alt="Permalink" title="Permalink" href="#generate-an-image-using-a-provided-kickstart-file">¶</a></span></h5></div></div></div><p>
                        This example runs in Cooked Mode and uses the
                        <code class="filename">mkefidisk</code> kickstart file:
                        </p><pre class="literallayout">
     $ wic create mkefidisk -e core-image-minimal
     Checking basic build environment...
     Done.

     Creating image(s)...

     Info: The new image(s) can be found here:
      /var/tmp/wic/build/mkefidisk-201310230946-sda.direct

     The following build artifacts were used to create the image(s):
      ROOTFS_DIR: /home/trz/yocto/yocto-image/build/tmp/work/minnow-poky-linux/core-image-minimal/1.0-r0/rootfs
      BOOTIMG_DIR: /home/trz/yocto/yocto-image/build/tmp/work/minnow-poky-linux/core-image-minimal/1.0-r0/core-image-minimal-1.0/hddimg
      KERNEL_DIR: /home/trz/yocto/yocto-image/build/tmp/sysroots/minnow/usr/src/kernel
      NATIVE_SYSROOT: /home/trz/yocto/yocto-image/build/tmp/sysroots/x86_64-linux

     The image(s) were created using OE kickstart file:
      /home/trz/yocto/yocto-image/scripts/lib/image/canned-wks/mkefidisk.wks
                        </pre><p>
                        The previous example shows the easiest way to create
                        an image by running in Cooked Mode and using the
                        <code class="filename">-e</code> option with an existing
                        kickstart file.
                        All that is necessary is to specify the image used to
                        generate the artifacts.
                        Your <code class="filename">local.conf</code> needs to have the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                        variable set to the machine you are using, which is
                        "minnow" in this example.
                    </p><p>
                        The output specifies the exact image created as well as
                        where it was created.
                        The output also names the artifacts used and the exact
                        <code class="filename">.wks</code> script that was used to
                        generate the image.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            You should always verify the details provided in the
                            output to make sure that the image was indeed
                            created exactly as expected.
                        </div><p>
                    </p><p>
                        Continuing with the example, you can now write the
                        image to a USB stick, or whatever media for which you
                        built your image, and boot the resulting media.
                        You can write the image by using
                        <code class="filename">bmaptool</code> or
                        <code class="filename">dd</code>:
                        </p><pre class="literallayout">
     $ oe-run-native bmaptool copy /var/tmp/wic/build/mkefidisk-201310230946-sda.direct /dev/sd<em class="replaceable"><code>X</code></em>
                        </pre><p>
                        or
                        </p><pre class="literallayout">
     $ sudo dd if=/var/tmp/wic/build/mkefidisk-201310230946-sda.direct of=/dev/sd<em class="replaceable"><code>X</code></em>
                        </pre><p>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            For more information on how to use the
                            <code class="filename">bmaptool</code> to flash a device
                            with an image, see the
                            "<a class="link" href="#flashing-images-using-bmaptool" title="2.4. Flashing Images Using bmaptool">Flashing Images Using <code class="filename">bmaptool</code></a>"
                            section.
                        </div><p>
                    </p></div><div class="section" title="5.9.2.6.2. Using a Modified Kickstart File"><div class="titlepage"><div><div><h5 class="title" id="using-a-modified-kickstart-file">5.9.2.6.2. Using a Modified Kickstart File<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-a-modified-kickstart-file">¶</a></span></h5></div></div></div><p>
                        Because partitioned image creation is
                        driven by the kickstart file, it is easy to affect
                        image creation by changing the parameters in the file.
                        This next example demonstrates that through modification
                        of the <code class="filename">directdisk</code> kickstart file.
                    </p><p>
                        As mentioned earlier, you can use the command
                        <code class="filename">wic list images</code> to show the list
                        of existing kickstart files.
                        The directory in which these files reside is
                        <code class="filename">scripts/lib/image/canned-wks/</code>
                        located in the
                        <a class="link" href="#source-directory">Source Directory</a>.
                        Because the available files reside in this directory,
                        you can create and add your own custom files to the
                        directory.
                        Subsequent use of the
                        <code class="filename">wic list images</code> command would then
                        include your kickstart files.
                    </p><p>
                        In this example, the existing
                        <code class="filename">directdisk</code> file already does most
                        of what is needed.
                        However, for the hardware in this example, the image
                        will need to boot from <code class="filename">sdb</code> instead
                        of <code class="filename">sda</code>, which is what the
                        <code class="filename">directdisk</code> kickstart file uses.
                    </p><p>
                        The example begins by making a copy of the
                        <code class="filename">directdisk.wks</code> file in the
                        <code class="filename">scripts/lib/image/canned-wks</code>
                        directory and then by changing the lines that specify
                        the target disk from which to boot.
                        </p><pre class="literallayout">
     $ cp /home/trz/yocto/yocto-image/scripts/lib/image/canned-wks/directdisk.wks \
          /home/trz/yocto/yocto-image/scripts/lib/image/canned-wks/directdisksdb.wks
                        </pre><p>
                        Next, the example modifies the
                        <code class="filename">directdisksdb.wks</code> file and changes
                        all instances of "<code class="filename">--ondisk sda</code>"
                        to "<code class="filename">--ondisk sdb</code>".
                        The example changes the following two lines and leaves
                        the remaining lines untouched:
                        </p><pre class="literallayout">
     part /boot --source bootimg-pcbios --ondisk sdb --label boot --active --align 1024
     part / --source rootfs --ondisk sdb --fstype=ext3 --label platform --align 1024
                        </pre><p>
                        Once the lines are changed, the example generates the
                        <code class="filename">directdisksdb</code> image.
                        The command points the process at the
                        <code class="filename">core-image-minimal</code> artifacts for
                        the Next Unit of Computing (nuc)
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                        the <code class="filename">local.conf</code>.
                        </p><pre class="literallayout">
     $ wic create directdisksdb -e core-image-minimal
     Checking basic build environment...
     Done.

     Creating image(s)...

     Info: The new image(s) can be found here:
      /var/tmp/wic/build/directdisksdb-201310231131-sdb.direct

     The following build artifacts were used to create the image(s):

      ROOTFS_DIR: /home/trz/yocto/yocto-image/build/tmp/work/nuc-poky-linux/core-image-minimal/1.0-r0/rootfs
      BOOTIMG_DIR: /home/trz/yocto/yocto-image/build/tmp/sysroots/nuc/usr/share
      KERNEL_DIR: /home/trz/yocto/yocto-image/build/tmp/sysroots/nuc/usr/src/kernel
      NATIVE_SYSROOT: /home/trz/yocto/yocto-image/build/tmp/sysroots/x86_64-linux

     The image(s) were created using OE kickstart file:
      /home/trz/yocto/yocto-image/scripts/lib/image/canned-wks/directdisksdb.wks
                        </pre><p>
                        Continuing with the example, you can now directly
                        <code class="filename">dd</code> the image to a USB stick, or
                        whatever media for which you built your image,
                        and boot the resulting media:
                        </p><pre class="literallayout">
     $ sudo dd if=/var/tmp/wic/build/directdisksdb-201310231131-sdb.direct of=/dev/sdb
     86018+0 records in
     86018+0 records out
     44041216 bytes (44 MB) copied, 13.0734 s, 3.4 MB/s
     [trz at empanada tmp]$ sudo eject /dev/sdb
                        </pre><p>
                    </p></div><div class="section" title="5.9.2.6.3. Creating an Image Based on core-image-minimal and crownbay-noemgd"><div class="titlepage"><div><div><h5 class="title" id="creating-an-image-based-on-core-image-minimal-and-crownbay-noemgd">5.9.2.6.3. Creating an Image Based on <code class="filename">core-image-minimal</code> and <code class="filename">crownbay-noemgd</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-an-image-based-on-core-image-minimal-and-crownbay-noemgd">¶</a></span></h5></div></div></div><p>
                        This example creates an image based on
                        <code class="filename">core-image-minimal</code> and a
                        <code class="filename">crownbay-noemgd</code>
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                        that works right out of the box.
                        </p><pre class="literallayout">
     $ wic create directdisk -e core-image-minimal

     Checking basic build environment...
     Done.

     Creating image(s)...

     Info: The new image(s) can be found here:
      /var/tmp/wic/build/directdisk-201309252350-sda.direct

     The following build artifacts were used to create the image(s):

     ROOTFS_DIR: /home/trz/yocto/yocto-image/build/tmp/work/crownbay_noemgd-poky-linux/core-image-minimal/1.0-r0/rootfs
     BOOTIMG_DIR: /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/share
     KERNEL_DIR: /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/src/kernel
     NATIVE_SYSROOT: /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/src/kernel

     The image(s) were created using OE kickstart file:
      /home/trz/yocto/yocto-image/scripts/lib/image/canned-wks/directdisk.wks
                        </pre><p>
                    </p></div><div class="section" title="5.9.2.6.4. Using a Modified Kickstart File and Running in Raw Mode"><div class="titlepage"><div><div><h5 class="title" id="using-a-modified-kickstart-file-and-running-in-raw-mode">5.9.2.6.4. Using a Modified Kickstart File and Running in Raw Mode<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-a-modified-kickstart-file-and-running-in-raw-mode">¶</a></span></h5></div></div></div><p>
                        This next example manually specifies each build artifact
                        (runs in Raw Mode) and uses a modified kickstart file.
                        The example also uses the <code class="filename">-o</code> option
                        to cause Wic to create the output
                        somewhere other than the default
                        <code class="filename">/var/tmp/wic</code> directory:
                        </p><pre class="literallayout">
     $ wic create ~/test.wks -o /home/trz/testwic --rootfs-dir \
          /home/trz/yocto/yocto-image/build/tmp/work/crownbay_noemgd-poky-linux/core-image-minimal/1.0-r0/rootfs \
          --bootimg-dir /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/share \
          --kernel-dir /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/src/kernel \
          --native-sysroot /home/trz/yocto/yocto-image/build/tmp/sysroots/x86_64-linux

     Creating image(s)...

     Info: The new image(s) can be found here:
      /home/trz/testwic/build/test-201309260032-sda.direct

     The following build artifacts were used to create the image(s):

     ROOTFS_DIR: /home/trz/yocto/yocto-image/build/tmp/work/crownbay_noemgd-poky-linux/core-image-minimal/1.0-r0/rootfs
     BOOTIMG_DIR: /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/share
     KERNEL_DIR: /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/src/kernel
     NATIVE_SYSROOT: /home/trz/yocto/yocto-image/build/tmp/sysroots/crownbay-noemgd/usr/src/kernel

     The image(s) were created using OE kickstart file:
      /home/trz/test.wks
                        </pre><p>
                        For this example,
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                        did not have to be specified in the
                        <code class="filename">local.conf</code> file since the
                        artifact is manually specified.
                    </p></div></div><div class="section" title="5.9.2.7. Plug-ins"><div class="titlepage"><div><div><h4 class="title" id="openembedded-kickstart-plugins">5.9.2.7. Plug-ins<span class="permalink"><a alt="Permalink" title="Permalink" href="#openembedded-kickstart-plugins">¶</a></span></h4></div></div></div><p>
                    Plug-ins allow Wic functionality to
                    be extended and specialized by users.
                    This section documents the plug-in interface, which is
                    currently restricted to source plug-ins.
                </p><p>
                    Source plug-ins provide a mechanism to customize
                    various aspects of the image generation process in
                    Wic, mainly the contents of
                    partitions.
                    The plug-ins provide a mechanism for mapping values
                    specified in <code class="filename">.wks</code> files using the
                    <code class="filename">--source</code> keyword to a
                    particular plug-in implementation that populates a
                    corresponding partition.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        If you use plug-ins that have build-time dependencies
                        (e.g. native tools, bootloaders, and so forth)
                        when building a Wic image, you need to specify those
                        dependencies using the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WKS_FILE_DEPENDS" target="_top"><code class="filename">WKS_FILE_DEPENDS</code></a>
                        variable.
                    </div><p>
                </p><p>
                    A source plug-in is created as a subclass of
                    <code class="filename">SourcePlugin</code>.
                    The plug-in file containing it is added to
                    <code class="filename">scripts/lib/wic/plugins/source/</code> to
                    make the plug-in implementation available to the
                    Wic implementation.
                    For more information, see
                    <code class="filename">scripts/lib/wic/pluginbase.py</code>.
                </p><p>
                    Source plug-ins can also be implemented and added by
                    external layers.
                    As such, any plug-ins found in a
                    <code class="filename">scripts/lib/wic/plugins/source/</code>
                    directory in an external layer are also made
                    available.
                </p><p>
                    When the Wic implementation needs
                    to invoke a partition-specific implementation, it looks
                    for the plug-in that has the same name as the
                    <code class="filename">--source</code> parameter given to
                    that partition.
                    For example, if the partition is set up as follows:
                    </p><pre class="literallayout">
     part /boot --source bootimg-pcbios   ...
                    </pre><p>
                    The methods defined as class members of the plug-in
                    having the matching <code class="filename">bootimg-pcbios.name</code>
                    class member are used.
                </p><p>
                    To be more concrete, here is the plug-in definition that
                    matches a
                    <code class="filename">--source bootimg-pcbios</code> usage,
                    along with an example
                    method called by the Wic implementation
                    when it needs to invoke an implementation-specific
                    partition-preparation function:
                    </p><pre class="literallayout">
    class BootimgPcbiosPlugin(SourcePlugin):
        name = 'bootimg-pcbios'

    @classmethod
        def do_prepare_partition(self, part, ...)
                    </pre><p>
                    If the subclass itself does not implement a function, a
                    default version in a superclass is located and
                    used, which is why all plug-ins must be derived from
                    <code class="filename">SourcePlugin</code>.
                </p><p>
                    The <code class="filename">SourcePlugin</code> class defines the
                    following methods, which is the current set of methods
                    that can be implemented or overridden by
                    <code class="filename">--source</code> plug-ins.
                    Any methods not implemented by a
                    <code class="filename">SourcePlugin</code> subclass inherit the
                    implementations present in the
                    <code class="filename">SourcePlugin</code> class.
                    For more information, see the
                    <code class="filename">SourcePlugin</code> source for details:
                </p><p>
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">do_prepare_partition()</code>:</em></span>
                            Called to do the actual content population for a
                            partition.
                            In other words, the method prepares the final
                            partition image that is incorporated into the
                            disk image.
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">do_configure_partition()</code>:</em></span>
                            Called before
                            <code class="filename">do_prepare_partition()</code>.
                            This method is typically used to create custom
                            configuration files for a partition (e.g. syslinux
                            or grub configuration files).
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">do_install_disk()</code>:</em></span>
                            Called after all partitions have been prepared and
                            assembled into a disk image.
                            This method provides a hook to allow finalization
                            of a disk image, (e.g. writing an MBR).
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">do_stage_partition()</code>:</em></span>
                            Special content-staging hook called before
                            <code class="filename">do_prepare_partition()</code>.
                            This method is normally empty.</p><p>Typically, a partition just uses the passed-in
                            parameters (e.g. the unmodified value of
                            <code class="filename">bootimg_dir</code>).
                            However, in some cases things might need to be
                            more tailored.
                            As an example, certain files might additionally
                            need to be taken from
                            <code class="filename">bootimg_dir + /boot</code>.
                            This hook allows those files to be staged in a
                            customized fashion.
                            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><code class="filename">get_bitbake_var()</code>
                                allows you to access non-standard variables
                                that you might want to use for this.
                            </div><p>
                            </p></li></ul></div><p>
                </p><p>
                    This scheme is extensible.
                    Adding more hooks is a simple matter of adding more
                    plug-in methods to <code class="filename">SourcePlugin</code> and
                    derived classes.
                    The code that then needs to call the plug-in methods uses
                    <code class="filename">plugin.get_source_plugin_methods()</code>
                    to find the method or methods needed by the call.
                    Retrieval of those methods is accomplished
                    by filling up a dict with keys
                    containing the method names of interest.
                    On success, these will be filled in with the actual
                    methods.
                    Please see the Wic
                    implementation for examples and details.
                </p></div><div class="section" title="5.9.2.8. OpenEmbedded Kickstart (.wks) Reference"><div class="titlepage"><div><div><h4 class="title" id="openembedded-kickstart-wks-reference">5.9.2.8. OpenEmbedded Kickstart (<code class="filename">.wks</code>) Reference<span class="permalink"><a alt="Permalink" title="Permalink" href="#openembedded-kickstart-wks-reference">¶</a></span></h4></div></div></div><p>
                    The current Wic implementation supports
                    only the basic kickstart partitioning commands:
                    <code class="filename">partition</code> (or <code class="filename">part</code>
                    for short) and <code class="filename">bootloader</code>.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        Future updates will implement more commands and options.
                        If you use anything that is not specifically
                        supported, results can be unpredictable.
                    </div><p>
                </p><p>
                    The following is a list of the commands, their syntax,
                    and meanings.
                    The commands are based on the Fedora
                    kickstart versions but with modifications to
                    reflect Wic capabilities.
                    You can see the original documentation for those commands
                    at the following links:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <a class="ulink" href="http://fedoraproject.org/wiki/Anaconda/Kickstart#part_or_partition" target="_top">http://fedoraproject.org/wiki/Anaconda/Kickstart#part_or_partition</a>
                            </p></li><li class="listitem"><p>
                            <a class="ulink" href="http://fedoraproject.org/wiki/Anaconda/Kickstart#bootloader" target="_top">http://fedoraproject.org/wiki/Anaconda/Kickstart#bootloader</a>
                            </p></li></ul></div><p>
                </p><div class="section" title="5.9.2.8.1. Command: part or partition"><div class="titlepage"><div><div><h5 class="title" id="command-part-or-partition">5.9.2.8.1. Command: part or partition<span class="permalink"><a alt="Permalink" title="Permalink" href="#command-part-or-partition">¶</a></span></h5></div></div></div><p>
                    Either of these commands create a partition on the system
                    and use the following syntax:
                        </p><pre class="literallayout">
     part [<em class="replaceable"><code>mntpoint</code></em>]
     partition [<em class="replaceable"><code>mntpoint</code></em>]
                        </pre><p>
                        If you do not provide
                        <em class="replaceable"><code>mntpoint</code></em>, Wic creates a
                        partition but does not mount it.
                    </p><p>
                        The
                        <code class="filename"><em class="replaceable"><code>mntpoint</code></em></code>
                        is where the partition will be mounted and must be of
                        one of the following forms:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                                <code class="filename">/<em class="replaceable"><code>path</code></em></code>:
                                For example, "/", "/usr", or "/home"
                                </p></li><li class="listitem"><p>
                                <code class="filename">swap</code>:
                                The created partition is used as swap space.
                                </p></li></ul></div><p>
                    </p><p>
                        Specifying a <em class="replaceable"><code>mntpoint</code></em> causes
                        the partition to automatically be mounted.
                        Wic achieves this by adding entries to the filesystem
                        table (fstab) during image generation.
                        In order for wic to generate a valid fstab, you must
                        also provide one of the <code class="filename">--ondrive</code>,
                        <code class="filename">--ondisk</code>, or
                        <code class="filename">--use-uuid</code> partition options as
                        part of the command.
                        Here is an example using "/" as the mountpoint.
                        The command uses "--ondisk" to force the partition onto
                        the <code class="filename">sdb</code> disk:
                        </p><pre class="literallayout">
     part / --source rootfs --ondisk sdb --fstype=ext3 --label platform --align 1024
                        </pre><p>
                    </p><p>
                        Here is a list that describes other supported options
                        you can use with the <code class="filename">part</code> and
                        <code class="filename">partition</code> commands:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--size</code>:</em></span>
                                The minimum partition size in MBytes.
                                Specify an integer value such as 500.
                                Do not append the number with "MB".
                                You do not need this option if you use
                                <code class="filename">--source</code>.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--source</code>:</em></span>
                                This option is a
                                Wic-specific option that
                                names the source of the data that populates
                                the partition.
                                The most common value for this option is
                                "rootfs", but you can use any value that maps to
                                a valid source plug-in.
                                For information on the source plug-ins, see the
                                "<a class="link" href="#openembedded-kickstart-plugins" title="5.9.2.7. Plug-ins">Plug-ins</a>"
                                section.</p><p>If you use
                                <code class="filename">--source rootfs</code>,
                                Wic creates a partition as
                                large as needed and to fill it with the contents
                                of the root filesystem pointed to by the
                                <code class="filename">-r</code> command-line option
                                or the equivalent rootfs derived from the
                                <code class="filename">-e</code> command-line
                                option.
                                The filesystem type used to create the
                                partition is driven by the value of the
                                <code class="filename">--fstype</code> option
                                specified for the partition.
                                See the entry on
                                <code class="filename">--fstype</code> that
                                follows for more information.
                                </p><p>If you use
                                <code class="filename">--source <em class="replaceable"><code>plugin-name</code></em></code>,
                                Wic creates a partition as
                                large as needed and fills it with the contents
                                of the partition that is generated by the
                                specified plug-in name using the data pointed
                                to by the <code class="filename">-r</code> command-line
                                option or the equivalent rootfs derived from the
                                <code class="filename">-e</code> command-line
                                option.
                                Exactly what those contents and filesystem type
                                end up being are dependent on the given plug-in
                                implementation.
                                </p><p>If you do not use the
                                <code class="filename">--source</code> option, the
                                <code class="filename">wic</code> command creates an
                                empty partition.
                                Consequently, you must use the
                                <code class="filename">--size</code> option to specify
                                the size of the empty partition.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--ondisk</code> or <code class="filename">--ondrive</code>:</em></span>
                                Forces the partition to be created on a
                                particular disk.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--fstype</code>:</em></span>
                                Sets the file system type for the partition.
                                Valid values are:
                                </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><code class="filename">ext4</code>
                                    </p></li><li class="listitem"><p><code class="filename">ext3</code>
                                    </p></li><li class="listitem"><p><code class="filename">ext2</code>
                                    </p></li><li class="listitem"><p><code class="filename">btrfs</code>
                                    </p></li><li class="listitem"><p><code class="filename">squashfs</code>
                                    </p></li><li class="listitem"><p><code class="filename">swap</code>
                                    </p></li></ul></div><p>
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--fsoptions</code>:</em></span>
                                Specifies a free-form string of options to be
                                used when mounting the filesystem.
                                This string will be copied into the
                                <code class="filename">/etc/fstab</code> file of the
                                installed system and should be enclosed in
                                quotes.
                                If not specified, the default string
                                is "defaults".
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--label label</code>:</em></span>
                                Specifies the label to give to the filesystem to
                                be made on the partition.
                                If the given label is already in use by another
                                filesystem, a new label is created for the
                                partition.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--active</code>:</em></span>
                                Marks the partition as active.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--align (in KBytes)</code>:</em></span>
                                This option is a
                                Wic-specific option that
                                says to start a partition on an
                                <em class="replaceable"><code>x</code></em> KBytes
                                boundary.</p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--no-table</code>:</em></span>
                                This option is a
                                Wic-specific option.
                                Using the option reserves space for the
                                partition and causes it to become populated.
                                However, the partition is not added to the
                                partition table.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--extra-space</code>:</em></span>
                                This option is a
                                Wic-specific option that
                                adds extra space after the space filled by the
                                content of the partition.
                                The final size can go beyond the size specified
                                by the <code class="filename">--size</code> option.
                                The default value is 10 Mbytes.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--overhead-factor</code>:</em></span>
                                This option is a
                                Wic-specific option that
                                multiplies the size of the partition by the
                                option's value.
                                You must supply a value greater than or equal to
                                "1".
                                The default value is "1.3".
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--part-type</code>:</em></span>
                                This option is a
                                Wic-specific option that
                                specifies the partition type globally
                                unique identifier (GUID) for GPT partitions.
                                You can find the list of partition type GUIDs
                                at
                                <a class="ulink" href="http://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_type_GUIDs" target="_top">http://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_type_GUIDs</a>.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--use-uuid</code>:</em></span>
                                This option is a
                                Wic-specific option that
                                causes Wic to generate a
                                random GUID for the partition.
                                The generated identifier is used in the
                                bootloader configuration to specify the root
                                partition.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--uuid</code>:</em></span>
                                This option is a
                                Wic-specific
                                option that specifies the partition UUID.
                                </p></li></ul></div><p>
                    </p></div><div class="section" title="5.9.2.8.2. Command: bootloader"><div class="titlepage"><div><div><h5 class="title" id="command-bootloader">5.9.2.8.2. Command: bootloader<span class="permalink"><a alt="Permalink" title="Permalink" href="#command-bootloader">¶</a></span></h5></div></div></div><p>
                        This command specifies how the bootloader should be
                        configured and supports the following options:
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            Bootloader functionality and boot partitions are
                            implemented by the various
                            <code class="filename">--source</code>
                            plug-ins that implement bootloader functionality.
                            The bootloader command essentially provides a
                            means of modifying bootloader configuration.
                        </div><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--timeout</code>:</em></span>
                                Specifies the number of seconds before the
                                bootloader times out and boots the default
                                option.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--append</code>:</em></span>
                                Specifies kernel parameters.
                                These parameters will be added to the syslinux
                                <code class="filename">APPEND</code> or
                                <code class="filename">grub</code> kernel command line.
                                </p></li><li class="listitem"><p>
                                <span class="emphasis"><em><code class="filename">--configfile</code>:</em></span>
                                Specifies a user-defined configuration file for
                                the bootloader.
                                You can provide a full pathname for the file or
                                a file that exists in the
                                <code class="filename">canned-wks</code> folder.
                                This option overrides all other bootloader
                                options.
                                </p></li></ul></div><p>
                    </p></div></div></div></div><div class="section" title="5.10. Building an Initial RAM Filesystem (initramfs) Image"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="building-an-initramfs-image">5.10. Building an Initial RAM Filesystem (initramfs) Image<span class="permalink"><a alt="Permalink" title="Permalink" href="#building-an-initramfs-image">¶</a></span></h2></div></div></div><p>
            initramfs is the successor of Initial RAM Disk (initrd).
            It is a "copy in and out" (cpio) archive of the initial file system
            that gets loaded into memory during the Linux startup process.
            Because Linux uses the contents of the archive during
            initialization, the initramfs needs to contain all of the device
            drivers and tools needed to mount the final root filesystem.
        </p><p>
            To build an initramfs image and bundle it into the kernel, set the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INITRAMFS_IMAGE_BUNDLE" target="_top"><code class="filename">INITRAMFS_IMAGE_BUNDLE</code></a>
            variable in your <code class="filename">local.conf</code> file, and set the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INITRAMFS_IMAGE" target="_top"><code class="filename">INITRAMFS_IMAGE</code></a>
            variable in your <code class="filename">machine.conf</code> file:
            </p><pre class="literallayout">
     INITRAMFS_IMAGE_BUNDLE = "1"
     INITRAMFS_IMAGE = "<em class="replaceable"><code>image_recipe_name</code></em>"
            </pre><p>
            Setting the <code class="filename">INITRAMFS_IMAGE_BUNDLE</code>
            flag causes the initramfs created by the recipe and defined by
            <code class="filename">INITRAMFS_IMAGE</code> to be unpacked into the
            <code class="filename">${B}/usr/</code> directory.
            The unpacked initramfs is then passed to the kernel's
            <code class="filename">Makefile</code> using the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-CONFIG_INITRAMFS_SOURCE" target="_top"><code class="filename">CONFIG_INITRAMFS_SOURCE</code></a>
            variable, allowing initramfs to be built in to the kernel
            normally.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                The preferred method is to use the
                <code class="filename">INITRAMFS_IMAGE</code> variable rather than the
                <code class="filename">INITRAMFS_TASK</code> variable.
                Setting <code class="filename">INITRAMFS_TASK</code> is supported for
                backward compatibility.
                However, use of this variable has circular dependency
                problems.
                See the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INITRAMFS_IMAGE_BUNDLE" target="_top"><code class="filename">INITRAMFS_IMAGE_BUNDLE</code></a>
                variable for additional information on these dependency
                problems.
            </div><p>
        </p><p>
            The recipe that <code class="filename">INITRAMFS_IMAGE</code>
            points to must produce a <code class="filename">.cpio.gz</code>,
            <code class="filename">.cpio.tar</code>, <code class="filename">.cpio.lz4</code>,
            <code class="filename">.cpio.lzma</code>, or
            <code class="filename">.cpio.xz</code> file.
            You can ensure you produce one of these <code class="filename">.cpio.*</code>
            files by setting the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INITRAMFS_FSTYPES" target="_top"><code class="filename">INITRAMFS_FSTYPES</code></a>
            variable in your configuration file to one or more of the above
            file types.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                If you add items to the initramfs image by way of its recipe,
                you should use
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_INSTALL" target="_top"><code class="filename">PACKAGE_INSTALL</code></a>
                rather than
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_INSTALL" target="_top"><code class="filename">IMAGE_INSTALL</code></a>.
                <code class="filename">PACKAGE_INSTALL</code> gives more direct control
                of what is added to the image as compared to the defaults you
                might not necessarily want that are set by the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-image" target="_top"><code class="filename">image</code></a>
                or
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-core-image" target="_top"><code class="filename">core-image</code></a>
                classes.
            </div><p>
        </p></div><div class="section" title="5.11. Configuring the Kernel"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="configuring-the-kernel">5.11. Configuring the Kernel<span class="permalink"><a alt="Permalink" title="Permalink" href="#configuring-the-kernel">¶</a></span></h2></div></div></div><p>
            Configuring the Yocto Project kernel consists of making sure the
            <code class="filename">.config</code> file has all the right information
            in it for the image you are building.
            You can use the <code class="filename">menuconfig</code> tool and
            configuration fragments to make sure your
            <code class="filename">.config</code> file is just how you need it.
            You can also save known configurations in a
            <code class="filename">defconfig</code> file that the build system can use
            for kernel configuration.
        </p><p>
            This section describes how to use <code class="filename">menuconfig</code>,
            create and use configuration fragments, and how to interactively
            modify your <code class="filename">.config</code> file to create the
            leanest kernel configuration file possible.
        </p><p>
            For more information on kernel configuration, see the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html#changing-the-configuration" target="_top">Changing the Configuration</a>"
            section in the Yocto Project Linux Kernel Development Manual.
        </p><div class="section" title="5.11.1. Using  menuconfig"><div class="titlepage"><div><div><h3 class="title" id="using-menuconfig">5.11.1. Using  <code class="filename">menuconfig</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#using-menuconfig">¶</a></span></h3></div></div></div><p>
                The easiest way to define kernel configurations is to set them through the
                <code class="filename">menuconfig</code> tool.
                This tool provides an interactive method with which
                to set kernel configurations.
                For general information on <code class="filename">menuconfig</code>, see
                <a class="ulink" href="http://en.wikipedia.org/wiki/Menuconfig" target="_top">http://en.wikipedia.org/wiki/Menuconfig</a>.
            </p><p>
                To use the <code class="filename">menuconfig</code> tool in the Yocto Project development
                environment, you must launch it using BitBake.
                Thus, the environment must be set up using the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                or
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>
                script found in the
                <a class="link" href="#build-directory">Build Directory</a>.
                You must also be sure of the state of your build in the
                <a class="link" href="#source-directory">Source Directory</a>.
                The following commands run <code class="filename">menuconfig</code>
                assuming the Source Directory's top-level folder is
                <code class="filename">~/poky</code>:
                </p><pre class="literallayout">
     $ cd poky
     $ source oe-init-build-env
     $ bitbake linux-yocto -c kernel_configme -f
     $ bitbake linux-yocto -c menuconfig
                </pre><p>
                Once <code class="filename">menuconfig</code> comes up, its standard
                interface allows you to interactively examine and configure
                all the kernel configuration parameters.
                After making your changes, simply exit the tool and save your
                changes to create an updated version of the
                <code class="filename">.config</code> configuration file.
            </p><p>
                Consider an example that configures the <code class="filename">linux-yocto-3.14</code>
                kernel.
                The OpenEmbedded build system recognizes this kernel as
                <code class="filename">linux-yocto</code>.
                Thus, the following commands from the shell in which you previously sourced the
                environment initialization script cleans the shared state cache and the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-WORKDIR" target="_top"><code class="filename">WORKDIR</code></a>
                directory and then runs <code class="filename">menuconfig</code>:
                </p><pre class="literallayout">
     $ bitbake linux-yocto -c menuconfig
                </pre><p>
            </p><p>
                Once <code class="filename">menuconfig</code> launches, use the interface
                to navigate through the selections to find the configuration settings in
                which you are interested.
                For example, consider the <code class="filename">CONFIG_SMP</code> configuration setting.
                You can find it at <code class="filename">Processor Type and Features</code> under
                the configuration selection <code class="filename">Symmetric Multi-processing Support</code>.
                After highlighting the selection, use the arrow keys to select or deselect
                the setting.
                When you are finished with all your selections, exit out and save them.
            </p><p>
                Saving the selections updates the <code class="filename">.config</code> configuration file.
                This is the file that the OpenEmbedded build system uses to configure the
                kernel during the build.
                You can find and examine this file in the Build Directory in
                <code class="filename">tmp/work/</code>.
                The actual <code class="filename">.config</code> is located in the area where the
                specific kernel is built.
                For example, if you were building a Linux Yocto kernel based on the
                Linux 3.14 kernel and you were building a QEMU image targeted for
                <code class="filename">x86</code> architecture, the
                <code class="filename">.config</code> file would be located here:
                </p><pre class="literallayout">
     poky/build/tmp/work/qemux86-poky-linux/linux-yocto-3.14.11+git1+84f...
        ...656ed30-r1/linux-qemux86-standard-build
                </pre><p>
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    The previous example directory is artificially split and many of the characters
                    in the actual filename are omitted in order to make it more readable.
                    Also, depending on the kernel you are using, the exact pathname
                    for <code class="filename">linux-yocto-3.14...</code> might differ.
                </div><p>
            </p><p>
                Within the <code class="filename">.config</code> file, you can see the kernel settings.
                For example, the following entry shows that symmetric multi-processor support
                is not set:
                </p><pre class="literallayout">
     # CONFIG_SMP is not set
                </pre><p>
            </p><p>
                A good method to isolate changed configurations is to use a combination of the
                <code class="filename">menuconfig</code> tool and simple shell commands.
                Before changing configurations with <code class="filename">menuconfig</code>, copy the
                existing <code class="filename">.config</code> and rename it to something else,
                use <code class="filename">menuconfig</code> to make
                as many changes as you want and save them, then compare the renamed configuration
                file against the newly created file.
                You can use the resulting differences as your base to create configuration fragments
                to permanently save in your kernel layer.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Be sure to make a copy of the <code class="filename">.config</code> and don't just
                    rename it.
                    The build system needs an existing <code class="filename">.config</code>
                    from which to work.
                </div><p>
            </p></div><div class="section" title="5.11.2. Creating a  defconfig File"><div class="titlepage"><div><div><h3 class="title" id="creating-a-defconfig-file">5.11.2. Creating a  <code class="filename">defconfig</code> File<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-a-defconfig-file">¶</a></span></h3></div></div></div><p>
                A <code class="filename">defconfig</code> file is simply a
                <code class="filename">.config</code> renamed to "defconfig".
                You can use a <code class="filename">defconfig</code> file
                to retain a known set of kernel configurations from which the
                OpenEmbedded build system can draw to create the final
                <code class="filename">.config</code> file.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Out-of-the-box, the Yocto Project never ships a
                    <code class="filename">defconfig</code> or
                    <code class="filename">.config</code> file.
                    The OpenEmbedded build system creates the final
                    <code class="filename">.config</code> file used to configure the
                    kernel.
                </div><p>
            </p><p>
                To create a <code class="filename">defconfig</code>, start with a
                complete, working Linux kernel <code class="filename">.config</code>
                file.
                Copy that file to the appropriate
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a><code class="filename">}</code>
                directory in your layer's
                <code class="filename">recipes-kernel/linux</code> directory, and rename
                the copied file to "defconfig".
                Then, add the following lines to the linux-yocto
                <code class="filename">.bbappend</code> file in your layer:
                </p><pre class="literallayout">
     FILESEXTRAPATHS_prepend := "${THISDIR}/${PN}:"
     SRC_URI += "file://defconfig"
                </pre><p>
                The
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                tells the build system how to search for the file, while the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESEXTRAPATHS" target="_top"><code class="filename">FILESEXTRAPATHS</code></a>
                extends the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESPATH" target="_top"><code class="filename">FILESPATH</code></a>
                variable (search directories) to include the
                <code class="filename">${PN}</code> directory you created to hold the
                configuration changes.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    The build system applies the configurations from the
                    <code class="filename">defconfig</code> file before applying any
                    subsequent configuration fragments.
                    The final kernel configuration is a combination of the
                    configurations in the <code class="filename">defconfig</code>
                    file and any configuration fragments you provide.
                    You need to realize that if you have any configuration
                    fragments, the build system applies these on top of and
                    after applying the existing defconfig file configurations.
                </div><p>
                For more information on configuring the kernel, see the
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html#changing-the-configuration" target="_top">Changing the Configuration</a>"
                and
                "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html#generating-configuration-files" target="_top">Generating Configuration Files</a>"
                sections, both in the Yocto Project Linux Kernel Development
                Manual.
            </p></div><div class="section" title="5.11.3. Creating Configuration Fragments"><div class="titlepage"><div><div><h3 class="title" id="creating-config-fragments">5.11.3. Creating Configuration Fragments<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-config-fragments">¶</a></span></h3></div></div></div><p>
                Configuration fragments are simply kernel options that appear in a file
                placed where the OpenEmbedded build system can find and apply them.
                Syntactically, the configuration statement is identical to what would appear
                in the <code class="filename">.config</code> file, which is in the
                <a class="link" href="#build-directory">Build Directory</a>:
                </p><pre class="literallayout">
     tmp/work/<em class="replaceable"><code>arch</code></em>-poky-linux/linux-yocto-<em class="replaceable"><code>release_specific_string</code></em>/linux-<em class="replaceable"><code>arch</code></em>-<em class="replaceable"><code>build_type</code></em>
                </pre><p>
            </p><p>
                It is simple to create a configuration fragment.
                For example, issuing the following from the shell creates a configuration fragment
                file named <code class="filename">my_smp.cfg</code> that enables multi-processor support
                within the kernel:
                </p><pre class="literallayout">
     $ echo "CONFIG_SMP=y" &gt;&gt; my_smp.cfg
                </pre><p>
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    All configuration fragment files must use the
                    <code class="filename">.cfg</code> extension in order for the
                    OpenEmbedded build system to recognize them as a
                    configuration fragment.
                </div><p>
            </p><p>
                Where do you put your configuration fragment files?
                You can place these files in the same area pointed to by
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>.
                The OpenEmbedded build system picks up the configuration and
                adds it to the kernel's configuration.
                For example, suppose you had a set of configuration options
                in a file called <code class="filename">myconfig.cfg</code>.
                If you put that file inside a directory named
                <code class="filename">linux-yocto</code> that resides in the same
                directory as the kernel's append file and then add a
                <code class="filename">SRC_URI</code> statement such as the following
                to the kernel's append file, those configuration options
                will be picked up and applied when the kernel is built.
                </p><pre class="literallayout">
     SRC_URI += "file://myconfig.cfg"
                </pre><p>
            </p><p>
                As mentioned earlier, you can group related configurations into multiple files and
                name them all in the <code class="filename">SRC_URI</code> statement as well.
                For example, you could group separate configurations specifically for Ethernet and graphics
                into their own files and add those by using a <code class="filename">SRC_URI</code> statement like the
                following in your append file:
                </p><pre class="literallayout">
     SRC_URI += "file://myconfig.cfg \
            file://eth.cfg \
            file://gfx.cfg"
                </pre><p>
            </p></div><div class="section" title="5.11.4. Fine-Tuning the Kernel Configuration File"><div class="titlepage"><div><div><h3 class="title" id="fine-tuning-the-kernel-configuration-file">5.11.4. Fine-Tuning the Kernel Configuration File<span class="permalink"><a alt="Permalink" title="Permalink" href="#fine-tuning-the-kernel-configuration-file">¶</a></span></h3></div></div></div><p>
                You can make sure the <code class="filename">.config</code> file is as lean or efficient as
                possible by reading the output of the kernel configuration fragment audit,
                noting any issues, making changes to correct the issues, and then repeating.
            </p><p>
                As part of the kernel build process, the
                <code class="filename">do_kernel_configcheck</code> task runs.
                This task validates the kernel configuration by checking the final
                <code class="filename">.config</code> file against the input files.
                During the check, the task produces warning messages for the following
                issues:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Requested options that did not make the final
                        <code class="filename">.config</code> file.</p></li><li class="listitem"><p>Configuration items that appear twice in the same
                        configuration fragment.</p></li><li class="listitem"><p>Configuration items tagged as "required" that were overridden.
                        </p></li><li class="listitem"><p>A board overrides a non-board specific option.</p></li><li class="listitem"><p>Listed options not valid for the kernel being processed.
                        In other words, the option does not appear anywhere.</p></li></ul></div><p>
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    The <code class="filename">do_kernel_configcheck</code> task can
                    also optionally report if an option is overridden during
                    processing.
                </div><p>
            </p><p>
                For each output warning, a message points to the file
                that contains a list of the options and a pointer to the
                configuration fragment that defines them.
                Collectively, the files are the key to streamlining the
                configuration.
            </p><p>
                To streamline the configuration, do the following:
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Start with a full configuration that you
                        know works - it builds and boots successfully.
                        This configuration file will be your baseline.
                        </p></li><li class="listitem"><p>Separately run the
                        <code class="filename">do_kernel_configme</code> and
                        <code class="filename">do_kernel_configcheck</code> tasks.
                        </p></li><li class="listitem"><p>Take the resulting list of files from the
                        <code class="filename">do_kernel_configcheck</code> task
                        warnings and do the following:
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                                Drop values that are redefined in the fragment
                                but do not change the final
                                <code class="filename">.config</code> file.
                                </p></li><li class="listitem"><p>
                                Analyze and potentially drop values from the
                                <code class="filename">.config</code> file that override
                                required configurations.
                                </p></li><li class="listitem"><p>
                                Analyze and potentially remove non-board
                                specific options.
                                </p></li><li class="listitem"><p>
                                Remove repeated and invalid options.
                                </p></li></ul></div></li><li class="listitem"><p>
                        After you have worked through the output of the kernel
                        configuration audit, you can re-run the
                        <code class="filename">do_kernel_configme</code> and
                        <code class="filename">do_kernel_configcheck</code> tasks to
                        see the results of your changes.
                        If you have more issues, you can deal with them as
                        described in the previous step.
                        </p></li></ol></div><p>
            </p><p>
                Iteratively working through steps two through four eventually yields
                a minimal, streamlined configuration file.
                Once you have the best <code class="filename">.config</code>, you can build the Linux
                Yocto kernel.
            </p></div><div class="section" title="5.11.5. Determining Hardware and Non-Hardware Features for the Kernel Configuration Audit Phase"><div class="titlepage"><div><div><h3 class="title" id="determining-hardware-and-non-hardware-features-for-the-kernel-configuration-audit-phase">5.11.5. Determining Hardware and Non-Hardware Features for the Kernel Configuration Audit Phase<span class="permalink"><a alt="Permalink" title="Permalink" href="#determining-hardware-and-non-hardware-features-for-the-kernel-configuration-audit-phase">¶</a></span></h3></div></div></div><p>
                This section describes part of the kernel configuration audit
                phase that most developers can ignore.
                During this part of the audit phase, the contents of the final
                <code class="filename">.config</code> file are compared against the
                fragments specified by the system.
                These fragments can be system fragments, distro fragments,
                or user specified configuration elements.
                Regardless of their origin, the OpenEmbedded build system
                warns the user if a specific option is not included in the
                final kernel configuration.
            </p><p>
                In order to not overwhelm the user with configuration warnings,
                by default the system only reports on missing "hardware"
                options because a missing hardware option could mean a boot
                failure or that important hardware is not available.
            </p><p>
                To determine whether or not a given option is "hardware" or
                "non-hardware", the kernel Metadata contains files that
                classify individual or groups of options as either hardware
                or non-hardware.
                To better show this, consider a situation where the
                Yocto Project kernel cache contains the following files:
                </p><pre class="literallayout">
     kernel-cache/features/drm-psb/hardware.cfg
     kernel-cache/features/kgdb/hardware.cfg
     kernel-cache/ktypes/base/hardware.cfg
     kernel-cache/bsp/mti-malta32/hardware.cfg
     kernel-cache/bsp/fsl-mpc8315e-rdb/hardware.cfg
     kernel-cache/bsp/qemu-ppc32/hardware.cfg
     kernel-cache/bsp/qemuarma9/hardware.cfg
     kernel-cache/bsp/mti-malta64/hardware.cfg
     kernel-cache/bsp/arm-versatile-926ejs/hardware.cfg
     kernel-cache/bsp/common-pc/hardware.cfg
     kernel-cache/bsp/common-pc-64/hardware.cfg
     kernel-cache/features/rfkill/non-hardware.cfg
     kernel-cache/ktypes/base/non-hardware.cfg
     kernel-cache/features/aufs/non-hardware.kcf
     kernel-cache/features/ocf/non-hardware.kcf
     kernel-cache/ktypes/base/non-hardware.kcf
     kernel-cache/ktypes/base/hardware.kcf
     kernel-cache/bsp/qemu-ppc32/hardware.kcf
                </pre><p>
                The following list provides explanations for the various
                files:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">hardware.kcf</code>:
                        Specifies a list of kernel Kconfig files that contain
                        hardware options only.
                        </p></li><li class="listitem"><p><code class="filename">non-hardware.kcf</code>:
                        Specifies a list of kernel Kconfig files that contain
                        non-hardware options only.
                        </p></li><li class="listitem"><p><code class="filename">hardware.cfg</code>:
                        Specifies a list of kernel
                        <code class="filename">CONFIG_</code> options that are hardware,
                        regardless of whether or not they are within a Kconfig
                        file specified by a hardware or non-hardware
                        Kconfig file (i.e. <code class="filename">hardware.kcf</code> or
                        <code class="filename">non-hardware.kcf</code>).
                        </p></li><li class="listitem"><p><code class="filename">non-hardware.cfg</code>:
                        Specifies a list of kernel
                        <code class="filename">CONFIG_</code> options that are
                        not hardware, regardless of whether or not they are
                        within a Kconfig file specified by a hardware or
                        non-hardware Kconfig file (i.e.
                        <code class="filename">hardware.kcf</code> or
                        <code class="filename">non-hardware.kcf</code>).
                        </p></li></ul></div><p>
                Here is a specific example using the
                <code class="filename">kernel-cache/bsp/mti-malta32/hardware.cfg</code>:
                </p><pre class="literallayout">
     CONFIG_SERIAL_8250
     CONFIG_SERIAL_8250_CONSOLE
     CONFIG_SERIAL_8250_NR_UARTS
     CONFIG_SERIAL_8250_PCI
     CONFIG_SERIAL_CORE
     CONFIG_SERIAL_CORE_CONSOLE
     CONFIG_VGA_ARB
                </pre><p>
                The kernel configuration audit automatically detects these
                files (hence the names must be exactly the ones discussed here),
                and uses them as inputs when generating warnings about the
                final <code class="filename">.config</code> file.
            </p><p>
                A user-specified kernel Metadata repository, or recipe space
                feature, can use these same files to classify options that are
                found within its <code class="filename">.cfg</code> files as hardware
                or non-hardware, to prevent the OpenEmbedded build system from
                producing an error or warning when an option is not in the
                final <code class="filename">.config</code> file.
            </p></div></div><div class="section" title="5.12. Patching the Kernel"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="patching-the-kernel">5.12. Patching the Kernel<span class="permalink"><a alt="Permalink" title="Permalink" href="#patching-the-kernel">¶</a></span></h2></div></div></div><p>
            Patching the kernel involves changing or adding configurations to an existing kernel,
            changing or adding recipes to the kernel that are needed to support specific hardware features,
            or even altering the source code itself.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                You can use the <code class="filename">yocto-kernel</code> script
                found in the <a class="link" href="#source-directory">Source Directory</a>
                under <code class="filename">scripts</code> to manage kernel patches and configuration.
                See the "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#managing-kernel-patches-and-config-items-with-yocto-kernel" target="_top">Managing kernel Patches and Config Items with yocto-kernel</a>"
                section in the Yocto Project Board Support Packages (BSP) Developer's Guide for
                more information.</div><p>
        </p><p>
            This example creates a simple patch by adding some QEMU emulator console
            output at boot time through <code class="filename">printk</code> statements in the kernel's
            <code class="filename">calibrate.c</code> source code file.
            Applying the patch and booting the modified image causes the added
            messages to appear on the emulator's console.
        </p><p>
            The example assumes a clean build exists for the <code class="filename">qemux86</code>
            machine in a
            <a class="link" href="#source-directory">Source Directory</a>
            named <code class="filename">poky</code>.
            Furthermore, the <a class="link" href="#build-directory">Build Directory</a> is
            <code class="filename">build</code> and is located in <code class="filename">poky</code> and
            the kernel is based on the Linux 3.4 kernel.
        </p><p>
            Also, for more information on patching the kernel, see the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html#applying-patches" target="_top">Applying Patches</a>"
            section in the Yocto Project Linux Kernel Development Manual.
        </p><div class="section" title="5.12.1. Create a Layer for your Changes"><div class="titlepage"><div><div><h3 class="title" id="create-a-layer-for-your-changes">5.12.1. Create a Layer for your Changes<span class="permalink"><a alt="Permalink" title="Permalink" href="#create-a-layer-for-your-changes">¶</a></span></h3></div></div></div><p>
                The first step is to create a layer so you can isolate your
                changes.
                Rather than use the <code class="filename">yocto-layer</code> script
                to create the layer, this example steps through the process
                by hand.
                If you want information on the script that creates a general
                layer, see the
                "<a class="link" href="#creating-a-general-layer-using-the-yocto-layer-script" title="5.1.9. Creating a General Layer Using the yocto-layer Script">Creating a General Layer Using the yocto-layer Script</a>"
                section.
            </p><p>
                These two commands create a directory you can use for your
                layer:
                </p><pre class="literallayout">
     $ cd ~/poky
     $ mkdir meta-mylayer
                </pre><p>
                Creating a directory that follows the Yocto Project layer naming
                conventions sets up the layer for your changes.
                The layer is where you place your configuration files, append
                files, and patch files.
                To learn more about creating a layer and filling it with the
                files you need, see the "<a class="link" href="#understanding-and-creating-layers" title="5.1. Understanding and Creating Layers">Understanding
                and Creating Layers</a>" section.
            </p></div><div class="section" title="5.12.2. Finding the Kernel Source Code"><div class="titlepage"><div><div><h3 class="title" id="finding-the-kernel-source-code">5.12.2. Finding the Kernel Source Code<span class="permalink"><a alt="Permalink" title="Permalink" href="#finding-the-kernel-source-code">¶</a></span></h3></div></div></div><p>
                Each time you build a kernel image, the kernel source code is fetched
                and unpacked into the following directory:
                </p><pre class="literallayout">
     ${S}/linux
                </pre><p>
                See the "<a class="link" href="#finding-the-temporary-source-code" title="4.3.3. Finding Temporary Source Code">Finding Temporary Source Code</a>"
                section and the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-S" target="_top"><code class="filename">S</code></a> variable
                for more information about where source is kept during a build.
            </p><p>
                For this example, we are going to patch the
                <code class="filename">init/calibrate.c</code> file
                by adding some simple console <code class="filename">printk</code> statements that we can
                see when we boot the image using QEMU.
            </p></div><div class="section" title="5.12.3. Creating the Patch"><div class="titlepage"><div><div><h3 class="title" id="creating-the-patch">5.12.3. Creating the Patch<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-the-patch">¶</a></span></h3></div></div></div><p>
                Two methods exist by which you can create the patch:
                <a class="link" href="#using-devtool-in-your-workflow" title="4.3.1. Using devtool in Your Workflow"><code class="filename">devtool</code></a> and
                <a class="link" href="#using-a-quilt-workflow" title="4.3.2. Using Quilt in Your Workflow">Quilt</a>.
                For kernel patches, the Git workflow is more appropriate.
                This section assumes the Git workflow and shows the steps specific to
                this example.
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Change the working directory</em></span>:
                        Change to where the kernel source code is before making
                        your edits to the <code class="filename">calibrate.c</code> file:
                        </p><pre class="literallayout">
     $ cd ~/poky/build/tmp/work/qemux86-poky-linux/linux-yocto-${PV}-${PR}/linux
                        </pre><p>
                        Because you are working in an established Git repository,
                        you must be in this directory in order to commit your changes
                        and create the patch file.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>The <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a> and
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top"><code class="filename">PR</code></a> variables
                            represent the version and revision for the
                            <code class="filename">linux-yocto</code> recipe.
                            The <code class="filename">PV</code> variable includes the Git meta and machine
                            hashes, which make the directory name longer than you might
                            expect.
                        </div></li><li class="listitem"><p><span class="emphasis"><em>Edit the source file</em></span>:
                        Edit the <code class="filename">init/calibrate.c</code> file to have the
                        following changes:
                        </p><pre class="literallayout">
     void calibrate_delay(void)
     {
         unsigned long lpj;
         static bool printed;
         int this_cpu = smp_processor_id();

         printk("*************************************\n");
         printk("*                                   *\n");
         printk("*        HELLO YOCTO KERNEL         *\n");
         printk("*                                   *\n");
         printk("*************************************\n");

     	if (per_cpu(cpu_loops_per_jiffy, this_cpu)) {
               .
               .
               .
                        </pre></li><li class="listitem"><p><span class="emphasis"><em>Stage and commit your changes</em></span>:
                        These Git commands display the modified file, stage it, and then
                        commit the file:
                        </p><pre class="literallayout">
     $ git status
     $ git add init/calibrate.c
     $ git commit -m "calibrate: Add printk example"
                        </pre></li><li class="listitem"><p><span class="emphasis"><em>Generate the patch file</em></span>:
                        This Git command creates the a patch file named
                        <code class="filename">0001-calibrate-Add-printk-example.patch</code>
                        in the current directory.
                        </p><pre class="literallayout">
     $ git format-patch -1
                        </pre><p>
                        </p></li></ol></div><p>
            </p></div><div class="section" title="5.12.4. Set Up Your Layer for the Build"><div class="titlepage"><div><div><h3 class="title" id="set-up-your-layer-for-the-build">5.12.4. Set Up Your Layer for the Build<span class="permalink"><a alt="Permalink" title="Permalink" href="#set-up-your-layer-for-the-build">¶</a></span></h3></div></div></div><p>These steps get your layer set up for the build:
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Create additional structure</em></span>:
                        Create the additional layer structure:
                        </p><pre class="literallayout">
     $ cd ~/poky/meta-mylayer
     $ mkdir conf
     $ mkdir recipes-kernel
     $ mkdir recipes-kernel/linux
     $ mkdir recipes-kernel/linux/linux-yocto
                         </pre><p>
                         The <code class="filename">conf</code> directory holds your configuration files, while the
                         <code class="filename">recipes-kernel</code> directory holds your append file and
                         your patch file.</p></li><li class="listitem"><p><span class="emphasis"><em>Create the layer configuration file</em></span>:
                        Move to the <code class="filename">meta-mylayer/conf</code> directory and create
                        the <code class="filename">layer.conf</code> file as follows:
                        </p><pre class="literallayout">
     # We have a conf and classes directory, add to BBPATH
     BBPATH .= ":${LAYERDIR}"

     # We have recipes-* directories, add to BBFILES
     BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \
                 ${LAYERDIR}/recipes-*/*/*.bbappend"

     BBFILE_COLLECTIONS += "mylayer"
     BBFILE_PATTERN_mylayer = "^${LAYERDIR}/"
     BBFILE_PRIORITY_mylayer = "5"
                         </pre><p>
                         Notice <code class="filename">mylayer</code> as part of the last three
                         statements.</p></li><li class="listitem"><p><span class="emphasis"><em>Create the kernel recipe append file</em></span>:
                        Move to the <code class="filename">meta-mylayer/recipes-kernel/linux</code> directory and create
                        the <code class="filename">linux-yocto_3.4.bbappend</code> file as follows:
                        </p><pre class="literallayout">
     FILESEXTRAPATHS_prepend := "${THISDIR}/${PN}:"

     SRC_URI += "file://0001-calibrate-Add-printk-example.patch"
                        </pre><p>
                        The <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FILESEXTRAPATHS" target="_top"><code class="filename">FILESEXTRAPATHS</code></a>
                        and <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                        statements enable the OpenEmbedded build system to find the patch file.
                        For more information on using append files, see the
                        "<a class="link" href="#using-bbappend-files" title="5.1.6. Using .bbappend Files">Using .bbappend Files</a>"
                        section.
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Put the patch file in your layer</em></span>:
                        Move the <code class="filename">0001-calibrate-Add-printk-example.patch</code> file to
                        the <code class="filename">meta-mylayer/recipes-kernel/linux/linux-yocto</code>
                        directory.</p></li></ol></div><p>
            </p></div><div class="section" title="5.12.5. Set Up for the Build"><div class="titlepage"><div><div><h3 class="title" id="set-up-for-the-build">5.12.5. Set Up for the Build<span class="permalink"><a alt="Permalink" title="Permalink" href="#set-up-for-the-build">¶</a></span></h3></div></div></div><p>
                Do the following to make sure the build parameters are set up for the example.
                Once you set up these build parameters, they do not have to change unless you
                change the target architecture of the machine you are building:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Build for the correct target architecture:</em></span> Your
                        selected <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                        definition within the <code class="filename">local.conf</code> file in the
                        <a class="link" href="#build-directory">Build Directory</a>
                        specifies the target architecture used when building the Linux kernel.
                        By default, <code class="filename">MACHINE</code> is set to
                        <code class="filename">qemux86</code>, which specifies a 32-bit
                        <span class="trademark">Intel</span>® Architecture
                        target machine suitable for the QEMU emulator.</p></li><li class="listitem"><p><span class="emphasis"><em>Identify your <code class="filename">meta-mylayer</code>
                        layer:</em></span> The
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBLAYERS" target="_top"><code class="filename">BBLAYERS</code></a>
                        variable in the
                        <code class="filename">bblayers.conf</code> file found in the
                        <code class="filename">poky/build/conf</code> directory needs to have the path to your local
                        <code class="filename">meta-mylayer</code> layer.
                        By default, the <code class="filename">BBLAYERS</code> variable contains paths to
                        <code class="filename">meta</code>, <code class="filename">meta-poky</code>, and
                        <code class="filename">meta-yocto-bsp</code> in the
                        <code class="filename">poky</code> Git repository.
                        Add the path to your <code class="filename">meta-mylayer</code> location:
                        </p><pre class="literallayout">
     BBLAYERS ?= " \
       $HOME/poky/meta \
       $HOME/poky/meta-poky \
       $HOME/poky/meta-yocto-bsp \
       $HOME/poky/meta-mylayer \
       "
                        </pre></li></ul></div><p>
            </p></div><div class="section" title="5.12.6. Build the Modified QEMU Kernel Image"><div class="titlepage"><div><div><h3 class="title" id="build-the-modified-qemu-kernel-image">5.12.6. Build the Modified QEMU Kernel Image<span class="permalink"><a alt="Permalink" title="Permalink" href="#build-the-modified-qemu-kernel-image">¶</a></span></h3></div></div></div><p>
                The following steps build your modified kernel image:
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Be sure your build environment is initialized</em></span>:
                        Your environment should be set up since you previously sourced
                        the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
                        script.
                        If it is not, source the script again from <code class="filename">poky</code>.
                        </p><pre class="literallayout">
     $ cd ~/poky
     $ source oe-init-build-env
                        </pre><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Clean up</em></span>:
                        Be sure to clean the shared state out by using BitBake
                        to run from within the Build Directory the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-cleansstate" target="_top"><code class="filename">do_cleansstate</code></a>
                        task as follows:
                        </p><pre class="literallayout">
     $ bitbake -c cleansstate linux-yocto
                        </pre><p>
                           </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                               Never remove any files by hand from the
                               <code class="filename">tmp/deploy</code>
                               directory inside the
                               <a class="link" href="#build-directory">Build Directory</a>.
                               Always use the various BitBake clean tasks to
                               clear out previous build artifacts.
                               For information on the clean tasks, see the
                               "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-clean" target="_top"><code class="filename">do_clean</code></a>",
                               "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-cleanall" target="_top"><code class="filename">do_cleanall</code></a>",
                               and
                               "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-tasks-cleansstate" target="_top"><code class="filename">do_cleansstate</code></a>"
                               sections all in the Yocto Project Reference
                               Manual.
                           </div><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>Build the image</em></span>:
                        Next, build the kernel image using this command:
                        </p><pre class="literallayout">
     $ bitbake -k linux-yocto
                        </pre></li></ol></div><p>
            </p></div><div class="section" title="5.12.7. Boot the Image and Verify Your Changes"><div class="titlepage"><div><div><h3 class="title" id="boot-the-image-and-verify-your-changes">5.12.7. Boot the Image and Verify Your Changes<span class="permalink"><a alt="Permalink" title="Permalink" href="#boot-the-image-and-verify-your-changes">¶</a></span></h3></div></div></div><p>
                These steps boot the image and allow you to see the changes
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Boot the image</em></span>:
                        Boot the modified image in the QEMU emulator
                        using this command:
                        </p><pre class="literallayout">
     $ runqemu qemux86
                        </pre></li><li class="listitem"><p><span class="emphasis"><em>Verify the changes</em></span>:
                        Log into the machine using <code class="filename">root</code> with no password and then
                        use the following shell command to scroll through the console's boot output.
                        </p><pre class="literallayout">
     # dmesg | less
                        </pre><p>
                        You should see the results of your <code class="filename">printk</code> statements
                        as part of the output.</p></li></ol></div><p>
            </p></div></div><div class="section" title="5.13. Making Images More Secure"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="making-images-more-secure">5.13. Making Images More Secure<span class="permalink"><a alt="Permalink" title="Permalink" href="#making-images-more-secure">¶</a></span></h2></div></div></div><p>
            Security is of increasing concern for embedded devices.
            Consider the issues and problems discussed in just this
            sampling of work found across the Internet:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>
                    "<a class="ulink" href="https://www.schneier.com/blog/archives/2014/01/security_risks_9.html" target="_top">Security Risks of Embedded Systems</a>"</em></span>
                    by Bruce Schneier
                    </p></li><li class="listitem"><p><span class="emphasis"><em>
                    "<a class="ulink" href="http://internetcensus2012.bitbucket.org/paper.html" target="_top">Internet Census 2012</a>"</em></span>
                    by Carna Botnet</p></li><li class="listitem"><p><span class="emphasis"><em>
                    "<a class="ulink" href="http://elinux.org/images/6/6f/Security-issues.pdf" target="_top">Security Issues for Embedded Devices</a>"</em></span>
                    by Jake Edge
                    </p></li></ul></div><p>
        </p><p>
            When securing your image is of concern, there are steps, tools,
            and variables that you can consider to help you reach the
            security goals you need for your particular device.
            Not all situations are identical when it comes to making an
            image secure.
            Consequently, this section provides some guidance and suggestions
            for consideration when you want to make your image more secure.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                Because the security requirements and risks are
                different for every type of device, this section cannot
                provide a complete reference on securing your custom OS.
                It is strongly recommended that you also consult other sources
                of information on embedded Linux system hardening and on
                security.
            </div><p>
        </p><div class="section" title="5.13.1. General Considerations"><div class="titlepage"><div><div><h3 class="title" id="general-considerations">5.13.1. General Considerations<span class="permalink"><a alt="Permalink" title="Permalink" href="#general-considerations">¶</a></span></h3></div></div></div><p>
                General considerations exist that help you create more
                secure images.
                You should consider the following suggestions to help
                make your device more secure:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        Scan additional code you are adding to the system
                        (e.g. application code) by using static analysis
                        tools.
                        Look for buffer overflows and other potential
                        security problems.
                    </p></li><li class="listitem"><p>
                        Pay particular attention to the security for
                        any web-based administration interface.
                        </p><p>Web interfaces typically need to perform
                        administrative functions and tend to need to run with
                        elevated privileges.
                        Thus, the consequences resulting from the interface's
                        security becoming compromised can be serious.
                        Look for common web vulnerabilities such as
                        cross-site-scripting (XSS), unvalidated inputs,
                        and so forth.</p><p>As with system passwords, the default credentials
                        for accessing a web-based interface should not be the
                        same across all devices.
                        This is particularly true if the interface is enabled
                        by default as it can be assumed that many end-users
                        will not change the credentials.
                    </p></li><li class="listitem"><p>
                        Ensure you can update the software on the device to
                        mitigate vulnerabilities discovered in the future.
                        This consideration especially applies when your
                        device is network-enabled.
                    </p></li><li class="listitem"><p>
                        Ensure you remove or disable debugging functionality
                        before producing the final image.
                        For information on how to do this, see the
                        "<a class="link" href="#considerations-specific-to-the-openembedded-build-system" title="5.13.3. Considerations Specific to the OpenEmbedded Build System">Considerations Specific to the OpenEmbedded Build System</a>"
                        section.
                        </p></li><li class="listitem"><p>
                        Ensure you have no network services listening that
                        are not needed.
                    </p></li><li class="listitem"><p>
                        Remove any software from the image that is not needed.
                    </p></li><li class="listitem"><p>
                        Enable hardware support for secure boot functionality
                        when your device supports this functionality.
                    </p></li></ul></div><p>
            </p></div><div class="section" title="5.13.2. Security Flags"><div class="titlepage"><div><div><h3 class="title" id="security-flags">5.13.2. Security Flags<span class="permalink"><a alt="Permalink" title="Permalink" href="#security-flags">¶</a></span></h3></div></div></div><p>
                The Yocto Project has security flags that you can enable that
                help make your build output more secure.
                The security flags are in the
                <code class="filename">meta/conf/distro/include/security_flags.inc</code>
                file in your
                <a class="link" href="#source-directory">Source Directory</a>
                (e.g. <code class="filename">poky</code>).
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Depending on the recipe, certain security flags are enabled
                    and disabled by default.
                </div><p>
            </p><p>

                Use the following line in your
                <code class="filename">local.conf</code> file or in your custom
                distribution configuration file to enable the security
                compiler and linker flags for your build:
                </p><pre class="literallayout">
     require conf/distro/include/security_flags.inc
                </pre><p>
            </p></div><div class="section" title="5.13.3. Considerations Specific to the OpenEmbedded Build System"><div class="titlepage"><div><div><h3 class="title" id="considerations-specific-to-the-openembedded-build-system">5.13.3. Considerations Specific to the OpenEmbedded Build System<span class="permalink"><a alt="Permalink" title="Permalink" href="#considerations-specific-to-the-openembedded-build-system">¶</a></span></h3></div></div></div><p>
                You can take some steps that are specific to the
                OpenEmbedded build system to make your images more secure:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        Ensure "debug-tweaks" is not one of your selected
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>.
                        When creating a new project, the default is to provide you
                        with an initial <code class="filename">local.conf</code> file that
                        enables this feature using the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTRA_IMAGE_FEATURES" target="_top"><code class="filename">EXTRA_IMAGE_FEATURES</code></a> variable with the line:
                </p><pre class="literallayout">
     EXTRA_IMAGE_FEATURES = "debug-tweaks"
                </pre><p>
                        To disable that feature, simply comment out that line in your
                        <code class="filename">local.conf</code> file, or
                        make sure <code class="filename">IMAGE_FEATURES</code> does not contain
                        "debug-tweaks" before producing your final image.
                        Among other things, leaving this in place sets the
                        root password as blank, which makes logging in for
                        debugging or inspection easy during
                        development but also means anyone can easily log in
                        during production.
                        </p></li><li class="listitem"><p>
                        It is possible to set a root password for the image
                        and also to set passwords for any extra users you might
                        add (e.g. administrative or service type users).
                        When you set up passwords for multiple images or
                        users, you should not duplicate passwords.
                        </p><p>
                        To set up passwords, use the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-extrausers" target="_top"><code class="filename">extrausers</code></a>
                        class, which is the preferred method.
                        For an example on how to set up both root and user
                        passwords, see the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-extrausers" target="_top"><code class="filename">extrausers.bbclass</code></a>"
                        section.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            When adding extra user accounts or setting a
                            root password, be cautious about setting the
                            same password on every device.
                            If you do this, and the password you have set
                            is exposed, then every device is now potentially
                            compromised.
                            If you need this access but want to ensure
                            security, consider setting a different,
                            random password for each device.
                            Typically, you do this as a separate step after
                            you deploy the image onto the device.
                        </div><p>
                        </p></li><li class="listitem"><p>
                        Consider enabling a Mandatory Access Control (MAC)
                        framework such as SMACK or SELinux and tuning it
                        appropriately for your device's usage.
                        You can find more information in the
                        <a class="ulink" href="http://git.yoctoproject.org/cgit/cgit.cgi/meta-selinux/" target="_top"><code class="filename">meta-selinux</code></a>
                        layer.
                        </p></li></ul></div><p>
            </p><p>
            </p></div><div class="section" title="5.13.4. Tools for Hardening Your Image"><div class="titlepage"><div><div><h3 class="title" id="tools-for-hardening-your-image">5.13.4. Tools for Hardening Your Image<span class="permalink"><a alt="Permalink" title="Permalink" href="#tools-for-hardening-your-image">¶</a></span></h3></div></div></div><p>
                The Yocto Project provides tools for making your image
                more secure.
                You can find these tools in the
                <code class="filename">meta-security</code> layer of the
                <a class="ulink" href="http://git.yoctoproject.org/cgit/cgit.cgi" target="_top">Yocto Project Source Repositories</a>.
            </p></div></div><div class="section" title="5.14. Creating Your Own Distribution"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="creating-your-own-distribution">5.14. Creating Your Own Distribution<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-your-own-distribution">¶</a></span></h2></div></div></div><p>
            When you build an image using the Yocto Project and
            do not alter any distribution
            <a class="link" href="#metadata">Metadata</a>, you are creating a
            Poky distribution.
            If you wish to gain more control over package alternative
            selections, compile-time options, and other low-level
            configurations, you can create your own distribution.
        </p><p>
            To create your own distribution, the basic steps consist of
            creating your own distribution layer, creating your own
            distribution configuration file, and then adding any needed
            code and Metadata to the layer.
            The following steps provide some more detail:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Create a layer for your new distro:</em></span>
                    Create your distribution layer so that you can keep your
                    Metadata and code for the distribution separate.
                    It is strongly recommended that you create and use your own
                    layer for configuration and code.
                    Using your own layer as compared to just placing
                    configurations in a <code class="filename">local.conf</code>
                    configuration file makes it easier to reproduce the same
                    build configuration when using multiple build machines.
                    See the
                    "<a class="link" href="#creating-a-general-layer-using-the-yocto-layer-script" title="5.1.9. Creating a General Layer Using the yocto-layer Script">Creating a General Layer Using the yocto-layer Script</a>"
                    section for information on how to quickly set up a layer.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Create the distribution configuration file:</em></span>
                    The distribution configuration file needs to be created in
                    the <code class="filename">conf/distro</code> directory of your
                    layer.
                    You need to name it using your distribution name
                    (e.g. <code class="filename">mydistro.conf</code>).
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        The
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO" target="_top"><code class="filename">DISTRO</code></a>
                        variable in your
                        <code class="filename">local.conf</code> file determines the
                        name of your distribution.
                    </div><p>You can split out parts of your configuration file
                    into include files and then "require" them from within
                    your distribution configuration file.
                    Be sure to place the include files in the
                    <code class="filename">conf/distro/include</code> directory of
                    your layer.
                    A common example usage of include files would be to
                    separate out the selection of desired version and revisions
                    for individual recipes.
</p><p>Your configuration file needs to set the following
                    required variables:
                    </p><pre class="literallayout">
     <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_NAME" target="_top"><code class="filename">DISTRO_NAME</code></a>
     <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_VERSION" target="_top"><code class="filename">DISTRO_VERSION</code></a>
                    </pre><p>
                    These following variables are optional and you typically
                    set them from the distribution configuration file:
                    </p><pre class="literallayout">
     <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_FEATURES" target="_top"><code class="filename">DISTRO_FEATURES</code></a>
     <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_EXTRA_RDEPENDS" target="_top"><code class="filename">DISTRO_EXTRA_RDEPENDS</code></a>
     <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_EXTRA_RRECOMMENDS" target="_top"><code class="filename">DISTRO_EXTRA_RRECOMMENDS</code></a>
     <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TCLIBC" target="_top"><code class="filename">TCLIBC</code></a>
                    </pre><p>
                    </p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>
                        If you want to base your distribution configuration file
                        on the very basic configuration from OE-Core, you
                        can use
                        <code class="filename">conf/distro/defaultsetup.conf</code> as
                        a reference and just include variables that differ
                        as compared to <code class="filename">defaultsetup.conf</code>.
                        Alternatively, you can create a distribution
                        configuration file from scratch using the
                        <code class="filename">defaultsetup.conf</code> file
                        or configuration files from other distributions
                        such as Poky or Angstrom as references.
                    </div></li><li class="listitem"><p><span class="emphasis"><em>Provide miscellaneous variables:</em></span>
                    Be sure to define any other variables for which you want to
                    create a default or enforce as part of the distribution
                    configuration.
                    You can include nearly any variable from the
                    <code class="filename">local.conf</code> file.
                    The variables you use are not limited to the list in the
                    previous bulleted item.</p></li><li class="listitem"><p><span class="emphasis"><em>Point to Your distribution configuration file:</em></span>
                    In your <code class="filename">local.conf</code> file in the
                    <a class="link" href="#build-directory">Build Directory</a>,
                    set your
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO" target="_top"><code class="filename">DISTRO</code></a>
                    variable to point to your distribution's configuration file.
                    For example, if your distribution's configuration file is
                    named <code class="filename">mydistro.conf</code>, then you point
                    to it as follows:
                    </p><pre class="literallayout">
     DISTRO = "mydistro"
                    </pre></li><li class="listitem"><p><span class="emphasis"><em>Add more to the layer if necessary:</em></span>
                    Use your layer to hold other information needed for the
                    distribution:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Add recipes for installing
                            distro-specific configuration files that are not
                            already installed by another recipe.
                            If you have distro-specific configuration files
                            that are included by an existing recipe, you should
                            add an append file (<code class="filename">.bbappend</code>)
                            for those.
                            For general information and recommendations
                            on how to add recipes to your layer, see the
                            "<a class="link" href="#creating-your-own-layer" title="5.1.2. Creating Your Own Layer">Creating Your Own Layer</a>"
                            and
                            "<a class="link" href="#best-practices-to-follow-when-creating-layers" title="5.1.3. Best Practices to Follow When Creating Layers">Best Practices to Follow When Creating Layers</a>"
                            sections.</p></li><li class="listitem"><p>Add any image recipes that are specific
                            to your distribution.</p></li><li class="listitem"><p>Add a <code class="filename">psplash</code>
                            append file for a branded splash screen.
                            For information on append files, see the
                            "<a class="link" href="#using-bbappend-files" title="5.1.6. Using .bbappend Files">Using .bbappend Files</a>"
                            section.</p></li><li class="listitem"><p>Add any other append files to make
                            custom changes that are specific to individual
                            recipes.</p></li></ul></div></li></ul></div><p>
        </p></div><div class="section" title="5.15. Creating a Custom Template Configuration Directory"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="creating-a-custom-template-configuration-directory">5.15. Creating a Custom Template Configuration Directory<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-a-custom-template-configuration-directory">¶</a></span></h2></div></div></div><p>
            If you are producing your own customized version
            of the build system for use by other users, you might
            want to customize the message shown by the setup script or
            you might want to change the template configuration files (i.e.
            <code class="filename">local.conf</code> and
            <code class="filename">bblayers.conf</code>) that are created in
            a new build directory.
        </p><p>
            The OpenEmbedded build system uses the environment variable
            <code class="filename">TEMPLATECONF</code> to locate the directory
            from which it gathers configuration information that ultimately
            ends up in the
            <a class="link" href="#build-directory">Build Directory's</a>
            <code class="filename">conf</code> directory.
            By default, <code class="filename">TEMPLATECONF</code> is set as
            follows in the <code class="filename">poky</code> repository:
            </p><pre class="literallayout">
     TEMPLATECONF=${TEMPLATECONF:-meta-poky/conf}
            </pre><p>
            This is the directory used by the build system to find templates
            from which to build some key configuration files.
            If you look at this directory, you will see the
            <code class="filename">bblayers.conf.sample</code>,
            <code class="filename">local.conf.sample</code>, and
            <code class="filename">conf-notes.txt</code> files.
            The build system uses these files to form the respective
            <code class="filename">bblayers.conf</code> file,
            <code class="filename">local.conf</code> file, and display the list of
            BitBake targets when running the setup script.
        </p><p>
            To override these default configuration files with
            configurations you want used within every new
            Build Directory, simply set the
            <code class="filename">TEMPLATECONF</code> variable to your directory.
            The <code class="filename">TEMPLATECONF</code> variable is set in the
            <code class="filename">.templateconf</code> file, which is in the
            top-level
            <a class="link" href="#source-directory">Source Directory</a>
            folder (e.g. <code class="filename">poky</code>).
            Edit the <code class="filename">.templateconf</code> so that it can locate
            your directory.
        </p><p>
            Best practices dictate that you should keep your
            template configuration directory in your custom distribution layer.
            For example, suppose you have a layer named
            <code class="filename">meta-mylayer</code> located in your home directory
            and you want your template configuration directory named
            <code class="filename">myconf</code>.
            Changing the <code class="filename">.templateconf</code> as follows
            causes the OpenEmbedded build system to look in your directory
            and base its configuration files on the
            <code class="filename">*.sample</code> configuration files it finds.
            The final configuration files (i.e.
            <code class="filename">local.conf</code> and
            <code class="filename">bblayers.conf</code> ultimately still end up in
            your Build Directory, but they are based on your
            <code class="filename">*.sample</code> files.
            </p><pre class="literallayout">
     TEMPLATECONF=${TEMPLATECONF:-meta-mylayer/myconf}
            </pre><p>
        </p><p>
            Aside from the <code class="filename">*.sample</code> configuration files,
            the <code class="filename">conf-notes.txt</code> also resides in the
            default <code class="filename">meta-poky/conf</code> directory.
            The scripts that set up the build environment
            (i.e.
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
            and
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>)
            use this file to display BitBake targets as part of the script
            output.
            Customizing this <code class="filename">conf-notes.txt</code> file is a
            good way to make sure your list of custom targets appears
            as part of the script's output.
        </p><p>
            Here is the default list of targets displayed as a result of
            running either of the setup scripts:
            </p><pre class="literallayout">
     You can now run 'bitbake &lt;target&gt;'

     Common targets are:
         core-image-minimal
         core-image-sato
         meta-toolchain
         meta-ide-support
            </pre><p>
        </p><p>
            Changing the listed common targets is as easy as editing your
            version of <code class="filename">conf-notes.txt</code> in your
            custom template configuration directory and making sure you
            have <code class="filename">TEMPLATECONF</code> set to your directory.
        </p></div><div class="section" title="5.16. Building a Tiny System"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="building-a-tiny-system">5.16. Building a Tiny System<span class="permalink"><a alt="Permalink" title="Permalink" href="#building-a-tiny-system">¶</a></span></h2></div></div></div><p>
            Very small distributions have some significant advantages such
            as requiring less on-die or in-package memory (cheaper), better
            performance through efficient cache usage, lower power requirements
            due to less memory, faster boot times, and reduced development
            overhead.
            Some real-world examples where a very small distribution gives
            you distinct advantages are digital cameras, medical devices,
            and small headless systems.
        </p><p>
            This section presents information that shows you how you can
            trim your distribution to even smaller sizes than the
            <code class="filename">poky-tiny</code> distribution, which is around
            5 Mbytes, that can be built out-of-the-box using the Yocto Project.
        </p><div class="section" title="5.16.1. Overview"><div class="titlepage"><div><div><h3 class="title" id="tiny-system-overview">5.16.1. Overview<span class="permalink"><a alt="Permalink" title="Permalink" href="#tiny-system-overview">¶</a></span></h3></div></div></div><p>
                The following list presents the overall steps you need to
                consider and perform to create distributions with smaller
                root filesystems, achieve faster boot times, maintain your critical
                functionality, and avoid initial RAM disks:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        <a class="link" href="#goals-and-guiding-principles" title="5.16.2. Goals and Guiding Principles">Determine your goals and guiding principles.</a>
                        </p></li><li class="listitem"><p>
                        <a class="link" href="#understand-what-gives-your-image-size" title="5.16.3. Understand What Contributes to Your Image Size">Understand what contributes to your image size.</a>
                        </p></li><li class="listitem"><p>
                        <a class="link" href="#trim-the-root-filesystem" title="5.16.4. Trim the Root Filesystem">Reduce the size of the root filesystem.</a>
                        </p></li><li class="listitem"><p>
                        <a class="link" href="#trim-the-kernel" title="5.16.5. Trim the Kernel">Reduce the size of the kernel.</a>
                        </p></li><li class="listitem"><p>
                        <a class="link" href="#remove-package-management-requirements" title="5.16.6. Remove Package Management Requirements">Eliminate packaging requirements.</a>
                        </p></li><li class="listitem"><p>
                        <a class="link" href="#look-for-other-ways-to-minimize-size" title="5.16.7. Look for Other Ways to Minimize Size">Look for other ways to minimize size.</a>
                        </p></li><li class="listitem"><p>
                        <a class="link" href="#iterate-on-the-process" title="5.16.8. Iterate on the Process">Iterate on the process.</a>
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.16.2. Goals and Guiding Principles"><div class="titlepage"><div><div><h3 class="title" id="goals-and-guiding-principles">5.16.2. Goals and Guiding Principles<span class="permalink"><a alt="Permalink" title="Permalink" href="#goals-and-guiding-principles">¶</a></span></h3></div></div></div><p>
                Before you can reach your destination, you need to know
                where you are going.
                Here is an example list that you can use as a guide when
                creating very small distributions:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Determine how much space you need
                        (e.g. a kernel that is 1 Mbyte or less and
                        a root filesystem that is 3 Mbytes or less).
                        </p></li><li class="listitem"><p>Find the areas that are currently
                        taking 90% of the space and concentrate on reducing
                        those areas.
                        </p></li><li class="listitem"><p>Do not create any difficult "hacks"
                        to achieve your goals.</p></li><li class="listitem"><p>Leverage the device-specific
                        options.</p></li><li class="listitem"><p>Work in a separate layer so that you
                        keep changes isolated.
                        For information on how to create layers, see
                        the "<a class="link" href="#understanding-and-creating-layers" title="5.1. Understanding and Creating Layers">Understanding and Creating Layers</a>" section.
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.16.3. Understand What Contributes to Your Image Size"><div class="titlepage"><div><div><h3 class="title" id="understand-what-gives-your-image-size">5.16.3. Understand What Contributes to Your Image Size<span class="permalink"><a alt="Permalink" title="Permalink" href="#understand-what-gives-your-image-size">¶</a></span></h3></div></div></div><p>
                It is easiest to have something to start with when creating
                your own distribution.
                You can use the Yocto Project out-of-the-box to create the
                <code class="filename">poky-tiny</code> distribution.
                Ultimately, you will want to make changes in your own
                distribution that are likely modeled after
                <code class="filename">poky-tiny</code>.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    To use <code class="filename">poky-tiny</code> in your build,
                    set the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO" target="_top"><code class="filename">DISTRO</code></a>
                    variable in your
                    <code class="filename">local.conf</code> file to "poky-tiny"
                    as described in the
                    "<a class="link" href="#creating-your-own-distribution" title="5.14. Creating Your Own Distribution">Creating Your Own Distribution</a>"
                    section.
                </div><p>
            </p><p>
                Understanding some memory concepts will help you reduce the
                system size.
                Memory consists of static, dynamic, and temporary memory.
                Static memory is the TEXT (code), DATA (initialized data
                in the code), and BSS (uninitialized data) sections.
                Dynamic memory represents memory that is allocated at runtime:
                stacks, hash tables, and so forth.
                Temporary memory is recovered after the boot process.
                This memory consists of memory used for decompressing
                the kernel and for the <code class="filename">__init__</code>
                functions.
            </p><p>
                To help you see where you currently are with kernel and root
                filesystem sizes, you can use two tools found in the
                <a class="link" href="#source-directory">Source Directory</a> in
                the <code class="filename">scripts/tiny/</code> directory:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">ksize.py</code>: Reports
                        component sizes for the kernel build objects.
                        </p></li><li class="listitem"><p><code class="filename">dirsize.py</code>: Reports
                        component sizes for the root filesystem.</p></li></ul></div><p>
                This next tool and command help you organize configuration
                fragments and view file dependencies in a human-readable form:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">merge_config.sh</code>:
                        Helps you manage configuration files and fragments
                        within the kernel.
                        With this tool, you can merge individual configuration
                        fragments together.
                        The tool allows you to make overrides and warns you
                        of any missing configuration options.
                        The tool is ideal for allowing you to iterate on
                        configurations, create minimal configurations, and
                        create configuration files for different machines
                        without having to duplicate your process.</p><p>The <code class="filename">merge_config.sh</code> script is
                        part of the Linux Yocto kernel Git repositories
                        (i.e. <code class="filename">linux-yocto-3.14</code>,
                        <code class="filename">linux-yocto-3.10</code>,
                        <code class="filename">linux-yocto-3.8</code>, and so forth)
                        in the
                        <code class="filename">scripts/kconfig</code> directory.</p><p>For more information on configuration fragments,
                        see the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/kernel-dev/kernel-dev.html#generating-configuration-files" target="_top">Generating Configuration Files</a>"
                        section of the Yocto Project Linux Kernel Development
                        Manual and the "<a class="link" href="#creating-config-fragments" title="5.11.3. Creating Configuration Fragments">Creating Configuration Fragments</a>"
                        section, which is in this manual.</p></li><li class="listitem"><p><code class="filename">bitbake -u depexp -g <em class="replaceable"><code>bitbake_target</code></em></code>:
                        Using the BitBake command with these options brings up
                        a Dependency Explorer from which you can view file
                        dependencies.
                        Understanding these dependencies allows you to make
                        informed decisions when cutting out various pieces of the
                        kernel and root filesystem.</p></li></ul></div><p>
            </p></div><div class="section" title="5.16.4. Trim the Root Filesystem"><div class="titlepage"><div><div><h3 class="title" id="trim-the-root-filesystem">5.16.4. Trim the Root Filesystem<span class="permalink"><a alt="Permalink" title="Permalink" href="#trim-the-root-filesystem">¶</a></span></h3></div></div></div><p>
                The root filesystem is made up of packages for booting,
                libraries, and applications.
                To change things, you can configure how the packaging happens,
                which changes the way you build them.
                You can also modify the filesystem itself or select a different
                filesystem.
            </p><p>
                First, find out what is hogging your root filesystem by running the
                <code class="filename">dirsize.py</code> script from your root directory:
                </p><pre class="literallayout">
     $ cd <em class="replaceable"><code>root-directory-of-image</code></em>
     $ dirsize.py 100000 &gt; dirsize-100k.log
     $ cat dirsize-100k.log
                </pre><p>
                You can apply a filter to the script to ignore files under
                a certain size.
                The previous example filters out any files below 100 Kbytes.
                The sizes reported by the tool are uncompressed, and thus
                will be smaller by a relatively constant factor in a
                compressed root filesystem.
                When you examine your log file, you can focus on areas of the
                root filesystem that take up large amounts of memory.
            </p><p>
                You need to be sure that what you eliminate does not cripple
                the functionality you need.
                One way to see how packages relate to each other is by using
                the Dependency Explorer UI with the BitBake command:
                </p><pre class="literallayout">
     $ cd <em class="replaceable"><code>image-directory</code></em>
     $ bitbake -u depexp -g <em class="replaceable"><code>image</code></em>
                </pre><p>
                Use the interface to select potential packages you wish to
                eliminate and see their dependency relationships.
            </p><p>
                When deciding how to reduce the size, get rid of packages that
                result in minimal impact on the feature set.
                For example, you might not need a VGA display.
                Or, you might be able to get by with <code class="filename">devtmpfs</code>
                and <code class="filename">mdev</code> instead of
                <code class="filename">udev</code>.
            </p><p>
                Use your <code class="filename">local.conf</code> file to make changes.
                For example, to eliminate <code class="filename">udev</code> and
                <code class="filename">glib</code>, set the following in the
                local configuration file:
                </p><pre class="literallayout">
     VIRTUAL-RUNTIME_dev_manager = ""
                </pre><p>
            </p><p>
                Finally, you should consider exactly the type of root
                filesystem you need to meet your needs while also reducing
                its size.
                For example, consider <code class="filename">cramfs</code>,
                <code class="filename">squashfs</code>, <code class="filename">ubifs</code>,
                <code class="filename">ext2</code>, or an <code class="filename">initramfs</code>
                using <code class="filename">initramfs</code>.
                Be aware that <code class="filename">ext3</code> requires a 1 Mbyte
                journal.
                If you are okay with running read-only, you do not need this
                journal.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                After each round of elimination, you need to rebuild your
                system and then use the tools to see the effects of your
                reductions.
            </div></div><div class="section" title="5.16.5. Trim the Kernel"><div class="titlepage"><div><div><h3 class="title" id="trim-the-kernel">5.16.5. Trim the Kernel<span class="permalink"><a alt="Permalink" title="Permalink" href="#trim-the-kernel">¶</a></span></h3></div></div></div><p>
                The kernel is built by including policies for hardware-independent
                aspects.
                What subsystems do you enable?
                For what architecture are you building?
                Which drivers do you build by default?
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>You can modify the kernel source if you want to help
                    with boot time.
                </div><p>
            </p><p>
                Run the <code class="filename">ksize.py</code> script from the top-level
                Linux build directory to get an idea of what is making up
                the kernel:
                </p><pre class="literallayout">
     $ cd <em class="replaceable"><code>top-level-linux-build-directory</code></em>
     $ ksize.py &gt; ksize.log
     $ cat ksize.log
                </pre><p>
                When you examine the log, you will see how much space is
                taken up with the built-in <code class="filename">.o</code> files for
                drivers, networking, core kernel files, filesystem, sound,
                and so forth.
                The sizes reported by the tool are uncompressed, and thus
                will be smaller by a relatively constant factor in a compressed
                kernel image.
                Look to reduce the areas that are large and taking up around
                the "90% rule."
            </p><p>
                To examine, or drill down, into any particular area, use the
                <code class="filename">-d</code> option with the script:
                </p><pre class="literallayout">
     $ ksize.py -d &gt; ksize.log
                </pre><p>
                Using this option breaks out the individual file information
                for each area of the kernel (e.g. drivers, networking, and
                so forth).
            </p><p>
                Use your log file to see what you can eliminate from the kernel
                based on features you can let go.
                For example, if you are not going to need sound, you do not
                need any drivers that support sound.
            </p><p>
                After figuring out what to eliminate, you need to reconfigure
                the kernel to reflect those changes during the next build.
                You could run <code class="filename">menuconfig</code> and make all your
                changes at once.
                However, that makes it difficult to see the effects of your
                individual eliminations and also makes it difficult to replicate
                the changes for perhaps another target device.
                A better method is to start with no configurations using
                <code class="filename">allnoconfig</code>, create configuration
                fragments for individual changes, and then manage the
                fragments into a single configuration file using
                <code class="filename">merge_config.sh</code>.
                The tool makes it easy for you to iterate using the
                configuration change and build cycle.
            </p><p>
                Each time you make configuration changes, you need to rebuild
                the kernel and check to see what impact your changes had on
                the overall size.
            </p></div><div class="section" title="5.16.6. Remove Package Management Requirements"><div class="titlepage"><div><div><h3 class="title" id="remove-package-management-requirements">5.16.6. Remove Package Management Requirements<span class="permalink"><a alt="Permalink" title="Permalink" href="#remove-package-management-requirements">¶</a></span></h3></div></div></div><p>
                Packaging requirements add size to the image.
                One way to reduce the size of the image is to remove all the
                packaging requirements from the image.
                This reduction includes both removing the package manager
                and its unique dependencies as well as removing the package
                management data itself.
            </p><p>
                To eliminate all the packaging requirements for an image,
                be sure that "package-management" is not part of your
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>
                statement for the image.
                When you remove this feature, you are removing the package
                manager as well as its dependencies from the root filesystem.
            </p></div><div class="section" title="5.16.7. Look for Other Ways to Minimize Size"><div class="titlepage"><div><div><h3 class="title" id="look-for-other-ways-to-minimize-size">5.16.7. Look for Other Ways to Minimize Size<span class="permalink"><a alt="Permalink" title="Permalink" href="#look-for-other-ways-to-minimize-size">¶</a></span></h3></div></div></div><p>
                Depending on your particular circumstances, other areas that you
                can trim likely exist.
                The key to finding these areas is through tools and methods
                described here combined with experimentation and iteration.
                Here are a couple of areas to experiment with:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">glibc</code>:
                        In general, follow this process:
                        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Remove <code class="filename">glibc</code>
                                features from
                                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_FEATURES" target="_top"><code class="filename">DISTRO_FEATURES</code></a>
                                that you think you do not need.</p></li><li class="listitem"><p>Build your distribution.
                                </p></li><li class="listitem"><p>If the build fails due to missing
                                symbols in a package, determine if you can
                                reconfigure the package to not need those
                                features.
                                For example, change the configuration to not
                                support wide character support as is done for
                                <code class="filename">ncurses</code>.
                                Or, if support for those characters is needed,
                                determine what <code class="filename">glibc</code>
                                features provide the support and restore the
                                configuration.
                                </p></li><li class="listitem"><p>Rebuild and repeat the process.
                                </p></li></ol></div></li><li class="listitem"><p><code class="filename">busybox</code>:
                        For BusyBox, use a process similar as described for
                        <code class="filename">glibc</code>.
                        A difference is you will need to boot the resulting
                        system to see if you are able to do everything you
                        expect from the running system.
                        You need to be sure to integrate configuration fragments
                        into Busybox because BusyBox handles its own core
                        features and then allows you to add configuration
                        fragments on top.
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.16.8. Iterate on the Process"><div class="titlepage"><div><div><h3 class="title" id="iterate-on-the-process">5.16.8. Iterate on the Process<span class="permalink"><a alt="Permalink" title="Permalink" href="#iterate-on-the-process">¶</a></span></h3></div></div></div><p>
                If you have not reached your goals on system size, you need
                to iterate on the process.
                The process is the same.
                Use the tools and see just what is taking up 90% of the root
                filesystem and the kernel.
                Decide what you can eliminate without limiting your device
                beyond what you need.
            </p><p>
                Depending on your system, a good place to look might be
                Busybox, which provides a stripped down
                version of Unix tools in a single, executable file.
                You might be able to drop virtual terminal services or perhaps
                ipv6.
            </p></div></div><div class="section" title="5.17. Building Images for More than One Machine"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="building-images-for-more-than-one-machine">5.17. Building Images for More than One Machine<span class="permalink"><a alt="Permalink" title="Permalink" href="#building-images-for-more-than-one-machine">¶</a></span></h2></div></div></div><p>
            A common scenario developers face is creating images for several
            different machines that use the same software environment.
            In this situation, it is tempting to set the
            tunings and optimization flags for each build specifically for
            the targeted hardware (i.e. "maxing out" the tunings).
            Doing so can considerably add to build times and package feed
            maintenance collectively for the machines.
            For example, selecting tunes that are extremely specific to a
            CPU core used in a system might enable some micro optimizations
            in GCC for that particular system but would otherwise not gain
            you much of a performance difference across the other systems
            as compared to using a more general tuning across all the builds
            (e.g. setting
            <a class="ulink" href="var-DEFAULTTUNE" target="_top"><code class="filename">DEFAULTTUNE</code></a>
            specifically for each machine's build).
            Rather than "max out" each build's tunings, you can take steps that
            cause the OpenEmbedded build system to reuse software across the
            various machines where it makes sense.
        </p><p>
            If build speed and package feed maintenance are considerations,
            you should consider the points in this section that can help you
            optimize your tunings to best consider build times and package
            feed maintenance.
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Share the Build Directory:</em></span>
                    If at all possible, share the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TMPDIR" target="_top"><code class="filename">TMPDIR</code></a>
                    across builds.
                    The Yocto Project supports switching between different
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>
                    values in the same <code class="filename">TMPDIR</code>.
                    This practice is well supported and regularly used by
                    developers when building for multiple machines.
                    When you use the same <code class="filename">TMPDIR</code> for
                    multiple machine builds, the OpenEmbedded build system can
                    reuse the existing native and often cross-recipes for
                    multiple machines.
                    Thus, build time decreases.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        If
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO" target="_top"><code class="filename">DISTRO</code></a>
                        settings change or fundamental configuration settings
                        such as the filesystem layout, you need to work with
                        a clean <code class="filename">TMPDIR</code>.
                        Sharing <code class="filename">TMPDIR</code> under these
                        circumstances might work but since it is not
                        guaranteed, you should use a clean
                        <code class="filename">TMPDIR</code>.
                    </div><p>
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Enable the Appropriate Package Architecture:</em></span>
                    By default, the OpenEmbedded build system enables three
                    levels of package architectures: "all", "tune" or "package",
                    and "machine".
                    Any given recipe usually selects one of these package
                    architectures (types) for its output.
                    Depending for what a given recipe creates packages, making
                    sure you enable the appropriate package architecture can
                    directly impact the build time.</p><p>A recipe that just generates scripts can enable
                    "all" architecture because there are no binaries to build.
                    To specifically enable "all" architecture, be sure your
                    recipe inherits the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-allarch" target="_top"><code class="filename">allarch</code></a>
                    class.
                    This class is useful for "all" architectures because it
                    configures many variables so packages can be used across
                    multiple architectures.</p><p>If your recipe needs to generate packages that are
                    machine-specific or when one of the build or runtime
                    dependencies is already machine-architecture dependent,
                    which makes your recipe also machine-architecture dependent,
                    make sure your recipe enables the "machine" package
                    architecture through the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE_ARCH" target="_top"><code class="filename">MACHINE_ARCH</code></a>
                    variable:
                    </p><pre class="literallayout">
     PACKAGE_ARCH = "${MACHINE_ARCH}"
                    </pre><p>
                    When you do not specifically enable a package
                    architecture through the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_ARCH" target="_top"><code class="filename">PACKAGE_ARCH</code></a>,
                    The OpenEmbedded build system defaults to the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TUNE_PKGARCH" target="_top"><code class="filename">TUNE_PKGARCH</code></a>
                    setting:
                    </p><pre class="literallayout">
     PACKAGE_ARCH = "${TUNE_PKGARCH}"
                    </pre><p>
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Choose a Generic Tuning File if Possible:</em></span>
                    Some tunes are more generic and can run on multiple targets
                    (e.g. an <code class="filename">armv5</code> set of packages could
                    run on <code class="filename">armv6</code> and
                    <code class="filename">armv7</code> processors in most cases).
                    Similarly, <code class="filename">i486</code> binaries could work
                    on <code class="filename">i586</code> and higher processors.
                    You should realize, however, that advances on newer
                    processor versions would not be used.</p><p>If you select the same tune for several different
                    machines, the OpenEmbedded build system reuses software
                    previously built, thus speeding up the overall build time.
                    Realize that even though a new sysroot for each machine is
                    generated, the software is not recompiled and only one
                    package feed exists.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Manage Granular Level Packaging:</em></span>
                    Sometimes cases exist where injecting another level
                    of package architecture beyond the three higher levels
                    noted earlier can be useful.
                    For example, consider the <code class="filename">emgd</code>
                    graphics stack in the
                    <code class="filename">meta-intel</code> layer.
                    In this layer, a subset of software exists that is
                    compiled against something different from the rest of the
                    generic packages.
                    You can examine the key code in the
                    <a class="ulink" href="http://git.yoctoproject.org/cgit/cgit.cgi" target="_top">Source Repositories</a>
                    "daisy" branch in
                    <code class="filename">classes/emgd-gl.bbclass</code>.
                    For a specific set of packages, the code redefines
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_ARCH" target="_top"><code class="filename">PACKAGE_ARCH</code></a>.
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_EXTRA_ARCHS" target="_top"><code class="filename">PACKAGE_EXTRA_ARCHS</code></a>
                    is then appended with this extra tune name in
                    <code class="filename">meta-intel-emgd.inc</code>.
                    The result is that when searching for packages, the
                    build system uses a four-level search and the packages
                    in this new level are preferred as compared to the standard
                    tune.
                    The overall result is that the build system reuses most
                    software from the common tune except for specific cases
                    as needed.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Use Tools to Debug Issues:</em></span>
                    Sometimes you can run into situations where software is
                    being rebuilt when you think it should not be.
                    For example, the OpenEmbedded build system might not be
                    using shared state between machines when you think it
                    should be.
                    These types of situations are usually due to references
                    to machine-specific variables such as
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SERIAL_CONSOLE" target="_top"><code class="filename">SERIAL_CONSOLE</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-XSERVER" target="_top"><code class="filename">XSERVER</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-MACHINE_FEATURES" target="_top"><code class="filename">MACHINE_FEATURES</code></a>,
                    and so forth in code that is supposed to only be
                    tune-specific or when the recipe depends
                    (<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RDEPENDS" target="_top"><code class="filename">RDEPENDS</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RRECOMMENDS" target="_top"><code class="filename">RRECOMMENDS</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RSUGGESTS" target="_top"><code class="filename">RSUGGESTS</code></a>,
                    and so forth) on some other recipe that already has
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_ARCH" target="_top"><code class="filename">PACKAGE_ARCH</code></a>
                    defined as "${MACHINE_ARCH}".
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        Patches to fix any issues identified are most welcome
                        as these issues occasionally do occur.
                    </div><p>For such cases, you can use some tools to help you
                    sort out the situation:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><span class="emphasis"><em><code class="filename">sstate-diff-machines.sh</code>:</em></span>
                            You can find this tool in the
                            <code class="filename">scripts</code> directory of the
                            Source Repositories.
                            See the comments in the script for information on
                            how to use the tool.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>BitBake's "-S printdiff" Option:</em></span>
                            Using this option causes BitBake to try to
                            establish the closest signature match it can
                            (e.g. in the shared state cache) and then run
                            <code class="filename">bitbake-diffsigs</code> over the
                            matches to determine the stamps and delta where
                            these two stamp trees diverge.
                            </p></li></ul></div><p>
                    </p></li></ul></div><p>
        </p></div><div class="section" title="5.18. Working with Packages"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="working-with-packages">5.18. Working with Packages<span class="permalink"><a alt="Permalink" title="Permalink" href="#working-with-packages">¶</a></span></h2></div></div></div><p>
            This section describes a few tasks that involve packages:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    <a class="link" href="#excluding-packages-from-an-image" title="5.18.1. Excluding Packages from an Image">Excluding packages from an image</a>
                    </p></li><li class="listitem"><p>
                    <a class="link" href="#incrementing-a-binary-package-version" title="5.18.2. Incrementing a Package Version">Incrementing a binary package version</a>
                    </p></li><li class="listitem"><p>
                    <a class="link" href="#handling-optional-module-packaging" title="5.18.3. Handling Optional Module Packaging">Handling optional module packaging</a>
                    </p></li><li class="listitem"><p>
                    <a class="link" href="#using-runtime-package-management" title="5.18.4. Using Runtime Package Management">Using Runtime Package Management</a>
                    </p></li><li class="listitem"><p>
                    <a class="link" href="#testing-packages-with-ptest" title="5.18.6. Testing Packages With ptest">Setting up and running package test (ptest)</a>
                    </p></li></ul></div><p>
        </p><div class="section" title="5.18.1. Excluding Packages from an Image"><div class="titlepage"><div><div><h3 class="title" id="excluding-packages-from-an-image">5.18.1. Excluding Packages from an Image<span class="permalink"><a alt="Permalink" title="Permalink" href="#excluding-packages-from-an-image">¶</a></span></h3></div></div></div><p>
                You might find it necessary to prevent specific packages
                from being installed into an image.
                If so, you can use several variables to direct the build
                system to essentially ignore installing recommended packages
                or to not install a package at all.
            </p><p>
                The following list introduces variables you can use to
                prevent packages from being installed into your image.
                Each of these variables only works with IPK and RPM
                package types.
                Support for Debian packages does not exist.
                Also, you can use these variables from your
                <code class="filename">local.conf</code> file or attach them to a
                specific image recipe by using a recipe name override.
                For more detail on the variables, see the descriptions in the
                Yocto Project Reference Manual's glossary chapter.
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BAD_RECOMMENDATIONS" target="_top"><code class="filename">BAD_RECOMMENDATIONS</code></a>:
                        Use this variable to specify "recommended-only"
                        packages that you do not want installed.
                        </p></li><li class="listitem"><p><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-NO_RECOMMENDATIONS" target="_top"><code class="filename">NO_RECOMMENDATIONS</code></a>:
                        Use this variable to prevent all "recommended-only"
                        packages from being installed.
                        </p></li><li class="listitem"><p><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_EXCLUDE" target="_top"><code class="filename">PACKAGE_EXCLUDE</code></a>:
                        Use this variable to prevent specific packages from
                        being installed regardless of whether they are
                        "recommended-only" or not.
                        You need to realize that the build process could
                        fail with an error when you
                        prevent the installation of a package whose presence
                        is required by an installed package.
                        </p></li></ul></div><p>
            </p></div><div class="section" title="5.18.2. Incrementing a Package Version"><div class="titlepage"><div><div><h3 class="title" id="incrementing-a-binary-package-version">5.18.2. Incrementing a Package Version<span class="permalink"><a alt="Permalink" title="Permalink" href="#incrementing-a-binary-package-version">¶</a></span></h3></div></div></div><p>
                This section provides some background on how binary package
                versioning is accomplished and presents some of the services,
                variables, and terminology involved.
            </p><p>
                In order to understand binary package versioning, you need
                to consider the following:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        Binary Package:  The binary package that is eventually
                        built and installed into an image.
                        </p></li><li class="listitem"><p>
                        Binary Package Version:  The binary package version
                        is composed of two components - a version and a
                        revision.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            Technically, a third component, the "epoch" (i.e.
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PE" target="_top"><code class="filename">PE</code></a>)
                            is involved but this discussion for the most part
                            ignores <code class="filename">PE</code>.
                        </div><p>
                        The version and revision are taken from the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>
                        and
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top"><code class="filename">PR</code></a>
                        variables, respectively.
                        </p></li><li class="listitem"><p>
                        <code class="filename">PV</code>:  The recipe version.
                        <code class="filename">PV</code> represents the version of the
                        software being packaged.
                        Do not confuse <code class="filename">PV</code> with the
                        binary package version.
                        </p></li><li class="listitem"><p>
                        <code class="filename">PR</code>:  The recipe revision.
                        </p></li><li class="listitem"><p>
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRCPV" target="_top"><code class="filename">SRCPV</code></a>:
                        The OpenEmbedded build system uses this string
                        to help define the value of <code class="filename">PV</code>
                        when the source code revision needs to be included
                        in it.
                        </p></li><li class="listitem"><p>
                        <a class="ulink" href="https://wiki.yoctoproject.org/wiki/PR_Service" target="_top">PR Service</a>:
                        A network-based service that helps automate keeping
                        package feeds compatible with existing package
                        manager applications such as RPM, APT, and OPKG.
                        </p></li></ul></div><p>
            </p><p>
                Whenever the binary package content changes, the binary package
                version must change.
                Changing the binary package version is accomplished by changing
                or "bumping" the <code class="filename">PR</code> and/or
                <code class="filename">PV</code> values.
                Increasing these values occurs one of two ways:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Automatically using a Package Revision
                        Service (PR Service).
                        </p></li><li class="listitem"><p>Manually incrementing the
                        <code class="filename">PR</code> and/or
                        <code class="filename">PV</code> variables.
                        </p></li></ul></div><p>
            </p><p>
                Given a primary challenge of any build system and its users
                is how to maintain a package feed that is compatible with
                existing package manager applications such as RPM, APT, and
                OPKG, using an automated system is much preferred over a
                manual system.
                In either system, the main requirement is that binary package
                version numbering increases in a linear fashion and that a
                number of version components exist that support that linear
                progression.
                For information on how to ensure package revisioning remains
                linear, see the
                "<a class="link" href="#automatically-incrementing-a-binary-package-revision-number" title="5.18.2.3. Automatically Incrementing a Package Version Number">Automatically Incrementing a Binary Package Revision Number</a>"
                section.
            </p><p>
                The following three sections provide related information on the
                PR Service, the manual method for "bumping"
                <code class="filename">PR</code> and/or <code class="filename">PV</code>, and
                on how to ensure binary package revisioning remains linear.
            </p><div class="section" title="5.18.2.1. Working With a PR Service"><div class="titlepage"><div><div><h4 class="title" id="working-with-a-pr-service">5.18.2.1. Working With a PR Service<span class="permalink"><a alt="Permalink" title="Permalink" href="#working-with-a-pr-service">¶</a></span></h4></div></div></div><p>
                    As mentioned, attempting to maintain revision numbers in the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/dev-manual/dev-manual.html#metadata" target="_top">Metadata</a>
                    is error prone, inaccurate, and causes problems for people
                    submitting recipes.
                    Conversely, the PR Service automatically generates
                    increasing numbers, particularly the revision field,
                    which removes the human element.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        For additional information on using a PR Service, you
                        can see the
                        <a class="ulink" href="https://wiki.yoctoproject.org/wiki/PR_Service" target="_top">PR Service</a>
                        wiki page.
                    </div><p>
                </p><p>
                    The Yocto Project uses variables in order of
                    decreasing priority to facilitate revision numbering (i.e.
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PE" target="_top"><code class="filename">PE</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>, and
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top"><code class="filename">PR</code></a>
                    for epoch, version, and revision, respectively).
                    The values are highly dependent on the policies and
                    procedures of a given distribution and package feed.
                </p><p>
                    Because the OpenEmbedded build system uses
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#checksums" target="_top">signatures</a>",
                    which are unique to a given build, the build system
                    knows when to rebuild packages.
                    All the inputs into a given task are represented by a
                    signature, which can trigger a rebuild when different.
                    Thus, the build system itself does not rely on the
                    <code class="filename">PR</code>, <code class="filename">PV</code>, and
                    <code class="filename">PE</code> numbers to trigger a rebuild.
                    The signatures, however, can be used to generate
                    these values.
                </p><p>
                    The PR Service works with both
                    <code class="filename">OEBasic</code> and
                    <code class="filename">OEBasicHash</code> generators.
                    The value of <code class="filename">PR</code> bumps when the
                    checksum changes and the different generator mechanisms
                    change signatures under different circumstances.
                </p><p>
                    As implemented, the build system includes values from
                    the PR Service into the <code class="filename">PR</code> field as
                    an addition using the form "<code class="filename">.x</code>" so
                    <code class="filename">r0</code> becomes <code class="filename">r0.1</code>,
                    <code class="filename">r0.2</code> and so forth.
                    This scheme allows existing <code class="filename">PR</code> values
                    to be used for whatever reasons, which include manual
                    <code class="filename">PR</code> bumps, should it be necessary.
                </p><p>
                    By default, the PR Service is not enabled or running.
                    Thus, the packages generated are just "self consistent".
                    The build system adds and removes packages and
                    there are no guarantees about upgrade paths but images
                    will be consistent and correct with the latest changes.
                </p><p>
                    The simplest form for a PR Service is for it to exist
                    for a single host development system that builds the
                    package feed (building system).
                    For this scenario, you can enable a local PR Service by
                    setting
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PRSERV_HOST" target="_top"><code class="filename">PRSERV_HOST</code></a>
                    in your <code class="filename">local.conf</code> file in the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/dev-manual/dev-manual.html#build-directory" target="_top">Build Directory</a>:
                    </p><pre class="literallayout">
     PRSERV_HOST = "localhost:0"
                    </pre><p>
                    Once the service is started, packages will automatically
                    get increasing <code class="filename">PR</code> values and
                    BitBake takes care of starting and stopping the server.
                </p><p>
                    If you have a more complex setup where multiple host
                    development systems work against a common, shared package
                    feed, you have a single PR Service running and it is
                    connected to each building system.
                    For this scenario, you need to start the PR Service using
                    the <code class="filename">bitbake-prserv</code> command:
                    </p><pre class="literallayout">
     bitbake-prserv --host <em class="replaceable"><code>ip</code></em> --port <em class="replaceable"><code>port</code></em> --start
                    </pre><p>
                    In addition to hand-starting the service, you need to
                    update the <code class="filename">local.conf</code> file of each
                    building system as described earlier so each system
                    points to the server and port.
                </p><p>
                    It is also recommended you use build history, which adds
                    some sanity checks to binary package versions, in
                    conjunction with the server that is running the PR Service.
                    To enable build history, add the following to each building
                    system's <code class="filename">local.conf</code> file:
                    </p><pre class="literallayout">
     # It is recommended to activate "buildhistory" for testing the PR service
     INHERIT += "buildhistory"
     BUILDHISTORY_COMMIT = "1"
                    </pre><p>
                    For information on build history, see the
                    "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#maintaining-build-output-quality" target="_top">Maintaining Build Output Quality</a>"
                    section in the Yocto Project Reference Manual.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
                        The OpenEmbedded build system does not maintain
                        <code class="filename">PR</code> information as part of the
                        shared state (sstate) packages.
                        If you maintain an sstate feed, its expected that either
                        all your building systems that contribute to the sstate
                         feed use a shared PR Service, or you do not run a PR
                        Service on any of your building systems.
                        Having some systems use a PR Service while others do
                        not leads to obvious problems.
                    </p><p>
                        For more information on shared state, see the
                        "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#shared-state-cache" target="_top">Shared State Cache</a>"
                        section in the Yocto Project Reference Manual.
                    </p></div></div><div class="section" title="5.18.2.2. Manually Bumping PR"><div class="titlepage"><div><div><h4 class="title" id="manually-bumping-pr">5.18.2.2. Manually Bumping PR<span class="permalink"><a alt="Permalink" title="Permalink" href="#manually-bumping-pr">¶</a></span></h4></div></div></div><p>
                    The alternative to setting up a PR Service is to manually
                    "bump" the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top"><code class="filename">PR</code></a>
                    variable.
                </p><p>
                    If a committed change results in changing the package
                    output, then the value of the PR variable needs to be
                    increased (or "bumped") as part of that commit.
                    For new recipes you should add the <code class="filename">PR</code>
                    variable and set its initial value equal to "r0", which is
                    the default.
                    Even though the default value is "r0", the practice of
                    adding it to a new recipe makes it harder to forget to bump
                    the variable when you make changes to the recipe in future.
                </p><p>
                    If you are sharing a common <code class="filename">.inc</code> file
                    with multiple recipes, you can also use the
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-INC_PR" target="_top">INC_PR</a></code>
                    variable to ensure that the recipes sharing the
                    <code class="filename">.inc</code> file are rebuilt when the
                    <code class="filename">.inc</code> file itself is changed.
                    The <code class="filename">.inc</code> file must set
                    <code class="filename">INC_PR</code> (initially to "r0"), and all
                    recipes referring to it should set <code class="filename">PR</code>
                    to "${INC_PR}.0" initially, incrementing the last number
                    when the recipe is changed.
                    If the <code class="filename">.inc</code> file is changed then its
                    <code class="filename">INC_PR</code> should be incremented.
                </p><p>
                    When upgrading the version of a binary package, assuming the
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top">PV</a></code>
                    changes, the <code class="filename">PR</code> variable should be
                    reset to "r0" (or "${INC_PR}.0" if you are using
                    <code class="filename">INC_PR</code>).
                </p><p>
                    Usually, version increases occur only to binary packages.
                    However, if for some reason <code class="filename">PV</code> changes
                    but does not increase, you can increase the
                    <code class="filename"><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PE" target="_top">PE</a></code>
                    variable (Package Epoch).
                    The <code class="filename">PE</code> variable defaults to "0".
                </p><p>
                    Binary package version numbering strives to follow the
                    <a class="ulink" href="http://www.debian.org/doc/debian-policy/ch-controlfields.html" target="_top">
                    Debian Version Field Policy Guidelines</a>.
                    These guidelines define how versions are compared and what
                    "increasing" a version means.
                </p></div><div class="section" title="5.18.2.3. Automatically Incrementing a Package Version Number"><div class="titlepage"><div><div><h4 class="title" id="automatically-incrementing-a-binary-package-revision-number">5.18.2.3. Automatically Incrementing a Package Version Number<span class="permalink"><a alt="Permalink" title="Permalink" href="#automatically-incrementing-a-binary-package-revision-number">¶</a></span></h4></div></div></div><p>
                    When fetching a repository, BitBake uses the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRCREV" target="_top"><code class="filename">SRCREV</code></a>
                    variable to determine the specific source code revision
                    from which to build.
                    You set the <code class="filename">SRCREV</code> variable to
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-AUTOREV" target="_top"><code class="filename">AUTOREV</code></a>
                    to cause the OpenEmbedded build system to automatically use the
                    latest revision of the software:
                    </p><pre class="literallayout">
     SRCREV = "${AUTOREV}"
                    </pre><p>
                </p><p>
                    Furthermore, you need to reference <code class="filename">SRCPV</code>
                    in <code class="filename">PV</code> in order to automatically update
                    the version whenever the revision of the source code
                    changes.
                    Here is an example:
                    </p><pre class="literallayout">
     PV = "1.0+git${SRCPV}"
                    </pre><p>
                    The OpenEmbedded build system substitutes
                    <code class="filename">SRCPV</code> with the following:
                    </p><pre class="literallayout">
     AUTOINC+<em class="replaceable"><code>source_code_revision</code></em>
                    </pre><p>
                    The build system replaces the <code class="filename">AUTOINC</code> with
                    a number.
                    The number used depends on the state of the PR Service:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            If PR Service is enabled, the build system increments
                            the number, which is similar to the behavior of
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PR" target="_top"><code class="filename">PR</code></a>.
                            This behavior results in linearly increasing package
                            versions, which is desirable.
                            Here is an example:
                            </p><pre class="literallayout">
     hello-world-git_0.0+git0+b6558dd387-r0.0_armv7a-neon.ipk
     hello-world-git_0.0+git1+dd2f5c3565-r0.0_armv7a-neon.ipk
                            </pre><p>
                            </p></li><li class="listitem"><p>
                            If PR Service is not enabled, the build system
                            replaces the <code class="filename">AUTOINC</code>
                            placeholder with zero (i.e. "0").
                            This results in changing the package version since
                            the source revision is included.
                            However, package versions are not increased linearly.
                            Here is an example:
                            </p><pre class="literallayout">
     hello-world-git_0.0+git0+b6558dd387-r0.0_armv7a-neon.ipk
     hello-world-git_0.0+git0+dd2f5c3565-r0.0_armv7a-neon.ipk
                            </pre><p>
                            </p></li></ul></div><p>
                </p><p>
                    In summary, the OpenEmbedded build system does not track the
                    history of binary package versions for this purpose.
                    <code class="filename">AUTOINC</code>, in this case, is comparable to
                    <code class="filename">PR</code>.
                    If PR server is not enabled, <code class="filename">AUTOINC</code>
                    in the package version is simply replaced by "0".
                    If PR server is enabled, the build system keeps track of the
                    package versions and bumps the number when the package
                    revision changes.
                </p></div></div><div class="section" title="5.18.3. Handling Optional Module Packaging"><div class="titlepage"><div><div><h3 class="title" id="handling-optional-module-packaging">5.18.3. Handling Optional Module Packaging<span class="permalink"><a alt="Permalink" title="Permalink" href="#handling-optional-module-packaging">¶</a></span></h3></div></div></div><p>
                Many pieces of software split functionality into optional
                modules (or plug-ins) and the plug-ins that are built
                might depend on configuration options.
                To avoid having to duplicate the logic that determines what
                modules are available in your recipe or to avoid having
                to package each module by hand, the OpenEmbedded build system
                provides functionality to handle module packaging dynamically.
            </p><p>
                To handle optional module packaging, you need to do two things:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Ensure the module packaging is actually
                        done.</p></li><li class="listitem"><p>Ensure that any dependencies on optional
                        modules from other recipes are satisfied by your recipe.
                        </p></li></ul></div><p>
            </p><div class="section" title="5.18.3.1. Making Sure the Packaging is Done"><div class="titlepage"><div><div><h4 class="title" id="making-sure-the-packaging-is-done">5.18.3.1. Making Sure the Packaging is Done<span class="permalink"><a alt="Permalink" title="Permalink" href="#making-sure-the-packaging-is-done">¶</a></span></h4></div></div></div><p>
                    To ensure the module packaging actually gets done, you use
                    the <code class="filename">do_split_packages</code> function within
                    the <code class="filename">populate_packages</code> Python function
                    in your recipe.
                    The <code class="filename">do_split_packages</code> function
                    searches for a pattern of files or directories under a
                    specified path and creates a package for each one it finds
                    by appending to the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES" target="_top"><code class="filename">PACKAGES</code></a>
                    variable and setting the appropriate values for
                    <code class="filename">FILES_packagename</code>,
                    <code class="filename">RDEPENDS_packagename</code>,
                    <code class="filename">DESCRIPTION_packagename</code>, and so forth.
                    Here is an example from the <code class="filename">lighttpd</code>
                    recipe:
                    </p><pre class="literallayout">
     python populate_packages_prepend () {
         lighttpd_libdir = d.expand('${libdir}')
         do_split_packages(d, lighttpd_libdir, '^mod_(.*)\.so$',
                          'lighttpd-module-%s', 'Lighttpd module for %s',
                           extra_depends='')
     }
                    </pre><p>
                    The previous example specifies a number of things in the
                    call to <code class="filename">do_split_packages</code>.
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A directory within the files installed
                            by your recipe through <code class="filename">do_install</code>
                            in which to search.</p></li><li class="listitem"><p>A regular expression used to match module
                            files in that directory.
                            In the example, note the parentheses () that mark
                            the part of the expression from which the module
                            name should be derived.</p></li><li class="listitem"><p>A pattern to use for the package names.
                            </p></li><li class="listitem"><p>A description for each package.
                            </p></li><li class="listitem"><p>An empty string for
                            <code class="filename">extra_depends</code>, which disables
                            the default dependency on the main
                            <code class="filename">lighttpd</code> package.
                            Thus, if a file in <code class="filename">${libdir}</code>
                            called <code class="filename">mod_alias.so</code> is found,
                            a package called <code class="filename">lighttpd-module-alias</code>
                            is created for it and the
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DESCRIPTION" target="_top"><code class="filename">DESCRIPTION</code></a>
                            is set to "Lighttpd module for alias".</p></li></ul></div><p>
                </p><p>
                    Often, packaging modules is as simple as the previous
                    example.
                    However, more advanced options exist that you can use
                    within <code class="filename">do_split_packages</code> to modify its
                    behavior.
                    And, if you need to, you can add more logic by specifying
                    a hook function that is called for each package.
                    It is also perfectly acceptable to call
                    <code class="filename">do_split_packages</code> multiple times if
                    you have more than one set of modules to package.
                </p><p>
                    For more examples that show how to use
                    <code class="filename">do_split_packages</code>, see the
                    <code class="filename">connman.inc</code> file in the
                    <code class="filename">meta/recipes-connectivity/connman/</code>
                    directory of the <code class="filename">poky</code>
                    <a class="link" href="#yocto-project-repositories" title="3.3. Yocto Project Source Repositories">source repository</a>.
                    You can also find examples in
                    <code class="filename">meta/classes/kernel.bbclass</code>.
                 </p><p>
                     Following is a reference that shows
                     <code class="filename">do_split_packages</code> mandatory and
                     optional arguments:
                     </p><pre class="literallayout">
     Mandatory arguments

     root
        The path in which to search
     file_regex
        Regular expression to match searched files.
        Use parentheses () to mark the part of this
        expression that should be used to derive the
        module name (to be substituted where %s is
        used in other function arguments as noted below)
     output_pattern
        Pattern to use for the package names. Must
        include %s.
     description
        Description to set for each package. Must
        include %s.

     Optional arguments

     postinst
        Postinstall script to use for all packages
        (as a string)
     recursive
        True to perform a recursive search - default
        False
     hook
        A hook function to be called for every match.
        The function will be called with the following
        arguments (in the order listed):

        f
           Full path to the file/directory match
        pkg
           The package name
        file_regex
           As above
        output_pattern
           As above
        modulename
           The module name derived using file_regex

     extra_depends
        Extra runtime dependencies (RDEPENDS) to be
        set for all packages. The default value of None
        causes a dependency on the main package
        (${PN}) - if you do not want this, pass empty
        string '' for this parameter.
     aux_files_pattern
        Extra item(s) to be added to FILES for each
        package. Can be a single string item or a list
        of strings for multiple items. Must include %s.
     postrm
        postrm script to use for all packages (as a
        string)
     allow_dirs
        True to allow directories to be matched -
        default False
     prepend
        If True, prepend created packages to PACKAGES
        instead of the default False which appends them
     match_path
        match file_regex on the whole relative path to
        the root rather than just the file name
     aux_files_pattern_verbatim
        Extra item(s) to be added to FILES for each
        package, using the actual derived module name
        rather than converting it to something legal
        for a package name. Can be a single string item
        or a list of strings for multiple items. Must
        include %s.
     allow_links
        True to allow symlinks to be matched - default
        False
     summary
        Summary to set for each package. Must include %s;
        defaults to description if not set.
                     </pre><p>
                 </p></div><div class="section" title="5.18.3.2. Satisfying Dependencies"><div class="titlepage"><div><div><h4 class="title" id="satisfying-dependencies">5.18.3.2. Satisfying Dependencies<span class="permalink"><a alt="Permalink" title="Permalink" href="#satisfying-dependencies">¶</a></span></h4></div></div></div><p>
                    The second part for handling optional module packaging
                    is to ensure that any dependencies on optional modules
                    from other recipes are satisfied by your recipe.
                    You can be sure these dependencies are satisfied by
                    using the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGES_DYNAMIC" target="_top"><code class="filename">PACKAGES_DYNAMIC</code></a> variable.
                    Here is an example that continues with the
                    <code class="filename">lighttpd</code> recipe shown earlier:
                    </p><pre class="literallayout">
     PACKAGES_DYNAMIC = "lighttpd-module-.*"
                    </pre><p>
                    The name specified in the regular expression can of
                    course be anything.
                    In this example, it is <code class="filename">lighttpd-module-</code>
                    and is specified as the prefix to ensure that any
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RDEPENDS" target="_top"><code class="filename">RDEPENDS</code></a>
                    and <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RRECOMMENDS" target="_top"><code class="filename">RRECOMMENDS</code></a>
                    on a package name starting with the prefix are satisfied
                    during build time.
                    If you are using <code class="filename">do_split_packages</code>
                    as described in the previous section, the value you put in
                    <code class="filename">PACKAGES_DYNAMIC</code> should correspond to
                    the name pattern specified in the call to
                    <code class="filename">do_split_packages</code>.
                </p></div></div><div class="section" title="5.18.4. Using Runtime Package Management"><div class="titlepage"><div><div><h3 class="title" id="using-runtime-package-management">5.18.4. Using Runtime Package Management<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-runtime-package-management">¶</a></span></h3></div></div></div><p>
                During a build, BitBake always transforms a recipe into one or
                more packages.
                For example, BitBake takes the <code class="filename">bash</code> recipe
                and currently produces the <code class="filename">bash-dbg</code>,
                <code class="filename">bash-staticdev</code>,
                <code class="filename">bash-dev</code>, <code class="filename">bash-doc</code>,
                <code class="filename">bash-locale</code>, and
                <code class="filename">bash</code> packages.
                Not all generated packages are included in an image.
            </p><p>
                In several situations, you might need to update, add, remove,
                or query the packages on a target device at runtime
                (i.e. without having to generate a new image).
                Examples of such situations include:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        You want to provide in-the-field updates to deployed
                        devices (e.g. security updates).
                        </p></li><li class="listitem"><p>
                        You want to have a fast turn-around development cycle
                        for one or more applications that run on your device.
                        </p></li><li class="listitem"><p>
                        You want to temporarily install the "debug" packages
                        of various applications on your device so that
                        debugging can be greatly improved by allowing
                        access to symbols and source debugging.
                        </p></li><li class="listitem"><p>
                        You want to deploy a more minimal package selection of
                        your device but allow in-the-field updates to add a
                        larger selection for customization.
                        </p></li></ul></div><p>
            </p><p>
                In all these situations, you have something similar to a more
                traditional Linux distribution in that in-field devices
                are able to receive pre-compiled packages from a server for
                installation or update.
                Being able to install these packages on a running,
                in-field device is what is termed "runtime package
                management".
            </p><p>
                In order to use runtime package management, you
                need a host/server machine that serves up the pre-compiled
                packages plus the required metadata.
                You also need package manipulation tools on the target.
                The build machine is a likely candidate to act as the server.
                However, that machine does not necessarily have to be the
                package server.
                The build machine could push its artifacts to another machine
                that acts as the server (e.g. Internet-facing).
            </p><p>
                A simple build that targets just one device produces
                more than one package database.
                In other words, the packages produced by a build are separated
                out into a couple of different package groupings based on
                criteria such as the target's CPU architecture, the target
                board, or the C library used on the target.
                For example, a build targeting the <code class="filename">qemuarm</code>
                device produces the following three package databases:
                <code class="filename">all</code>, <code class="filename">armv5te</code>, and
                <code class="filename">qemuarm</code>.
                If you wanted your <code class="filename">qemuarm</code> device to be
                aware of all the packages that were available to it,
                you would need to point it to each of these databases
                individually.
                In a similar way, a traditional Linux distribution usually is
                configured to be aware of a number of software repositories
                from which it retrieves packages.
            </p><p>
                Using runtime package management is completely optional and
                not required for a successful build or deployment in any
                way.
                But if you want to make use of runtime package management,
                you need to do a couple things above and beyond the basics.
                The remainder of this section describes what you need to do.
            </p><div class="section" title="5.18.4.1. Build Considerations"><div class="titlepage"><div><div><h4 class="title" id="runtime-package-management-build">5.18.4.1. Build Considerations<span class="permalink"><a alt="Permalink" title="Permalink" href="#runtime-package-management-build">¶</a></span></h4></div></div></div><p>
                    This section describes build considerations of which you
                    need to be aware in order to provide support for runtime
                    package management.
                </p><p>
                    When BitBake generates packages, it needs to know
                    what format or formats to use.
                    In your configuration, you use the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_CLASSES" target="_top"><code class="filename">PACKAGE_CLASSES</code></a>
                    variable to specify the format:
                    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                            Open the <code class="filename">local.conf</code> file
                            inside your
                            <a class="link" href="#build-directory">Build Directory</a>
                            (e.g. <code class="filename">~/poky/build/conf/local.conf</code>).
                            </p></li><li class="listitem"><p>
                            Select the desired package format as follows:
                            </p><pre class="literallayout">
     PACKAGE_CLASSES ?= “package_<em class="replaceable"><code>packageformat</code></em>”
                            </pre><p>
                            where <em class="replaceable"><code>packageformat</code></em>
                            can be "ipk", "rpm", and "deb", which are the
                            supported package formats.
                            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                                Because the Yocto Project supports three
                                different package formats, you can set the
                                variable with more than one argument.
                                However, the OpenEmbedded build system only
                                uses the first argument when creating an image
                                or Software Development Kit (SDK).
                            </div><p>
                            </p></li></ol></div><p>
                </p><p>
                    If you would like your image to start off with a basic
                    package database containing the packages in your current
                    build as well as to have the relevant tools available on the
                    target for runtime package management, you can include
                    "package-management" in the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>
                    variable.
                    Including "package-management" in this
                    configuration variable ensures that when the image
                    is assembled for your target, the image includes
                    the currently-known package databases as well as
                    the target-specific tools required for runtime
                    package management to be performed on the target.
                    However, this is not strictly necessary.
                    You could start your image off without any databases
                    but only include the required on-target package
                    tool(s).
                    As an example, you could include "opkg" in your
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_INSTALL" target="_top"><code class="filename">IMAGE_INSTALL</code></a>
                    variable if you are using the IPK package format.
                    You can then initialize your target's package database(s)
                    later once your image is up and running.
                </p><p>
                    Whenever you perform any sort of build step that can
                    potentially generate a package or modify an existing
                    package, it is always a good idea to re-generate the
                    package index with:
                    </p><pre class="literallayout">
    $ bitbake package-index
                    </pre><p>
                    Realize that it is not sufficient to simply do the
                    following:
                    </p><pre class="literallayout">
    $ bitbake <em class="replaceable"><code>some-package</code></em> package-index
                    </pre><p>
                    The reason for this restriction is because BitBake does not
                    properly schedule the <code class="filename">package-index</code>
                    target fully after any other target has completed.
                    Thus, be sure to run the package update step separately.
                </p><p>
                    You can use the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_ARCHS" target="_top"><code class="filename">PACKAGE_FEED_ARCHS</code></a>,
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_BASE_PATHS" target="_top"><code class="filename">PACKAGE_FEED_BASE_PATHS</code></a>,
                    and
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_URIS" target="_top"><code class="filename">PACKAGE_FEED_URIS</code></a>
                    variables to pre-configure target images to use a package
                    feed.
                    If you do not define these variables, then manual steps
                    as described in the subsequent sections are necessary to
                    configure the target.
                    You should set these variables before building the image
                    in order to produce a correctly configured image.
                </p><p>
                    When your build is complete, your packages reside in the
                    <code class="filename">${TMPDIR}/deploy/<em class="replaceable"><code>packageformat</code></em></code>
                    directory.
                    For example, if
                    <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TMPDIR" target="_top"><code class="filename">TMPDIR</code></a><code class="filename">}</code>
                    is <code class="filename">tmp</code> and your selected package type
                    is IPK, then your IPK packages are available in
                    <code class="filename">tmp/deploy/ipk</code>.
                </p></div><div class="section" title="5.18.4.2. Host or Server Machine Setup"><div class="titlepage"><div><div><h4 class="title" id="runtime-package-management-server">5.18.4.2. Host or Server Machine Setup<span class="permalink"><a alt="Permalink" title="Permalink" href="#runtime-package-management-server">¶</a></span></h4></div></div></div><p>
                    Although other protocols are possible, a server using HTTP
                    typically serves packages.
                    If you want to use HTTP, then set up and configure a
                    web server such as Apache 2, lighttpd, or
                    SimpleHTTPServer on the machine serving the packages.
                </p><p>
                    To keep things simple, this section describes how to set
                    up a SimpleHTTPServer web server to share package feeds
                    from the developer's machine.
                    Although this server might not be the best for a production
                    environment, the setup is simple and straight forward.
                    Should you want to use a different server more suited for
                    production (e.g. Apache 2, Lighttpd, or Nginx), take the
                    appropriate steps to do so.
                </p><p>
                    From within the build directory where you have built an
                    image based on your packaging choice (i.e. the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_CLASSES" target="_top"><code class="filename">PACKAGE_CLASSES</code></a>
                    setting), simply start the server.
                    The following example assumes a build directory of
                    <code class="filename">~/poky/build/tmp/deploy/rpm</code> and a
                    <code class="filename">PACKAGE_CLASSES</code> setting of
                    "package_rpm":
                    </p><pre class="literallayout">
     $ cd ~/poky/build/tmp/deploy/rpm
     $ python -m SimpleHTTPServer
                    </pre><p>
                </p></div><div class="section" title="5.18.4.3. Target Setup"><div class="titlepage"><div><div><h4 class="title" id="runtime-package-management-target">5.18.4.3. Target Setup<span class="permalink"><a alt="Permalink" title="Permalink" href="#runtime-package-management-target">¶</a></span></h4></div></div></div><p>
                    Setting up the target differs depending on the
                    package management system.
                    This section provides information for RPM, IPK, and DEB.
                </p><div class="section" title="5.18.4.3.1. Using RPM"><div class="titlepage"><div><div><h5 class="title" id="runtime-package-management-target-rpm">5.18.4.3.1. Using RPM<span class="permalink"><a alt="Permalink" title="Permalink" href="#runtime-package-management-target-rpm">¶</a></span></h5></div></div></div><p>
                        The <code class="filename">dnf</code> application performs
                        runtime package management of RPM packages.
                        You must perform an initial setup for
                        <code class="filename">dnf</code> on the target machine
                        if the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_ARCHS" target="_top"><code class="filename">PACKAGE_FEED_ARCHS</code></a>,
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_BASE_PATHS" target="_top"><code class="filename">PACKAGE_FEED_BASE_PATHS</code></a>,
                        and
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_URIS" target="_top"><code class="filename">PACKAGE_FEED_URIS</code></a>
                        variables have not been set or the target image was
                        built before the variables were set.
                    </p><p>
                        As an example, assume the target is able to use the
                        following package databases:
                        <code class="filename">all</code>, <code class="filename">i586</code>,
                        and <code class="filename">qemux86</code> from a server named
                        <code class="filename">my.server</code>.
                        You must inform <code class="filename">dnf</code> of the
                        availability of these databases by creating a
                        <code class="filename">/etc/yum.repos.d/oe-packages.repo</code>
                        file with the following content:
                        </p><pre class="literallayout">
     [oe-packages]
     baseurl="http://my.server/rpm/i586 http://my.server/rpm/qemux86 http://my.server/rpm/all"
                        </pre><p>
                        From the target machine, fetch the repository:
                        </p><pre class="literallayout">
     # dnf makecache
                        </pre><p>
                        After everything is set up, <code class="filename">dnf</code>
                        is able to find, install, and upgrade packages from
                        the specified repository.
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                            See the
                            <a class="ulink" href="http://dnf.readthedocs.io/en/latest/" target="_top">Dnf documentation</a>
                            for additional information.
                        </div><p>
                    </p></div><div class="section" title="5.18.4.3.2. Using IPK"><div class="titlepage"><div><div><h5 class="title" id="runtime-package-management-target-ipk">5.18.4.3.2. Using IPK<span class="permalink"><a alt="Permalink" title="Permalink" href="#runtime-package-management-target-ipk">¶</a></span></h5></div></div></div><p>
                        The <code class="filename">opkg</code> application performs
                        runtime package management of IPK packages.
                        You must perform an initial setup for
                        <code class="filename">opkg</code> on the target machine
                        if the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_ARCHS" target="_top"><code class="filename">PACKAGE_FEED_ARCHS</code></a>,
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_BASE_PATHS" target="_top"><code class="filename">PACKAGE_FEED_BASE_PATHS</code></a>, and
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_URIS" target="_top"><code class="filename">PACKAGE_FEED_URIS</code></a>
                        variables have not been set or the target image was
                        built before the variables were set.
                    </p><p>
                        The <code class="filename">opkg</code> application uses
                        configuration files to find available package
                        databases.
                        Thus, you need to create a configuration file inside
                        the <code class="filename">/etc/opkg/</code> direction, which
                        informs <code class="filename">opkg</code> of any repository
                        you want to use.
                    </p><p>
                        As an example, suppose you are serving packages from a
                        <code class="filename">ipk/</code> directory containing the
                        <code class="filename">i586</code>,
                        <code class="filename">all</code>, and
                        <code class="filename">qemux86</code> databases through an
                        HTTP server named <code class="filename">my.server</code>.
                        On the target, create a configuration file
                        (e.g. <code class="filename">my_repo.conf</code>) inside the
                        <code class="filename">/etc/opkg/</code> directory containing
                        the following:
                        </p><pre class="literallayout">
     src/gz all http://my.server/ipk/all
     src/gz i586 http://my.server/ipk/i586
     src/gz qemux86 http://my.server/ipk/qemux86
                        </pre><p>
                        Next, instruct <code class="filename">opkg</code> to fetch
                        the repository information:
                        </p><pre class="literallayout">
     # opkg update
                        </pre><p>
                        The <code class="filename">opkg</code> application is now able
                        to find, install, and upgrade packages from the
                        specified repository.
                    </p></div><div class="section" title="5.18.4.3.3. Using DEB"><div class="titlepage"><div><div><h5 class="title" id="runtime-package-management-target-deb">5.18.4.3.3. Using DEB<span class="permalink"><a alt="Permalink" title="Permalink" href="#runtime-package-management-target-deb">¶</a></span></h5></div></div></div><p>
                        The <code class="filename">apt</code> application performs
                        runtime package management of DEB packages.
                        This application uses a source list file to find
                        available package databases.
                        You must perform an initial setup for
                        <code class="filename">apt</code> on the target machine
                        if the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_ARCHS" target="_top"><code class="filename">PACKAGE_FEED_ARCHS</code></a>,
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_BASE_PATHS" target="_top"><code class="filename">PACKAGE_FEED_BASE_PATHS</code></a>, and
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PACKAGE_FEED_URIS" target="_top"><code class="filename">PACKAGE_FEED_URIS</code></a>
                        variables have not been set or the target image was
                        built before the variables were set.
                    </p><p>
                        To inform <code class="filename">apt</code> of the repository
                        you want to use, you might create a list file (e.g.
                        <code class="filename">my_repo.list</code>) inside the
                        <code class="filename">/etc/apt/sources.list.d/</code>
                        directory.
                        As an example, suppose you are serving packages from a
                        <code class="filename">deb/</code> directory containing the
                        <code class="filename">i586</code>,
                        <code class="filename">all</code>, and
                        <code class="filename">qemux86</code> databases through an
                        HTTP server named <code class="filename">my.server</code>.
                        The list file should contain:
                        </p><pre class="literallayout">
     deb http://my.server/deb/all ./
     deb http://my.server/deb/i586 ./
     deb http://my.server/deb/qemux86 ./
                        </pre><p>
                        Next, instruct the <code class="filename">apt</code>
                        application to fetch the repository information:
                        </p><pre class="literallayout">
     # apt-get update
                        </pre><p>
                        After this step, <code class="filename">apt</code> is able
                        to find, install, and upgrade packages from the
                        specified repository.
                    </p></div></div></div><div class="section" title="5.18.5. Generating and Using Signed Packages"><div class="titlepage"><div><div><h3 class="title" id="generating-and-using-signed-packages">5.18.5. Generating and Using Signed Packages<span class="permalink"><a alt="Permalink" title="Permalink" href="#generating-and-using-signed-packages">¶</a></span></h3></div></div></div><p>
                In order to add security to RPM packages used during a build,
                you can take steps to securely sign them.
                Once a signature is verified, the OpenEmbedded build system
                can use the package in the build.
                If security fails for a signed package, the build system
                aborts the build.
            </p><p>
                This section describes how to sign RPM packages during a build
                and how to use signed package feeds (repositories) when
                doing a build.
            </p><div class="section" title="5.18.5.1. Signing RPM Packages"><div class="titlepage"><div><div><h4 class="title" id="signing-rpm-packages">5.18.5.1. Signing RPM Packages<span class="permalink"><a alt="Permalink" title="Permalink" href="#signing-rpm-packages">¶</a></span></h4></div></div></div><p>
                    To enable signing RPM packages, you must set up the
                    following configurations in either your
                    <code class="filename">local.config</code> or
                    <code class="filename">distro.config</code> file:
                    </p><pre class="literallayout">
     # Inherit sign_rpm.bbclass to enable signing functionality
     INHERIT += " sign_rpm"
     # Define the GPG key that will be used for signing.
     RPM_GPG_NAME = "<em class="replaceable"><code>key_name</code></em>"
     # Provide passphrase for the key
     RPM_GPG_PASSPHRASE = "<em class="replaceable"><code>passphrase</code></em>"
                    </pre><p>
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        Be sure to supply appropriate values for both
                        <em class="replaceable"><code>key_name</code></em> and
                        <em class="replaceable"><code>passphrase</code></em></div><p>
                    Aside from the
                    <code class="filename">RPM_GPG_NAME</code> and
                    <code class="filename">RPM_GPG_PASSPHRASE</code> variables in the
                    previous example, two optional variables related to signing
                    exist:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">GPG_BIN</code>:</em></span>
                            Specifies a <code class="filename">gpg</code> binary/wrapper
                            that is executed when the package is signed.
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">GPG_PATH</code>:</em></span>
                            Specifies the <code class="filename">gpg</code> home
                            directory used when the package is signed.
                            </p></li></ul></div><p>
                </p></div><div class="section" title="5.18.5.2. Processing Package Feeds"><div class="titlepage"><div><div><h4 class="title" id="processing-package-feeds">5.18.5.2. Processing Package Feeds<span class="permalink"><a alt="Permalink" title="Permalink" href="#processing-package-feeds">¶</a></span></h4></div></div></div><p>
                    In addition to being able to sign RPM packages, you can
                    also enable the OpenEmbedded build system to be able to
                    handle previously signed package feeds for IPK
                    packages.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        The OpenEmbedded build system does not currently
                        support signed DPKG or RPM package feeds.
                    </div><p>
                    The steps you need to take to enable signed package feed
                    use are similar to the steps used to sign RPM packages.
                    You must define the following in your
                    <code class="filename">local.config</code> or
                    <code class="filename">distro.config</code> file:
                    </p><pre class="literallayout">
     INHERIT += "sign_package_feed"
     PACKAGE_FEED_GPG_NAME = "<em class="replaceable"><code>key_name</code></em>"
     PACKAGE_FEED_GPG_PASSPHRASE_FILE = "<em class="replaceable"><code>path_to_file_containing_passphrase</code></em>"
                    </pre><p>
                    For signed package feeds, the passphrase must exist in a
                    separate file, which is pointed to by the
                    <code class="filename">PACKAGE_FEED_GPG_PASSPHRASE_FILE</code>
                    variable.
                    Regarding security, keeping a plain text passphrase out of
                    the configuration is more secure.
                </p><p>
                    Aside from the
                    <code class="filename">PACKAGE_FEED_GPG_NAME</code> and
                    <code class="filename">PACKAGE_FEED_GPG_PASSPHRASE_FILE</code>
                    variables, three optional variables related to signed
                    package feeds exist:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">GPG_BIN</code>:</em></span>
                            Specifies a <code class="filename">gpg</code> binary/wrapper
                            that is executed when the package is signed.
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">GPG_PATH</code>:</em></span>
                            Specifies the <code class="filename">gpg</code> home
                            directory used when the package is signed.
                            </p></li><li class="listitem"><p>
                            <span class="emphasis"><em><code class="filename">PACKAGE_FEED_GPG_SIGNATURE_TYPE</code>:</em></span>
                            Specifies the type of <code class="filename">gpg</code>
                            signature.
                            This variable applies only to RPM and IPK package
                            feeds.
                            Allowable values for the
                            <code class="filename">PACKAGE_FEED_GPG_SIGNATURE_TYPE</code>
                            are "ASC", which is the default and specifies ascii
                            armored, and "BIN", which specifies binary.
                            </p></li></ul></div><p>
                </p></div></div><div class="section" title="5.18.6. Testing Packages With ptest"><div class="titlepage"><div><div><h3 class="title" id="testing-packages-with-ptest">5.18.6. Testing Packages With ptest<span class="permalink"><a alt="Permalink" title="Permalink" href="#testing-packages-with-ptest">¶</a></span></h3></div></div></div><p>
                A Package Test (ptest) runs tests against packages built
                by the OpenEmbedded build system on the target machine.
                A ptest contains at least two items: the actual test, and
                a shell script (<code class="filename">run-ptest</code>) that starts
                the test.
                The shell script that starts the test must not contain
                the actual test - the script only starts the test.
                On the other hand, the test can be anything from a simple
                shell script that runs a binary and checks the output to
                an elaborate system of test binaries and data files.
            </p><p>
                The test generates output in the format used by
                Automake:
                </p><pre class="literallayout">
     <em class="replaceable"><code>result</code></em>: <em class="replaceable"><code>testname</code></em>
                </pre><p>
                where the result can be <code class="filename">PASS</code>,
                <code class="filename">FAIL</code>, or <code class="filename">SKIP</code>,
                and the testname can be any identifying string.
            </p><p>
                For a list of Yocto Project recipes that are already
                enabled with ptest, see the
                <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Ptest" target="_top">Ptest</a>
                wiki page.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    A recipe is "ptest-enabled" if it inherits the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-ptest" target="_top"><code class="filename">ptest</code></a>
                    class.
                </div><p>
            </p><div class="section" title="5.18.6.1. Adding ptest to Your Build"><div class="titlepage"><div><div><h4 class="title" id="adding-ptest-to-your-build">5.18.6.1. Adding ptest to Your Build<span class="permalink"><a alt="Permalink" title="Permalink" href="#adding-ptest-to-your-build">¶</a></span></h4></div></div></div><p>
                    To add package testing to your build, add the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_FEATURES" target="_top"><code class="filename">DISTRO_FEATURES</code></a>
                    and <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTRA_IMAGE_FEATURES" target="_top"><code class="filename">EXTRA_IMAGE_FEATURES</code></a>
                    variables to your <code class="filename">local.conf</code> file,
                    which is found in the
                    <a class="link" href="#build-directory">Build Directory</a>:
                    </p><pre class="literallayout">
     DISTRO_FEATURES_append = " ptest"
     EXTRA_IMAGE_FEATURES += "ptest-pkgs"
                    </pre><p>
                    Once your build is complete, the ptest files are installed
                    into the
                    <code class="filename">/usr/lib/<em class="replaceable"><code>package</code></em>/ptest</code>
                    directory within the image, where
                    <code class="filename"><em class="replaceable"><code>package</code></em></code>
                    is the name of the package.
                </p></div><div class="section" title="5.18.6.2. Running ptest"><div class="titlepage"><div><div><h4 class="title" id="running-ptest">5.18.6.2. Running ptest<span class="permalink"><a alt="Permalink" title="Permalink" href="#running-ptest">¶</a></span></h4></div></div></div><p>
                    The <code class="filename">ptest-runner</code> package installs a
                    shell script that loops through all installed ptest test
                    suites and runs them in sequence.
                    Consequently, you might want to add this package to
                    your image.
                </p></div><div class="section" title="5.18.6.3. Getting Your Package Ready"><div class="titlepage"><div><div><h4 class="title" id="getting-your-package-ready">5.18.6.3. Getting Your Package Ready<span class="permalink"><a alt="Permalink" title="Permalink" href="#getting-your-package-ready">¶</a></span></h4></div></div></div><p>
                    In order to enable a recipe to run installed ptests
                    on target hardware,
                    you need to prepare the recipes that build the packages
                    you want to test.
                    Here is what you have to do for each recipe:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Be sure the recipe
                            inherits the
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-ptest" target="_top"><code class="filename">ptest</code></a>
                            class:</em></span>
                            Include the following line in each recipe:
                            </p><pre class="literallayout">
     inherit ptest
                            </pre><p>
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Create <code class="filename">run-ptest</code>:</em></span>
                            This script starts your test.
                            Locate the script where you will refer to it
                            using
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>.
                            Here is an example that starts a test for
                            <code class="filename">dbus</code>:
                            </p><pre class="literallayout">
     #!/bin/sh
     cd test
     make -k runtest-TESTS
                            </pre><p>
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Ensure dependencies are
                            met:</em></span>
                            If the test adds build or runtime dependencies
                            that normally do not exist for the package
                            (such as requiring "make" to run the test suite),
                            use the
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEPENDS" target="_top"><code class="filename">DEPENDS</code></a>
                            and
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-RDEPENDS" target="_top"><code class="filename">RDEPENDS</code></a>
                            variables in your recipe in order for the package
                            to meet the dependencies.
                            Here is an example where the package has a runtime
                            dependency on "make":
                            </p><pre class="literallayout">
     RDEPENDS_${PN}-ptest += "make"
                            </pre><p>
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Add a function to build the
                            test suite:</em></span>
                            Not many packages support cross-compilation of
                            their test suites.
                            Consequently, you usually need to add a
                            cross-compilation function to the package.
                            </p><p>Many packages based on Automake compile and
                            run the test suite by using a single command
                            such as <code class="filename">make check</code>.
                            However, the host <code class="filename">make check</code>
                            builds and runs on the same computer, while
                            cross-compiling requires that the package is built
                            on the host but executed for the target
                            architecture (though often, as in the case for
                            ptest, the execution occurs on the host).
                            The built version of Automake that ships with the
                            Yocto Project includes a patch that separates
                            building and execution.
                            Consequently, packages that use the unaltered,
                            patched version of <code class="filename">make check</code>
                            automatically cross-compiles.</p><p>Regardless, you still must add a
                            <code class="filename">do_compile_ptest</code> function to
                            build the test suite.
                            Add a function similar to the following to your
                            recipe:
                            </p><pre class="literallayout">
     do_compile_ptest() {
        oe_runmake buildtest-TESTS
     }
                            </pre><p>
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Ensure special configurations
                            are set:</em></span>
                            If the package requires special configurations
                            prior to compiling the test code, you must
                            insert a <code class="filename">do_configure_ptest</code>
                            function into the recipe.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Install the test
                            suite:</em></span>
                            The <code class="filename">ptest</code> class
                            automatically copies the file
                            <code class="filename">run-ptest</code> to the target and
                            then runs make <code class="filename">install-ptest</code>
                            to run the tests.
                            If this is not enough, you need to create a
                            <code class="filename">do_install_ptest</code> function and
                            make sure it gets called after the
                            "make install-ptest" completes.
                            </p></li></ul></div><p>
                </p></div></div></div><div class="section" title="5.19. Working with Source Files"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="working-with-source-files">5.19. Working with Source Files<span class="permalink"><a alt="Permalink" title="Permalink" href="#working-with-source-files">¶</a></span></h2></div></div></div><p>
            The OpenEmbedded build system works with source files located
            through the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
            variable.
            When you build something using BitBake, a big part of the operation
            is locating and downloading all the source tarballs.
            For images, downloading all the source for various packages can
            take a significant amount of time.
        </p><p>
            This section presents information for working with source
            files that can lead to more efficient use of resources and
            time.
        </p><div class="section" title="5.19.1. Setting up Effective Mirrors"><div class="titlepage"><div><div><h3 class="title" id="setting-up-effective-mirrors">5.19.1. Setting up Effective Mirrors<span class="permalink"><a alt="Permalink" title="Permalink" href="#setting-up-effective-mirrors">¶</a></span></h3></div></div></div><p>
                As mentioned, a good deal that goes into a Yocto Project
                build is simply downloading all of the source tarballs.
                Maybe you have been working with another build system
                (OpenEmbedded or Angstrom) for which you have built up a
                sizable directory of source tarballs.
                Or, perhaps someone else has such a directory for which you
                have read access.
                If so, you can save time by adding statements to your
                configuration file so that the build process checks local
                directories first for existing tarballs before checking the
                Internet.
            </p><p>
                Here is an efficient way to set it up in your
                <code class="filename">local.conf</code> file:
                </p><pre class="literallayout">
     SOURCE_MIRROR_URL ?= "file:///home/you/your-download-dir/"
     INHERIT += "own-mirrors"
     BB_GENERATE_MIRROR_TARBALLS = "1"
     # BB_NO_NETWORK = "1"
                </pre><p>
            </p><p>
                In the previous example, the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BB_GENERATE_MIRROR_TARBALLS" target="_top"><code class="filename">BB_GENERATE_MIRROR_TARBALLS</code></a>
                variable causes the OpenEmbedded build system to generate
                tarballs of the Git repositories and store them in the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DL_DIR" target="_top"><code class="filename">DL_DIR</code></a>
                directory.
                Due to performance reasons, generating and storing these
                tarballs is not the build system's default behavior.
            </p><p>
                You can also use the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PREMIRRORS" target="_top"><code class="filename">PREMIRRORS</code></a>
                variable.
                For an example, see the variable's glossary entry in the
                Yocto Project Reference Manual.
            </p></div><div class="section" title="5.19.2. Getting Source Files and Suppressing the Build"><div class="titlepage"><div><div><h3 class="title" id="getting-source-files-and-suppressing-the-build">5.19.2. Getting Source Files and Suppressing the Build<span class="permalink"><a alt="Permalink" title="Permalink" href="#getting-source-files-and-suppressing-the-build">¶</a></span></h3></div></div></div><p>
                Another technique you can use to ready yourself for a
                successive string of build operations, is to pre-fetch
                all the source files without actually starting a build.
                This technique lets you work through any download issues
                and ultimately gathers all the source files into your
                download directory
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-build-downloads" target="_top"><code class="filename">build/downloads</code></a>,
                which is located with
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DL_DIR" target="_top"><code class="filename">DL_DIR</code></a>.
            </p><p>
                Use the following BitBake command form to fetch all the
                necessary sources without starting the build:
                </p><pre class="literallayout">
     $ bitbake -c fetchall <em class="replaceable"><code>target</code></em>
                </pre><p>
                This variation of the BitBake command guarantees that you
                have all the sources for that BitBake target should you
                disconnect from the Internet and want to do the build
                later offline.
            </p></div></div><div class="section" title="5.20. Building Software from an External Source"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="building-software-from-an-external-source">5.20. Building Software from an External Source<span class="permalink"><a alt="Permalink" title="Permalink" href="#building-software-from-an-external-source">¶</a></span></h2></div></div></div><p>
            By default, the OpenEmbedded build system uses the
            <a class="link" href="#build-directory">Build Directory</a> when
            building source code.
            The build process involves fetching the source files, unpacking
            them, and then patching them if necessary before the build takes
            place.
        </p><p>
            Situations exist where you might want to build software from source
            files that are external to and thus outside of the
            OpenEmbedded build system.
            For example, suppose you have a project that includes a new BSP with
            a heavily customized kernel.
            And, you want to minimize exposing the build system to the
            development team so that they can focus on their project and
            maintain everyone's workflow as much as possible.
            In this case, you want a kernel source directory on the development
            machine where the development occurs.
            You want the recipe's
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
            variable to point to the external directory and use it as is, not
            copy it.
        </p><p>
            To build from software that comes from an external source, all you
            need to do is inherit the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-externalsrc" target="_top"><code class="filename">externalsrc</code></a>
            class and then set the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTERNALSRC" target="_top"><code class="filename">EXTERNALSRC</code></a>
            variable to point to your external source code.
            Here are the statements to put in your
            <code class="filename">local.conf</code> file:
            </p><pre class="literallayout">
     INHERIT += "externalsrc"
     EXTERNALSRC_pn-<em class="replaceable"><code>myrecipe</code></em> = "<em class="replaceable"><code>path-to-your-source-tree</code></em>"
            </pre><p>
        </p><p>
            This next example shows how to accomplish the same thing by setting
            <code class="filename">EXTERNALSRC</code> in the recipe itself or in the
            recipe's append file:
            </p><pre class="literallayout">
     EXTERNALSRC = "<em class="replaceable"><code>path</code></em>"
     EXTERNALSRC_BUILD = "<em class="replaceable"><code>path</code></em>"
            </pre><p>
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                In order for these settings to take effect, you must globally
                or locally inherit the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-externalsrc" target="_top"><code class="filename">externalsrc</code></a>
                class.
            </div><p>
        </p><p>
            By default, <code class="filename">externalsrc.bbclass</code> builds
            the source code in a directory separate from the external source
            directory as specified by
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTERNALSRC" target="_top"><code class="filename">EXTERNALSRC</code></a>.
            If you need to have the source built in the same directory in
            which it resides, or some other nominated directory, you can set
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTERNALSRC_BUILD" target="_top"><code class="filename">EXTERNALSRC_BUILD</code></a>
            to point to that directory:
            </p><pre class="literallayout">
     EXTERNALSRC_BUILD_pn-<em class="replaceable"><code>myrecipe</code></em> = "<em class="replaceable"><code>path-to-your-source-tree</code></em>"
            </pre><p>
        </p></div><div class="section" title="5.21. Selecting an Initialization Manager"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="selecting-an-initialization-manager">5.21. Selecting an Initialization Manager<span class="permalink"><a alt="Permalink" title="Permalink" href="#selecting-an-initialization-manager">¶</a></span></h2></div></div></div><p>
            By default, the Yocto Project uses SysVinit as the initialization
            manager.
            However, support also exists for systemd,
            which is a full replacement for init with
            parallel starting of services, reduced shell overhead and other
            features that are used by many distributions.
        </p><p>
            If you want to use SysVinit, you do
            not have to do anything.
            But, if you want to use systemd, you must
            take some steps as described in the following sections.
        </p><div class="section" title="5.21.1. Using systemd Exclusively"><div class="titlepage"><div><div><h3 class="title" id="using-systemd-exclusively">5.21.1. Using systemd Exclusively<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-systemd-exclusively">¶</a></span></h3></div></div></div><p>
                Set the these variables in your distribution configuration
                file as follows:
                </p><pre class="literallayout">
     DISTRO_FEATURES_append = " systemd"
     VIRTUAL-RUNTIME_init_manager = "systemd"
                </pre><p>
                You can also prevent the SysVinit
                distribution feature from
                being automatically enabled as follows:
                </p><pre class="literallayout">
     DISTRO_FEATURES_BACKFILL_CONSIDERED = "sysvinit"
                </pre><p>
                Doing so removes any redundant SysVinit scripts.
            </p><p>
                To remove  initscripts from your image altogether,
                set this variable also:
                </p><pre class="literallayout">
     VIRTUAL-RUNTIME_initscripts = ""
                </pre><p>
            </p><p>
                For information on the backfill variable, see
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_FEATURES_BACKFILL_CONSIDERED" target="_top"><code class="filename">DISTRO_FEATURES_BACKFILL_CONSIDERED</code></a>.
            </p></div><div class="section" title="5.21.2. Using systemd for the Main Image and Using SysVinit for the Rescue Image"><div class="titlepage"><div><div><h3 class="title" id="using-systemd-for-the-main-image-and-using-sysvinit-for-the-rescue-image">5.21.2. Using systemd for the Main Image and Using SysVinit for the Rescue Image<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-systemd-for-the-main-image-and-using-sysvinit-for-the-rescue-image">¶</a></span></h3></div></div></div><p>
                Set these variables in your distribution configuration
                file as follows:
                </p><pre class="literallayout">
     DISTRO_FEATURES_append = " systemd"
     VIRTUAL-RUNTIME_init_manager = "systemd"
                </pre><p>
                Doing so causes your main image to use the
                <code class="filename">packagegroup-core-boot.bb</code> recipe and
                systemd.
                The rescue/minimal image cannot use this package group.
                However, it can install SysVinit
                and the appropriate packages will have support for both
                systemd and SysVinit.
            </p></div></div><div class="section" title="5.22. Selecting a Device Manager"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="selecting-dev-manager">5.22. Selecting a Device Manager<span class="permalink"><a alt="Permalink" title="Permalink" href="#selecting-dev-manager">¶</a></span></h2></div></div></div><p>
            The Yocto Project provides multiple ways to manage the device
            manager (<code class="filename">/dev</code>):
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Persistent and Pre-Populated<code class="filename">/dev</code>:</em></span>
                    For this case, the <code class="filename">/dev</code> directory
                    is persistent and the required device nodes are created
                    during the build.
                    </p></li><li class="listitem"><p><span class="emphasis"><em>Use <code class="filename">devtmpfs</code> with a Device Manager:</em></span>
                    For this case, the <code class="filename">/dev</code> directory
                    is provided by the kernel as an in-memory file system and
                    is automatically populated by the kernel at runtime.
                    Additional configuration of device nodes is done in user
                    space by a device manager like
                    <code class="filename">udev</code> or
                    <code class="filename">busybox-mdev</code>.
                    </p></li></ul></div><p>
        </p><div class="section" title="5.22.1. Using Persistent and Pre-Populated/dev"><div class="titlepage"><div><div><h3 class="title" id="static-dev-management">5.22.1. Using Persistent and Pre-Populated<code class="filename">/dev</code><span class="permalink"><a alt="Permalink" title="Permalink" href="#static-dev-management">¶</a></span></h3></div></div></div><p>
                To use the static method for device population, you need to
                set the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-USE_DEVFS" target="_top"><code class="filename">USE_DEVFS</code></a>
                variable to "0" as follows:
                </p><pre class="literallayout">
     USE_DEVFS = "0"
                </pre><p>
            </p><p>
                The content of the resulting <code class="filename">/dev</code>
                directory is defined in a Device Table file.
                The
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_DEVICE_TABLES" target="_top"><code class="filename">IMAGE_DEVICE_TABLES</code></a>
                variable defines the Device Table to use and should be set
                in the machine or distro configuration file.
                Alternatively, you can set this variable in your
                <code class="filename">local.conf</code> configuration file.
            </p><p>
                If you do not define the
                <code class="filename">IMAGE_DEVICE_TABLES</code> variable, the default
                <code class="filename">device_table-minimal.txt</code> is used:
                </p><pre class="literallayout">
     IMAGE_DEVICE_TABLES = "device_table-mymachine.txt"
                </pre><p>
            </p><p>
                The population is handled by the <code class="filename">makedevs</code>
                utility during image creation:
            </p></div><div class="section" title="5.22.2. Using devtmpfs and a Device Manager"><div class="titlepage"><div><div><h3 class="title" id="devtmpfs-dev-management">5.22.2. Using <code class="filename">devtmpfs</code> and a Device Manager<span class="permalink"><a alt="Permalink" title="Permalink" href="#devtmpfs-dev-management">¶</a></span></h3></div></div></div><p>
                To use the dynamic method for device population, you need to
                use (or be sure to set) the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-USE_DEVFS" target="_top"><code class="filename">USE_DEVFS</code></a>
                variable to "1", which is the default:
                </p><pre class="literallayout">
     USE_DEVFS = "1"
                </pre><p>
                With this setting, the resulting <code class="filename">/dev</code>
                directory is populated by the kernel using
                <code class="filename">devtmpfs</code>.
                Make sure the corresponding kernel configuration variable
                <code class="filename">CONFIG_DEVTMPFS</code> is set when building
                you build a Linux kernel.
            </p><p>
                All devices created by <code class="filename">devtmpfs</code> will be
                owned by <code class="filename">root</code> and have permissions
                <code class="filename">0600</code>.
            </p><p>
                To have more control over the device nodes, you can use a
                device manager like <code class="filename">udev</code> or
                <code class="filename">busybox-mdev</code>.
                You choose the device manager by defining the
                <code class="filename">VIRTUAL-RUNTIME_dev_manager</code> variable
                in your machine or distro configuration file.
                Alternatively, you can set this variable in your
                <code class="filename">local.conf</code> configuration file:
                </p><pre class="literallayout">
     VIRTUAL-RUNTIME_dev_manager = "udev"

     # Some alternative values
     # VIRTUAL-RUNTIME_dev_manager = "busybox-mdev"
     # VIRTUAL-RUNTIME_dev_manager = "systemd"
                </pre><p>
            </p></div></div><div class="section" title="5.23. Using an External SCM"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="platdev-appdev-srcrev">5.23. Using an External SCM<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-appdev-srcrev">¶</a></span></h2></div></div></div><p>
            If you're working on a recipe that pulls from an external Source
            Code Manager (SCM), it is possible to have the OpenEmbedded build
            system notice new recipe changes added to the SCM and then build
            the resulting packages that depend on the new recipes by using
            the latest versions.
            This only works for SCMs from which it is possible to get a
            sensible revision number for changes.
            Currently, you can do this with Apache Subversion (SVN), Git, and
            Bazaar (BZR) repositories.
        </p><p>
            To enable this behavior, the
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PV" target="_top"><code class="filename">PV</code></a>
            of the recipe needs to reference
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRCPV" target="_top"><code class="filename">SRCPV</code></a>.
            Here is an example:
            </p><pre class="literallayout">
     PV = "1.2.3+git${SRCPV}"
            </pre><p>
            Then, you can add the following to your
            <code class="filename">local.conf</code>:
            </p><pre class="literallayout">
     SRCREV_pn-<em class="replaceable"><code>PN</code></em> = "${AUTOREV}"
            </pre><p>
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PN" target="_top"><code class="filename">PN</code></a>
            is the name of the recipe for which you want to enable automatic source
            revision updating.
        </p><p>
            If you do not want to update your local configuration file, you can
            add the following directly to the recipe to finish enabling
            the feature:
            </p><pre class="literallayout">
     SRCREV = "${AUTOREV}"
            </pre><p>
        </p><p>
            The Yocto Project provides a distribution named
            <code class="filename">poky-bleeding</code>, whose configuration
            file contains the line:
            </p><pre class="literallayout">
     require conf/distro/include/poky-floating-revisions.inc
            </pre><p>
            This line pulls in the listed include file that contains
            numerous lines of exactly that form:
            </p><pre class="literallayout">
     #SRCREV_pn-opkg-native ?= "${AUTOREV}"
     #SRCREV_pn-opkg-sdk ?= "${AUTOREV}"
     #SRCREV_pn-opkg ?= "${AUTOREV}"
     #SRCREV_pn-opkg-utils-native ?= "${AUTOREV}"
     #SRCREV_pn-opkg-utils ?= "${AUTOREV}"
     SRCREV_pn-gconf-dbus ?= "${AUTOREV}"
     SRCREV_pn-matchbox-common ?= "${AUTOREV}"
     SRCREV_pn-matchbox-config-gtk ?= "${AUTOREV}"
     SRCREV_pn-matchbox-desktop ?= "${AUTOREV}"
     SRCREV_pn-matchbox-keyboard ?= "${AUTOREV}"
     SRCREV_pn-matchbox-panel-2 ?= "${AUTOREV}"
     SRCREV_pn-matchbox-themes-extra ?= "${AUTOREV}"
     SRCREV_pn-matchbox-terminal ?= "${AUTOREV}"
     SRCREV_pn-matchbox-wm ?= "${AUTOREV}"
     SRCREV_pn-settings-daemon ?= "${AUTOREV}"
     SRCREV_pn-screenshot ?= "${AUTOREV}"
          .
          .
          .
            </pre><p>
            These lines allow you to experiment with building a
            distribution that tracks the latest development source
            for numerous packages.
            </p><div class="note" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3>
                The <code class="filename">poky-bleeding</code> distribution
                is not tested on a regular basis.
                Keep this in mind if you use it.
            </div><p>
        </p></div><div class="section" title="5.24. Creating a Read-Only Root Filesystem"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="creating-a-read-only-root-filesystem">5.24. Creating a Read-Only Root Filesystem<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-a-read-only-root-filesystem">¶</a></span></h2></div></div></div><p>
            Suppose, for security reasons, you need to disable
            your target device's root filesystem's write permissions
            (i.e. you need a read-only root filesystem).
            Or, perhaps you are running the device's operating system
            from a read-only storage device.
            For either case, you can customize your image for
            that behavior.
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            Supporting a read-only root filesystem requires that the system and
            applications do not try to write to the root filesystem.
            You must configure all parts of the target system to write
            elsewhere, or to gracefully fail in the event of attempting to
            write to the root filesystem.
        </div><div class="section" title="5.24.1. Creating the Root Filesystem"><div class="titlepage"><div><div><h3 class="title" id="creating-the-root-filesystem">5.24.1. Creating the Root Filesystem<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-the-root-filesystem">¶</a></span></h3></div></div></div><p>
                To create the read-only root filesystem, simply add the
                "read-only-rootfs" feature to your image.
                Using either of the following statements in your
                image recipe or from within the
                <code class="filename">local.conf</code> file found in the
                <a class="link" href="#build-directory">Build Directory</a>
                causes the build system to create a read-only root filesystem:
                </p><pre class="literallayout">
     IMAGE_FEATURES = "read-only-rootfs"
                </pre><p>
                or
                </p><pre class="literallayout">
     EXTRA_IMAGE_FEATURES += "read-only-rootfs"
                </pre><p>
            </p><p>
                For more information on how to use these variables, see the
                "<a class="link" href="#usingpoky-extend-customimage-imagefeatures" title="5.2.2. Customizing Images Using Custom IMAGE_FEATURES and EXTRA_IMAGE_FEATURES">Customizing Images Using Custom <code class="filename">IMAGE_FEATURES</code> and <code class="filename">EXTRA_IMAGE_FEATURES</code></a>"
                section.
                For information on the variables, see
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>
                and <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-EXTRA_IMAGE_FEATURES" target="_top"><code class="filename">EXTRA_IMAGE_FEATURES</code></a>.
            </p></div><div class="section" title="5.24.2. Post-Installation Scripts"><div class="titlepage"><div><div><h3 class="title" id="post-installation-scripts">5.24.2. Post-Installation Scripts<span class="permalink"><a alt="Permalink" title="Permalink" href="#post-installation-scripts">¶</a></span></h3></div></div></div><p>
                It is very important that you make sure all
                post-Installation (<code class="filename">pkg_postinst</code>) scripts
                for packages that are installed into the image can be run
                at the time when the root filesystem is created during the
                build on the host system.
                These scripts cannot attempt to run during first-boot on the
                target device.
                With the "read-only-rootfs" feature enabled,
                the build system checks during root filesystem creation to make
                sure all post-installation scripts succeed.
                If any of these scripts still need to be run after the root
                filesystem is created, the build immediately fails.
                These build-time checks ensure that the build fails
                rather than the target device fails later during its
                initial boot operation.
            </p><p>
                Most of the common post-installation scripts generated by the
                build system for the out-of-the-box Yocto Project are engineered
                so that they can run during root filesystem creation
                (e.g. post-installation scripts for caching fonts).
                However, if you create and add custom scripts, you need
                to be sure they can be run during this file system creation.
            </p><p>
                Here are some common problems that prevent
                post-installation scripts from running during root filesystem
                creation:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        <span class="emphasis"><em>Not using $D in front of absolute
                        paths:</em></span>
                        The build system defines
                        <code class="filename">$</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-D" target="_top"><code class="filename">D</code></a>
                        when the root filesystem is created.
                        Furthermore, <code class="filename">$D</code> is blank when the
                        script is run on the target device.
                        This implies two purposes for <code class="filename">$D</code>:
                        ensuring paths are valid in both the host and target
                        environments, and checking to determine which
                        environment is being used as a method for taking
                        appropriate actions.
                        </p></li><li class="listitem"><p>
                        <span class="emphasis"><em>Attempting to run processes that are
                        specific to or dependent on the target
                        architecture:</em></span>
                        You can work around these attempts by using native
                        tools, which run on the host system,
                        to accomplish the same tasks, or
                        by alternatively running the processes under QEMU,
                        which has the <code class="filename">qemu_run_binary</code>
                        function.
                        For more information, see the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-qemu" target="_top"><code class="filename">qemu</code></a>
                        class.</p></li></ul></div><p>
            </p></div><div class="section" title="5.24.3. Areas With Write Access"><div class="titlepage"><div><div><h3 class="title" id="areas-with-write-access">5.24.3. Areas With Write Access<span class="permalink"><a alt="Permalink" title="Permalink" href="#areas-with-write-access">¶</a></span></h3></div></div></div><p>
                With the "read-only-rootfs" feature enabled,
                any attempt by the target to write to the root filesystem at
                runtime fails.
                Consequently, you must make sure that you configure processes
                and applications that attempt these types of writes do so
                to directories with write access (e.g.
                <code class="filename">/tmp</code> or <code class="filename">/var/run</code>).
            </p></div></div><div class="section" title="5.25. Performing Automated Runtime Testing"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="performing-automated-runtime-testing">5.25. Performing Automated Runtime Testing<span class="permalink"><a alt="Permalink" title="Permalink" href="#performing-automated-runtime-testing">¶</a></span></h2></div></div></div><p>
            The OpenEmbedded build system makes available a series of automated
            tests for images to verify runtime functionality.
            You can run these tests on either QEMU or actual target hardware.
            Tests are written in Python making use of the
            <code class="filename">unittest</code> module, and the majority of them
            run commands on the target system over SSH.
            This section describes how you set up the environment to use these
            tests, run available tests, and write and add your own tests.
        </p><p>
            For information on the test and QA infrastructure available
            within the Yocto Project, see the
            "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#testing-and-quality-assurance" target="_top">Testing and Quality Assurance</a>"
            section in the Yocto Project Reference Manual.
        </p><div class="section" title="5.25.1. Enabling Tests"><div class="titlepage"><div><div><h3 class="title" id="enabling-tests">5.25.1. Enabling Tests<span class="permalink"><a alt="Permalink" title="Permalink" href="#enabling-tests">¶</a></span></h3></div></div></div><p>
                Depending on whether you are planning to run tests using
                QEMU or on the hardware, you have to take
                different steps to enable the tests.
                See the following subsections for information on how to
                enable both types of tests.
            </p><div class="section" title="5.25.1.1. Enabling Runtime Tests on QEMU"><div class="titlepage"><div><div><h4 class="title" id="qemu-image-enabling-tests">5.25.1.1. Enabling Runtime Tests on QEMU<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-image-enabling-tests">¶</a></span></h4></div></div></div><p>
                    In order to run tests, you need to do the following:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Set up to avoid interaction
                            with <code class="filename">sudo</code> for networking:</em></span>
                            To accomplish this, you must do one of the
                            following:
                            </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Add
                                    <code class="filename">NOPASSWD</code> for your user
                                    in <code class="filename">/etc/sudoers</code> either for
                                    all commands or just for
                                    <code class="filename">runqemu-ifup</code>.
                                    You must provide the full path as that can
                                    change if you are using multiple clones of the
                                    source repository.
                                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                                        On some distributions, you also need to
                                        comment out "Defaults requiretty" in
                                        <code class="filename">/etc/sudoers</code>.
                                    </div></li><li class="listitem"><p>Manually configure a tap interface
                                    for your system.</p></li><li class="listitem"><p>Run as root the script in
                                    <code class="filename">scripts/runqemu-gen-tapdevs</code>,
                                    which should generate a list of tap devices.
                                    This is the option typically chosen for
                                    Autobuilder-type environments.
                                    </p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>Set the
                            <code class="filename">DISPLAY</code> variable:</em></span>
                            You need to set this variable so that you have an X
                            server available (e.g. start
                            <code class="filename">vncserver</code> for a headless machine).
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Be sure your host's firewall
                            accepts incoming connections from
                            192.168.7.0/24:</em></span>
                            Some of the tests (in particular dnf tests) start
                            an HTTP server on a random high number port,
                            which is used to serve files to the target.
                            The Dnf module serves
                            <code class="filename">${WORKDIR}/oe-rootfs-repo</code>
                            so it can run dnf channel commands.
                            That means your host's firewall
                            must accept incoming connections from 192.168.7.0/24,
                            which is the default IP range used for tap devices
                            by <code class="filename">runqemu</code>.</p></li><li class="listitem"><p><span class="emphasis"><em>Be sure your host has the
                            correct packages installed:</em></span>
                            Depending your host's distribution, you need
                            to have the following packages installed:
                            </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Ubuntu and Debian:
                                    <code class="filename">sysstat</code> and
                                    <code class="filename">iproute2</code>
                                    </p></li><li class="listitem"><p>OpenSUSE:
                                    <code class="filename">sysstat</code> and
                                    <code class="filename">iproute2</code>
                                    </p></li><li class="listitem"><p>Fedora:
                                    <code class="filename">sysstat</code> and
                                    <code class="filename">iproute</code>
                                    </p></li><li class="listitem"><p>CentOS:
                                    <code class="filename">sysstat</code> and
                                    <code class="filename">iproute</code>
                                    </p></li></ul></div><p>
                        </p></li></ul></div><p>
                </p><p>
                    Once you start running the tests, the following happens:
                    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A copy of the root filesystem is written
                            to <code class="filename">${WORKDIR}/testimage</code>.
                            </p></li><li class="listitem"><p>The image is booted under QEMU using the
                            standard <code class="filename">runqemu</code> script.
                            </p></li><li class="listitem"><p>A default timeout of 500 seconds occurs
                            to allow for the boot process to reach the login prompt.
                            You can change the timeout period by setting
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TEST_QEMUBOOT_TIMEOUT" target="_top"><code class="filename">TEST_QEMUBOOT_TIMEOUT</code></a>
                            in the <code class="filename">local.conf</code> file.
                            </p></li><li class="listitem"><p>Once the boot process is reached and the
                            login prompt appears, the tests run.
                            The full boot log is written to
                            <code class="filename">${WORKDIR}/testimage/qemu_boot_log</code>.
                            </p></li><li class="listitem"><p>Each test module loads in the order found
                            in <code class="filename">TEST_SUITES</code>.
                            You can find the full output of the commands run over
                            SSH in
                            <code class="filename">${WORKDIR}/testimgage/ssh_target_log</code>.
                            </p></li><li class="listitem"><p>If no failures occur, the task running the
                            tests ends successfully.
                            You can find the output from the
                            <code class="filename">unittest</code> in the task log at
                            <code class="filename">${WORKDIR}/temp/log.do_testimage</code>.
                            </p></li></ol></div><p>
                </p></div><div class="section" title="5.25.1.2. Enabling Runtime Tests on Hardware"><div class="titlepage"><div><div><h4 class="title" id="hardware-image-enabling-tests">5.25.1.2. Enabling Runtime Tests on Hardware<span class="permalink"><a alt="Permalink" title="Permalink" href="#hardware-image-enabling-tests">¶</a></span></h4></div></div></div><p>
                    The OpenEmbedded build system can run tests on real
                    hardware, and for certain devices it can also deploy
                    the image to be tested onto the device beforehand.
                </p><p>
                    For automated deployment, a "master image" is installed
                    onto the hardware once as part of setup.
                    Then, each time tests are to be run, the following
                    occurs:
                    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The master image is booted into and
                            used to write the image to be tested to
                            a second partition.
                            </p></li><li class="listitem"><p>The device is then rebooted using an
                            external script that you need to provide.
                            </p></li><li class="listitem"><p>The device boots into the image to be
                            tested.
                            </p></li></ol></div><p>
                </p><p>
                    When running tests (independent of whether the image
                    has been deployed automatically or not), the device is
                    expected to be connected to a network on a
                    pre-determined IP address.
                    You can either use static IP addresses written into
                    the image, or set the image to use DHCP and have your
                    DHCP server on the test network assign a known IP address
                    based on the MAC address of the device.
                </p><p>
                    In order to run tests on hardware, you need to set
                    <code class="filename">TEST_TARGET</code> to an appropriate value.
                    For QEMU, you do not have to change anything, the default
                    value is "QemuTarget".
                    For running tests on hardware, the following options exist:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>"SimpleRemoteTarget":</em></span>
                            Choose "SimpleRemoteTarget" if you are going to
                            run tests on a target system that is already
                            running the image to be tested and is available
                            on the network.
                            You can use "SimpleRemoteTarget" in conjunction
                            with either real hardware or an image running
                            within a separately started QEMU or any
                            other virtual machine manager.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>"Systemd-bootTarget":</em></span>
                            Choose "Systemd-bootTarget" if your hardware is
                            an EFI-based machine with
                            <code class="filename">systemd-boot</code> as bootloader and
                            <code class="filename">core-image-testmaster</code>
                            (or something similar) is installed.
                            Also, your hardware under test must be in a
                            DHCP-enabled network that gives it the same IP
                            address for each reboot.</p><p>If you choose "Systemd-bootTarget", there are
                            additional requirements and considerations.
                            See the
                            "<a class="link" href="#selecting-systemd-boottarget" title="5.25.1.3. Selecting Systemd-bootTarget">Selecting Systemd-bootTarget</a>"
                            section, which follows, for more information.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>"BeagleBoneTarget":</em></span>
                            Choose "BeagleBoneTarget" if you are deploying
                            images and running tests on the BeagleBone
                            "Black" or original "White" hardware.
                            For information on how to use these tests, see the
                            comments at the top of the BeagleBoneTarget
                            <code class="filename">meta-yocto-bsp/lib/oeqa/controllers/beaglebonetarget.py</code>
                            file.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>"EdgeRouterTarget":</em></span>
                            Choose "EdgeRouterTarget" is you are deploying
                            images and running tests on the Ubiquiti Networks
                            EdgeRouter Lite.
                            For information on how to use these tests, see the
                            comments at the top of the EdgeRouterTarget
                            <code class="filename">meta-yocto-bsp/lib/oeqa/controllers/edgeroutertarget.py</code>
                            file.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>"GrubTarget":</em></span>
                            Choose the "supports deploying images and running
                            tests on any generic PC that boots using GRUB.
                            For information on how to use these tests, see the
                            comments at the top of the GrubTarget
                            <code class="filename">meta-yocto-bsp/lib/oeqa/controllers/grubtarget.py</code>
                            file.
                            </p></li><li class="listitem"><p><span class="emphasis"><em>"<em class="replaceable"><code>your-target</code></em>":</em></span>
                            Create your own custom target if you want to run
                            tests when you are deploying images and running
                            tests on a custom machine within your BSP layer.
                            To do this, you need to add a Python unit that
                            defines the target class under
                            <code class="filename">lib/oeqa/controllers/</code> within
                            your layer.
                            You must also provide an empty
                            <code class="filename">__init__.py</code>.
                            For examples, see files in
                            <code class="filename">meta-yocto-bsp/lib/oeqa/controllers/</code>.
                            </p></li></ul></div><p>
                </p></div><div class="section" title="5.25.1.3. Selecting Systemd-bootTarget"><div class="titlepage"><div><div><h4 class="title" id="selecting-systemd-boottarget">5.25.1.3. Selecting Systemd-bootTarget<span class="permalink"><a alt="Permalink" title="Permalink" href="#selecting-systemd-boottarget">¶</a></span></h4></div></div></div><p>
                    If you did not set <code class="filename">TEST_TARGET</code> to
                    "Systemd-bootTarget", then you do not need any information
                    in this section.
                    You can skip down to the
                    "<a class="link" href="#qemu-image-running-tests" title="5.25.2. Running Tests">Running Tests</a>"
                    section.
                </p><p>
                    If you did set <code class="filename">TEST_TARGET</code> to
                    "Systemd-bootTarget", you also need to perform a one-time
                    setup of your master image by doing the following:
                    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Set <code class="filename">EFI_PROVIDER</code>:</em></span>
                            Be sure that <code class="filename">EFI_PROVIDER</code>
                            is as follows:
                            </p><pre class="literallayout">
     EFI_PROVIDER = "systemd-boot"
                            </pre><p>
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Build the master image:</em></span>
                            Build the <code class="filename">core-image-testmaster</code>
                            image.
                            The <code class="filename">core-image-testmaster</code>
                            recipe is provided as an example for a
                            "master" image and you can customize the image
                            recipe as you would any other recipe.
                            </p><p>Here are the image recipe requirements:
                            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Inherits
                                    <code class="filename">core-image</code>
                                    so that kernel modules are installed.
                                    </p></li><li class="listitem"><p>Installs normal linux utilities
                                    not busybox ones (e.g.
                                    <code class="filename">bash</code>,
                                    <code class="filename">coreutils</code>,
                                    <code class="filename">tar</code>,
                                    <code class="filename">gzip</code>, and
                                    <code class="filename">kmod</code>).
                                    </p></li><li class="listitem"><p>Uses a custom
                                    Initial RAM Disk (initramfs) image with a
                                    custom installer.
                                    A normal image that you can install usually
                                    creates a single rootfs partition.
                                    This image uses another installer that
                                    creates a specific partition layout.
                                    Not all Board Support Packages (BSPs)
                                    can use an installer.
                                    For such cases, you need to manually create
                                    the following partition layout on the
                                    target:
                                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>First partition mounted
                                            under <code class="filename">/boot</code>,
                                            labeled "boot".
                                            </p></li><li class="listitem"><p>The main rootfs
                                            partition where this image gets
                                            installed, which is mounted under
                                            <code class="filename">/</code>.
                                            </p></li><li class="listitem"><p>Another partition
                                            labeled "testrootfs" where test
                                            images get deployed.
                                            </p></li></ul></div><p>
                                    </p></li></ul></div><p>
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Install image:</em></span>
                            Install the image that you just built on the target
                            system.
                            </p></li></ol></div><p>
                </p><p>
                    The final thing you need to do when setting
                    <code class="filename">TEST_TARGET</code> to "Systemd-bootTarget" is
                    to set up the test image:
                    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Set up your <code class="filename">local.conf</code> file:</em></span>
                            Make sure you have the following statements in
                            your <code class="filename">local.conf</code> file:
                            </p><pre class="literallayout">
     IMAGE_FSTYPES += "tar.gz"
     INHERIT += "testimage"
     TEST_TARGET = "Systemd-bootTarget"
     TEST_TARGET_IP = "192.168.2.3"
                            </pre><p>
                            </p></li><li class="listitem"><p><span class="emphasis"><em>Build your test image:</em></span>
                            Use BitBake to build the image:
                            </p><pre class="literallayout">
     $ bitbake core-image-sato
                            </pre><p>
                            </p></li></ol></div><p>
                </p></div><div class="section" title="5.25.1.4. Power Control"><div class="titlepage"><div><div><h4 class="title" id="power-control">5.25.1.4. Power Control<span class="permalink"><a alt="Permalink" title="Permalink" href="#power-control">¶</a></span></h4></div></div></div><p>
                    For most hardware targets other than SimpleRemoteTarget,
                    you can control power:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            You can use
                            <code class="filename">TEST_POWERCONTROL_CMD</code>
                            together with
                            <code class="filename">TEST_POWERCONTROL_EXTRA_ARGS</code>
                            as a command that runs on the host and does power
                            cycling.
                            The test code passes one argument to that command:
                            off, on or cycle (off then on).
                            Here is an example that could appear in your
                            <code class="filename">local.conf</code> file:
                            </p><pre class="literallayout">
     TEST_POWERCONTROL_CMD = "powercontrol.exp test 10.11.12.1 nuc1"
                            </pre><p>
                            In this example, the expect script does the
                            following:
                            </p><pre class="literallayout">
     ssh test@10.11.12.1 "pyctl nuc1 <em class="replaceable"><code>arg</code></em>"
                            </pre><p>
                            It then runs a Python script that controls power
                            for a label called <code class="filename">nuc1</code>.
                            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                                You need to customize
                                <code class="filename">TEST_POWERCONTROL_CMD</code>
                                and
                                <code class="filename">TEST_POWERCONTROL_EXTRA_ARGS</code>
                                for your own setup.
                                The one requirement is that it accepts
                                "on", "off", and "cycle" as the last argument.
                            </div><p>
                            </p></li><li class="listitem"><p>
                            When no command is defined, it connects to the
                            device over SSH and uses the classic reboot command
                            to reboot the device.
                            Classic reboot is fine as long as the machine
                            actually reboots (i.e. the SSH test has not
                            failed).
                            It is useful for scenarios where you have a simple
                            setup, typically with a single board, and where
                            some manual interaction is okay from time to time.
                            </p></li></ul></div><p>
                    If you have no hardware to automatically perform power
                    control but still wish to experiment with automated
                    hardware testing, you can use the dialog-power-control
                    script that shows a dialog prompting you to perform the
                    required power action.
                    This script requires either KDialog or Zenity to be
                    installed.
                    To use this script, set the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TEST_POWERCONTROL_CMD" target="_top"><code class="filename">TEST_POWERCONTROL_CMD</code></a>
                    variable as follows:
                    </p><pre class="literallayout">
     TEST_POWERCONTROL_CMD = "${COREBASE}/scripts/contrib/dialog-power-control"
                    </pre><p>
                </p></div><div class="section" title="5.25.1.5. Serial Console Connection"><div class="titlepage"><div><div><h4 class="title" id="serial-console-connection">5.25.1.5. Serial Console Connection<span class="permalink"><a alt="Permalink" title="Permalink" href="#serial-console-connection">¶</a></span></h4></div></div></div><p>
                    For test target classes requiring a serial console
                    to interact with the bootloader (e.g. BeagleBoneTarget,
                    EdgeRouterTarget, and GrubTarget), you need to
                    specify a command to use to connect to the serial console
                    of the target machine by using the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TEST_SERIALCONTROL_CMD" target="_top"><code class="filename">TEST_SERIALCONTROL_CMD</code></a>
                    variable and optionally the
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TEST_SERIALCONTROL_EXTRA_ARGS" target="_top"><code class="filename">TEST_SERIALCONTROL_EXTRA_ARGS</code></a>
                    variable.
                </p><p>
                    These cases could be a serial terminal program if the
                    machine is connected to a local serial port, or a
                    <code class="filename">telnet</code> or
                    <code class="filename">ssh</code> command connecting to a remote
                    console server.
                    Regardless of the case, the command simply needs to
                    connect to the serial console and forward that connection
                    to standard input and output as any normal terminal
                    program does.
                    For example, to use the picocom terminal program on
                    serial device <code class="filename">/dev/ttyUSB0</code>
                    at 115200bps, you would set the variable as follows:
                    </p><pre class="literallayout">
     TEST_SERIALCONTROL_CMD = "picocom /dev/ttyUSB0 -b 115200"
                    </pre><p>
                    For local devices where the serial port device disappears
                    when the device reboots, an additional "serdevtry" wrapper
                    script is provided.
                    To use this wrapper, simply prefix the terminal command
                    with
                    <code class="filename">${COREBASE}/scripts/contrib/serdevtry</code>:
                    </p><pre class="literallayout">
     TEST_SERIALCONTROL_CMD = "${COREBASE}/scripts/contrib/serdevtry picocom -b
115200 /dev/ttyUSB0"
                    </pre><p>
                </p></div></div><div class="section" title="5.25.2. Running Tests"><div class="titlepage"><div><div><h3 class="title" id="qemu-image-running-tests">5.25.2. Running Tests<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-image-running-tests">¶</a></span></h3></div></div></div><p>
                You can start the tests automatically or manually:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Automatically running tests:</em></span>
                        To run the tests automatically after the
                        OpenEmbedded build system successfully creates an image,
                        first set the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TEST_IMAGE" target="_top"><code class="filename">TEST_IMAGE</code></a>
                        variable to "1" in your <code class="filename">local.conf</code>
                        file in the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/dev-manual/dev-manual.html#build-directory" target="_top">Build Directory</a>:
                        </p><pre class="literallayout">
     TEST_IMAGE = "1"
                        </pre><p>
                        Next, build your image.
                        If the image successfully builds, the tests will be
                        run:
                        </p><pre class="literallayout">
     bitbake core-image-sato
                        </pre></li><li class="listitem"><p><span class="emphasis"><em>Manually running tests:</em></span>
                        To manually run the tests, first globally inherit the
                        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-testimage*" target="_top"><code class="filename">testimage</code></a>
                        class by editing your <code class="filename">local.conf</code>
                        file:
                        </p><pre class="literallayout">
    INHERIT += "testimage"
                        </pre><p>
                        Next, use BitBake to run the tests:
                        </p><pre class="literallayout">
     bitbake -c testimage <em class="replaceable"><code>image</code></em>
                        </pre></li></ul></div><p>
            </p><p>
                All test files reside in
                <code class="filename">meta/lib/oeqa/runtime</code> in the
                <a class="link" href="#source-directory">Source Directory</a>.
                A test name maps directly to a Python module.
                Each test module may contain a number of individual tests.
                Tests are usually grouped together by the area
                tested (e.g tests for systemd reside in
                <code class="filename">meta/lib/oeqa/runtime/systemd.py</code>).
            </p><p>
                You can add tests to any layer provided you place them in the
                proper area and you extend
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBPATH" target="_top"><code class="filename">BBPATH</code></a>
                in the <code class="filename">local.conf</code> file as normal.
                Be sure that tests reside in
                <code class="filename"><em class="replaceable"><code>layer</code></em>/lib/oeqa/runtime</code>.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Be sure that module names do not collide with module names
                    used in the default set of test modules in
                    <code class="filename">meta/lib/oeqa/runtime</code>.
                </div><p>
            </p><p>
                You can change the set of tests run by appending or overriding
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TEST_SUITES" target="_top"><code class="filename">TEST_SUITES</code></a>
                variable in <code class="filename">local.conf</code>.
                Each name in <code class="filename">TEST_SUITES</code> represents a
                required test for the image.
                Test modules named within <code class="filename">TEST_SUITES</code>
                cannot be skipped even if a test is not suitable for an image
                (e.g. running the RPM tests on an image without
                <code class="filename">rpm</code>).
                Appending "auto" to <code class="filename">TEST_SUITES</code> causes the
                build system to try to run all tests that are suitable for the
                image (i.e. each test module may elect to skip itself).
            </p><p>
                The order you list tests in <code class="filename">TEST_SUITES</code>
                is important and influences test dependencies.
                Consequently, tests that depend on other tests should be added
                after the test on which they depend.
                For example, since the <code class="filename">ssh</code> test
                depends on the
                <code class="filename">ping</code> test, "ssh" needs to come after
                "ping" in the list.
                The test class provides no re-ordering or dependency handling.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Each module can have multiple classes with multiple test
                    methods.
                    And, Python <code class="filename">unittest</code> rules apply.
                </div><p>
            </p><p>
                Here are some things to keep in mind when running tests:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The default tests for the image are defined
                        as:
                        </p><pre class="literallayout">
     DEFAULT_TEST_SUITES_pn-<em class="replaceable"><code>image</code></em> = "ping ssh df connman syslog xorg scp vnc date rpm dnf dmesg"
                        </pre></li><li class="listitem"><p>Add your own test to the list of the
                        by using the following:
                        </p><pre class="literallayout">
     TEST_SUITES_append = " mytest"
                        </pre></li><li class="listitem"><p>Run a specific list of tests as follows:
                        </p><pre class="literallayout">
     TEST_SUITES = "test1 test2 test3"
                        </pre><p>
                        Remember, order is important.
                        Be sure to place a test that is dependent on another test
                        later in the order.</p></li></ul></div><p>
            </p></div><div class="section" title="5.25.3. Exporting Tests"><div class="titlepage"><div><div><h3 class="title" id="exporting-tests">5.25.3. Exporting Tests<span class="permalink"><a alt="Permalink" title="Permalink" href="#exporting-tests">¶</a></span></h3></div></div></div><p>
                You can export tests so that they can run independently of
                the build system.
                Exporting tests is required if you want to be able to hand
                the test execution off to a scheduler.
                You can only export tests that are defined in
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-TEST_SUITES" target="_top"><code class="filename">TEST_SUITES</code></a>.
            </p><p>
                If your image is already built, make sure the following are set
                in your <code class="filename">local.conf</code> file:
                </p><pre class="literallayout">
     INHERIT +="testexport"
     TEST_TARGET_IP = "<em class="replaceable"><code>IP-address-for-the-test-target</code></em>"
     TEST_SERVER_IP = "<em class="replaceable"><code>IP-address-for-the-test-server</code></em>"
                </pre><p>
                You can then export the tests with the following BitBake
                command form:
                </p><pre class="literallayout">
     $ bitbake <em class="replaceable"><code>image</code></em> -c testexport
                </pre><p>
                Exporting the tests places them in the
                <a class="link" href="#build-directory">Build Directory</a> in
                <code class="filename">tmp/testexport/</code><em class="replaceable"><code>image</code></em>,
                which is controlled by the
                <code class="filename">TEST_EXPORT_DIR</code> variable.
            </p><p>
                You can now run the tests outside of the build environment:
                </p><pre class="literallayout">
     $ cd tmp/testexport/<em class="replaceable"><code>image</code></em>
     $ ./runexported.py testdata.json
                </pre><p>
            </p><p>
                Here is a complete example that shows IP addresses and uses
                the <code class="filename">core-image-sato</code> image:
                </p><pre class="literallayout">
     INHERIT +="testexport"
     TEST_TARGET_IP = "192.168.7.2"
     TEST_SERVER_IP = "192.168.7.1"
                </pre><p>
                Use BitBake to export the tests:
                </p><pre class="literallayout">
     $ bitbake core-image-sato -c testexport
                </pre><p>
                Run the tests outside of the build environment using the
                following:
                </p><pre class="literallayout">
     $ cd tmp/testexport/core-image-sato
     $ ./runexported.py testdata.json
                </pre><p>
            </p></div><div class="section" title="5.25.4. Writing New Tests"><div class="titlepage"><div><div><h3 class="title" id="qemu-image-writing-new-tests">5.25.4. Writing New Tests<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-image-writing-new-tests">¶</a></span></h3></div></div></div><p>
                As mentioned previously, all new test files need to be in the
                proper place for the build system to find them.
                New tests for additional functionality outside of the core
                should be added to the layer that adds the functionality, in
                <code class="filename"><em class="replaceable"><code>layer</code></em>/lib/oeqa/runtime</code>
                (as long as
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-BBPATH" target="_top"><code class="filename">BBPATH</code></a>
                is extended in the layer's
                <code class="filename">layer.conf</code> file as normal).
                Just remember the following:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Filenames need to map directly to test
                        (module) names.
                        </p></li><li class="listitem"><p>Do not use module names that
                        collide with existing core tests.
                        </p></li><li class="listitem"><p>Minimally, an empty
                        <code class="filename">__init__.py</code> file must exist
                        in the runtime directory.
                        </p></li></ul></div><p>
            </p><p>
                To create a new test, start by copying an existing module
                (e.g. <code class="filename">syslog.py</code> or
                <code class="filename">gcc.py</code> are good ones to use).
                Test modules can use code from
                <code class="filename">meta/lib/oeqa/utils</code>, which are helper
                classes.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                Structure shell commands such that you rely on them and they
                return a single code for success.
                Be aware that sometimes you will need to parse the output.
                See the <code class="filename">df.py</code> and
                <code class="filename">date.py</code> modules for examples.
            </div><p>
                You will notice that all test classes inherit
                <code class="filename">oeRuntimeTest</code>, which is found in
                <code class="filename">meta/lib/oetest.py</code>.
                This base class offers some helper attributes, which are
                described in the following sections:
            </p><div class="section" title="5.25.4.1. Class Methods"><div class="titlepage"><div><div><h4 class="title" id="qemu-image-writing-tests-class-methods">5.25.4.1. Class Methods<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-image-writing-tests-class-methods">¶</a></span></h4></div></div></div><p>
                    Class methods are as follows:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><code class="filename">hasPackage(pkg)</code>:</em></span>
                            Returns "True" if <code class="filename">pkg</code> is in the
                            installed package list of the image, which is based
                            on the manifest file that is generated during the
                            <code class="filename">do_rootfs</code> task.
                            </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">hasFeature(feature)</code>:</em></span>
                            Returns "True" if the feature is in
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>
                            or
                            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DISTRO_FEATURES" target="_top"><code class="filename">DISTRO_FEATURES</code></a>.
                            </p></li></ul></div><p>
                </p></div><div class="section" title="5.25.4.2. Class Attributes"><div class="titlepage"><div><div><h4 class="title" id="qemu-image-writing-tests-class-attributes">5.25.4.2. Class Attributes<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-image-writing-tests-class-attributes">¶</a></span></h4></div></div></div><p>
                    Class attributes are as follows:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><code class="filename">pscmd</code>:</em></span>
                            Equals "ps -ef" if <code class="filename">procps</code> is
                            installed in the image.
                            Otherwise, <code class="filename">pscmd</code> equals
                            "ps" (busybox).
                            </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">tc</code>:</em></span>
                            The called test context, which gives access to the
                            following attributes:
                            </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><span class="emphasis"><em><code class="filename">d</code>:</em></span>
                                    The BitBake datastore, which allows you to
                                    use stuff such as
                                    <code class="filename">oeRuntimeTest.tc.d.getVar("VIRTUAL-RUNTIME_init_manager")</code>.
                                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">testslist</code> and <code class="filename">testsrequired</code>:</em></span>
                                    Used internally.
                                    The tests do not need these.
                                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">filesdir</code>:</em></span>
                                    The absolute path to
                                    <code class="filename">meta/lib/oeqa/runtime/files</code>,
                                    which contains helper files for tests meant
                                    for copying on the target such as small
                                    files written in C for compilation.
                                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">target</code>:</em></span>
                                    The target controller object used to deploy
                                    and start an image on a particular target
                                    (e.g. QemuTarget, SimpleRemote, and
                                    Systemd-bootTarget).
                                    Tests usually use the following:
                                    </p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem"><p><span class="emphasis"><em><code class="filename">ip</code>:</em></span>
                                            The target's IP address.
                                            </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">server_ip</code>:</em></span>
                                            The host's IP address, which is
                                            usually used by the "dnf" test
                                            suite.
                                            </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">run(cmd, timeout=None)</code>:</em></span>
                                            The single, most used method.
                                            This command is a wrapper for:
                                            <code class="filename">ssh root@host "cmd"</code>.
                                            The command returns a tuple:
                                            (status, output), which are what
                                            their names imply - the return code
                                            of "cmd" and whatever output
                                            it produces.
                                            The optional timeout argument
                                            represents the number of seconds the
                                            test should wait for "cmd" to
                                            return.
                                            If the argument is "None", the
                                            test uses the default instance's
                                            timeout period, which is 300
                                            seconds.
                                            If the argument is "0", the test
                                            runs until the command returns.
                                            </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">copy_to(localpath, remotepath)</code>:</em></span>
                                            <code class="filename">scp localpath root@ip:remotepath</code>.
                                            </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">copy_from(remotepath, localpath)</code>:</em></span>
                                            <code class="filename">scp root@host:remotepath localpath</code>.
                                            </p></li></ul></div></li></ul></div></li></ul></div><p>
                </p></div><div class="section" title="5.25.4.3. Instance Attributes"><div class="titlepage"><div><div><h4 class="title" id="qemu-image-writing-tests-instance-attributes">5.25.4.3. Instance Attributes<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-image-writing-tests-instance-attributes">¶</a></span></h4></div></div></div><p>
                    A single instance attribute exists, which is
                    <code class="filename">target</code>.
                    The <code class="filename">target</code> instance attribute is
                    identical to the class attribute of the same name, which
                    is described in the previous section.
                    This attribute exists as both an instance and class
                    attribute so tests can use
                    <code class="filename">self.target.run(cmd)</code> in instance
                    methods instead of
                    <code class="filename">oeRuntimeTest.tc.target.run(cmd)</code>.
                </p></div></div><div class="section" title="5.25.5. Installing Packages in the DUT Without the Package Manager"><div class="titlepage"><div><div><h3 class="title" id="installing-packages-in-the-dut-without-the-package-manager">5.25.5. Installing Packages in the DUT Without the Package Manager<span class="permalink"><a alt="Permalink" title="Permalink" href="#installing-packages-in-the-dut-without-the-package-manager">¶</a></span></h3></div></div></div><p>
                When a test requires a package built by BitBake, it is possible
                to install that package.
                Installing the package does not require a package manager be
                installed in the device under test (DUT).
                It does, however, require an SSH connection and the target must
                be using the <code class="filename">sshcontrol</code> class.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    This method uses <code class="filename">scp</code> to copy files
                    from the host to the target, which causes permissions and
                    special attributes to be lost.
                </div><p>
            </p><p>
                A JSON file is used to define the packages needed by a test.
                This file must be in the same path as the file used to define
                the tests.
                Furthermore, the filename must map directly to the test
                module name with a <code class="filename">.json</code> extension.
            </p><p>
                The JSON file must include an object with the test name as
                keys of an object or an array.
                This object (or array of objects) uses the following data:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>"pkg" - A mandatory string that is the
                        name of the package to be installed.
                        </p></li><li class="listitem"><p>"rm" - An optional boolean, which defaults
                        to "false", that specifies to remove the package after
                        the test.
                        </p></li><li class="listitem"><p>"extract" - An optional boolean, which
                        defaults to "false", that specifies if the package must
                        be extracted from the package format.
                        When set to "true", the package is not automatically
                        installed into the DUT.
                        </p></li></ul></div><p>
            </p><p>
                Following is an example JSON file that handles test "foo"
                installing package "bar" and test "foobar" installing
                packages "foo" and "bar".
                Once the test is complete, the packages are removed from the
                DUT.
                </p><pre class="literallayout">
     {
         "foo": {
             "pkg": "bar"
         },
         "foobar": [
             {
                 "pkg": "foo",
                 "rm": true
             },
             {
                 "pkg": "bar",
                 "rm": true
             }
         ]
     }
                </pre><p>
            </p></div></div><div class="section" title="5.26. Debugging With the GNU Project Debugger (GDB) Remotely"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="platdev-gdb-remotedebug">5.26. Debugging With the GNU Project Debugger (GDB) Remotely<span class="permalink"><a alt="Permalink" title="Permalink" href="#platdev-gdb-remotedebug">¶</a></span></h2></div></div></div><p>
            GDB allows you to examine running programs, which in turn helps you to understand and fix problems.
            It also allows you to perform post-mortem style analysis of program crashes.
            GDB is available as a package within the Yocto Project and is
            installed in SDK images by default.
            See the "<a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-images" target="_top">Images</a>" chapter
            in the Yocto Project Reference Manual for a description of these images.
            You can find information on GDB at <a class="ulink" href="http://sourceware.org/gdb/" target="_top">http://sourceware.org/gdb/</a>.
        </p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>
            For best results, install debug (<code class="filename">-dbg</code>) packages
            for the applications you are going to debug.
            Doing so makes extra debug symbols available that give you more
            meaningful output.
        </div><p>
            Sometimes, due to memory or disk space constraints, it is not possible
            to use GDB directly on the remote target to debug applications.
            These constraints arise because GDB needs to load the debugging information and the
            binaries of the process being debugged.
            Additionally, GDB needs to perform many computations to locate information such as function
            names, variable names and values, stack traces and so forth - even before starting the
            debugging process.
            These extra computations place more load on the target system and can alter the
            characteristics of the program being debugged.
        </p><p>
            To help get past the previously mentioned constraints, you can use Gdbserver.
            Gdbserver runs on the remote target and does not load any debugging information
            from the debugged process.
            Instead, a GDB instance processes the debugging information that is run on a
            remote computer - the host GDB.
            The host GDB then sends control commands to Gdbserver to make it stop or start the debugged
            program, as well as read or write memory regions of that debugged program.
            All the debugging information loaded and processed as well
            as all the heavy debugging is done by the host GDB.
            Offloading these processes gives the Gdbserver running on the target a chance to remain
            small and fast.
        </p><p>
            Because the host GDB is responsible for loading the debugging information and
            for doing the necessary processing to make actual debugging happen,
            you have to make sure the host can access the unstripped binaries complete
            with their debugging information and also be sure the target is compiled with no optimizations.
            The host GDB must also have local access to all the libraries used by the
            debugged program.
            Because Gdbserver does not need any local debugging information, the binaries on
            the remote target can remain stripped.
            However, the binaries must also be compiled without optimization
            so they match the host's binaries.
        </p><p>
            To remain consistent with GDB documentation and terminology, the binary being debugged
            on the remote target machine is referred to as the "inferior" binary.
            For documentation on GDB see the
            <a class="ulink" href="http://sourceware.org/gdb/documentation/" target="_top">GDB site</a>.
        </p><p>
            The following steps show you how to debug using the GNU project
            debugger.
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                    <span class="emphasis"><em>Configure your build system to construct the
                    companion debug filesystem:</em></span></p><p>In your <code class="filename">local.conf</code> file, set
                    the following:
                    </p><pre class="literallayout">
     IMAGE_GEN_DEBUGFS = "1"
     IMAGE_FSTYPES_DEBUGFS = "tar.bz2"
                    </pre><p>
                    These options cause the OpenEmbedded build system
                    to generate a special companion filesystem fragment,
                    which contains the matching source and debug symbols to
                    your deployable filesystem.
                    The build system does this by looking at what is in the
                    deployed filesystem, and pulling the corresponding
                    <code class="filename">-dbg</code> packages.</p><p>The companion debug filesystem is not a complete
                    filesystem, but only contains the debug fragments.
                    This filesystem must be combined with the full filesystem
                    for debugging.
                    Subsequent steps in this procedure show how to combine
                    the partial filesystem with the full filesystem.
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Configure the system to include Gdbserver in
                    the target filesystem:</em></span></p><p>Make the following addition in either your
                    <code class="filename">local.conf</code> file or in an image
                    recipe:
                    </p><pre class="literallayout">
     IMAGE_INSTALL_append = “ gdbserver"
                    </pre><p>
                    The change makes sure the <code class="filename">gdbserver</code>
                    package is included.
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Build the environment:</em></span></p><p>Use the following command to construct the image and
                    the companion Debug Filesystem:
                    </p><pre class="literallayout">
     $ bitbake <em class="replaceable"><code>image</code></em>
                    </pre><p>
                    Build the cross GDB component and make it available
                    for debugging.
                    Build the SDK that matches the image.
                    Building the SDK is best for a production build
                    that can be used later for debugging, especially
                    during long term maintenance:
                    </p><pre class="literallayout">
     $ bitbake -c populate_sdk <em class="replaceable"><code>image</code></em>
                    </pre><p>Alternatively, you can build the minimal
                    toolchain components that match the target.
                    Doing so creates a smaller than typical SDK and only
                    contains a minimal set of components with which to
                    build simple test applications, as well as run the
                    debugger:
                    </p><pre class="literallayout">
     $ bitbake meta-toolchain
                    </pre><p>A final method is to build Gdb itself within
                    the build system:
                    </p><pre class="literallayout">
     $ bitbake gdb-cross-<em class="replaceable"><code>architecture</code></em>
                    </pre><p>
                    Doing so produces a temporary copy of
                    <code class="filename">cross-gdb</code> you can use for
                    debugging during development.
                    While this is the quickest approach, the two previous
                    methods in this step are better when considering
                    long-term maintenance strategies.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        If you run
                        <code class="filename">bitbake gdb-cross</code>, the
                        OpenEmbedded build system suggests the actual
                        image (e.g. <code class="filename">gdb-cross-i586</code>).
                        The suggestion is usually the actual name you want
                        to use.
                    </div><p>
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Set up the</em></span> <code class="filename">debugfs</code></p><p>Run the following commands to set up the
                    <code class="filename">debugfs</code>:
                    </p><pre class="literallayout">
     $ mkdir debugfs
     $ cd debugfs
     $ tar xvfj <em class="replaceable"><code>build-dir</code></em>/tmp-glibc/deploy/images/<em class="replaceable"><code>machine</code></em>/<em class="replaceable"><code>image</code></em>.rootfs.tar.bz2
     $ tar xvfj <em class="replaceable"><code>build-dir</code></em>/tmp-glibc/deploy/images/<em class="replaceable"><code>machine</code></em>/<em class="replaceable"><code>image</code></em>-dbg.rootfs.tar.bz2
                    </pre><p>
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Set up GDB</em></span></p><p>Install the SDK (if you built one) and then
                    source the correct environment file.
                    Sourcing the environment file puts the SDK in your
                    <code class="filename">PATH</code> environment variable.</p><p>If you are using the build system, Gdb is
                    located in
                    <em class="replaceable"><code>build-dir</code></em>/tmp/sysroots/<em class="replaceable"><code>host</code></em>/usr/bin/<em class="replaceable"><code>architecture</code></em>/<em class="replaceable"><code>architecture</code></em>-gdb
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Boot the target:</em></span></p><p>For information on how to run QEMU, see the
                    <a class="ulink" href="http://wiki.qemu.org/Documentation/GettingStartedDevelopers" target="_top">QEMU Documentation</a>.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        Be sure to verify that your host can access the
                        target via TCP.
                    </div><p>
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Debug a program:</em></span></p><p>Debugging a program involves running Gdbserver
                    on the target and then running Gdb on the host.
                    The example in this step debugs
                    <code class="filename">gzip</code>:
                    </p><pre class="literallayout">
     root@qemux86:~# gdbserver localhost:1234 /bin/gzip —help
                    </pre><p>
                    For additional Gdbserver options, see the
                    <a class="ulink" href="https://www.gnu.org/software/gdb/documentation/" target="_top">Gdb Server Documentation</a>.
                    </p><p>After running Gdbserver on the target, you need
                    to run Gdb on the host and configure it and connect to
                    the target.
                    Use these commands:
                    </p><pre class="literallayout">
     $ cd <em class="replaceable"><code>directory-holding-the-debugfs-directory</code></em>
     $ <em class="replaceable"><code>arch</code></em>-gdb

     (gdb) set sysroot debugfs
     (gdb) set substitute-path /usr/src/debug debugfs/usr/src/debug
     (gdb) target remote <em class="replaceable"><code>IP-of-target</code></em>:1234
                    </pre><p>
                    At this point, everything should automatically load
                    (i.e. matching binaries, symbols and headers).
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                        The Gdb <code class="filename">set</code> commands in the
                        previous example can be placed into the users
                        <code class="filename">~/.gdbinit</code> file.
                        Upon starting, Gdb automatically runs whatever
                        commands are in that file.
                    </div><p>
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Deploying without a full image
                    rebuild:</em></span></p><p>In many cases, during development you want a
                    quick method to deploy a new binary to the target and
                    debug it, without waiting for a full image build.
                    </p><p>One approach to solving this situation is to
                    just build the component you want to debug.
                    Once you have built the component, copy the
                    executable directly to both the target and the
                    host <code class="filename">debugfs</code>.</p><p>If the binary is processed through the debug
                    splitting in OpenEmbedded, you should also
                    copy the debug items (i.e. <code class="filename">.debug</code>
                    contents and corresponding
                    <code class="filename">/usr/src/debug</code> files)
                    from the work directory.
                    Here is an example:
                    </p><pre class="literallayout">
     $ bitbake bash
     $ bitbake -c devshell bash
     $ cd ..
     $ scp packages-split/bash/bin/bash <em class="replaceable"><code>target</code></em>:/bin/bash
     $ cp -a packages-split/bash-dbg/* <em class="replaceable"><code>path</code></em>/debugfs
                    </pre><p>
                    </p></li></ol></div><p>
        </p></div><div class="section" title="5.27. Debugging with the GNU Project Debugger (GDB) on the Target"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="debugging-with-the-gnu-project-debugger-gdb-on-the-target">5.27. Debugging with the GNU Project Debugger (GDB) on the Target<span class="permalink"><a alt="Permalink" title="Permalink" href="#debugging-with-the-gnu-project-debugger-gdb-on-the-target">¶</a></span></h2></div></div></div><p>
            The previous section addressed using GDB remotely for debugging
            purposes, which is the most usual case due to the inherent
            hardware limitations on many embedded devices.
            However, debugging in the target hardware itself is also possible
            with more powerful devices.
            This section describes what you need to do in order to support
            using GDB to debug on the target hardware.
        </p><p>
            To support this kind of debugging, you need do the following:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    Ensure that GDB is on the target.
                    You can do this by adding "gdb" to
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_INSTALL" target="_top"><code class="filename">IMAGE_INSTALL</code></a>:
                    </p><pre class="literallayout">
     IMAGE_INSTALL_append = " gdb"
                    </pre><p>
                    Alternatively, you can add "tools-debug" to
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-IMAGE_FEATURES" target="_top"><code class="filename">IMAGE_FEATURES</code></a>:
                    </p><pre class="literallayout">
     IMAGE_FEATURES_append = " tools-debug"
                    </pre><p>
                    </p></li><li class="listitem"><p>
                    Ensure that debug symbols are present.
                    You can make sure these symbols are present by installing
                    <code class="filename">-dbg</code>:
                    </p><pre class="literallayout">
     IMAGE_INSTALL_append = " <em class="replaceable"><code>packagename</code></em>-dbg"
                    </pre><p>
                    Alternatively, you can do the following to include all the
                    debug symbols:
                    </p><pre class="literallayout">
     IMAGE_FEATURES_append = " dbg-pkgs"
                    </pre><p>
                    </p></li></ul></div><p>
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                To improve the debug information accuracy, you can reduce the
                level of optimization used by the compiler.
                For example, when adding the following line to your
                <code class="filename">local.conf</code> file, you will reduce
                optimization from
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-FULL_OPTIMIZATION" target="_top"><code class="filename">FULL_OPTIMIZATION</code></a>
                of "-O2" to
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DEBUG_OPTIMIZATION" target="_top"><code class="filename">DEBUG_OPTIMIZATION</code></a>
                of "-O -fno-omit-frame-pointer":
                <pre class="literallayout">
     DEBUG_BUILD = "1"
                </pre>
                Consider that this will reduce the application's performance
                and is recommended only for debugging purposes.
            </div><p>
        </p></div><div class="section" title="5.28. Debugging Parallel Make Races"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="debugging-parallel-make-races">5.28. Debugging Parallel Make Races<span class="permalink"><a alt="Permalink" title="Permalink" href="#debugging-parallel-make-races">¶</a></span></h2></div></div></div><p>
            A parallel <code class="filename">make</code> race occurs when the build
            consists of several parts that are run simultaneously and
            a situation occurs when the output or result of one
            part is not ready for use with a different part of the build that
            depends on that output.
            Parallel make races are annoying and can sometimes be difficult
            to reproduce and fix.
            However, some simple tips and tricks exist that can help
            you debug and fix them.
            This section presents a real-world example of an error encountered
            on the Yocto Project autobuilder and the process used to fix it.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                If you cannot properly fix a <code class="filename">make</code> race
                condition, you can work around it by clearing either the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PARALLEL_MAKE" target="_top"><code class="filename">PARALLEL_MAKE</code></a>
                or
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PARALLEL_MAKEINST" target="_top"><code class="filename">PARALLEL_MAKEINST</code></a>
                variables.
            </div><p>
        </p><div class="section" title="5.28.1. The Failure"><div class="titlepage"><div><div><h3 class="title" id="the-failure">5.28.1. The Failure<span class="permalink"><a alt="Permalink" title="Permalink" href="#the-failure">¶</a></span></h3></div></div></div><p>
                For this example, assume that you are building an image that
                depends on the "neard" package.
                And, during the build, BitBake runs into problems and
                creates the following output.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    This example log file has longer lines artificially
                    broken to make the listing easier to read.
                </div><p>
                If you examine the output or the log file, you see the
                failure during <code class="filename">make</code>:
                </p><pre class="literallayout">
     | DEBUG: SITE files ['endian-little', 'bit-32', 'ix86-common', 'common-linux', 'common-glibc', 'i586-linux', 'common']
     | DEBUG: Executing shell function do_compile
     | NOTE: make -j 16
     | make --no-print-directory all-am
     | /bin/mkdir -p include/near
     | /bin/mkdir -p include/near
     | /bin/mkdir -p include/near
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/types.h include/near/types.h
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/log.h include/near/log.h
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/plugin.h include/near/plugin.h
     | /bin/mkdir -p include/near
     | /bin/mkdir -p include/near
     | /bin/mkdir -p include/near
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/tag.h include/near/tag.h
     | /bin/mkdir -p include/near
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/adapter.h include/near/adapter.h
     | /bin/mkdir -p include/near
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/ndef.h include/near/ndef.h
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/tlv.h include/near/tlv.h
     | /bin/mkdir -p include/near
     | /bin/mkdir -p include/near
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/setting.h include/near/setting.h
     | /bin/mkdir -p include/near
     | /bin/mkdir -p include/near
     | /bin/mkdir -p include/near
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/device.h include/near/device.h
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/nfc_copy.h include/near/nfc_copy.h
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/snep.h include/near/snep.h
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/version.h include/near/version.h
     | ln -s /home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/work/i586-poky-linux/neard/
       0.14-r0/neard-0.14/include/dbus.h include/near/dbus.h
     | ./src/genbuiltin nfctype1 nfctype2 nfctype3 nfctype4 p2p &gt; src/builtin.h
     | i586-poky-linux-gcc  -m32 -march=i586 --sysroot=/home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/
       build/build/tmp/sysroots/qemux86 -DHAVE_CONFIG_H -I. -I./include -I./src -I./gdbus  -I/home/pokybuild/
       yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/sysroots/qemux86/usr/include/glib-2.0
       -I/home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/tmp/sysroots/qemux86/usr/
       lib/glib-2.0/include  -I/home/pokybuild/yocto-autobuilder/yocto-slave/nightly-x86/build/build/
       tmp/sysroots/qemux86/usr/include/dbus-1.0 -I/home/pokybuild/yocto-autobuilder/yocto-slave/
       nightly-x86/build/build/tmp/sysroots/qemux86/usr/lib/dbus-1.0/include  -I/home/pokybuild/yocto-autobuilder/
       yocto-slave/nightly-x86/build/build/tmp/sysroots/qemux86/usr/include/libnl3
       -DNEAR_PLUGIN_BUILTIN -DPLUGINDIR=\""/usr/lib/near/plugins"\"
       -DCONFIGDIR=\""/etc/neard\"" -O2 -pipe -g -feliminate-unused-debug-types -c
       -o tools/snep-send.o tools/snep-send.c
     | In file included from tools/snep-send.c:16:0:
     | tools/../src/near.h:41:23: fatal error: near/dbus.h: No such file or directory
     |  #include &lt;near/dbus.h&gt;
     |                        ^
     | compilation terminated.
     | make[1]: *** [tools/snep-send.o] Error 1
     | make[1]: *** Waiting for unfinished jobs....
     | make: *** [all] Error 2
     | ERROR: oe_runmake failed
                </pre><p>
            </p></div><div class="section" title="5.28.2. Reproducing the Error"><div class="titlepage"><div><div><h3 class="title" id="reproducing-the-error">5.28.2. Reproducing the Error<span class="permalink"><a alt="Permalink" title="Permalink" href="#reproducing-the-error">¶</a></span></h3></div></div></div><p>
                Because race conditions are intermittent, they do not
                manifest themselves every time you do the build.
                In fact, most times the build will complete without problems
                even though the potential race condition exists.
                Thus, once the error surfaces, you need a way to reproduce it.
            </p><p>
                In this example, compiling the "neard" package is causing the
                problem.
                So the first thing to do is build "neard" locally.
                Before you start the build, set the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-PARALLEL_MAKE" target="_top"><code class="filename">PARALLEL_MAKE</code></a>
                variable in your <code class="filename">local.conf</code> file to
                a high number (e.g. "-j 20").
                Using a high value for <code class="filename">PARALLEL_MAKE</code>
                increases the chances of the race condition showing up:
                </p><pre class="literallayout">
     $ bitbake neard
                </pre><p>
            </p><p>
                Once the local build for "neard" completes, start a
                <code class="filename">devshell</code> build:
                </p><pre class="literallayout">
     $ bitbake neard -c devshell
                </pre><p>
                For information on how to use a
                <code class="filename">devshell</code>, see the
                "<a class="link" href="#platdev-appdev-devshell" title="4.5. Using a Development Shell">Using a Development Shell</a>"
                section.
            </p><p>
                In the <code class="filename">devshell</code>, do the following:
                </p><pre class="literallayout">
     $ make clean
     $ make tools/snep-send.o
                </pre><p>
                The <code class="filename">devshell</code> commands cause the failure
                to clearly be visible.
                In this case, a missing dependency exists for the "neard"
                Makefile target.
                Here is some abbreviated, sample output with the
                missing dependency clearly visible at the end:
                </p><pre class="literallayout">
     i586-poky-linux-gcc  -m32 -march=i586 --sysroot=/home/scott-lenovo/......
        .
        .
        .
     tools/snep-send.c
     In file included from tools/snep-send.c:16:0:
     tools/../src/near.h:41:23: fatal error: near/dbus.h: No such file or directory
      #include &lt;near/dbus.h&gt;
                       ^
     compilation terminated.
     make: *** [tools/snep-send.o] Error 1
     $
                </pre><p>
            </p></div><div class="section" title="5.28.3. Creating a Patch for the Fix"><div class="titlepage"><div><div><h3 class="title" id="creating-a-patch-for-the-fix">5.28.3. Creating a Patch for the Fix<span class="permalink"><a alt="Permalink" title="Permalink" href="#creating-a-patch-for-the-fix">¶</a></span></h3></div></div></div><p>
                Because there is a missing dependency for the Makefile
                target, you need to patch the
                <code class="filename">Makefile.am</code> file, which is generated
                from <code class="filename">Makefile.in</code>.
                You can use Quilt to create the patch:
                </p><pre class="literallayout">
     $ quilt new parallelmake.patch
     Patch patches/parallelmake.patch is now on top
     $ quilt add Makefile.am
     File Makefile.am added to patch patches/parallelmake.patch
                </pre><p>
                For more information on using Quilt, see the
                "<a class="link" href="#using-a-quilt-workflow" title="4.3.2. Using Quilt in Your Workflow">Using Quilt in Your Workflow</a>"
                section.
            </p><p>
                At this point you need to make the edits to
                <code class="filename">Makefile.am</code> to add the missing
                dependency.
                For our example, you have to add the following line
                to the file:
                </p><pre class="literallayout">
     tools/snep-send.$(OBJEXT): include/near/dbus.h
                </pre><p>
            </p><p>
                Once you have edited the file, use the
                <code class="filename">refresh</code> command to create the patch:
                </p><pre class="literallayout">
     $ quilt refresh
     Refreshed patch patches/parallelmake.patch
                </pre><p>
                Once the patch file exists, you need to add it back to the
                originating recipe folder.
                Here is an example assuming a top-level
                <a class="link" href="#source-directory">Source Directory</a>
                named <code class="filename">poky</code>:
                </p><pre class="literallayout">
     $ cp patches/parallelmake.patch poky/meta/recipes-connectivity/neard/neard
                </pre><p>
                The final thing you need to do to implement the fix in the
                build is to update the "neard" recipe (i.e.
                <code class="filename">neard-0.14.bb</code>) so that the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-SRC_URI" target="_top"><code class="filename">SRC_URI</code></a>
                statement includes the patch file.
                The recipe file is in the folder above the patch.
                Here is what the edited <code class="filename">SRC_URI</code>
                statement would look like:
                </p><pre class="literallayout">
     SRC_URI = "${KERNELORG_MIRROR}/linux/network/nfc/${BPN}-${PV}.tar.xz \
                file://neard.in \
                file://neard.service.in \
                file://parallelmake.patch \
               "
                </pre><p>
            </p><p>
                With the patch complete and moved to the correct folder and
                the <code class="filename">SRC_URI</code> statement updated, you can
                exit the <code class="filename">devshell</code>:
                </p><pre class="literallayout">
     $ exit
                </pre><p>
            </p></div><div class="section" title="5.28.4. Testing the Build"><div class="titlepage"><div><div><h3 class="title" id="testing-the-build">5.28.4. Testing the Build<span class="permalink"><a alt="Permalink" title="Permalink" href="#testing-the-build">¶</a></span></h3></div></div></div><p>
                With everything in place, you can get back to trying the
                build again locally:
                </p><pre class="literallayout">
     $ bitbake neard
                </pre><p>
                This build should succeed.
            </p><p>
                Now you can open up a <code class="filename">devshell</code> again
                and repeat the clean and make operations as follows:
                </p><pre class="literallayout">
     $ bitbake neard -c devshell
     $ make clean
     $ make tools/snep-send.o
                </pre><p>
                The build should work without issue.
            </p><p>
                As with all solved problems, if they originated upstream, you
                need to submit the fix for the recipe in OE-Core and upstream
                so that the problem is taken care of at its source.
                See the
                "<a class="link" href="#how-to-submit-a-change" title="3.9. How to Submit a Change">How to Submit a Change</a>"
                section for more information.
            </p></div></div><div class="section" title="5.29. Maintaining Open Source License Compliance During Your Product's Lifecycle"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="maintaining-open-source-license-compliance-during-your-products-lifecycle">5.29. Maintaining Open Source License Compliance During Your Product's Lifecycle<span class="permalink"><a alt="Permalink" title="Permalink" href="#maintaining-open-source-license-compliance-during-your-products-lifecycle">¶</a></span></h2></div></div></div><p>
            One of the concerns for a development organization using open source
            software is how to maintain compliance with various open source
            licensing during the lifecycle of the product.
            While this section does not provide legal advice or
            comprehensively cover all scenarios, it does
            present methods that you can use to
            assist you in meeting the compliance requirements during a software
            release.
        </p><p>
            With hundreds of different open source licenses that the Yocto
            Project tracks, it is difficult to know the requirements of each
            and every license.
            However, the requirements of the major FLOSS licenses can begin
            to be covered by
            assuming that three main areas of concern exist:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Source code must be provided.</p></li><li class="listitem"><p>License text for the software must be
                    provided.</p></li><li class="listitem"><p>Compilation scripts and modifications to the
                    source code must be provided.
                    </p></li></ul></div><p>
            There are other requirements beyond the scope of these
            three and the methods described in this section
            (e.g. the mechanism through which source code is distributed).
        </p><p>
            As different organizations have different methods of complying with
            open source licensing, this section is not meant to imply that
            there is only one single way to meet your compliance obligations,
            but rather to describe one method of achieving compliance.
            The remainder of this section describes methods supported to meet the
            previously mentioned three requirements.
            Once you take steps to meet these requirements,
            and prior to releasing images, sources, and the build system,
            you should audit all artifacts to ensure completeness.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                The Yocto Project generates a license manifest during
                image creation that is located
                in <code class="filename">${DEPLOY_DIR}/licenses/<em class="replaceable"><code>image_name-datestamp</code></em></code>
                to assist with any audits.
            </div><p>
        </p><div class="section" title="5.29.1. Providing the Source Code"><div class="titlepage"><div><div><h3 class="title" id="providing-the-source-code">5.29.1. Providing the Source Code<span class="permalink"><a alt="Permalink" title="Permalink" href="#providing-the-source-code">¶</a></span></h3></div></div></div><p>
                Compliance activities should begin before you generate the
                final image.
                The first thing you should look at is the requirement that
                tops the list for most compliance groups - providing
                the source.
                The Yocto Project has a few ways of meeting this
                requirement.
            </p><p>
                One of the easiest ways to meet this requirement is
                to provide the entire
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-DL_DIR" target="_top"><code class="filename">DL_DIR</code></a>
                used by the build.
                This method, however, has a few issues.
                The most obvious is the size of the directory since it includes
                all sources used in the build and not just the source used in
                the released image.
                It will include toolchain source, and other artifacts, which
                you would not generally release.
                However, the more serious issue for most companies is accidental
                release of proprietary software.
                The Yocto Project provides an
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-archiver" target="_top"><code class="filename">archiver</code></a>
                class to help avoid some of these concerns.
            </p><p>
                Before you employ <code class="filename">DL_DIR</code> or the
                <code class="filename">archiver</code> class, you need to decide how
                you choose to provide source.
                The source <code class="filename">archiver</code> class can generate
                tarballs and SRPMs and can create them with various levels of
                compliance in mind.
            </p><p>
                One way of doing this (but certainly not the only way) is to
                release just the source as a tarball.
                You can do this by adding the following to the
                <code class="filename">local.conf</code> file found in the
                <a class="link" href="#build-directory">Build Directory</a>:
                </p><pre class="literallayout">
     INHERIT += "archiver"
     ARCHIVER_MODE[src] = "original"
                </pre><p>
                During the creation of your image, the source from all
                recipes that deploy packages to the image is placed within
                subdirectories of
                <code class="filename">DEPLOY_DIR/sources</code> based on the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LICENSE" target="_top"><code class="filename">LICENSE</code></a>
                for each recipe.
                Releasing the entire directory enables you to comply with
                requirements concerning providing the unmodified source.
                It is important to note that the size of the directory can
                get large.
            </p><p>
                A way to help mitigate the size issue is to only release
                tarballs for licenses that require the release of
                source.
                Let us assume you are only concerned with GPL code as
                identified by running the following script:
                </p><pre class="literallayout">
     # Script to archive a subset of packages matching specific license(s)
     # Source and license files are copied into sub folders of package folder
     # Must be run from build folder
     #!/bin/bash
     src_release_dir="source-release"
     mkdir -p $src_release_dir
     for a in tmp/deploy/sources/*; do
        for d in $a/*; do
           # Get package name from path
           p=`basename $d`
           p=${p%-*}
           p=${p%-*}
           # Only archive GPL packages (update *GPL* regex for your license check)
           numfiles=`ls tmp/deploy/licenses/$p/*GPL* 2&gt; /dev/null | wc -l`
           if [ $numfiles -gt 1 ]; then
              echo Archiving $p
              mkdir -p $src_release_dir/$p/source
              cp $d/* $src_release_dir/$p/source 2&gt; /dev/null
              mkdir -p $src_release_dir/$p/license
              cp tmp/deploy/licenses/$p/* $src_release_dir/$p/license 2&gt; /dev/null
           fi
        done
     done                </pre><p>
                At this point, you could create a tarball from the
                <code class="filename">gpl_source_release</code> directory and
                provide that to the end user.
                This method would be a step toward achieving compliance
                with section 3a of GPLv2 and with section 6 of GPLv3.
            </p></div><div class="section" title="5.29.2. Providing License Text"><div class="titlepage"><div><div><h3 class="title" id="providing-license-text">5.29.2. Providing License Text<span class="permalink"><a alt="Permalink" title="Permalink" href="#providing-license-text">¶</a></span></h3></div></div></div><p>
                One requirement that is often overlooked is inclusion
                of license text.
                This requirement also needs to be dealt with prior to
                generating the final image.
                Some licenses require the license text to accompany
                the binary.
                You can achieve this by adding the following to your
                <code class="filename">local.conf</code> file:
                </p><pre class="literallayout">
     COPY_LIC_MANIFEST = "1"
     COPY_LIC_DIRS = "1"
     LICENSE_CREATE_PACKAGE = "1"
                </pre><p>
                Adding these statements to the configuration file ensures
                that the licenses collected during package generation
                are included on your image.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Setting all three variables to "1" results in the
                    image having two copies of the same license file.
                    One copy resides in
                    <code class="filename">/usr/share/common-licenses</code> and
                    the other resides in
                    <code class="filename">/usr/share/license</code>.</p><p>The reason for this behavior is because
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-COPY_LIC_DIRS" target="_top"><code class="filename">COPY_LIC_DIRS</code></a>
                    and
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-COPY_LIC_MANIFEST" target="_top"><code class="filename">COPY_LIC_MANIFEST</code></a>
                    add a copy of the license when the image is built but do
                    not offer a path for adding licenses for newly installed
                    packages to an image.
                    <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LICENSE_CREATE_PACKAGE" target="_top"><code class="filename">LICENSE_CREATE_PACKAGE</code></a>
                    adds a separate package and an upgrade path for adding
                    licenses to an image.</p></div><p>
            </p><p>
                As the source <code class="filename">archiver</code> class has already
                archived the original
                unmodified source that contains the license files,
                you would have already met the requirements for inclusion
                of the license information with source as defined by the GPL
                and other open source licenses.
            </p></div><div class="section" title="5.29.3. Providing Compilation Scripts and Source Code Modifications"><div class="titlepage"><div><div><h3 class="title" id="providing-compilation-scripts-and-source-code-modifications">5.29.3. Providing Compilation Scripts and Source Code Modifications<span class="permalink"><a alt="Permalink" title="Permalink" href="#providing-compilation-scripts-and-source-code-modifications">¶</a></span></h3></div></div></div><p>
                At this point, we have addressed all we need to
                prior to generating the image.
                The next two requirements are addressed during the final
                packaging of the release.
            </p><p>
                By releasing the version of the OpenEmbedded build system
                and the layers used during the build, you will be providing both
                compilation scripts and the source code modifications in one
                step.
            </p><p>
                If the deployment team has a
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/bsp-guide/bsp-guide.html#bsp-layers" target="_top">BSP layer</a>
                and a distro layer, and those those layers are used to patch,
                compile, package, or modify (in any way) any open source
                software included in your released images, you
                might be required to release those layers under section 3 of
                GPLv2 or section 1 of GPLv3.
                One way of doing that is with a clean
                checkout of the version of the Yocto Project and layers used
                during your build.
                Here is an example:
                </p><pre class="literallayout">
     # We built using the pyro branch of the poky repo
     $ git clone -b pyro git://git.yoctoproject.org/poky
     $ cd poky
     # We built using the release_branch for our layers
     $ git clone -b release_branch git://git.mycompany.com/meta-my-bsp-layer
     $ git clone -b release_branch git://git.mycompany.com/meta-my-software-layer
     # clean up the .git repos
     $ find . -name ".git" -type d -exec rm -rf {} \;
                </pre><p>
                One thing a development organization might want to consider
                for end-user convenience is to modify
                <code class="filename">meta-poky/conf/bblayers.conf.sample</code> to
                ensure that when the end user utilizes the released build
                system to build an image, the development organization's
                layers are included in the <code class="filename">bblayers.conf</code>
                file automatically:
                </p><pre class="literallayout">
     # LAYER_CONF_VERSION is increased each time build/conf/bblayers.conf
     # changes incompatibly
     LCONF_VERSION = "6"

     BBPATH = "${TOPDIR}"
     BBFILES ?= ""

     BBLAYERS ?= " \
       ##OEROOT##/meta \
       ##OEROOT##/meta-poky \
       ##OEROOT##/meta-yocto-bsp \
       ##OEROOT##/meta-mylayer \
       "
                </pre><p>
                Creating and providing an archive of the
                <a class="link" href="#metadata">Metadata</a> layers
                (recipes, configuration files, and so forth)
                enables you to meet your
                requirements to include the scripts to control compilation
                as well as any modifications to the original source.
            </p></div></div><div class="section" title="5.30. Using the Error Reporting Tool"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="using-the-error-reporting-tool">5.30. Using the Error Reporting Tool<span class="permalink"><a alt="Permalink" title="Permalink" href="#using-the-error-reporting-tool">¶</a></span></h2></div></div></div><p>
            The error reporting tool allows you to
            submit errors encountered during builds to a central database.
            Outside of the build environment, you can use a web interface to
            browse errors, view statistics, and query for errors.
            The tool works using a client-server system where the client
            portion is integrated with the installed Yocto Project
            <a class="link" href="#source-directory">Source Directory</a>
            (e.g. <code class="filename">poky</code>).
            The server receives the information collected and saves it in a
            database.
        </p><p>
            A live instance of the error reporting server exists at
            <a class="ulink" href="http://errors.yoctoproject.org" target="_top">http://errors.yoctoproject.org</a>.
            This server exists so that when you want to get help with
            build failures, you can submit all of the information on the
            failure easily and then point to the URL in your bug report
            or send an email to the mailing list.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                If you send error reports to this server, the reports become
                publicly visible.
            </div><p>
        </p><div class="section" title="5.30.1. Enabling and Using the Tool"><div class="titlepage"><div><div><h3 class="title" id="enabling-and-using-the-tool">5.30.1. Enabling and Using the Tool<span class="permalink"><a alt="Permalink" title="Permalink" href="#enabling-and-using-the-tool">¶</a></span></h3></div></div></div><p>
                By default, the error reporting tool is disabled.
                You can enable it by inheriting the
                <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#ref-classes-report-error" target="_top"><code class="filename">report-error</code></a>
                class by adding the following statement to the end of
                your <code class="filename">local.conf</code> file in your
                <a class="link" href="#build-directory">Build Directory</a>.
                </p><pre class="literallayout">
     INHERIT += "report-error"
                </pre><p>
            </p><p>
                By default, the error reporting feature stores information in
                <code class="filename">${</code><a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#var-LOG_DIR" target="_top"><code class="filename">LOG_DIR</code></a><code class="filename">}/error-report</code>.
                However, you can specify a directory to use by adding the following
                to your <code class="filename">local.conf</code> file:
                </p><pre class="literallayout">
     ERR_REPORT_DIR = "path"
                </pre><p>
                Enabling error reporting causes the build process to collect
                the errors and store them in a file as previously described.
                When the build system encounters an error, it includes a
                command as part of the console output.
                You can run the command to send the error file to the server.
                For example, the following command sends the errors to an
                upstream server:
                </p><pre class="literallayout">
     $ send-error-report /home/brandusa/project/poky/build/tmp/log/error-report/error_report_201403141617.txt
                </pre><p>
                In the previous example, the errors are sent to a public
                database available at
                <a class="ulink" href="http://errors.yoctoproject.org" target="_top">http://errors.yoctoproject.org</a>, which is
                used by the entire community.
                If you specify a particular server, you can send the errors
                to a different database.
                Use the following command for more information on available
                options:
                </p><pre class="literallayout">
     $ send-error-report --help
                </pre><p>
            </p><p>
                When sending the error file, you are prompted to review the
                data being sent as well as to provide a name and optional
                email address.
                Once you satisfy these prompts, the command returns a link
                from the server that corresponds to your entry in the database.
                For example, here is a typical link:
                </p><pre class="literallayout">
     http://errors.yoctoproject.org/Errors/Details/9522/
                </pre><p>
                Following the link takes you to a web interface where you can
                browse, query the errors, and view statistics.
             </p></div><div class="section" title="5.30.2. Disabling the Tool"><div class="titlepage"><div><div><h3 class="title" id="disabling-the-tool">5.30.2. Disabling the Tool<span class="permalink"><a alt="Permalink" title="Permalink" href="#disabling-the-tool">¶</a></span></h3></div></div></div><p>
                To disable the error reporting feature, simply remove or comment
                out the following statement from the end of your
                <code class="filename">local.conf</code> file in your
                <a class="link" href="#build-directory">Build Directory</a>.
                </p><pre class="literallayout">
     INHERIT += "report-error"
                </pre><p>
            </p></div><div class="section" title="5.30.3. Setting Up Your Own Error Reporting Server"><div class="titlepage"><div><div><h3 class="title" id="setting-up-your-own-error-reporting-server">5.30.3. Setting Up Your Own Error Reporting Server<span class="permalink"><a alt="Permalink" title="Permalink" href="#setting-up-your-own-error-reporting-server">¶</a></span></h3></div></div></div><p>
                If you want to set up your own error reporting server, you
                can obtain the code from the Git repository at
                <a class="ulink" href="http://git.yoctoproject.org/cgit/cgit.cgi/error-report-web/" target="_top">http://git.yoctoproject.org/cgit/cgit.cgi/error-report-web/</a>.
                Instructions on how to set it up are in the README document.
            </p></div></div></div>

    <div class="chapter" title="Chapter 6. Using the Quick EMUlator (QEMU)" id="dev-manual-qemu"><div class="titlepage"><div><div><h2 class="title">Chapter 6. Using the Quick EMUlator (QEMU)<span class="permalink"><a alt="Permalink" title="Permalink" href="#dev-manual-qemu">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="#qemu-overview">6.1. Overview</a></span></dt><dt><span class="section"><a href="#qemu-running-qemu">6.2. Running QEMU</a></span></dt><dd><dl><dt><span class="section"><a href="#qemu-setting-up-the-environment">6.2.1. Setting Up the Environment</a></span></dt><dt><span class="section"><a href="#qemu-using-the-runqemu-command">6.2.2. Using the <code class="filename">runqemu</code> Command</a></span></dt></dl></dd><dt><span class="section"><a href="#qemu-running-under-a-network-file-system-nfs-server">6.3. Running Under a Network File System (NFS) Server</a></span></dt><dd><dl><dt><span class="section"><a href="#qemu-setting-up-to-use-nfs">6.3.1. Setting Up to Use NFS</a></span></dt><dt><span class="section"><a href="#qemu-starting-and-stopping-nfs">6.3.2. Starting and Stopping NFS</a></span></dt></dl></dd><dt><span class="section"><a href="#qemu-tips-and-tricks">6.4. Tips and Tricks</a></span></dt></dl></div><p>
    Quick EMUlator (QEMU) is an Open Source project the Yocto Project uses
    as part of its development "tool set".
    As such, the information in this chapter is limited to the
    Yocto Project integration of QEMU and not QEMU in general.
    For official information and documentation on QEMU, see the
    following references:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><a class="ulink" href="http://wiki.qemu.org/Main_Page" target="_top">QEMU Website</a>:</em></span>
            The official website for the QEMU Open Source project.
            </p></li><li class="listitem"><p><span class="emphasis"><em><a class="ulink" href="http://wiki.qemu.org/Manual" target="_top">Documentation</a>:</em></span>
            The QEMU user manual.
            </p></li></ul></div><p>
</p><p>
    This chapter provides an overview of the Yocto Project's integration of
    QEMU, a description of how you use QEMU and its various options, running
    under a Network File System (NFS) server, and a few tips and tricks you
    might find helpful when using QEMU.
</p><div class="section" title="6.1. Overview"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="qemu-overview">6.1. Overview<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-overview">¶</a></span></h2></div></div></div><p>
        Within the context of the Yocto Project, QEMU is an
        emulator and virtualization machine that allows you to run a complete
        image you have built using the Yocto Project as just another task
        on your build system.
        QEMU is useful for running and testing images and applications on
        supported Yocto Project architectures without having actual hardware.
        Among other things, the Yocto Project uses QEMU to run automated
        Quality Assurance (QA) tests on final images shipped with each
        release.
    </p><p>
        QEMU is made available with the Yocto Project a number of ways.
        One method is to install a Software Development Kit (SDK).
        For more information on how to make sure you have
        QEMU available, see the
        <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/sdk-manual/sdk-manual.html#sdk-intro" target="_top">Yocto Project Software Development Kit (SDK) Developer's Guide</a>.
    </p></div><div class="section" title="6.2. Running QEMU"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="qemu-running-qemu">6.2. Running QEMU<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-running-qemu">¶</a></span></h2></div></div></div><p>
        Running QEMU involves having your build environment set up, having the
        right artifacts available, and understanding how to use the many
        options that are available to you when you start QEMU using the
        <code class="filename">runqemu</code> command.
    </p><div class="section" title="6.2.1. Setting Up the Environment"><div class="titlepage"><div><div><h3 class="title" id="qemu-setting-up-the-environment">6.2.1. Setting Up the Environment<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-setting-up-the-environment">¶</a></span></h3></div></div></div><p>
            You run QEMU in the same environment from which you run BitBake.
            This means you need to source a build environment script (i.e.
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>
            or
            <a class="ulink" href="http://www.yoctoproject.org/docs/2.3/ref-manual/ref-manual.html#structure-memres-core-script" target="_top"><code class="filename">oe-init-build-env-memres</code></a>).
        </p></div><div class="section" title="6.2.2. Using the runqemu Command"><div class="titlepage"><div><div><h3 class="title" id="qemu-using-the-runqemu-command">6.2.2. Using the <code class="filename">runqemu</code> Command<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-using-the-runqemu-command">¶</a></span></h3></div></div></div><p>
            The basic <code class="filename">runqemu</code> command syntax is as
            follows:
            </p><pre class="literallayout">
     $ runqemu [<em class="replaceable"><code>option</code></em> ]  [...]
            </pre><p>
            Based on what you provide on the command line,
            <code class="filename">runqemu</code> does a good job of figuring out what
            you are trying to do.
            For example, by default, QEMU looks for the most recently built
            image according to the timestamp when it needs to look for an
            image.
            Minimally, through the use of options, you must provide either
            a machine name, a virtual machine image
            (<code class="filename">*.vmdk</code>), or a kernel image
            (<code class="filename">*.bin</code>).
        </p><p>
            Following is a description of <code class="filename">runqemu</code>
            options you can provide on the command line:
            </p><div class="note" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>
                If you do provide some "illegal" option combination or perhaps
                you do not provide enough in the way of options,
                <code class="filename">runqemu</code> provides appropriate error
                messaging to help you correct the problem.
            </div><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><em class="replaceable"><code>QEMUARCH</code></em>:
                    The QEMU machine architecture, which must be "qemux86",
                    "qemux86_64", "qemuarm", "qemumips", "qemumipsel",
                    “qemumips64", "qemush4", "qemuppc", "qemumicroblaze",
                    or "qemuzynq".
                    </p></li><li class="listitem"><p><code class="filename"><em class="replaceable"><code>VM</code></em></code>:
                    The virtual machine image, which must be a
                    <code class="filename">.vmdk</code> file.
                    Use this option when you want to boot a
                    <code class="filename">.vmdk</code> image.
                    The image filename you provide must contain one of the
                    following strings: "qemux86-64", "qemux86", "qemuarm",
                    "qemumips64", "qemumips", "qemuppc", or "qemush4".
                    </p></li><li class="listitem"><p><em class="replaceable"><code>ROOTFS</code></em>:
                    A root filesystem that has one of the following
                    filetype extensions: "ext2", "ext3", "ext4", "jffs2",
                    "nfs", or "btrfs".
                    If the filename you provide for this option uses “nfs”, it
                    must provide an explicit root filesystem path.
                    </p></li><li class="listitem"><p><em class="replaceable"><code>KERNEL</code></em>:
                    A kernel image, which is a <code class="filename">.bin</code> file.
                    When you provide a <code class="filename">.bin</code> file,
                    <code class="filename">runqemu</code> detects it and assumes the
                    file is a kernel image.
                    </p></li><li class="listitem"><p><em class="replaceable"><code>MACHINE</code></em>:
                    The architecture of the QEMU machine, which must be one
                    of the following: "qemux86",
                    "qemux86-64", "qemuarm", "qemumips", "qemumipsel",
                    “qemumips64", "qemush4", "qemuppc", "qemumicroblaze",
                    or "qemuzynq".
                    The <em class="replaceable"><code>MACHINE</code></em> and
                    <em class="replaceable"><code>QEMUARCH</code></em> options are basically
                    identical.
                    If you do not provide a <em class="replaceable"><code>MACHINE</code></em>
                    option, <code class="filename">runqemu</code> tries to determine
                    it based on other options.
                    </p></li><li class="listitem"><p><code class="filename">ramfs</code>:
                    Indicates you are booting an initial RAM disk (initramfs)
                    image, which means the <code class="filename">FSTYPE</code> is
                    <code class="filename">cpio.gz</code>.
                    </p></li><li class="listitem"><p><code class="filename">iso</code>:
                    Indicates you are booting an ISO image, which means the
                    <code class="filename">FSTYPE</code> is
                    <code class="filename">.iso</code>.
                    </p></li><li class="listitem"><p><code class="filename">nographic</code>:
                    Disables the video console, which sets the console to
                    "ttys0".
                    </p></li><li class="listitem"><p><code class="filename">serial</code>:
                    Enables a serial console on
                    <code class="filename">/dev/ttyS0</code>.
                    </p></li><li class="listitem"><p><code class="filename">biosdir</code>:
                    Establishes a custom directory for BIOS, VGA BIOS and
                    keymaps.
                    </p></li><li class="listitem"><p><code class="filename">biosfilename</code>:
                    Establishes a custom BIOS name.
                    </p></li><li class="listitem"><p><code class="filename">qemuparams=\"<em class="replaceable"><code>xyz</code></em>\"</code>:
                    Specifies custom QEMU parameters.
                    Use this option to pass options other than the simple
                    "kvm" and "serial" options.
                    </p></li><li class="listitem"><p><code class="filename">bootparams=\"<em class="replaceable"><code>xyz</code></em>\"</code>:
                    Specifies custom boot parameters for the kernel.
                    </p></li><li class="listitem"><p><code class="filename">audio</code>:
                    Enables audio in QEMU.
                    The <em class="replaceable"><code>MACHINE</code></em> option must be
                    either "qemux86" or "qemux86-64" in order for audio to be
                    enabled.
                    Additionally, the <code class="filename">snd_intel8x0</code>
                    or <code class="filename">snd_ens1370</code> driver must be
                    installed in linux guest.
                    </p></li><li class="listitem"><p><code class="filename">slirp</code>:
                    Enables "slirp" networking, which is a different way
                    of networking that does not need root access
                    but also is not as easy to use or comprehensive
                    as the default.
                    </p></li><li class="listitem"><p><a id="kvm-cond"></a><code class="filename">kvm</code>:
                    Enables KVM when running "qemux86" or "qemux86-64"
                    QEMU architectures.
                    For KVM to work, all the following conditions must be met:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>
                            Your <em class="replaceable"><code>MACHINE</code></em> must be either
qemux86" or "qemux86-64".
                            </p></li><li class="listitem"><p>
                            Your build host has to have the KVM modules
                            installed, which are
                            <code class="filename">/dev/kvm</code>.
                            </p></li><li class="listitem"><p>
                            The  build host <code class="filename">/dev/kvm</code>
                            directory has to be both writable and readable.
                            </p></li></ul></div><p>
                    </p></li><li class="listitem"><p><code class="filename">kvm-vhost</code>:
                    Enables KVM with VHOST support when running "qemux86" or "qemux86-64"
                    QEMU architectures.
                    For KVM with VHOST to work, the following conditions must
                    be met:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>
                            <a class="link" href="#kvm-cond">kvm</a> option
                            conditions must be met.
                            </p></li><li class="listitem"><p>
                            Your build host has to have virtio net device, which
                            are <code class="filename">/dev/vhost-net</code>.
                            </p></li><li class="listitem"><p>
                            The build host <code class="filename">/dev/vhost-net</code>
                            directory has to be either readable or writable
                            and “slirp-enabled”.
                            </p></li></ul></div><p>
                    </p></li><li class="listitem"><p><code class="filename">publicvnc</code>:
                    Enables a VNC server open to all hosts.
                    </p></li></ul></div><p>
        </p><p>
            For further understanding regarding option use with
            <code class="filename">runqemu</code>, consider some examples.
        </p><p>
            This example starts QEMU with
            <em class="replaceable"><code>MACHINE</code></em> set to "qemux86".
            Assuming a standard
            <a class="link" href="#build-directory">Build Directory</a>,
            <code class="filename">runqemu</code> automatically finds the
            <code class="filename">bzImage-qemux86.bin</code> image file and
            the
            <code class="filename">core-image-minimal-qemux86-20140707074611.rootfs.ext3</code>
            (assuming the current build created a
            <code class="filename">core-image-minimal</code> image).
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                When more than one image with the same name exists, QEMU finds
                and uses the most recently built image according to the
                timestamp.
            </div><p>
            </p><pre class="literallayout">
    $ runqemu qemux86
            </pre><p>
            This example produces the exact same results as the
            previous example.
            This command, however, specifically provides the image
            and root filesystem type.
            </p><pre class="literallayout">
     $ runqemu qemux86 core-image-minimal ext3
            </pre><p>
            This example specifies to boot an initial RAM disk image
            and to enable audio in QEMU.
            For this case, <code class="filename">runqemu</code> set the
            internal variable <code class="filename">FSTYPE</code> to
            "cpio.gz".
            Also, for audio to be enabled, an appropriate driver must
            be installed (see the previous description for the
            <code class="filename">audio</code> option for more information).
            </p><pre class="literallayout">
     $ runqemu qemux86 ramfs audio
            </pre><p>
            This example does not provide enough information for
            QEMU to launch.
            While the command does provide a root filesystem type, it
            must also minimally provide a
            <em class="replaceable"><code>MACHINE</code></em>,
            <em class="replaceable"><code>KERNEL</code></em>, or
            <em class="replaceable"><code>VM</code></em> option.
            </p><pre class="literallayout">
     $ runqemu ext3
            </pre><p>
            This example specifies to boot a virtual machine image
            (<code class="filename">.vmdk</code> file).
            From the <code class="filename">.vmdk</code>,
            <code class="filename">runqemu</code> determines the QEMU
            architecture (<em class="replaceable"><code>MACHINE</code></em>) to be
            "qemux86" and the root filesystem type to be "vmdk".
            </p><pre class="literallayout">
     $ runqemu /home/scott-lenovo/vm/core-image-minimal-qemux86.vmdk
            </pre><p>
        </p></div></div><div class="section" title="6.3. Running Under a Network File System (NFS) Server"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="qemu-running-under-a-network-file-system-nfs-server">6.3. Running Under a Network File System (NFS) Server<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-running-under-a-network-file-system-nfs-server">¶</a></span></h2></div></div></div><p>
        One method for running QEMU is to run it on an NFS server.
        This is useful when you need to access the same file system from both
        the build and the emulated system at the same time.
        It is also worth noting that the system does not need root privileges
        to run.
        It uses a user space NFS server to avoid that.
        This section describes how to set up for running QEMU using an NFS
        server and then how you can start and stop the server.
    </p><div class="section" title="6.3.1. Setting Up to Use NFS"><div class="titlepage"><div><div><h3 class="title" id="qemu-setting-up-to-use-nfs">6.3.1. Setting Up to Use NFS<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-setting-up-to-use-nfs">¶</a></span></h3></div></div></div><p>
            Once you are able to run QEMU in your environment, you can use the
            <code class="filename">runqemu-extract-sdk</code> script, which is located
            in the <code class="filename">scripts</code> directory along with
            <code class="filename">runqemu</code> script.
            The <code class="filename">runqemu-extract-sdk</code> takes a root
            file system tarball and extracts it into a location that you
            specify.
            Then, when you run <code class="filename">runqemu</code>, you can specify
            the location that has the file system to pass it to QEMU.
            Here is an example that takes a file system and extracts it to
            a directory named <code class="filename">test-nfs</code>:
            </p><pre class="literallayout">
     runqemu-extract-sdk ./tmp/deploy/images/qemux86/core-image-sato-qemux86.tar.bz2 test-nfs
            </pre><p>
            Once you have extracted the file system, you can run
            <code class="filename">runqemu</code> normally with the additional
            location of the file system.
            You can then also make changes to the files within
            <code class="filename">./test-nfs</code> and see those changes appear in the
            image in real time.
            Here is an example using the <code class="filename">qemux86</code> image:
            </p><pre class="literallayout">
     runqemu qemux86 ./test-nfs
            </pre><p>
        </p></div><div class="section" title="6.3.2. Starting and Stopping NFS"><div class="titlepage"><div><div><h3 class="title" id="qemu-starting-and-stopping-nfs">6.3.2. Starting and Stopping NFS<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-starting-and-stopping-nfs">¶</a></span></h3></div></div></div><p>
            You can manually start and stop the NFS share using these
            commands:
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em><code class="filename">start</code>:</em></span>
                    Starts the NFS share:
                    </p><pre class="literallayout">
     runqemu-export-rootfs start <em class="replaceable"><code>file-system-location</code></em>
                    </pre><p>
                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">stop</code>:</em></span>
                    Stops the NFS share:
                    </p><pre class="literallayout">
     runqemu-export-rootfs stop <em class="replaceable"><code>file-system-location</code></em>
                    </pre><p>
                    </p></li><li class="listitem"><p><span class="emphasis"><em><code class="filename">restart</code>:</em></span>
                    Restarts the NFS share:
                    </p><pre class="literallayout">
     runqemu-export-rootfs restart <em class="replaceable"><code>file-system-location</code></em>
                    </pre><p>
                    </p></li></ul></div><p>
        </p></div></div><div class="section" title="6.4. Tips and Tricks"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="qemu-tips-and-tricks">6.4. Tips and Tricks<span class="permalink"><a alt="Permalink" title="Permalink" href="#qemu-tips-and-tricks">¶</a></span></h2></div></div></div><p>
        The following list describes things you can do to make running QEMU
        in the context of the Yocto Project a better experience:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Switching Between Consoles:</em></span>
                When booting or running QEMU, you can switch between
                supported consoles by using
                Ctrl+Alt+<em class="replaceable"><code>number</code></em>.
                For example, Ctrl+Alt+3 switches you to the serial console as
                long as that console is enabled.
                Being able to switch consoles is helpful, for example, if the
                main QEMU console breaks for some reason.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    Usually, "2" gets you to the main console and "3" gets you
                    to the serial console.
                </div><p>
                </p></li><li class="listitem"><p><span class="emphasis"><em>Removing the Splash Screen:</em></span>
                You can remove the splash screen when QEMU is booting by
                using Alt+left.
                Removing the splash screen allows you to see what is happening
                in the background.
                </p></li><li class="listitem"><p><span class="emphasis"><em>Disabling the Cursor Grab:</em></span>
                The default QEMU integration captures the cursor within the
                main window.
                It does this since standard mouse devices only provide relative
                input and not absolute coordinates.
                You then have to break out of the grab using the "Ctrl+Alt" key
                combination.
                However, the Yocto Project's integration of QEMU enables the
                wacom USB touch pad driver by default to allow input of absolute
                coordinates.
                This default means that the mouse can enter and leave the
                main window without the grab taking effect leading to a better
                user experience.
                </p></li></ul></div><p>
    </p></div></div>

</div></body></html>